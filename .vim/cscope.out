cscope 15 $HOME/.vim -q 0000002156 0000433438
	@/home/lyang3/work/src_son/runWorld/Application/Application.cpp

4 
	~"AµliÿtiÚ.h
"

5 
	~"../¿dio-b—»r.h
"

6 
	~"../../deviû/N‘wÜkNode.h
"

7 
	~"../QoS/QoSP¬am‘”s.h
"

8 
	~"../../compÚ’tMªag”s/N‘wÜkMªag”.h
"

9 
	~"../¿dio-b—»r-sšk.h
"

10 
	~"­¶iÿtiÚ-sšk.h
"

11 
	~"../../phy/Ée-phy.h
"

12 
	~"../../chªÃl/L‹ChªÃl.h
"

13 
	~"../../deviû/U£rEqum’t.h
"

14 
	~"../../deviû/ENodeB.h
"

15 
	~"../../lßd-·¿m‘”s.h
"

17 
	gAµliÿtiÚ
::
	$AµliÿtiÚ
()

19 
m_şassif›rP¬am‘”s
 = 
NULL
;

20 
m_qosP¬am‘”s
 = 
NULL
;

21 
m_sourû
 = 
NULL
;

22 
m_de¡š©iÚ
 = 
NULL
;

23 
m_¿dioB—»r
 = 
NULL
;

24 
m_b—»rSšk
 = 
NULL
;

25 
m_­¶iÿtiÚSšk
 = 
NULL
;

26 
	}
}

29 
	gAµliÿtiÚ
::
	$De¡roy
 ()

31 
m_şassif›rP¬am‘”s
 = 
NULL
;

32 
m_qosP¬am‘”s
 = 
NULL
;

33 
m_sourû
 = 
NULL
;

34 
m_de¡š©iÚ
 = 
NULL
;

35 
m_¿dioB—»r
 = 
NULL
;

36 
m_b—»rSšk
 = 
NULL
;

37 
m_­¶iÿtiÚSšk
 = 
NULL
;

38 
	}
}

40 
	gAµliÿtiÚ
::
	$AµliÿtiÚ
(
AµliÿtiÚTy³
 
­¶iÿtiÚTy³
)

42 
m_­¶iÿtiÚTy³
 = 
­¶iÿtiÚTy³
;

43 
	}
}

45 
	gAµliÿtiÚ
::~
	$AµliÿtiÚ
()

47 
	`De¡roy
 ();

48 
	}
}

51 
	gAµliÿtiÚ
::
	$S¹
 ()

53 #ifdeà
TEST_START_APPLICATION


54 
¡d
::
cout
 << "S¹ AµliÿtiÚ: src: " << 
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 ()

55 << " d¡: " << 
	`G‘De¡š©iÚ
 ()->
	`G‘IDN‘wÜkNode
 (è<< 
¡d
::
’dl
;

59 
m_¿dioB—»r
 = 
Ãw
 
	`RadioB—»r
 ();

60 
m_¿dioB—»r
->
	`G‘RlcEÁ™y
 ()->
	`S‘RlcEÁ™yIndex
 (
	`G‘AµliÿtiÚID
 ());

63 ià(
	`G‘Sourû
 ()->
	`G‘NodeTy³
(è=ğ
N‘wÜkNode
::
TYPE_UE
)

66 
U£rEqum’t
* 
ue
 = (U£rEqum’t*è
	`G‘Sourû
 ();

67 
ue
->
	`S‘NodeS‹
 (
N‘wÜkNode
::
STATE_ACTIVE
);

69 #ifdeà
TEST_START_APPLICATION


70 
¡d
::
cout
 << "C»©UL„adiØb—»¸bewtw“n: " << 
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 ()

71 << "‡nd " << 
ue
->
	`G‘T¬g‘Node
 ()->
	`G‘IDN‘wÜkNode
 (è<< 
¡d
::
’dl
;

74 
m_¿dioB—»r
->
	`S‘Sourû
 (
ue
);

75 
m_¿dioB—»r
->
	`S‘De¡š©iÚ
 (
ue
->
	`G‘T¬g‘Node
 ());

76 
m_¿dioB—»r
->
	`S‘CÏssif›rP¬am‘”s
 (
	`G‘CÏssif›rP¬am‘”s
 ());

77 
m_¿dioB—»r
->
	`S‘AµliÿtiÚ
 (
this
);

78 
m_¿dioB—»r
->
	`S‘QoSP¬am‘”s
 (
	`G‘QoSP¬am‘”s
 ());

80 ià(
	`G‘Sourû
 ()->
	`G‘NodeTy³
(è=ğ
N‘wÜkNode
::
TYPE_GW
)

83 
U£rEqum’t
* 
ue
 = (U£rEqum’t*è
	`G‘De¡š©iÚ
 ();

84 
ue
->
	`S‘NodeS‹
 (
N‘wÜkNode
::
STATE_ACTIVE
);

86 #ifdeà
TEST_START_APPLICATION


87 
¡d
::
cout
 << "C»©DL„adiØb—»¸bewtw“n: " << 
ue
->
	`G‘T¬g‘Node
 ()->
	`G‘IDN‘wÜkNode
 ()

88 << "‡nd " << 
ue
->
	`G‘IDN‘wÜkNode
 (è<< 
¡d
::
’dl
;

91 
m_¿dioB—»r
->
	`S‘Sourû
 (
ue
->
	`G‘T¬g‘Node
 ());

92 
m_¿dioB—»r
->
	`S‘De¡š©iÚ
 (
ue
);

93 
m_¿dioB—»r
->
	`S‘CÏssif›rP¬am‘”s
 (
	`G‘CÏssif›rP¬am‘”s
 ());

94 
m_¿dioB—»r
->
	`S‘AµliÿtiÚ
 (
this
);

95 
m_¿dioB—»r
->
	`S‘QoSP¬am‘”s
 (
	`G‘QoSP¬am‘”s
 ());

98 
m_¿dioB—»r
->
	`G‘Sourû
 ()->
	`G‘PrÙocŞSck
 ()->
	`G‘RrcEÁ™y
 ()->
	`AddRadioB—»r
 (m_radioBearer);

102 
m_­¶iÿtiÚSšk
 = 
Ãw
 
	`AµliÿtiÚSšk
 ();

103 
m_­¶iÿtiÚSšk
->
	`S‘CÏssif›rP¬am‘”s
 (
	`G‘CÏssif›rP¬am‘”s
 ());

104 
m_­¶iÿtiÚSšk
->
	`S‘SourûAµliÿtiÚ
 (
this
);

108 
m_b—»rSšk
 = 
Ãw
 
	`RadioB—»rSšk
 ();

109 
m_b—»rSšk
->
	`G‘RlcEÁ™y
 ()->
	`S‘RlcEÁ™yIndex
 (
	`G‘AµliÿtiÚID
 ());

110 
m_b—»rSšk
->
	`S‘AµliÿtiÚ
 (
m_­¶iÿtiÚSšk
);

111 
m_b—»rSšk
->
	`S‘CÏssif›rP¬am‘”s
 (
	`G‘CÏssif›rP¬am‘”s
 ());

112 
m_b—»rSšk
->
	`S‘QoSP¬am‘”s
 (
	`G‘QoSP¬am‘”s
 ());

113 ià(
	`G‘Sourû
 ()->
	`G‘NodeTy³
(è=ğ
N‘wÜkNode
::
TYPE_UE
)

115 
U£rEqum’t
* 
ue
 = (U£rEqum’t*è
	`G‘Sourû
 ();

116 
ue
->
	`S‘NodeS‹
 (
N‘wÜkNode
::
STATE_ACTIVE
);

117 
m_b—»rSšk
->
	`S‘Sourû
 (
ue
);

118 
m_b—»rSšk
->
	`S‘De¡š©iÚ
 (
ue
->
	`G‘T¬g‘Node
 ());

120 ià(
	`G‘Sourû
 ()->
	`G‘NodeTy³
(è=ğ
N‘wÜkNode
::
TYPE_GW
)

122 
U£rEqum’t
* 
ue
 = (U£rEqum’t*è
	`G‘De¡š©iÚ
 ();

123 
ue
->
	`S‘NodeS‹
 (
N‘wÜkNode
::
STATE_ACTIVE
);

124 
m_b—»rSšk
->
	`S‘Sourû
 (
ue
->
	`G‘T¬g‘Node
 ());

125 
m_b—»rSšk
->
	`S‘De¡š©iÚ
 (
ue
);

130 
m_¿dioB—»r
->
	`G‘De¡š©iÚ
(è->
	`G‘PrÙocŞSck
 ()->
	`G‘RrcEÁ™y
 ()->
	`AddRadioB—»rSšk
(
m_b—»rSšk
);

131 
m_­¶iÿtiÚSšk
->
	`S‘RadioB—»rSšk
 (
m_b—»rSšk
);

135 ià(
	`G‘Sourû
 ()->
	`G‘NodeTy³
(è=ğ
N‘wÜkNode
::
TYPE_UE
)

137 
U£rEqum’t
* 
ue
 = (U£rEqum’t*è
	`G‘Sourû
 ();

138 
L‹ChªÃl
 *
ch
 = 
ue
->
	`G‘T¬g‘Node
 ()->
	`G‘Phy
 ()->
	`G‘UlChªÃl
 ();

140 ià(!
ch
->
	`IsA‰ached
 (
ue
))

142 
ch
->
	`AddDeviû
 (
ue
);

145 
ue
->
	`MakeAùive
 ();

147 ià(
	`G‘Sourû
 ()->
	`G‘NodeTy³
(è=ğ
N‘wÜkNode
::
TYPE_GW
)

149 
U£rEqum’t
* 
ue
 = (U£rEqum’t*è
	`G‘De¡š©iÚ
 ();

150 
L‹ChªÃl
 *
ch
 = 
ue
->
	`G‘T¬g‘Node
 ()->
	`G‘Phy
 ()->
	`G‘DlChªÃl
 ();

152 ià(!
ch
->
	`IsA‰ached
 (
ue
))

154 
ch
->
	`AddDeviû
 (
ue
);

157 
ue
->
	`MakeAùive
 ();

160 #ifdeà
TEST_START_APPLICATION


161 
¡d
::
cout
 << "CREATED RADIO BEARER " << 
m_¿dioB—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚID
 ()

163 << 
m_¿dioB—»r
->
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 () << "‡nd "

164 << 
m_¿dioB—»r
->
	`G‘De¡š©iÚ
 (è->
	`G‘IDN‘wÜkNode
 ()<< 
¡d
::
’dl
;

167 
	`DoS¹
 ();

168 
	}
}

171 
	gAµliÿtiÚ
::
	$Stİ
 ()

172 {
	}
}

175 
RadioB—»r
*

176 
AµliÿtiÚ
::
	$G‘RadioB—»r
 ()

178  
m_¿dioB—»r
;

179 
	}
}

182 
	gAµliÿtiÚ
::
	$S‘AµliÿtiÚID
 (
id
)

184 
m_­¶iÿtiÚID
 = 
id
;

185 
	}
}

188 
	gAµliÿtiÚ
::
	$G‘AµliÿtiÚID
 ()

190  
m_­¶iÿtiÚID
;

191 
	}
}

195 
	gAµliÿtiÚ
::
	$S‘AµliÿtiÚTy³
 (
AµliÿtiÚTy³
 
­¶iÿtiÚTy³
)

197 
m_­¶iÿtiÚTy³
 = 
­¶iÿtiÚTy³
;

198 
	}
}

200 
	gAµliÿtiÚ
::
AµliÿtiÚTy³


201 
AµliÿtiÚ
::
	$G‘AµliÿtiÚTy³
 () const

203  
m_­¶iÿtiÚTy³
;

204 
	}
}

207 
	gAµliÿtiÚ
::
	$S‘CÏssif›rP¬am‘”s
 (
CÏssif›rP¬am‘”s
* 
ı
)

209 
m_şassif›rP¬am‘”s
 = 
ı
;

210 
	}
}

212 
CÏssif›rP¬am‘”s
*

213 
	gAµliÿtiÚ
::
	$G‘CÏssif›rP¬am‘”s
 ()

215  
m_şassif›rP¬am‘”s
;

216 
	}
}

219 
	gAµliÿtiÚ
::
	$S‘QoSP¬am‘”s
 (
QoSP¬am‘”s
* 
qos
)

221 
m_qosP¬am‘”s
 = 
qos
;

222 
	}
}

224 
QoSP¬am‘”s
*

225 
	gAµliÿtiÚ
::
	$G‘QoSP¬am‘”s
 ()

227  
m_qosP¬am‘”s
;

228 
	}
}

230 
N‘wÜkNode
*

231 
	gAµliÿtiÚ
::
	$G‘Sourû
 ()

233  
m_sourû
;

234 
	}
}

236 
N‘wÜkNode
*

237 
	gAµliÿtiÚ
::
	$G‘De¡š©iÚ
 ()

239  
m_de¡š©iÚ
;

240 
	}
}

243 
	gAµliÿtiÚ
::
	$G‘SourûPÜt
 () const

245  
m_sourûPÜt
;

246 
	}
}

249 
	gAµliÿtiÚ
::
	$G‘De¡š©iÚPÜt
 () const

251  
m_de¡š©iÚPÜt
;

252 
	}
}

255 
	gAµliÿtiÚ
::
	$S‘Sourû
 (
N‘wÜkNode
 *
sourû
)

257 
m_sourû
 = 
sourû
;

258 
	}
}

261 
	gAµliÿtiÚ
::
	$S‘De¡š©iÚ
 (
N‘wÜkNode
 *
de¡š©iÚ
)

263 
m_de¡š©iÚ
 = 
de¡š©iÚ
;

264 
	}
}

267 
	gAµliÿtiÚ
::
	$S‘SourûPÜt
 (
pÜt
)

269 
m_sourûPÜt
 = 
pÜt
;

270 
	}
}

273 
	gAµliÿtiÚ
::
	$S‘De¡š©iÚPÜt
 (
pÜt
)

275 
m_de¡š©iÚPÜt
 = 
pÜt
;

276 
	}
}

278 
	gT¿n¥ÜtPrÙocŞ
::
T¿n¥ÜtPrÙocŞTy³


279 
AµliÿtiÚ
::
	$G‘T¿n¥ÜtPrÙocŞ
 () const

281  
m_Œª¥ÜtPrÙocŞ
;

282 
	}
}

285 
	gAµliÿtiÚ
::
	$S‘T¿n¥ÜtPrÙocŞ
 (
T¿n¥ÜtPrÙocŞ
::
T¿n¥ÜtPrÙocŞTy³
 
´ÙocŞ
)

287 
m_Œª¥ÜtPrÙocŞ
 = 
´ÙocŞ
;

288 
	}
}

292 
	gAµliÿtiÚ
::
	$S‘S¹Time
 (
time
)

294 
m_¡¬tTime
 = 
time
;

295 
SimuÏtÜ
::
	`In™
()->
	`ScheduË
(
time
,

296 &
AµliÿtiÚ
::
S¹
,

297 
this
);

298 
	}
}

301 
	gAµliÿtiÚ
::
	$G‘S¹Time
 () const

303  
m_¡¬tTime
;

304 
	}
}

307 
	gAµliÿtiÚ
::
	$S‘StİTime
 (
time
)

309 
m_¡İTime
 = 
time
;

310 
SimuÏtÜ
::
	`In™
()->
	`ScheduË
(
time
 + 0.1,

311 &
AµliÿtiÚ
::
Stİ
,

312 
this
);

313 
	}
}

316 
	gAµliÿtiÚ
::
	$G‘StİTime
 () const

318  
m_¡İTime
;

319 
	}
}

322 
	gAµliÿtiÚ
::
	$T¿û
 (
Pack‘
* 
p
)

325 ià(!
_APP_TRACING_
) ;

332 
¡d
::
cout
 << "TX";

333 
m_­¶iÿtiÚTy³
)

335 
AµliÿtiÚ
::
APPLICATION_TYPE_VOIP
:

337 
¡d
::
cout
 << " VOIP";

340 
AµliÿtiÚ
::
APPLICATION_TYPE_TRACE_BASED
:

342 
¡d
::
cout
 << " VIDEO";

345 
AµliÿtiÚ
::
APPLICATION_TYPE_CBR
:

347 
¡d
::
cout
 << " CBR";

350 
AµliÿtiÚ
::
APPLICATION_TYPE_INFINITE_BUFFER
:

352 
¡d
::
cout
 << " INF_BUF";

357 
¡d
::
cout
 << " UNDEFINED";

362 
¡d
::
cout
 << " ID " << 
p
->
	`G‘ID
 ()

363 << " B " << 
	`G‘AµliÿtiÚID
 ()

364 << " SIZE " << 
p
->
	`G‘Size
 ()

365 << " SRC " << 
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 ()

366 << " DST " << 
	`G‘De¡š©iÚ
 ()->
	`G‘IDN‘wÜkNode
 ()

367 << " T " << 
SimuÏtÜ
::
	`In™
()->
	`Now
(è<< 
¡d
::
’dl
;

369 
	}
}

372 
	gAµliÿtiÚ
::
	$Pršt
 ()

374 
cout
 << " Application object: "

375 "\n\ˆm_­¶iÿtiÚTy³ = " << 
m_­¶iÿtiÚTy³
 <<

376 
’dl
;

377 
	}
}

	@/home/lyang3/work/src_son/runWorld/Application/Application.h

4 #iâdeà
APPLICATION_H_


5 
	#APPLICATION_H_


	)

7 
	~"../../cÜe/ev’tScheduËr/simuÏtÜ.h
"

8 
	~"../../´ÙocŞSck/·ck‘/Pack‘.h
"

9 
	~"../../´ÙocŞSck/´ÙocŞs/T¿n¥ÜtPrÙocŞ.h
"

10 
	~"../../lßd-·¿m‘”s.h
"

11 
	~"../../deviû/IPCÏssif›r/CÏssif›rP¬am‘”s.h
"

12 
	~"../../´ÙocŞSck/·ck‘/Pack‘TAGs.h
"

15 
	~<io¡»am
>

16 
	~"../../¡dšt.h
"

18 
şass
 
	gN‘wÜkNode
;

19 
şass
 
	gCÏssif›rP¬am‘”s
;

20 
şass
 
	gRadioB—»r
;

21 
şass
 
	gQoSP¬am‘”s
;

22 
şass
 
	gAµliÿtiÚSšk
;

23 
şass
 
	gRadioB—»rSšk
;

25 şas 
	cAµliÿtiÚ
 {

26 
	mpublic
:

27 
	eAµliÿtiÚTy³


29 
APPLICATION_TYPE_VOIP
,

30 
	mAPPLICATION_TYPE_TRACE_BASED
,

31 
	mAPPLICATION_TYPE_INFINITE_BUFFER
,

32 
	mAPPLICATION_TYPE_CBR


35 
AµliÿtiÚ
();

36 
AµliÿtiÚ
(
AµliÿtiÚTy³
 
­¶iÿtiÚTy³
);

37 
	gvœtu®
 ~
AµliÿtiÚ
();

39 
De¡roy
 ();

41 
S‘AµliÿtiÚTy³
 (
AµliÿtiÚTy³
 
­¶iÿtiÚTy³
);

42 
AµliÿtiÚTy³
 
	$G‘AµliÿtiÚTy³
 () const;

44 
	`S‘CÏssif›rP¬am‘”s
 (
CÏssif›rP¬am‘”s
* 
ı
);

45 
CÏssif›rP¬am‘”s
* 
	`G‘CÏssif›rP¬am‘”s
 ();

47 
	`S‘QoSP¬am‘”s
 (
QoSP¬am‘”s
* 
qos
);

48 
QoSP¬am‘”s
* 
	`G‘QoSP¬am‘”s
 ();

50 
N‘wÜkNode
* 
	`G‘Sourû
 ();

51 
	`S‘Sourû
 (
N‘wÜkNode
 *
sourû
);

52 
N‘wÜkNode
* 
	`G‘De¡š©iÚ
 ();

53 
	`S‘De¡š©iÚ
 (
N‘wÜkNode
 *
de¡š©iÚ
);

54 
	$G‘SourûPÜt
 () const;

55 
	`S‘SourûPÜt
 (
pÜt
);

56 
	$G‘De¡š©iÚPÜt
 () const;

57 
	`S‘De¡š©iÚPÜt
 (
pÜt
);

58 
T¿n¥ÜtPrÙocŞ
::
T¿n¥ÜtPrÙocŞTy³
 
	$G‘T¿n¥ÜtPrÙocŞ
 () const;

59 
	`S‘T¿n¥ÜtPrÙocŞ
 (
T¿n¥ÜtPrÙocŞ
::
T¿n¥ÜtPrÙocŞTy³
 
´ÙocŞ
);

62 
	`S‘S¹Time
 (
time
);

63 
	$G‘S¹Time
 () const;

64 
	`S‘StİTime
 (
time
);

65 
	$G‘StİTime
 () const;

67 
	`S¹
 ();

68 
	`Stİ
 ();

69 
vœtu®
 
	`DoS¹
 () = 0;

70 
vœtu®
 
	`DoStİ
 () = 0;

72 
	`S‘AµliÿtiÚID
 (
id
);

73 
	`G‘AµliÿtiÚID
 ();

75 
RadioB—»r
* 
	`G‘RadioB—»r
 ();

77 
	`T¿û
 (
Pack‘
* 
·ck‘
);

80 
	`Pršt
 ();

82 
´iv©e
:

83 
AµliÿtiÚTy³
 
m_­¶iÿtiÚTy³
;

85 
N‘wÜkNode
 *
m_sourû
;

86 
N‘wÜkNode
 *
m_de¡š©iÚ
;

87 
m_sourûPÜt
;

88 
m_de¡š©iÚPÜt
;

89 
T¿n¥ÜtPrÙocŞ
::
T¿n¥ÜtPrÙocŞTy³
 
m_Œª¥ÜtPrÙocŞ
;

91 
CÏssif›rP¬am‘”s
* 
m_şassif›rP¬am‘”s
;

92 
QoSP¬am‘”s
 *
m_qosP¬am‘”s
;

94 
RadioB—»r
* 
m_¿dioB—»r
;

95 
RadioB—»rSšk
 *
m_b—»rSšk
;

96 
AµliÿtiÚSšk
 *
m_­¶iÿtiÚSšk
;

98 
m_¡¬tTime
;

99 
m_¡İTime
;

101 
m_­¶iÿtiÚID
;

102 
	}
};

	@/home/lyang3/work/src_son/runWorld/Application/CBR.cpp

4 
	~"CBR.h
"

5 
	~<c¡dlib
>

6 
	~"../../compÚ’tMªag”s/N‘wÜkMªag”.h
"

7 
	~"../¿dio-b—»r.h
"

9 
	gCBR
::
	$CBR
()

11 
	`S‘AµliÿtiÚTy³
 (
AµliÿtiÚ
::
APPLICATION_TYPE_CBR
);

12 
	}
}

14 
	gCBR
::~
	$CBR
()

16 
	`De¡roy
 ();

17 
	}
}

20 
	gCBR
::
	$DoS¹
 ()

22 
SimuÏtÜ
::
	`In™
()->
	`ScheduË
(0.0, &
CBR
::
S’d
, 
this
);

23 
	}
}

26 
	gCBR
::
	$DoStİ
 ()

28 
	}
}

31 
CBR
::
	$ScheduËT¿nsm™
 (
time
)

33 iàĞ(
SimuÏtÜ
::
	`In™
()->
	`Now
 (è+ 
time
è< 
	`G‘StİTime
 () )

35 
SimuÏtÜ
::
	`In™
()->
	`ScheduË
(
time
, &
CBR
::
S’d
, 
this
);

37 
	}
}

40 
	gCBR
::
	$S’d
 ()

43 
Pack‘
 *
·ck‘
 = 
Ãw
 
	`Pack‘
 ();

44 
uid
 = 
SimuÏtÜ
::
	`In™
()->
	`G‘UID
 ();

46 
·ck‘
->
	`S‘ID
(
uid
);

47 
·ck‘
->
	`S‘TimeSmp
 (
SimuÏtÜ
::
	`In™
()->
	`Now
 ());

48 
·ck‘
->
	`S‘Size
 (
	`G‘Size
 ());

50 
	`T¿û
 (
·ck‘
);

52 
Pack‘TAGs
 *
gs
 = 
Ãw
 
	`Pack‘TAGs
 ();

53 
gs
->
	`S‘AµliÿtiÚTy³
(
Pack‘TAGs
::
APPLICATION_TYPE_CBR
);

54 
gs
->
	`S‘AµliÿtiÚSize
 (
·ck‘
->
	`G‘Size
 ());

55 
·ck‘
->
	`S‘Pack‘Tags
(
gs
);

58 
UDPH—d”
 *
udp
 = 
Ãw
 
	`UDPH—d”
 (
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘SourûPÜt
 (),

59 
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘De¡š©iÚPÜt
 ());

60 
·ck‘
->
	`AddUDPH—d”
 (
udp
);

62 
IPH—d”
 *

 = 
Ãw
 
	`IPH—d”
 (
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘SourûID
 (),

63 
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘De¡š©iÚID
 ());

64 
·ck‘
->
	`AddIPH—d”
 (

);

66 
PDCPH—d”
 *
pdı
 = 
Ãw
 
	`PDCPH—d”
 ();

67 
·ck‘
->
	`AddPDCPH—d”
 (
pdı
);

69 
	`T¿û
 (
·ck‘
);

71 
	`G‘RadioB—»r
()->
	`Enqueue
 (
·ck‘
);

73 
	`ScheduËT¿nsm™
 (
	`G‘IÁ”v®
 ());

75 
	}
}

79 
	gCBR
::
	$G‘Size
 () const

81  
m_size
;

82 
	}
}

85 
	gCBR
::
	$S‘Size
(
size
)

87 
m_size
 = 
size
;

88 
	}
}

90 
	gCBR
::
	$S‘IÁ”v®
(
š‹rv®
)

92 
m_š‹rv®
 = 
š‹rv®
;

93 
	}
}

96 
	gCBR
::
	$G‘IÁ”v®
 () const

98  
m_š‹rv®
;

99 
	}
}

	@/home/lyang3/work/src_son/runWorld/Application/CBR.h

4 #iâdeà
CBR_H_


5 
	#CBR_H_


	)

7 
	~"AµliÿtiÚ.h
"

9 şas 
	cCBR
 : 
public
 
AµliÿtiÚ
 {

10 
public
:

11 
CBR
();

12 
	mvœtu®
 ~
CBR
();

14 
vœtu®
 
DoS¹
 ();

15 
vœtu®
 
DoStİ
 ();

18 
ScheduËT¿nsm™
 (
time
);

20 
S’d
 ();

23 
S‘Size
(
size
);

25 
	$G‘Size
 () const;

27 
	`S‘IÁ”v®
(
š‹rv®
);

29 
	$G‘IÁ”v®
 () const;

31 
´iv©e
:

33 
m_š‹rv®
;

34 
m_size
;

	@/home/lyang3/work/src_son/runWorld/Application/InfiniteBuffer.cpp

4 
	~"Infš™eBufãr.h
"

5 
	~"../../compÚ’tMªag”s/N‘wÜkMªag”.h
"

7 
	gInfš™eBufãr
::
	$Infš™eBufãr
()

9 
	`S‘AµliÿtiÚTy³
 (
AµliÿtiÚ
::
APPLICATION_TYPE_INFINITE_BUFFER
);

10 
	}
}

12 
	gInfš™eBufãr
::~
	$Infš™eBufãr
()

14 
	`De¡roy
 ();

15 
	}
}

18 
	gInfš™eBufãr
::
	$DoS¹
 ()

19 {
	}
}

22 
Infš™eBufãr
::
	$DoStİ
 ()

23 {
	}
}

	@/home/lyang3/work/src_son/runWorld/Application/InfiniteBuffer.h

3 #iâdeà
INFINITEBUFFER_H_


4 
	#INFINITEBUFFER_H_


	)

6 
	~"AµliÿtiÚ.h
"

8 şas 
	cInfš™eBufãr
 : 
public
 
AµliÿtiÚ
 {

9 
public
:

10 
Infš™eBufãr
();

11 
	mvœtu®
 ~
Infš™eBufãr
();

13 
vœtu®
 
DoS¹
 ();

14 
vœtu®
 
DoStİ
 ();

	@/home/lyang3/work/src_son/runWorld/Application/Trace/default-trace.h

6 
	#NB_FRAME
 10

	)

8 
	gäameTy³_Tab
[10] =

10 
	gtime_Tab
[10] =

12 
ušt16_t
 
	gsize_Tab
[10] =

	@/home/lyang3/work/src_son/runWorld/Application/TraceBased.cpp

3 
	~"T¿ûBa£d.h
"

4 
	~"T¿û/deçuÉ-Œaû.h
"

5 
	~<c¡ršg
>

6 
	~"../../compÚ’tMªag”s/N‘wÜkMªag”.h
"

7 
	~"../¿dio-b—»r.h
"

9 
	#MAXMTUSIZE
 1490

	)

11 
	gT¿ûBa£d
::
	$T¿ûBa£d
()

13 
m_£Á
 = 0;

14 
m_’Œ›s
 = 
Ãw
 
¡d
::
veùÜ
<
T¿ûEÁry
> ();

15 
	`LßdDeçuÉT¿û
 ();

16 
m_äameCouÁ”
 = 0;

17 
	`S‘AµliÿtiÚTy³
 (
AµliÿtiÚ
::
APPLICATION_TYPE_TRACE_BASED
);

18 
	}
}

20 
	gT¿ûBa£d
::~
	$T¿ûBa£d
()

22 
m_’Œ›s
->
	`ş—r
 ();

23 
d–‘e
 
m_’Œ›s
;

24 
	`De¡roy
 ();

25 
	}
}

28 
	gT¿ûBa£d
::
	$DoS¹
 ()

30 
SimuÏtÜ
::
	`In™
()->
	`ScheduË
(0.0, &
T¿ûBa£d
::
S’d
, 
this
);

31 
	}
}

34 
	gT¿ûBa£d
::
	$DoStİ
 ()

35 {
	}
}

38 
T¿ûBa£d
::
	$S‘T¿ûFe
(
¡d
::
¡ršg
 
ŒaûFe
)

40 
	`LßdT¿û
 (
ŒaûFe
);

42 #ifdeà
APPLICATION_DEBUG


43 
¡d
::
cout
 << " TRACE_BASED_DEBUG: Add fileraceo Trace-Based "

44 "AµliÿtiÚ Cl›Á..... DONE" << 
¡d
::
’dl
;

47 
	}
}

50 
	gT¿ûBa£d
::
	$LßdT¿û
 (
¡d
::
¡ršg
 
ŒaûFe
)

52 ià(
m_’Œ›s
->
	`size
() > 0)

54 
m_’Œ›s
->
	`ş—r
 ();

57 
ušt32_t
 
time
, 
šdex
, 
´evTime
 = 0;

58 
ušt16_t
 
size
;

59 
äameTy³
;

60 
T¿ûEÁry
 
’Œy
;

61 
¡d
::
if¡»am
 
ifT¿ûFe
;

62 
ifT¿ûFe
.
	`İ’
 (
ŒaûFe
.
	`c_¡r
 (), 
¡d
::
if¡»am
::
š
);

64 ià(!
ifT¿ûFe
.
	`good
 ())

66 
¡d
::
cout
 << " TRACE_BASED_APPLICATION ERROR BAD FILE"<< std::
’dl
;

67 
	`LßdDeçuÉT¿û
 ();

69 
ifT¿ûFe
.
	`good
 ())

71 
ifT¿ûFe
 >> 
šdex
 >> 
äameTy³
 >> 
time
 >> 
size
;

72 ià(
äameTy³
 == 'B' || frameType == 'PB')

74 
’Œy
.
TimeToS’d
 = 0;

78 
’Œy
.
TimeToS’d
 = 
time
 - 
´evTime
;

79 
´evTime
 = 
time
;

81 
’Œy
.
Pack‘Size
 = 
size
;

82 
’Œy
.
F¿meIndex
 = 
šdex
;

83 
’Œy
.
F¿meTy³
 = 
äameTy³
;

84 
m_’Œ›s
->
	`push_back
 (
’Œy
);

86 
ifT¿ûFe
.
	`şo£
 ();

87 
™”
 = 
m_’Œ›s
->
	`begš
 ();

88 
	}
}

91 
	gT¿ûBa£d
::
	$LßdDeçuÉT¿û
 ()

93 
ušt32_t
 
time
, 
šdex
, 
´evTime
 = 0;

94 
ušt16_t
 
size
;

95 
äameTy³
;

96 
T¿ûEÁry
 
’Œy
;

97 
i
 = 0; i < 
NB_FRAME
; i++)

99 
šdex
 = 
i
 + 1;

100 
äameTy³
 = 
äameTy³_Tab
[
i
];

101 
time
 = 
time_Tab
[
i
];

102 
size
 = 
size_Tab
[
i
];

104 ià(
äameTy³
 == 'B')

106 
’Œy
.
TimeToS’d
 = 0;

110 
’Œy
.
TimeToS’d
 = 
time
 - 
´evTime
;

111 
´evTime
 = 
time
;

113 
’Œy
.
Pack‘Size
 = 
size
;

114 
’Œy
.
F¿meIndex
 = 
šdex
;

115 
’Œy
.
F¿meTy³
 = 
äameTy³
;

116 
m_’Œ›s
->
	`push_back
 (
’Œy
);

118 
™”
 = 
m_’Œ›s
->
	`begš
 ();

120 
	}
}

123 
	gT¿ûBa£d
::
	$ScheduËT¿nsm™
 (
time
)

125 iàĞ(
SimuÏtÜ
::
	`In™
()->
	`Now
 (è+ 
time
è< 
	`G‘StİTime
 () )

127 
SimuÏtÜ
::
	`In™
()->
	`ScheduË
(
time
, &
T¿ûBa£d
::
S’d
, 
this
);

129 
	}
}

132 
	gT¿ûBa£d
::
	$S’d
 ()

135 
d©aOfF¿meAÌ—dyS’t
 = 0;

137 
Œue
)

139 
i
 = 0; i < (
™”
->
Pack‘Size
è/ 
MAXMTUSIZE
; i++)

142 
Pack‘
 *
·ck‘
 = 
Ãw
 
	`Pack‘
 ();

143 
uid
 = 
SimuÏtÜ
::
	`In™
()->
	`G‘UID
 ();

145 
·ck‘
->
	`S‘ID
(
uid
);

146 
·ck‘
->
	`S‘TimeSmp
 (
SimuÏtÜ
::
	`In™
()->
	`Now
 ());

147 
·ck‘
->
	`S‘Size
 (
MAXMTUSIZE
);

149 
	`T¿û
 (
·ck‘
);

151 
Pack‘TAGs
 *
gs
 = 
Ãw
 
	`Pack‘TAGs
 ();

152 
gs
->
	`S‘AµliÿtiÚTy³
(
Pack‘TAGs
::
APPLICATION_TYPE_TRACE_BASED
);

153 
gs
->
	`S‘F¿meNumb”
(
	`G‘F¿meCouÁ”
());

154 
gs
->
	`S‘S¹By‹
(
d©aOfF¿meAÌ—dyS’t
);

155 
gs
->
	`S‘EndBy‹
(
d©aOfF¿meAÌ—dyS’t
+
MAXMTUSIZE
-1);

156 
gs
->
	`S‘AµliÿtiÚSize
 (
·ck‘
->
	`G‘Size
 ());

157 
d©aOfF¿meAÌ—dyS’t
+=
MAXMTUSIZE
;

158 
·ck‘
->
	`S‘Pack‘Tags
(
gs
);

161 
UDPH—d”
 *
udp
 = 
Ãw
 
	`UDPH—d”
 (
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘SourûPÜt
 (),

162 
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘De¡š©iÚPÜt
 ());

163 
·ck‘
->
	`AddUDPH—d”
 (
udp
);

165 
IPH—d”
 *

 = 
Ãw
 
	`IPH—d”
 (
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘SourûID
 (),

166 
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘De¡š©iÚID
 ());

167 
·ck‘
->
	`AddIPH—d”
 (

);

169 
PDCPH—d”
 *
pdı
 = 
Ãw
 
	`PDCPH—d”
 ();

170 
·ck‘
->
	`AddPDCPH—d”
 (
pdı
);

172 
	`G‘RadioB—»r
()->
	`Enqueue
 (
·ck‘
);

175 
ušt16_t
 
siz‘o£nd
 = (
™”
->
Pack‘Size
è% 
MAXMTUSIZE
;

177 ià(
siz‘o£nd
 > 0)

180 
Pack‘
 *
·ck‘
 = 
Ãw
 
	`Pack‘
 ();

181 
uid
 = 
SimuÏtÜ
::
	`In™
()->
	`G‘UID
 ();

183 
·ck‘
->
	`S‘ID
(
uid
);

184 
·ck‘
->
	`S‘TimeSmp
 (
SimuÏtÜ
::
	`In™
()->
	`Now
 ());

185 
·ck‘
->
	`S‘Size
 (
siz‘o£nd
);

187 
	`T¿û
 (
·ck‘
);

189 
Pack‘TAGs
 *
gs
 = 
Ãw
 
	`Pack‘TAGs
 ();

190 
gs
->
	`S‘AµliÿtiÚTy³
(
Pack‘TAGs
::
APPLICATION_TYPE_TRACE_BASED
);

191 
gs
->
	`S‘F¿meNumb”
(
	`G‘F¿meCouÁ”
());

192 
gs
->
	`S‘S¹By‹
(
d©aOfF¿meAÌ—dyS’t
);

193 
gs
->
	`S‘EndBy‹
(
d©aOfF¿meAÌ—dyS’t
+
siz‘o£nd
-1);

194 
gs
->
	`S‘AµliÿtiÚSize
 (
·ck‘
->
	`G‘Size
 ());

195 
d©aOfF¿meAÌ—dyS’t
+=
siz‘o£nd
;

196 
·ck‘
->
	`S‘Pack‘Tags
(
gs
);

199 
UDPH—d”
 *
udp
 = 
Ãw
 
	`UDPH—d”
 (
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘SourûPÜt
 (),

200 
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘De¡š©iÚPÜt
 ());

201 
·ck‘
->
	`AddUDPH—d”
 (
udp
);

203 
IPH—d”
 *

 = 
Ãw
 
	`IPH—d”
 (
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘SourûID
 (),

204 
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘De¡š©iÚID
 ());

205 
·ck‘
->
	`AddIPH—d”
 (

);

207 
PDCPH—d”
 *
pdı
 = 
Ãw
 
	`PDCPH—d”
 ();

208 
·ck‘
->
	`AddPDCPH—d”
 (
pdı
);

210 
	`G‘RadioB—»r
()->
	`Enqueue
 (
·ck‘
);

213 
™”
++;

214 
m_äameCouÁ”
++;

215 
d©aOfF¿meAÌ—dyS’t
 = 0;

217 ià(
™”
 =ğ
m_’Œ›s
->
	`’d
 ())

219 
™”
 = 
m_’Œ›s
->
	`begš
 ();

222 ià(
™”
->
TimeToS’d
 != 0)

224 
	`ScheduËT¿nsm™
 ((
™”
->
TimeToS’d
)*0.001);

228 
	}
}

231 
	gT¿ûBa£d
::
	$Upd©eF¿meCouÁ”
 ()

233 
m_äameCouÁ”
++;

234 
	}
}

237 
	gT¿ûBa£d
::
	$G‘F¿meCouÁ”
 ()

239  
m_äameCouÁ”
;

240 
	}
}

243 
	gT¿ûBa£d
::
	$PrštT¿û
()

245 
¡d
::
cout
 << "PršˆT¿û "<< std::
’dl
;

246 
¡d
::
veùÜ
<
T¿ûEÁry
>::
™”©Ü
 
™
;

248 
n
=0;

249 
™
 = 
m_’Œ›s
->
	`begš
(); iˆ!ğm_’Œ›s->
	`’d
(); it++)

251 
¡d
::
cout
 << 
™
->
F¿meIndex
 << " " <<™->
F¿meTy³


252 << " " << 
™
->
TimeToS’d
 << " " << it->
Pack‘Size
 << 
¡d
::
’dl
;

253 
n
++;

254 ià(
n
==10)

257 
	}
}

	@/home/lyang3/work/src_son/runWorld/Application/TraceBased.h

2 #iâdeà
TRACEBASED_H_


3 
	#TRACEBASED_H_


	)

5 
	~"AµliÿtiÚ.h
"

7 
	~<c¡dio
>

8 
	~<io¡»am
>

9 
	~<f¡»am
>

23 şas 
	cT¿ûBa£d
 : 
public
 
AµliÿtiÚ
 {

24 
public
:

25 
T¿ûBa£d
();

26 
T¿ûBa£d
(
N‘wÜkNode
 *
sourû
,

27 
N‘wÜkNode
 *
de¡š©iÚ
,

28 
sourûPÜt
,

29 
de¡š©iÚPÜt
,

30 
T¿n¥ÜtPrÙocŞ
::
T¿n¥ÜtPrÙocŞTy³
 
´ÙocŞ
);

32 
	mvœtu®
 ~
T¿ûBa£d
();

34 
S‘T¿ûFe
(
¡d
::
¡ršg
 
ŒaûFe
);

35 
LßdT¿û
 (
¡d
::
¡ršg
 
ŒaûFe
);

36 
LßdDeçuÉT¿û
 ();

38 
vœtu®
 
DoS¹
 ();

39 
vœtu®
 
DoStİ
 ();

41 
ScheduËT¿nsm™
 (
time
);

42 
S’d
 ();

44 
Upd©eF¿meCouÁ”
 ();

45 
G‘F¿meCouÁ”
 ();

47 
PrštT¿û
 ();

49 
	m´iv©e
:

51 
ušt32_t
 
m_T¿ûSize
;

52 
	mm_š‹rv®
;

53 
ušt32_t
 
	mm_size
;

54 
ušt32_t
 
	mm_£Á
;

58 
ušt32_t
 
	mTimeToS’d
;

59 
ušt16_t
 
	mPack‘Size
;

60 
ušt32_t
 
	mF¿meIndex
;

61 
	mF¿meTy³
;

62 } 
	tT¿ûEÁry
;

64 
	g¡d
::
veùÜ
<
T¿ûEÁry
> * 
m_’Œ›s
;

65 
	g¡d
::
veùÜ
<
T¿ûEÁry
>::
™”©Ü
 
™”
;

67 
	gm_äameCouÁ”
;

	@/home/lyang3/work/src_son/runWorld/Application/VoIP.cpp

3 
	~"VoIP.h
"

4 
	~<c¡dlib
>

5 
	~"../../compÚ’tMªag”s/N‘wÜkMªag”.h
"

6 
	~"../¿dio-b—»r.h
"

7 
	~<m©h.h
>

9 
	gVoIP
::
	$VoIP
()

15 
m_size
 = 32;

16 
m_¡©eON
 = 
çl£
;

17 
	`S‘AµliÿtiÚTy³
 (
AµliÿtiÚ
::
APPLICATION_TYPE_VOIP
);

18 
	}
}

20 
	gVoIP
::~
	$VoIP
()

22 
	`De¡roy
 ();

23 
	}
}

26 
	gVoIP
::
	$DoS¹
 ()

28 
SimuÏtÜ
::
	`In™
()->
	`ScheduË
(0.0, &
VoIP
::
S’d
, 
this
);

29 
	}
}

32 
	gVoIP
::
	$DoStİ
 ()

33 {
	}
}

36 
VoIP
::
	$ScheduËT¿nsm™
 (
time
)

38 iàĞ(
SimuÏtÜ
::
	`In™
()->
	`Now
 (è+ 
time
è< 
	`G‘StİTime
 () )

40 
SimuÏtÜ
::
	`In™
()->
	`ScheduË
(
time
, &
VoIP
::
S’d
, 
this
);

42 
	}
}

45 
	gVoIP
::
	$S’d
 ()

47 ià(!
m_¡©eON
)

49 
m_¡©eON
 = 
Œue
;

51 
¿ndom
 = 
	`¿nd
() %10000;

52 
m_¡©eDu¿tiÚ
 = -3*
	`log
(1-(()
¿ndom
/10000));

53 
m_’dS‹
 = 
SimuÏtÜ
::
	`In™
()->
	`Now
 (è+ 
m_¡©eDu¿tiÚ
;

54 #ifdeà
APPLICATION_DEBUG


55 
¡d
::
cout
 << " VoIP_DEBUG - Start ON Period, "

56 "\n\ˆTimğ" << 
SimuÏtÜ
::
	`In™
()->
	`Now
 ()

57 << "\n\ˆ¡©ON Du¿tiÚ = " << 
m_¡©eDu¿tiÚ


58 << "\n\ˆ’d ON s‹ = " << 
m_’dS‹
 << 
¡d
::
’dl
;

63 
Pack‘
 *
·ck‘
 = 
Ãw
 
	`Pack‘
 ();

64 
uid
 = 
SimuÏtÜ
::
	`In™
()->
	`G‘UID
 ();

66 
·ck‘
->
	`S‘ID
(
uid
);

67 
·ck‘
->
	`S‘TimeSmp
 (
SimuÏtÜ
::
	`In™
()->
	`Now
 ());

68 
·ck‘
->
	`S‘Size
 (
	`G‘Size
 ());

70 
	`T¿û
 (
·ck‘
);

72 
Pack‘TAGs
 *
gs
 = 
Ãw
 
	`Pack‘TAGs
 ();

73 
gs
->
	`S‘AµliÿtiÚTy³
(
Pack‘TAGs
::
APPLICATION_TYPE_VOIP
);

74 
gs
->
	`S‘AµliÿtiÚSize
 (
·ck‘
->
	`G‘Size
 ());

75 
·ck‘
->
	`S‘Pack‘Tags
(
gs
);

78 
UDPH—d”
 *
udp
 = 
Ãw
 
	`UDPH—d”
 (
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘SourûPÜt
 (),

79 
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘De¡š©iÚPÜt
 ());

80 
·ck‘
->
	`AddUDPH—d”
 (
udp
);

82 
IPH—d”
 *

 = 
Ãw
 
	`IPH—d”
 (
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘SourûID
 (),

83 
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘De¡š©iÚID
 ());

84 
·ck‘
->
	`AddIPH—d”
 (

);

86 
PDCPH—d”
 *
pdı
 = 
Ãw
 
	`PDCPH—d”
 ();

87 
·ck‘
->
	`AddPDCPH—d”
 (
pdı
);

89 
	`G‘RadioB—»r
()->
	`Enqueue
 (
·ck‘
);

92 ià(
SimuÏtÜ
::
	`In™
()->
	`Now
 (è<ğ
m_’dS‹
)

94 
	`ScheduËT¿nsm™
 (0.02);

99 
m_¡©eON
 = 
çl£
;

100 
¿ndom
 = 
	`¿nd
() %10000;

101 
m_¡©eDu¿tiÚ
 = -2.23*
	`log
(1-(()
¿ndom
/10000));

102 ià(
m_¡©eDu¿tiÚ
 > 6.9)

104 
m_¡©eDu¿tiÚ
 = 6.9;

106 #ifdeà
APPLICATION_DEBUG


107 
¡d
::
cout
 << " VoIP_DEBUG - Start OFF Period, "

108 "\n\ˆTimğ" << 
SimuÏtÜ
::
	`In™
()->
	`Now
 ()

109 << "\n\ˆ¡©OFF Du¿tiÚ = " << 
m_¡©eDu¿tiÚ
 << 
¡d
::
’dl
;

111 
	`ScheduËT¿nsm™
 (
m_¡©eDu¿tiÚ
);

113 
	}
}

117 
	gVoIP
::
	$G‘Size
 () const

119  
m_size
;

120 
	}
}

	@/home/lyang3/work/src_son/runWorld/Application/VoIP.h

2 #iâdeà
VOIP_H_


3 
	#VOIP_H_


	)

5 
	~"AµliÿtiÚ.h
"

7 şas 
	cVoIP
 : 
public
 
AµliÿtiÚ
 {

8 
public
:

9 
VoIP
();

10 
	mvœtu®
 ~
VoIP
();

12 
DoS¹
 ();

13 
DoStİ
 ();

15 
ScheduËT¿nsm™
 (
time
);

16 
S’d
 ();

18 
	$G‘Size
 () const;

21 
´iv©e
:

22 
m_š‹rv®
;

23 
m_size
;

24 
boŞ
 
m_¡©eON
;

25 
m_¡©eDu¿tiÚ
;

26 
m_’dS‹
;

	@/home/lyang3/work/src_son/runWorld/Application/application-sink.cpp

3 
	~"­¶iÿtiÚ-sšk.h
"

4 
	~"../../deviû/IPCÏssif›r/CÏssif›rP¬am‘”s.h
"

5 
	~"../../compÚ’tMªag”s/N‘wÜkMªag”.h
"

6 
	~"../../cÜe/ev’tScheduËr/simuÏtÜ.h
"

7 
	~"../../lßd-·¿m‘”s.h
"

9 
	gAµliÿtiÚSšk
::
	$AµliÿtiÚSšk
()

11 
m_şassif›rP¬am‘”s
 = 
NULL
;

12 
m_¿dioB—»r
 = 
NULL
;

13 
m_sourûAµliÿtiÚ
 = 
NULL
;

14 
	}
}

16 
	gAµliÿtiÚSšk
::~
	$AµliÿtiÚSšk
()

18 
m_şassif›rP¬am‘”s
 = 
NULL
;

19 
m_¿dioB—»r
 = 
NULL
;

20 
m_sourûAµliÿtiÚ
 = 
NULL
;

21 
	}
}

24 
	gAµliÿtiÚSšk
::
	$S‘CÏssif›rP¬am‘”s
 (
CÏssif›rP¬am‘”s
* 
ı
)

26 
m_şassif›rP¬am‘”s
 = 
ı
;

27 
	}
}

29 
CÏssif›rP¬am‘”s
*

30 
	gAµliÿtiÚSšk
::
	$G‘CÏssif›rP¬am‘”s
 ()

32  
m_şassif›rP¬am‘”s
;

33 
	}
}

37 
	gAµliÿtiÚSšk
::
	$S‘RadioB—»rSšk
 (
RadioB—»rSšk
* 
r
)

39 
m_¿dioB—»r
 = 
r
;

40 
	}
}

42 
RadioB—»rSšk
*

43 
	gAµliÿtiÚSšk
::
	$G‘RadioB—»rSšk
 ()

45  
m_¿dioB—»r
;

46 
	}
}

49 
	gAµliÿtiÚSšk
::
	$S‘SourûAµliÿtiÚ
 (
AµliÿtiÚ
* 
a
)

51 
m_sourûAµliÿtiÚ
 = 
a
;

52 
	}
}

54 
AµliÿtiÚ
*

55 
	gAµliÿtiÚSšk
::
	$G‘SourûAµliÿtiÚ
 ()

57  
m_sourûAµliÿtiÚ
;

58 
	}
}

61 
	gAµliÿtiÚSšk
::
	$Reûive
 (
Pack‘
* 
p
)

69 ià(!
_APP_TRACING_
) ;

71 
¡d
::
cout
 << "RX";

73 
m_sourûAµliÿtiÚ
->
	`G‘AµliÿtiÚTy³
 ())

75 
AµliÿtiÚ
::
APPLICATION_TYPE_VOIP
:

77 
¡d
::
cout
 << " VOIP";

80 
AµliÿtiÚ
::
APPLICATION_TYPE_TRACE_BASED
:

82 
¡d
::
cout
 << " VIDEO";

85 
AµliÿtiÚ
::
APPLICATION_TYPE_CBR
:

87 
¡d
::
cout
 << " CBR";

90 
AµliÿtiÚ
::
APPLICATION_TYPE_INFINITE_BUFFER
:

92 
¡d
::
cout
 << " INF_BUF";

97 
¡d
::
cout
 << " UNDEFINED";

102 
d–ay
 = ((
SimuÏtÜ
::
	`In™
()->
	`Now
(è*10000è- (
p
->
	`G‘TimeSmp
 () *10000)) /10000;

103 ià(
d–ay
 < 0.000001) delay = 0.000001;

105 
¡d
::
cout
 << " ID " << 
p
->
	`G‘ID
 ()

106 << " B " << 
m_sourûAµliÿtiÚ
->
	`G‘AµliÿtiÚID
 ()

107 << " SIZE " << 
p
->
	`G‘Pack‘Tags
 ()->
	`G‘AµliÿtiÚSize
 ()

108 << " SRC " << 
p
->
	`G‘SourûID
 ()

109 << " DST " << 
p
->
	`G‘De¡š©iÚID
 ()

110 << " D " << 
d–ay
 << 
¡d
::
’dl
;

111 
d–‘e
 
p
;

112 
	}
}

	@/home/lyang3/work/src_son/runWorld/Application/application-sink.h

2 #iâdeà
APPLICATIONSINK_H_


3 
	#APPLICATIONSINK_H_


	)

5 
	~<io¡»am
>

6 
	~"../../¡dšt.h
"

7 
	~"AµliÿtiÚ.h
"

9 
şass
 
	gCÏssif›rP¬am‘”s
;

10 
şass
 
	gRadioB—»r
;

11 
şass
 
	gRadioB—»rSšk
;

12 
şass
 
	gPack‘
;

15 şas 
	cAµliÿtiÚSšk
 {

16 
	mpublic
:

17 
AµliÿtiÚSšk
();

18 
	mvœtu®
 ~
AµliÿtiÚSšk
();

20 
S‘CÏssif›rP¬am‘”s
 (
CÏssif›rP¬am‘”s
* 
ı
);

21 
CÏssif›rP¬am‘”s
* 
G‘CÏssif›rP¬am‘”s
 ();

23 
S‘RadioB—»rSšk
 (
RadioB—»rSšk
* 
r
);

24 
RadioB—»rSšk
* 
G‘RadioB—»rSšk
 ();

26 
S‘SourûAµliÿtiÚ
 (
AµliÿtiÚ
* 
a
);

27 
AµliÿtiÚ
* 
G‘SourûAµliÿtiÚ
 ();

29 
Reûive
 (
Pack‘
* 
p
);

31 
	m´iv©e
:

32 
CÏssif›rP¬am‘”s
* 
m_şassif›rP¬am‘”s
;

33 
RadioB—»rSšk
* 
	mm_¿dioB—»r
;

35 
AµliÿtiÚ
* 
	mm_sourûAµliÿtiÚ
;

	@/home/lyang3/work/src_son/runWorld/CqiManager/cqi-manager.cpp

1 
	~"cqi-mªag”.h
"

3 
	gCqiMªag”
::
	$CqiMªag”
()

5 
m_deviû
 = 0;

6 
	}
}

8 
	gCqiMªag”
::~
	$CqiMªag”
()

10 
m_deviû
 = 0;

11 
	}
}

14 
	gCqiMªag”
::
	$S‘Deviû
 (
N‘wÜkNode
* 
d
)

16 
m_deviû
 = 
d
;

17 
	}
}

19 
N‘wÜkNode
*

20 
	gCqiMªag”
::
	$G‘Deviû
 ()

22  
m_deviû
;

23 
	}
}

26 
	gCqiMªag”
::
	$S‘CqiR•ÜtšgMode
 (
CqiMªag”
::
CQIR•ÜtšgMode
 
m
)

28 
m_»pÜtšgMode
 = 
m
;

29 ià(
m_»pÜtšgMode
 =ğ
CqiMªag”
::
APERIODIC
)

31 
m_£ndCqi
 = 
çl£
;

35 
m_£ndCqi
 = 
Œue
;

37 
	}
}

39 
	gCqiMªag”
::
CQIR•ÜtšgMode


40 
CqiMªag”
::
	$G‘CqiR•ÜtšgMode
 ()

42  
m_»pÜtšgMode
;

43 
	}
}

46 
	gCqiMªag”
::
	$S‘S’dCqi
 (
boŞ
 
b
)

48 
m_£ndCqi
 = 
b
;

49 
	}
}

51 
boŞ


52 
	gCqiMªag”
::
	$G‘S’dCqi
 ()

54  
m_£ndCqi
;

55 
	}
}

59 
	gCqiMªag”
::
	$S‘R•ÜtšgIÁ”v®
 (
i
)

61 
m_»pÜtšgIÁ”v®
 = 
i
;

62 
	}
}

65 
	gCqiMªag”
::
	$G‘R•ÜtšgIÁ”v®
 ()

67  
m_»pÜtšgIÁ”v®
;

68 
	}
}

71 
	gCqiMªag”
::
	$S‘La¡S’t
 ()

73 
m_Ï¡S’t
 = 
SimuÏtÜ
::
	`In™
 ()->
	`Now
 () * 1000;

74 
	}
}

77 
	gCqiMªag”
::
	$G‘La¡S’t
 ()

79  
m_Ï¡S’t
;

80 
	}
}

82 
boŞ


83 
	gCqiMªag”
::
	$N“dToS’dF“dbacks
 ()

87 ià(
	`G‘S’dCqi
 (è&& 
	`G‘R•ÜtšgIÁ”v®
 () == 1 )

89  
Œue
;

92 ià(
	`G‘S’dCqi
 (è&& (()(
SimuÏtÜ
::
	`In™
 ()->
	`Now
 ()*1000è- 
	`G‘La¡S’t
 ()è>ğ
	`G‘R•ÜtšgIÁ”v®
 ())

94  
Œue
;

98  
çl£
;

100 
	}
}

	@/home/lyang3/work/src_son/runWorld/CqiManager/cqi-manager.h

1 #iâdeà
CQIMANAGER_H_


2 
	#CQIMANAGER_H_


	)

4 
	~<veùÜ
>

6 
şass
 
	gN‘wÜkNode
;

8 şas 
	cCqiMªag”
 {

9 
	mpublic
:

11 
	eCQIR•ÜtšgMode


13 
PERIODIC
,

14 
	mAPERIODIC


17 
CqiMªag”
();

18 
	gvœtu®
 ~
CqiMªag”
();

20 
S‘Deviû
 (
N‘wÜkNode
* 
d
);

21 
N‘wÜkNode
* 
G‘Deviû
 ();

23 
S‘CqiR•ÜtšgMode
 (
CQIR•ÜtšgMode
 
m
);

24 
CQIR•ÜtšgMode
 
G‘CqiR•ÜtšgMode
 ();

26 
S‘S’dCqi
 (
boŞ
 
b
);

27 
boŞ
 
G‘S’dCqi
 ();

29 
S‘R•ÜtšgIÁ”v®
 (
i
);

30 
G‘R•ÜtšgIÁ”v®
 ();

32 
S‘La¡S’t
 ();

33 
G‘La¡S’t
 ();

35 
vœtu®
 
C»©eCqiF“dbacks
 (
¡d
::
veùÜ
<> 
sšr
) = 0;

37 
boŞ
 
N“dToS’dF“dbacks
 ();

39 
	g´iv©e
:

40 
CQIR•ÜtšgMode
 
m_»pÜtšgMode
;

42 
boŞ
 
	gm_£ndCqi
;

44 
	gm_»pÜtšgIÁ”v®
;

45 
	gm_Ï¡S’t
;

47 
N‘wÜkNode
* 
	gm_deviû
;

	@/home/lyang3/work/src_son/runWorld/CqiManager/fullband-cqi-manager.cpp

1 
	~"fuÎbªd-cqi-mªag”.h
"

2 
	~"../../cÜe/id—lMes§ges/id—l-cÚŒŞ-mes§ges.h
"

3 
	~"../../´ÙocŞSck/mac/AMCModuË.h
"

4 
	~"../../phy/Ée-phy.h
"

5 
	~"../../cÜe/¥eùrum/bªdwidth-mªag”.h
"

8 
	gFuÎbªdCqiMªag”
::
	$FuÎbªdCqiMªag”
()

9 {
	}
}

11 
FuÎbªdCqiMªag”
::~
	$FuÎbªdCqiMªag”
()

12 {
	}
}

15 
FuÎbªdCqiMªag”
::
C»©eCqiF“dbacks
 (
¡d
::
veùÜ
<> 
sšr
)

17 #ifdeà
TEST_CQI_FEEDBACKS


18 
¡d
::
cout
 << "FuÎbªdCqiMªag” -> C»©eCqiF“dback " << std::
’dl
;

21 #ifdeà
AMC_MAPPING


22 
	g¡d
::
cout
 << "\t sinr: ";

23 
	gi
 = 0; i < 
	gsšr
.
size
 (); i++)

25 
	g¡d
::
cout
 << 
sšr
.
©
 (
i
) << " ";

27 
	g¡d
::
cout
 << 
¡d
::
’dl
;

30 
U£rEqum’t
* 
	gthisNode
 = (U£rEqum’t*è
G‘Deviû
 ();

31 
N‘wÜkNode
* 
	grg‘Node
 = 
thisNode
->
G‘T¬g‘Node
 ();

33 
AMCModuË
 *
	gamc
 = 
G‘Deviû
 ()->
G‘PrÙocŞSck
 ()->
G‘MacEÁ™y
 ()->
G‘AmcModuË
 ();

34 
	g¡d
::
veùÜ
<> 
cqi
 = 
amc
->
C»©eCqiF“dbacks
 (
sšr
);

36 
CqiId—lCÚŒŞMes§ge
 *
	gmsg
 = 
Ãw
 CqiIdealControlMessage ();

37 
	gmsg
->
S‘SourûDeviû
 (
thisNode
);

38 
	gmsg
->
S‘De¡š©iÚDeviû
 (
rg‘Node
);

40 
	gnbSubChªÃls
 = 
cqi
.
size
 ();

41 
	g¡d
::
veùÜ
<> 
dlSubChªÃls
 = 
thisNode
->
G‘Phy
 ()->
G‘BªdwidthMªag”
 ()->
G‘DlSubChªÃls
 ();

43 
	gi
 = 0; i < 
	gnbSubChªÃls
; i++)

45 
	gmsg
->
AddNewRecÜd
 (
dlSubChªÃls
.
©
 (
i
), 
cqi
.at (i));

48 
S‘La¡S’t
 ();

50 
	gthisNode
->
G‘Phy
 ()->
S’dId—lCÚŒŞMes§ge
 (
msg
);

	@/home/lyang3/work/src_son/runWorld/CqiManager/fullband-cqi-manager.h

2 #iâdeà
FULLBANDCQIMANAGER_H_


3 
	#FULLBANDCQIMANAGER_H_


	)

5 
	~"cqi-mªag”.h
"

7 şas 
	cFuÎbªdCqiMªag”
: 
public
 
CqiMªag”
 {

8 
public
:

9 
FuÎbªdCqiMªag”
();

10 
	mvœtu®
 ~
FuÎbªdCqiMªag”
();

12 
vœtu®
 
C»©eCqiF“dbacks
 (
¡d
::
veùÜ
<> 
sšr
);

	@/home/lyang3/work/src_son/runWorld/CqiManager/wideband-cqi-manager.cpp

2 
	~"widebªd-cqi-mªag”.h
"

3 
	~"../../cÜe/id—lMes§ges/id—l-cÚŒŞ-mes§ges.h
"

4 
	~"../../´ÙocŞSck/mac/AMCModuË.h
"

5 
	~"../../phy/Ée-phy.h
"

6 
	~"../../cÜe/¥eùrum/bªdwidth-mªag”.h
"

7 
	~"../../lßd-·¿m‘”s.h
"

11 
	gWidebªdCqiMªag”
::
	$WidebªdCqiMªag”
()

12 {
	}
}

14 
WidebªdCqiMªag”
::~
	$WidebªdCqiMªag”
()

15 {
	}
}

18 
WidebªdCqiMªag”
::
C»©eCqiF“dbacks
 (
¡d
::
veùÜ
<> 
sšr
)

20 #ifdeà
TEST_CQI_FEEDBACKS


21 
¡d
::
cout
 << "WidebªdCqiMªag” -> C»©eCqiF“dback " << std::
’dl
;

24 
	gefãùive_sšr
 = 
G‘EesmEfãùiveSšr
 (
sšr
);

25 
	gi
 = 0; i < 
	gsšr
.
size
 (); i++)

27 
	gsšr
.
©
 (
i
èğ
efãùive_sšr
;

30 #ifdeà
AMC_MAPPING


31 
	g¡d
::
cout
 << "\t sinr: ";

32 
	gi
 = 0; i < 
	gsšr
.
size
 (); i++)

34 
	g¡d
::
cout
 << 
sšr
.
©
 (
i
) << " ";

36 
	g¡d
::
cout
 << 
¡d
::
’dl
;

40 
U£rEqum’t
* 
	gthisNode
 = (U£rEqum’t*è
G‘Deviû
 ();

41 
N‘wÜkNode
* 
	grg‘Node
 = 
thisNode
->
G‘T¬g‘Node
 ();

43 
AMCModuË
 *
	gamc
 = 
G‘Deviû
 ()->
G‘PrÙocŞSck
 ()->
G‘MacEÁ™y
 ()->
G‘AmcModuË
 ();

44 
	g¡d
::
veùÜ
<> 
cqi
 = 
amc
->
C»©eCqiF“dbacks
 (
sšr
);

46 
CqiId—lCÚŒŞMes§ge
 *
	gmsg
 = 
Ãw
 CqiIdealControlMessage ();

47 
	gmsg
->
S‘SourûDeviû
 (
thisNode
);

48 
	gmsg
->
S‘De¡š©iÚDeviû
 (
rg‘Node
);

50 
	gnbSubChªÃls
 = 
cqi
.
size
 ();

51 
	g¡d
::
veùÜ
<> 
dlSubChªÃls
 = 
thisNode
->
G‘Phy
 ()->
G‘BªdwidthMªag”
 ()->
G‘DlSubChªÃls
 ();

53 
	gi
 = 0; i < 
	gnbSubChªÃls
; i++)

55 
	gmsg
->
AddNewRecÜd
 (
dlSubChªÃls
.
©
 (
i
), 
cqi
.at (i));

58 
S‘La¡S’t
 ();

60 
	gthisNode
->
G‘Phy
 ()->
S’dId—lCÚŒŞMes§ge
 (
msg
);

	@/home/lyang3/work/src_son/runWorld/CqiManager/wideband-cqi-manager.h

1 #iâdeà
WIDEBANDCQIMANAGER_H_


2 
	#WIDEBANDCQIMANAGER_H_


	)

10 
	~"cqi-mªag”.h
"

12 şas 
	cWidebªdCqiMªag”
: 
public
 
CqiMªag”
 {

13 
public
:

14 
WidebªdCqiMªag”
();

15 
	mvœtu®
 ~
WidebªdCqiMªag”
();

17 
vœtu®
 
C»©eCqiF“dbacks
 (
¡d
::
veùÜ
<> 
sšr
);

	@/home/lyang3/work/src_son/runWorld/QoS/QoSForEXP.cpp

3 
	~"QoSFÜEXP.h
"

4 
	~<io¡»am
>

6 
	gQoSFÜEXP
::
	$QoSFÜEXP
 ()

8 
m_drİProbab™y
 = 0.01;

9 
	}
}

11 
	gQoSFÜEXP
::
	$QoSFÜEXP
 (
rg‘D–ay
)

13 
	`S‘MaxD–ay
 (
rg‘D–ay
);

14 
m_drİProbab™y
 = 0.01;

15 
	}
}

17 
	gQoSFÜEXP
::
	$QoSFÜEXP
(
rg‘D–ay
,

18 
drİProbab™y
)

20 
	`S‘MaxD–ay
 (
rg‘D–ay
);

21 
m_drİProbab™y
 = 
drİProbab™y
;

22 
	}
}

24 
	gQoSFÜEXP
::~
	$QoSFÜEXP
()

25 {
	}
}

29 
QoSFÜEXP
::
	$S‘DrİPÜbab™y
 (
´obab™y
)

31 
m_drİProbab™y
 = 
´obab™y
;

32 
	}
}

35 
	gQoSFÜEXP
::
	$G‘DrİProbab™y
 () const

37  
m_drİProbab™y
;

38 
	}
}

43 
	gQoSFÜEXP
::
	$Pršt
 ()

45 
	}
}

	@/home/lyang3/work/src_son/runWorld/QoS/QoSForEXP.h

4 #iâdeà
QOSFOREXP_H_


5 
	#QOSFOREXP_H_


	)

7 
	~"QoSP¬am‘”s.h
"

9 şas 
	cQoSFÜEXP
 :
public
 
QoSP¬am‘”s
 {

11 
public
:

12 
QoSFÜEXP
 ();

13 
QoSFÜEXP
(
rg‘D–ay
);

14 
QoSFÜEXP
(
rg‘D–ay
,

15 
drİProbab™y
);

17 
	mvœtu®
 ~
QoSFÜEXP
();

20 
S‘DrİPÜbab™y
 (
´obab™y
);

22 
	$G‘DrİProbab™y
 () const;

26 
	`Pršt
 ();

28 
´iv©e
:

29 
m_drİProbab™y
;

	@/home/lyang3/work/src_son/runWorld/QoS/QoSForFLS.cpp

3 
	~"QoSFÜFLS.h
"

4 
	~<io¡»am
>

5 
	~"../../¡dšt.h
"

7 
	gQoSFÜFLS
::
	$QoSFÜFLS
()

8 {
	}
}

10 
QoSFÜFLS
::~
	$QoSFÜFLS
()

11 {
	}
}

14 
QoSFÜFLS
::
	$C»©eQ
 ()

15 {
	}
}

18 
QoSFÜFLS
::
	$C»©eU
 ()

19 {
	}
}

22 
QoSFÜFLS
::
	$C»©eF‹rCÛffic›Ás
 ()

23 {
	}
}

27 
QoSFÜFLS
::
	$S‘NbOfCÛffic›Ás
(
M
)

28 {
	}
}

31 
QoSFÜFLS
::
	$G‘NbOfCÛffic›Ás
 () const

33  
m_nbOfCÛffic›Ás
;

34 
	}
}

37 
	gQoSFÜFLS
::
	$G‘Q
 ()

39  
m_q
;

40 
	}
}

43 
	gQoSFÜFLS
::
	$G‘U
 ()

45  
m_u
;

46 
	}
}

49 
	gQoSFÜFLS
::
	$G‘F‹rCÛffic›Ás
 () const

51  
m_f‹rCÛffic›Ás
;

52 
	}
}

55 
	gQoSFÜFLS
::
	$Upd©eQ
 (
q_
)

56 {
	}
}

59 
QoSFÜFLS
::
	$Upd©eU
 (
u_
)

60 {
	}
}

63 
QoSFÜFLS
::
	$S‘D©aToT¿nsm™
 (
d©a
)

64 {
	}
}

67 
QoSFÜFLS
::
	$G‘D©aToT¿nsm™
 () const

69  
m_d©aToT¿nsm™
;

70 
	}
}

73 
	gQoSFÜFLS
::
	$Upd©eD©aToT¿nsm™
 (
d©a
)

74 {
	}
}

79 
QoSFÜFLS
::
	$Pršt
 ()

80 {
	}
}

	@/home/lyang3/work/src_son/runWorld/QoS/QoSForFLS.h

2 #iâdeà
QOSFORFLS_H_


3 
	#QOSFORFLS_H_


	)

5 
	~"QoSP¬am‘”s.h
"

7 şas 
	cQoSFÜFLS
 :
public
 
QoSP¬am‘”s
 {

8 
public
:

9 
QoSFÜFLS
();

10 
	mvœtu®
 ~
QoSFÜFLS
();

13 
S‘NbOfCÛffic›Ás
(
M
);

15 
	$G‘NbOfCÛffic›Ás
 () const;

18 
	`C»©eQ
 ();

20 
	`C»©eU
 ();

22 
	`C»©eF‹rCÛffic›Ás
 ();

25 
	`G‘Q
 ();

27 
	`G‘U
 ();

29 
	$G‘F‹rCÛffic›Ás
 () const;

32 
	`Upd©eQ
 (
q_
);

34 
	`Upd©eU
 (
u_
);

38 
	`S‘D©aToT¿nsm™
 (
d©a
);

40 
	$G‘D©aToT¿nsm™
 () const;

42 
	`Upd©eD©aToT¿nsm™
 (
d©a
);

47 
	`Pršt
 ();

49 
´iv©e
:

50 
m_nbOfCÛffic›Ás
;

52 *
m_q
;

53 *
m_u
;

54 *
m_f‹rCÛffic›Ás
;

56 
m_d©aToT¿nsm™
;

	@/home/lyang3/work/src_son/runWorld/QoS/QoSForM_LWDF.cpp

3 
	~"QoSFÜM_LWDF.h
"

4 
	~<io¡»am
>

6 
	gQoSFÜM_LWDF
::
	$QoSFÜM_LWDF
()

8 
m_drİProbab™y
 = 0.005;

9 
	}
}

11 
	gQoSFÜM_LWDF
::
	$QoSFÜM_LWDF
(
rg‘D–ay
)

13 
	`S‘MaxD–ay
 (
rg‘D–ay
);

14 
m_drİProbab™y
 = 0.005;

15 
	}
}

17 
	gQoSFÜM_LWDF
::~
	$QoSFÜM_LWDF
()

18 {
	}
}

21 
QoSFÜM_LWDF
::
	$S‘DrİPÜbab™y
 (
´obab™y
)

23 
m_drİProbab™y
 = 
´obab™y
;

24 
	}
}

27 
	gQoSFÜM_LWDF
::
	$G‘DrİProbab™y
 () const

29  
m_drİProbab™y
;

30 
	}
}

35 
	gQoSFÜM_LWDF
::
	$Pršt
 ()

37 
	}
}

	@/home/lyang3/work/src_son/runWorld/QoS/QoSForM_LWDF.h

2 #iâdeà
QOSFORM_LWDF_H_


3 
	#QOSFORM_LWDF_H_


	)

5 
	~"QoSP¬am‘”s.h
"

7 şas 
	cQoSFÜM_LWDF
 :
public
 
QoSP¬am‘”s
 {

9 
public
:

10 
QoSFÜM_LWDF
 ();

11 
QoSFÜM_LWDF
(
rg‘D–ay
);

12 
	mvœtu®
 ~
QoSFÜM_LWDF
();

15 
S‘DrİPÜbab™y
 (
´obab™y
);

17 
	$G‘DrİProbab™y
 () const;

21 
	`Pršt
 ();

23 
´iv©e
:

24 
m_drİProbab™y
;

	@/home/lyang3/work/src_son/runWorld/QoS/QoSParameters.cpp

3 
	~"QoSP¬am‘”s.h
"

4 
	~<io¡»am
>

6 
	gQoSP¬am‘”s
::
	$QoSP¬am‘”s
()

8 
m_qci
 = 0;

9 
m_gbr
 = 0;

10 
m_mbr
 = 0;

11 
m_¬pP»Em±iÚC­ab™y
 = 
çl£
;

12 
m_¬pP»Em±iÚVuÊ”ab™y
 = 
çl£
;

13 
m_maxD–ay
 = 0;

14 
	}
}

16 
	gQoSP¬am‘”s
::
	$QoSP¬am‘”s
 (
qci
,

17 
gbr
,

18 
mbr
)

20 
m_qci
 = 
qci
;

21 
m_gbr
 = 
gbr
;

22 
m_mbr
 = 
mbr
;

23 
m_¬pP»Em±iÚC­ab™y
 = 
çl£
;

24 
m_¬pP»Em±iÚVuÊ”ab™y
 = 
çl£
;

25 
m_maxD–ay
 = 0;

26 
	}
}

28 
	gQoSP¬am‘”s
::
	$QoSP¬am‘”s
 (
qci
,

29 
boŞ
 
¬pP»Em±iÚC­ab™y
,

30 
boŞ
 
¬pP»Em±iÚVuÊ”ab™y
,

31 
gbr
,

32 
mbr
)

34 
m_qci
 = 
qci
;

35 
m_gbr
 = 
gbr
;

36 
m_mbr
 = 
mbr
;

37 
m_¬pP»Em±iÚC­ab™y
 = 
¬pP»Em±iÚC­ab™y
;

38 
m_¬pP»Em±iÚVuÊ”ab™y
 = 
¬pP»Em±iÚVuÊ”ab™y
;

39 
m_maxD–ay
 = 0;

40 
	}
}

43 
	gQoSP¬am‘”s
::~
	$QoSP¬am‘”s
()

44 {
	}
}

47 
QoSP¬am‘”s
::
	$S‘QCI
 (
qci
)

49 
m_qci
 = 
qci
;

50 
	}
}

53 
	gQoSP¬am‘”s
::
	$G‘QCI
 () const

55  
m_qci
;

56 
	}
}

59 
	gQoSP¬am‘”s
::
	$S‘A½P»Em±iÚC­ab™y
 (
boŞ
 
æag
)

61 
m_¬pP»Em±iÚC­ab™y
 = 
æag
;

62 
	}
}

64 
boŞ


65 
	gQoSP¬am‘”s
::
	$G‘A½P»Em±iÚC­ab™y
 () const

67  
m_¬pP»Em±iÚC­ab™y
;

68 
	}
}

71 
	gQoSP¬am‘”s
::
	$S‘A½P»Em±iÚVuÊ”ab™y
 (
boŞ
 
æag
)

73 
m_¬pP»Em±iÚVuÊ”ab™y
 = 
æag
;

74 
	}
}

76 
boŞ


77 
	gQoSP¬am‘”s
::
	$G‘A½P»Em±iÚVuÊ”ab™y
 () const

79  
m_¬pP»Em±iÚVuÊ”ab™y
;

80 
	}
}

83 
	gQoSP¬am‘”s
::
	$S‘GBR
 (
gbr
)

85 
m_gbr
 = 
gbr
;

86 
	}
}

89 
	gQoSP¬am‘”s
::
	$G‘GBR
 () const

91  
m_gbr
;

92 
	}
}

95 
	gQoSP¬am‘”s
::
	$S‘MBR
 (
mbr
)

97 
m_mbr
 = 
mbr
;

98 
	}
}

101 
	gQoSP¬am‘”s
::
	$G‘MBR
 () const

103  
m_mbr
;

104 
	}
}

107 
	gQoSP¬am‘”s
::
	$S‘MaxD–ay
 (
rg‘D–ay
)

109 
m_maxD–ay
 = 
rg‘D–ay
;

110 
	}
}

113 
	gQoSP¬am‘”s
::
	$G‘MaxD–ay
 () const

115  
m_maxD–ay
;

116 
	}
}

	@/home/lyang3/work/src_son/runWorld/QoS/QoSParameters.h

2 #iâdeà
QOSPARAMETERS_H_


3 
	#QOSPARAMETERS_H_


	)

37 şas 
	cQoSP¬am‘”s
 {

38 
	mpublic
:

39 
QoSP¬am‘”s
();

40 
QoSP¬am‘”s
 (
qci
,

41 
gbr
,

42 
mbr
);

43 
QoSP¬am‘”s
 (
qci
,

44 
boŞ
 
¬pP»Em±iÚC­ab™y
,

45 
boŞ
 
¬pP»Em±iÚVuÊ”ab™y
,

46 
gbr
,

47 
mbr
);

48 
	mvœtu®
 ~
QoSP¬am‘”s
();

51 
S‘QCI
 (
qci
);

53 
	$G‘QCI
 () const;

55 
	`S‘A½P»Em±iÚC­ab™y
 (
boŞ
 
æag
);

56 
boŞ


57 
	$G‘A½P»Em±iÚC­ab™y
 () const;

59 
	`S‘A½P»Em±iÚVuÊ”ab™y
 (
boŞ
 
æag
);

60 
boŞ


61 
	$G‘A½P»Em±iÚVuÊ”ab™y
 () const;

63 
	`S‘GBR
 (
gbr
);

65 
	$G‘GBR
 () const;

67 
	`S‘MBR
 (
mbr
);

69 
	$G‘MBR
 () const;

72 
	`S‘MaxD–ay
 (
rg‘D–ay
);

74 
	$G‘MaxD–ay
 () const;

76 
´iv©e
:

77 
m_qci
;

78 
boŞ
 
m_¬pP»Em±iÚC­ab™y
;

79 
boŞ
 
m_¬pP»Em±iÚVuÊ”ab™y
;

80 
m_gbr
;

81 
m_mbr
;

83 
m_maxD–ay
;

	@/home/lyang3/work/src_son/runWorld/RadioBearer/radio-bearer-instance.cpp

2 
	~"¿dio-b—»r-š¡ªû.h
"

3 
	~"../deviû/N‘wÜkNode.h
"

4 
	~"../deviû/IPCÏssif›r/CÏssif›rP¬am‘”s.h
"

5 
	~"­¶iÿtiÚ/AµliÿtiÚ.h
"

6 
	~"../´ÙocŞSck/·ck‘/Pack‘.h
"

7 
	~"../lßd-·¿m‘”s.h
"

8 
	~"../æows/MacQueue.h
"

9 
	~"../æows/QoS/QoSP¬am‘”s.h
"

10 
	~"../æows/QoS/QoSFÜEXP.h
"

11 
	~"../æows/QoS/QoSFÜFLS.h
"

12 
	~"../æows/QoS/QoSFÜM_LWDF.h
"

13 
	~"../´ÙocŞSck/¾c/¾c-’t™y.h
"

14 
	~"../´ÙocŞSck/¾c/tm-¾c-’t™y.h
"

15 
	~"../´ÙocŞSck/¾c/um-¾c-’t™y.h
"

16 
	~"../´ÙocŞSck/¾c/am-¾c-’t™y.h
"

19 
	gRadioB—»rIn¡ªû
::
	$RadioB—»rIn¡ªû
()

21 
m_¤c
 = 
NULL
;

22 
m_d¡
 = 
NULL
;

23 
m_şassif›rP¬am‘”s
 = 
NULL
;

24 
m_qosP¬am‘”s
 = 
NULL
;

25 
m_¾c
 = 
NULL
;

26 
	}
}

28 
	gRadioB—»rIn¡ªû
::~
	$RadioB—»rIn¡ªû
()

30 
	`De¡Üy
 ();

31 
	}
}

34 
	gRadioB—»rIn¡ªû
::
	$De¡Üy
 ()

36 
m_¤c
 = 
NULL
;

37 
m_d¡
 = 
NULL
;

38 
m_şassif›rP¬am‘”s
 = 
NULL
;

39 
m_qosP¬am‘”s
 = 
NULL
;

40 
d–‘e
 
m_¾c
;

41 
	}
}

44 
	gRadioB—»rIn¡ªû
::
	$S‘CÏssif›rP¬am‘”s
 (
CÏssif›rP¬am‘”s
* 
ı
)

46 
m_şassif›rP¬am‘”s
 = 
ı
;

47 
	}
}

49 
CÏssif›rP¬am‘”s
*

50 
	gRadioB—»rIn¡ªû
::
	$G‘CÏssif›rP¬am‘”s
 ()

52  
m_şassif›rP¬am‘”s
;

53 
	}
}

56 
	gRadioB—»rIn¡ªû
::
	$S‘Sourû
 (
N‘wÜkNode
* 
¤c
)

58 
m_¤c
 = 
¤c
;

59 
	}
}

62 
	gRadioB—»rIn¡ªû
::
	$S‘De¡š©iÚ
 (
N‘wÜkNode
* 
d¡
)

64 
m_d¡
 = 
d¡
;

65 
	}
}

67 
N‘wÜkNode
*

68 
	gRadioB—»rIn¡ªû
::
	$G‘Sourû
 ()

70  
m_¤c
;

71 
	}
}

73 
N‘wÜkNode
*

74 
	gRadioB—»rIn¡ªû
::
	$G‘De¡š©iÚ
 ()

76  
m_d¡
;

77 
	}
}

80 
	gRadioB—»rIn¡ªû
::
	$S‘QoSP¬am‘”s
 (
QoSP¬am‘”s
 *
·¿m‘”s
)

82 
m_qosP¬am‘”s
 = 
·¿m‘”s
;

83 
	}
}

85 
QoSP¬am‘”s
*

86 
	gRadioB—»rIn¡ªû
::
	$G‘QoSP¬am‘”s
 () const

88  
m_qosP¬am‘”s
;

89 
	}
}

92 
	gRadioB—»rIn¡ªû
::
	$S‘RlcEÁ™y
 (
RlcEÁ™y
 *
¾c
)

94 
m_¾c
 = 
¾c
;

95 
	}
}

97 
RlcEÁ™y
*

98 
	gRadioB—»rIn¡ªû
::
	$G‘RlcEÁ™y
 ()

100  
m_¾c
;

101 
	}
}

	@/home/lyang3/work/src_son/runWorld/RadioBearer/radio-bearer-instance.h

3 #iâdeà
RADIO_BEARER_INSTANCE_H_


4 
	#RADIO_BEARER_INSTANCE_H_


	)

6 
şass
 
	gN‘wÜkNode
;

7 
şass
 
	gCÏssif›rP¬am‘”s
;

8 
şass
 
	gAµliÿtiÚ
;

9 
şass
 
	gMacQueue
;

10 
şass
 
	gQoSP¬am‘”s
;

11 
şass
 
	gPack‘
;

12 
şass
 
	gRlcEÁ™y
;

14 şas 
	cRadioB—»rIn¡ªû
 {

15 
	mpublic
:

16 
RadioB—»rIn¡ªû
();

17 
	mvœtu®
 ~
RadioB—»rIn¡ªû
();

19 
De¡Üy
 ();

21 
S‘Sourû
 (
N‘wÜkNode
* 
¤c
);

22 
S‘De¡š©iÚ
 (
N‘wÜkNode
* 
d¡
);

23 
N‘wÜkNode
* 
G‘Sourû
 ();

24 
N‘wÜkNode
* 
G‘De¡š©iÚ
 ();

26 
S‘RlcEÁ™y
 (
RlcEÁ™y
 *
¾c
);

27 
RlcEÁ™y
* 
G‘RlcEÁ™y
 ();

29 
S‘CÏssif›rP¬am‘”s
 (
CÏssif›rP¬am‘”s
* 
ı
);

30 
CÏssif›rP¬am‘”s
* 
G‘CÏssif›rP¬am‘”s
 ();

32 
S‘QoSP¬am‘”s
 (
QoSP¬am‘”s
 *
·¿m‘”s
);

33 
QoSP¬am‘”s
* 
	$G‘QoSP¬am‘”s
 () const;

35 
	eB—»rQoSTy³


37 
BEARER_TYPE_GBR
, 
BEARER_TYPE_NGBR


40 
	`S‘B—»rQoSTy³
 (
B—»rQoSTy³
 
b—»rQoSTy³
);

41 
B—»rQoSTy³
 
	$G‘B—»rQoSTy³
 () const;

43 
´iv©e
:

44 
N‘wÜkNode
* 
m_¤c
;

45 
N‘wÜkNode
* 
m_d¡
;

47 
CÏssif›rP¬am‘”s
* 
m_şassif›rP¬am‘”s
;

49 
RlcEÁ™y
 *
m_¾c
;

52 
QoSP¬am‘”s
 *
m_qosP¬am‘”s
;

53 
B—»rQoSTy³
 
m_ty³
;

55 
	}
};

	@/home/lyang3/work/src_son/runWorld/RadioBearer/radio-bearer-sink.cpp

2 
	~"¿dio-b—»r-sšk.h
"

3 
	~"¿dio-b—»r.h
"

4 
	~"../deviû/N‘wÜkNode.h
"

5 
	~"../deviû/IPCÏssif›r/CÏssif›rP¬am‘”s.h
"

6 
	~"­¶iÿtiÚ/­¶iÿtiÚ-sšk.h
"

7 
	~"../´ÙocŞSck/¾c/¾c-’t™y.h
"

8 
	~"../´ÙocŞSck/¾c/tm-¾c-’t™y.h
"

9 
	~"../´ÙocŞSck/¾c/um-¾c-’t™y.h
"

10 
	~"../´ÙocŞSck/¾c/am-¾c-’t™y.h
"

11 
	~"../lßd-·¿m‘”s.h
"

13 
	gRadioB—»rSšk
::
	$RadioB—»rSšk
()

15 
	`S‘CÏssif›rP¬am‘”s
 (
NULL
);

16 
	`S‘Sourû
 (
NULL
);

17 
	`S‘De¡š©iÚ
 (
NULL
);

20 
RlcEÁ™y
 *
¾c
 = 
Ãw
 
	`AmRlcEÁ™y
 ();

23 
¾c
->
	`S‘RadioB—»r
 (
this
);

24 
	`S‘RlcEÁ™y
(
¾c
);

25 
	}
}

27 
	gRadioB—»rSšk
::~
	$RadioB—»rSšk
()

29 
m_­¶iÿtiÚ
 = 
NULL
;

30 
	`De¡Üy
 ();

31 
	}
}

34 
	gRadioB—»rSšk
::
	$S‘AµliÿtiÚ
 (
AµliÿtiÚSšk
* 
a
)

36 
m_­¶iÿtiÚ
 = 
a
;

37 
	}
}

39 
AµliÿtiÚSšk
*

40 
	gRadioB—»rSšk
::
	$G‘AµliÿtiÚ
 ()

42  
m_­¶iÿtiÚ
;

43 
	}
}

46 
	gRadioB—»rSšk
::
	$Reûive
 (
Pack‘
* 
p
)

48 
RadioB—»r
* 
txB—»r
 = 
	`G‘AµliÿtiÚ
 ()->
	`G‘SourûAµliÿtiÚ
 ()->
	`G‘RadioB—»r
 ();

49 
txB—»r
->
	`Upd©eT¿nsm™‹dBy‹s
 (
p
->
	`G‘Size
 ());

51 
	`G‘AµliÿtiÚ
 ()->
	`Reûive
 (
p
);

52 
	}
}

	@/home/lyang3/work/src_son/runWorld/RadioBearer/radio-bearer-sink.h

2 #iâdeà
RADIOBEARERSINK_H_


3 
	#RADIOBEARERSINK_H_


	)

5 
	~"¿dio-b—»r-š¡ªû.h
"

7 
şass
 
	gN‘wÜkNode
;

8 
şass
 
	gCÏssif›rP¬am‘”s
;

9 
şass
 
	gAµliÿtiÚSšk
;

10 
şass
 
	gPack‘
;

11 
şass
 
	gRlcEÁ™y
;

13 şas 
	cRadioB—»rSšk
 : 
public
 
RadioB—»rIn¡ªû
 {

14 
public
:

15 
RadioB—»rSšk
();

16 
	mvœtu®
 ~
RadioB—»rSšk
();

18 
S‘AµliÿtiÚ
 (
AµliÿtiÚSšk
* 
a
);

19 
AµliÿtiÚSšk
* 
G‘AµliÿtiÚ
 ();

21 
Reûive
 (
Pack‘
* 
p
);

23 
	m´iv©e
:

24 
AµliÿtiÚSšk
* 
m_­¶iÿtiÚ
;

	@/home/lyang3/work/src_son/runWorld/RadioBearer/radio-bearer.cpp

3 
	~"¿dio-b—»r.h
"

4 
	~"../deviû/N‘wÜkNode.h
"

5 
	~"../deviû/IPCÏssif›r/CÏssif›rP¬am‘”s.h
"

6 
	~"­¶iÿtiÚ/AµliÿtiÚ.h
"

7 
	~"../´ÙocŞSck/·ck‘/Pack‘.h
"

8 
	~"../æows/MacQueue.h
"

9 
	~"../æows/QoS/QoSP¬am‘”s.h
"

10 
	~"../æows/QoS/QoSFÜEXP.h
"

11 
	~"../æows/QoS/QoSFÜFLS.h
"

12 
	~"../æows/QoS/QoSFÜM_LWDF.h
"

13 
	~"../´ÙocŞSck/¾c/¾c-’t™y.h
"

14 
	~"../´ÙocŞSck/¾c/tm-¾c-’t™y.h
"

15 
	~"../´ÙocŞSck/¾c/um-¾c-’t™y.h
"

16 
	~"../´ÙocŞSck/¾c/am-¾c-’t™y.h
"

17 
	~"../´ÙocŞSck/¾c/amd-»cÜd.h
"

18 
	~"../lßd-·¿m‘”s.h
"

20 
	gRadioB—»r
::
	$RadioB—»r
()

22 
m_macQueue
 = 
Ãw
 
	`MacQueue
 ();

23 
m_­¶iÿtiÚ
 = 
NULL
;

26 
RlcEÁ™y
 *
¾c
 = 
Ãw
 
	`AmRlcEÁ™y
 ();

29 
¾c
->
	`S‘RadioB—»r
 (
this
);

30 
	`S‘RlcEÁ™y
(
¾c
);

32 
m_av”ageT¿nsmissiÚR©e
 = 100000;

33 
	`Re£tT¿nsm™‹dBy‹s
 ();

34 
	}
}

36 
	gRadioB—»r
::~
	$RadioB—»r
()

38 
	`De¡Üy
 ();

39 
d–‘e
 
m_macQueue
;

40 
m_­¶iÿtiÚ
 = 
NULL
;

41 
	}
}

43 
MacQueue
*

44 
	gRadioB—»r
::
	$G‘MacQueue
 ()

46  
m_macQueue
;

47 
	}
}

50 
	gRadioB—»r
::
	$S‘AµliÿtiÚ
 (
AµliÿtiÚ
* 
a
)

52 
m_­¶iÿtiÚ
 = 
a
;

53 
	}
}

55 
AµliÿtiÚ
*

56 
	gRadioB—»r
::
	$G‘AµliÿtiÚ
 ()

58  
m_­¶iÿtiÚ
;

59 
	}
}

62 
	gRadioB—»r
::
	$Upd©eT¿nsm™‹dBy‹s
 (
by‹s
)

64 
m_Œªsm™‹dBy‹s
 +ğ
by‹s
;

65 
	}
}

68 
	gRadioB—»r
::
	$G‘T¿nsm™‹dBy‹s
 () const

70  
m_Œªsm™‹dBy‹s
;

71 
	}
}

74 
	gRadioB—»r
::
	$Re£tT¿nsm™‹dBy‹s
 ()

76 
m_Œªsm™‹dBy‹s
 = 0;

77 
	`S‘La¡Upd©e
 ();

78 
	}
}

81 
	gRadioB—»r
::
	$Upd©eAv”ageT¿nsmissiÚR©e
 ()

89 
¿‹
 = (
	`G‘T¿nsm™‹dBy‹s
 (è* 8)/(
SimuÏtÜ
::
	`In™
()->
	`Now
(è- 
	`G‘La¡Upd©e
());

91 
b‘a
 = 0.2;

93 
m_av”ageT¿nsmissiÚR©e
 =

94 ((1 - 
b‘a
è* 
m_av”ageT¿nsmissiÚR©e
è+ (b‘¨* 
¿‹
);

96 ià(
m_av”ageT¿nsmissiÚR©e
 < 1)

98 
m_av”ageT¿nsmissiÚR©e
 = 1;

112 
	`Re£tT¿nsm™‹dBy‹s
();

113 
	}
}

116 
	gRadioB—»r
::
	$G‘Av”ageT¿nsmissiÚR©e
 () const

118  
m_av”ageT¿nsmissiÚR©e
;

119 
	}
}

122 
	gRadioB—»r
::
	$S‘La¡Upd©e
 ()

124 
m_Ï¡Upd©e
 = 
SimuÏtÜ
::
	`In™
()->
	`Now
();

125 
	}
}

128 
	gRadioB—»r
::
	$G‘La¡Upd©e
 () const

130  
m_Ï¡Upd©e
;

131 
	}
}

133 
Pack‘
*

134 
	gRadioB—»r
::
	$C»©ePack‘
 (
by‹s
)

136 
Pack‘
 *
p
 = 
Ãw
 
	`Pack‘
 ();

138 
p
->
	`S‘ID
(
SimuÏtÜ
::
	`In™
()->
	`G‘UID
 ());

139 
p
->
	`S‘TimeSmp
(
SimuÏtÜ
::
	`In™
()->
	`Now
 ());

141 
UDPH—d”
 *
udp
 = 
Ãw
 
	`UDPH—d”
 (
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘SourûPÜt
(),

142 
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘De¡š©iÚPÜt
 ());

143 
p
->
	`AddUDPH—d”
(
udp
);

145 
IPH—d”
 *

 = 
Ãw
 
	`IPH—d”
 (
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘SourûID
 (),

146 
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘De¡š©iÚID
());

147 
p
->
	`AddIPH—d”
(

);

149 
PDCPH—d”
 *
pdı
 = 
Ãw
 
	`PDCPH—d”
 ();

150 
p
->
	`AddPDCPH—d”
 (
pdı
);

152 
RLCH—d”
 *
¾c
 = 
Ãw
 
	`RLCH—d”
 ();

153 
p
->
	`AddRLCH—d”
(
¾c
);

155 
Pack‘TAGs
 *
gs
 = 
Ãw
 
	`Pack‘TAGs
 ();

156 
gs
->
	`S‘AµliÿtiÚTy³
(
Pack‘TAGs
::
APPLICATION_TYPE_INFINITE_BUFFER
);

157 
p
->
	`S‘Pack‘Tags
(
gs
);

159 ià(
_APP_TRACING_
)

166 
¡d
::
cout
 << "TX";

167 
p
->
	`G‘Pack‘Tags
 ()->
	`G‘AµliÿtiÚTy³
 ())

169 
AµliÿtiÚ
::
APPLICATION_TYPE_VOIP
:

171 
¡d
::
cout
 << " VOIP";

174 
AµliÿtiÚ
::
APPLICATION_TYPE_TRACE_BASED
:

176 
¡d
::
cout
 << " VIDEO";

179 
AµliÿtiÚ
::
APPLICATION_TYPE_CBR
:

181 
¡d
::
cout
 << " CBR";

184 
AµliÿtiÚ
::
APPLICATION_TYPE_INFINITE_BUFFER
:

186 
¡d
::
cout
 << " INF_BUF";

191 
¡d
::
cout
 << " UNDEFINED";

196 ià(
by‹s
 > 1490) bytes = 1490;

197 
by‹s
 = bytes - 13;

199 
¡d
::
cout
 << " ID " << 
p
->
	`G‘ID
 ()

200 << " B " << 
	`G‘RlcEÁ™y
 ()->
	`G‘RlcEÁ™yIndex
 ()

201 << " SIZE " << 
by‹s


202 << " SRC " << 
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 ()

203 << " DST " << 
	`G‘De¡š©iÚ
 ()->
	`G‘IDN‘wÜkNode
 ()

204 << " T " << 
SimuÏtÜ
::
	`In™
()->
	`Now
(è<< 
¡d
::
’dl
;

207  
p
;

208 
	}
}

211 
	gRadioB—»r
::
	$G‘QueueSize
 ()

213 
size
 = 0;

214 
size
 +ğ
	`G‘MacQueue
 ()->
	`G‘QueueSizeW™hMACHov”h—d
 ();

216 ià(
	`G‘RlcEÁ™y
 ()->
	`G‘RlcMod–
 (è=ğ
RlcEÁ™y
::
AM_RLC_MODE
)

218 
AmRlcEÁ™y
* 
amRlc
 = (AmRlcEÁ™y*è
	`G‘RlcEÁ™y
 ();

219 
size
 +ğ
amRlc
->
	`G‘SizeOfUÇknowËdgedAmd
 ();

222  
size
;

223 
	}
}

226 
	gRadioB—»r
::
	$G‘H—dOfLšePack‘D–ay
 ()

228 
HOL
 = 0.;

229 
now
 = 
SimuÏtÜ
::
	`In™
()->
	`Now
();

230 ià(
	`G‘RlcEÁ™y
 ()->
	`G‘RlcMod–
 (è=ğ
RlcEÁ™y
::
AM_RLC_MODE
)

232 
AmRlcEÁ™y
* 
amRlc
 = (AmRlcEÁ™y*è
	`G‘RlcEÁ™y
 ();

233 ià(
amRlc
->
	`G‘S’tAMDs
()->
	`size
() > 0)

235 
HOL
 = 
now
 - 
amRlc
->
	`G‘S’tAMDs
()->
	`©
 (0)->
m_·ck‘
->
	`G‘TimeSmp
 ();

239 
HOL
 = 
now
 - 
	`G‘MacQueue
 ()->
	`P“k
 ().
	`G‘TimeSmp
 ();

244 
HOL
 = 
now
 - 
	`G‘MacQueue
 ()->
	`P“k
().
	`G‘TimeSmp
 ();

247 ià(
HOL
 < 0.00001) HOL = 0.00001;

249  
HOL
;

250 
	}
}

253 
	gRadioB—»r
::
	$CheckFÜDrİPack‘s
 ()

255 ià(
m_­¶iÿtiÚ
->
	`G‘AµliÿtiÚTy³
 (è!ğ
AµliÿtiÚ
::
APPLICATION_TYPE_TRACE_BASED


257 
m_­¶iÿtiÚ
->
	`G‘AµliÿtiÚTy³
 (è!ğ
AµliÿtiÚ
::
APPLICATION_TYPE_VOIP
)

262 
	`G‘MacQueue
()->
	`CheckFÜDrİPack‘s
(

263 
	`G‘QoSP¬am‘”s
()->
	`G‘MaxD–ay
(), 
m_­¶iÿtiÚ
->
	`G‘AµliÿtiÚID
 ());

264 
	}
}

267 
	gRadioB—»r
::
	$Enqueue
 (
Pack‘
 *
·ck‘
)

269 #ifdeà
TEST_ENQUEUE_PACKETS


270 
¡d
::
cout
 << "Enqueu·ck‘ oÀ" << 
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 (è<< std::
’dl
;

273 
	`G‘MacQueue
 ()->
	`Enqueue
(
·ck‘
);

274 
	}
}

277 
boŞ


278 
	gRadioB—»r
::
	$HasPack‘s
 ()

280 ià(
m_­¶iÿtiÚ
->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_INFINITE_BUFFER
)

282  
Œue
;

285 ià(
	`G‘RlcEÁ™y
 ()->
	`G‘RlcMod–
 (è=ğ
RlcEÁ™y
::
AM_RLC_MODE
)

287 
AmRlcEÁ™y
* 
amRlc
 = (AmRlcEÁ™y*è
	`G‘RlcEÁ™y
 ();

288 ià(
amRlc
->
	`G‘S’tAMDs
()->
	`size
() > 0)

290  
Œue
;

294  !
	`G‘MacQueue
 ()->
	`IsEm±y
();

299  !
	`G‘MacQueue
 ()->
	`IsEm±y
();

301 
	}
}

	@/home/lyang3/work/src_son/runWorld/RadioBearer/radio-bearer.h

2 #iâdeà
RADIOBEARER_H_


3 
	#RADIOBEARER_H_


	)

5 
	~"¿dio-b—»r-š¡ªû.h
"

7 
şass
 
	gN‘wÜkNode
;

8 
şass
 
	gCÏssif›rP¬am‘”s
;

9 
şass
 
	gAµliÿtiÚ
;

10 
şass
 
	gMacQueue
;

11 
şass
 
	gQoSP¬am‘”s
;

12 
şass
 
	gPack‘
;

13 
şass
 
	gRlcEÁ™y
;

15 şas 
	cRadioB—»r
 : 
public
 
RadioB—»rIn¡ªû
 {

16 
public
:

17 
RadioB—»r
();

18 
	mvœtu®
 ~
RadioB—»r
();

20 
MacQueue
* 
G‘MacQueue
 ();

22 
S‘AµliÿtiÚ
 (
AµliÿtiÚ
* 
a
);

23 
AµliÿtiÚ
* 
G‘AµliÿtiÚ
 ();

25 
Upd©eT¿nsm™‹dBy‹s
 (
by‹s
);

26 
	$G‘T¿nsm™‹dBy‹s
 () const;

27 
	`Re£tT¿nsm™‹dBy‹s
 ();

28 
	`Upd©eAv”ageT¿nsmissiÚR©e
 ();

29 
	$G‘Av”ageT¿nsmissiÚR©e
 () const;

30 
	`S‘La¡Upd©e
 ();

31 
	$G‘La¡Upd©e
 () const;

34 
	`Enqueue
 (
Pack‘
 *
·ck‘
);

35 
boŞ
 
	`HasPack‘s
 ();

37 
Pack‘
* 
	`C»©ePack‘
 (
by‹s
);

39 
	`CheckFÜDrİPack‘s
 ();

41 
	`G‘QueueSize
 ();

42 
	`G‘H—dOfLšePack‘D–ay
 ();

44 
´iv©e
:

45 
AµliÿtiÚ
* 
m_­¶iÿtiÚ
;

47 
MacQueue
 *
m_macQueue
;

50 
m_av”ageT¿nsmissiÚR©e
;

51 
m_Œªsm™‹dBy‹s
;

52 
m_Ï¡Upd©e
;

	@/home/lyang3/work/src_son/runWorld/bs.cpp

1 
	~<io¡»am
>

2 
	~<iomª
>

3 
	~<f¡»am
>

4 
	~<m©h.h
>

5 
	~"runWÜld.h
"

6 
	~"geom‘ry.h
"

7 
	~"bs.h
"

9 
usšg
 
Çme¥aû
 
	g¡d
;

10 
	gRBSizeTabË
[27] = {1, 2, 3, 4, 5, 6, 8, 10, 12, 14, 18, 22, 26, 30, 34, 38, 42, 46, 50, 54,

14 
	gT¿fficMªag”
::
	$T¿fficMªag”
()

16 
ŒafficMod–
 = 
FuÎBuff
;

17 
iU£rS”ved
 = 0;

18 
iU£rS”všg
 = 0;

19 
iU£rS”všgUl
 = 0;

20 
	}
};

22 
	gT¿fficMªag”
::~
	$T¿fficMªag”
()

24 
	}
};

27 
	gnB_h¥a_·¿ms
::
	$nB_h¥a_·¿ms
()

29 
	}
};

31 
	gnB_h¥a_·¿ms
::~
	$nB_h¥a_·¿ms
()

33 
	}
};

35 
	gnB_h¥a_·¿ms
::
	$´št
()

37 
cout
 << 
fixed
 << 
	`£»cisiÚ
(1)

39 << 
ŒafficMªag”
.
iU£rS”ved


41 << 
dTxpow”


43 << 
dRxšt


45 
	}
};

51 
	g’B_Ée_·¿ms
::
	$’B_Ée_·¿ms
()

53 
i
,
j
;

54 
i
=0; i<
Nrb
; i++)

55 
TxPow”ENB³rRB
[
i
] = 0.0;

57 
i
=0; i<
numBlocksDL
; i++)

58 
j
=0; j<8; j++)

59 
TxPow”ENB³rBlockRecÜd
[
i
][
j
] = 0.0;

61 
	}
};

63 
	g’B_Ée_·¿ms
::~
	$’B_Ée_·¿ms
()

65 
	}
};

67 
	g’B_Ée_·¿ms
::
	$´št
()

69 
cout
 << "\tServed LTE Users: "

70 << 
ŒafficMªag”
.
iU£rS”ved


72 << 
dTxpow”


74 << 
dRxšt


76 
	}
};

80 
	gSeùÜ
::
	$SeùÜ
()

82 
	}
}

84 
SeùÜ
::
	$š™Ÿli£
(
iSeùÜ
)

87 
dB—ršg
 = (
iSeùÜ
+0.5)*2.0*
PI
/(1.0*
MACROSECTORS
);

90 
nB_h¥a_·rs
.
ŒafficMªag”
.
iU£rS”ved
 = 0;

91 
nB_h¥a_·rs
.
dTxpow”
 = 
HSPANBTXPWRMACRO
;

92 
nB_h¥a_·rs
.
dRxšt
 = 
NOdBm
;

93 
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
 = 0;

94 
’B_Ée_·rs
.
dTxpow”
 = 
LTEeNBTXPWRMACRO
;

95 
’B_Ée_·rs
.
dRxšt
 = 
NOdBm
;

99 
	}
}

101 
	gSeùÜ
::
	$ª‹ÂaGaš
(
dTh‘a
){

103 
dTh‘a_3dB
 =70.0,

104 
dAm
 = 20.0,

105 
dA·‰”n
;

107 
dA·‰”n
 = 12.0 * 
	`pow
((
dTh‘a
/
dTh‘a_3dB
),2.0);

108 ià(
dA·‰”n
 < 20.0){

109  (
BSANTGAIN
-
dA·‰”n
);

112  (
BSANTGAIN
-20.0);

114 
	}
}

116 
	gSeùÜ
::
	$ª‹ÂaA‰’
(
dTh‘a
){

118 
dTh‘a_3dB
 =70.0,

119 
dAm
 = 20.0,

120 
dA·‰”n
;

122 
dA·‰”n
 = 12.0 * 
	`pow
((
dTh‘a
/
dTh‘a_3dB
),2.0);

123 ià(
dA·‰”n
 < 20.0){

124  
	`pow
(10.0,-
dA·‰”n
/20.0);

127  
	`pow
(10.0, -1.0);

129 
	}
}

131 
	gSeùÜ
::
	$ª‹ÂaTe¡
(){

133 
dAngË
,

134 
dGaš
;

136 
of¡»am


137 
feAÁ’ÇP©‹º
;

139 
feAÁ’ÇP©‹º
.
	`İ’
("Results/AntennaPattern.txt");

141 
dAngË
 = -179; dAngle < 180.0; dAngle += 1.0){

142 
dGaš
 = 
	`ª‹ÂaGaš
(
dAngË
);

143 
feAÁ’ÇP©‹º
 << 
dAngË
 << "\t" << 
dGaš
 << 
’dl
;

145 
feAÁ’ÇP©‹º
.
	`şo£
();

147 
	}
}

149 
	gSeùÜ
::
	$´št
()

151 
cout
 << "B—ršg: " << 180.0*
dB—ršg
/
PI
 << " ";

152 
nB_h¥a_·rs
.
	`´št
();

153 
’B_Ée_·rs
.
	`´št
();

154 
cout
 << 
’dl
;

155 
	}
}

157 
	gSeùÜ
::~
	$SeùÜ
()

159 
	}
}

164 
Ba£S™e
::
	$Ba£S™e
()

166 
	}
}

168 
Ba£S™e
::
	$š™Ÿli£
()

171 
iSeùÜ
;

174 
iSeùÜ
=0; iSeùÜ<
MACROSECTORS
; iSector++){

175 
SeùÜs
[
iSeùÜ
].
	`š™Ÿli£
(iSector);

178 
ª‹ÂaHeight
 = 
BSANTHEIGHT
;

179 
	}
}

181 
	gBa£S™e
::
	$´št
()

184 
iSeùÜ
;

186 
LoÿtiÚ
.
	`´št
();

187 
cout
 << 
’dl
;

189 
iSeùÜ
=0; iSeùÜ<
MACROSECTORS
; iSector++){

190 
cout
 << "SeùÜ: " << 
iSeùÜ
 << " ";

191 
SeùÜs
[
iSeùÜ
].
	`´št
();

195 
	}
}

196 
	gBa£S™e
::~
	$Ba£S™e
()

198 
	}
}

202 
FemtoS™e
::
	$FemtoS™e
()

204 
	}
}

206 
FemtoS™e
::~
	$FemtoS™e
()

208 
	}
}

210 
FemtoS™e
::
	$š™Ÿli£
()

212 
ª‹ÂaHeight
 = 
FEMTOANTHEIGHT
;

213 
pow”S‘tšgM‘hod
 = 
viùimUE
;

215 
®phaPow”S‘tšg
 = 1;

216 
b‘aPow”S‘tšg
 = 55;

219 
nB_h¥a_·rs
.
ŒafficMªag”
.
iU£rS”ved
 = 0;

220 
nB_h¥a_·rs
.
dTxpow”
 = 
LTEHeNBTXPWRFEMTO
;

221 
nB_h¥a_·rs
.
dRxšt
 = 
NOdBm
;

222 
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
 = 0;

223 
’B_Ée_·rs
.
dTxpow”
 = 
LTEHeNBTXPWRFEMTO
;

224 
’B_Ée_·rs
.
dRxšt
 = 
NOdBm
;

225 
	}
}

227 
	gFemtoS™e
::
	$pow”S‘tšg
(
UE
 *
HUEs
, UE *
MUEs
, 
numMaüoS™es
, 
numMUE
){

230 
iS™es
, 
iSeùs
, 
iUE
,

231 
æagViùimD‘eùed
,

232 
šdexViùimUE
;

234 
PLTmp
,

235 
PLMax
 = 0,

236 
PLMš
 = 200,

237 
RxPwr
,

238 
Ioh
 = -200,

239 
Iob
,

240 
üsEC
;

242 ià(
pow”S‘tšgM‘hod
 =ğ
viùimUE
){

244 
Iob
 = 
’B_Ée_·rs
.
dRxšt
;

245 
æagViùimD‘eùed
 = 1;

247 
PLMš
 = 200;

248 
iS™es
=0; iS™es<
numMaüoS™es
; iSites++){

249 
iSeùs
=0; iSeùs<
MACROSECTORS
; iSects++){

250 
PLTmp
 = 
ûÎD©a
[
iS™es
][
iSeùs
].
dP©hloss
;

251 ià(
PLMš
 > 
PLTmp
){

252 
PLMš
 = 
PLTmp
;

254 
Ioh
 = 
	`AdddBm
(Ioh, 
LTEeNBTXPWRMACRO
 - 
PLTmp
);

258 
üsEC
 = 
LTEeNBTXPWRMACRO
 - 
PLMš
;

260 ià(
Iob
 < -103)

261 
æagViùimD‘eùed
 = 0;

263 ià(
Ioh
 > 
üsEC
 + 30)

265 
’B_Ée_·rs
.
dTxpow”
 = 10;

269 ià(
æagViùimD‘eùed
 == 1){

272 
’B_Ée_·rs
.
dTxpow”
 = 
üsEC
 * 
®phaPow”S‘tšg
 + 
b‘aPow”S‘tšg
;

277 ià(
pow”S‘tšgM‘hod
 =ğ
basicMaxPl
){

279 
iUE
 = 0; iUE < 
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
; iUE++){

280 
PLMš
 = 200;

281 
iS™es
=0; iS™es<
numMaüoS™es
; iSites++){

282 
iSeùs
=0; iSeùs<
MACROSECTORS
; iSects++){

283 
PLTmp
 = 
HUEs
[
’B_Ée_·rs
.
ŒafficMªag”
.
ueS”vedQueue
[
iUE
]].
ueLTEd©a
.
ûÎD©a
[
iS™es
][
iSeùs
].
dP©hloss
;

284 ià(
PLMš
 > 
PLTmp
){

285 
PLMš
 = 
PLTmp
;

289 ià(
PLMš
 > 
PLMax
)

290 
PLMax
 = 
PLMš
;

292 
RxPwr
 = 
LTEeNBTXPWRMACRO
 - 
PLMax
;

293 
’B_Ée_·rs
.
dTxpow”
 = 
RxPwr
 + 
DLd—dzÚeT¬g‘
 - 
DLmšMaüoSIR
;

296 if(
pow”S‘tšgM‘hod
 =ğ
¢ifãrMaüoBS
){

298 
PLMš
 = 200;

299 
iS™es
=0; iS™es<
numMaüoS™es
; iSites++){

300 
iSeùs
=0; iSeùs<
MACROSECTORS
; iSects++){

301 
PLTmp
 = 
ûÎD©a
[
iS™es
][
iSeùs
].
dP©hloss
;

302 ià(
PLMš
 > 
PLTmp
){

303 
PLMš
 = 
PLTmp
;

308 
RxPwr
 = 
LTEeNBTXPWRMACRO
 - 
PLMš
;

309 
’B_Ée_·rs
.
dTxpow”
 = 
RxPwr
 * 
®phaPow”S‘tšg
 + 
b‘aPow”S‘tšg
;

313 
’B_Ée_·rs
.
dTxpow”
 = 
LTEHeNBTXPWRFEMTO
;

316 
’B_Ée_·rs
.
dTxpow”
 = 
	`mš
ÓnB_Ée_·rs.dTxpow”, 
LTEHeNBTXPWRFEMTO
);

318 
’B_Ée_·rs
.
dTxpow”
 = 
	`max
ÓnB_Ée_·rs.dTxpow”, 
LTEHeNBTXPWRFEMTOMIN
);

319 
	}
}

321 
	g­¬tm’tBlock
::
	$­¬tm’tBlock
()

323 
	}
}

325 
­¬tm’tBlock
::~
	$­¬tm’tBlock
()

327 
	}
}

330 
C–lSnifãr
::
	$C–lSnifãr
()

332 
	}
}

334 
C–lSnifãr
::~
	$C–lSnifãr
()

336 
	}
}

338 
C–lSnifãr
::
	$š™Ÿli£
()

340 
dDi¡ªû
 = 0.0;

341 
dP©hloss
 = 
NOdBm
;

342 
dB—ršg
 = 0.0;

343 
dRxpow”
 = 
NOdBm
;

344 
dRxšt
 = 
NOdBm
;

345 
dCtoI
 = 
NOdBm
;

346 
	}
}

349 
	gM‘roS™e
::
	$M‘roS™e
()

351 
	}
}

353 
M‘roS™e
::~
	$M‘roS™e
()

355 
	}
}

357 
M‘roS™e
::
	$š™Ÿli£
()

362 
nB_h¥a_·rs
.
ŒafficMªag”
.
iU£rS”ved
 = 0;

363 
nB_h¥a_·rs
.
dTxpow”
 = 
LTEeNBTXPWRMETRO
;

364 
nB_h¥a_·rs
.
dRxšt
 = 
NOdBm
;

365 
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
 = 0;

366 
’B_Ée_·rs
.
dTxpow”
 = 
LTEeNBTXPWRMETRO
;

367 
’B_Ée_·rs
.
dRxšt
 = 
NOdBm
;

368 
	}
}

	@/home/lyang3/work/src_son/runWorld/bs.h

1 
	~"runWÜld.h
"

2 
	~"ue.h
"

4 
	ePow”S‘tšgM‘hod
 {

5 
	mnoPow”S‘tšg
,

6 
	mviùimUE
,

7 
	mbasicMaxPl
,

8 
	m¢ifãrMaüoBS


11 şas 
	cT¿fficMªag”


13 
	mpublic
:

15 
T¿fficMªag”
();

16 ~
T¿fficMªag”
();

20 
	miU£rS”ved
,

21 
	miU£rS”všg
,

22 
	miU£rS”všgUl
,

23 
	mueS”vedQueue
[70];

25 
T¿fficMod–Ty³


26 
	mŒafficMod–
;

30 şas 
	cnB_h¥a_·¿ms


32 
	mpublic
:

34 
nB_h¥a_·¿ms
();

35 ~
nB_h¥a_·¿ms
();

36 
´št
();

39 
	mdTxpow”
,

40 
	mdRxšt
;

42 
T¿fficMªag”


43 
	mŒafficMªag”
;

46 şas 
	c’B_Ée_·¿ms


48 
	mpublic
:

50 
’B_Ée_·¿ms
();

51 ~
’B_Ée_·¿ms
();

52 
´št
();

55 
	mdTxpow”
,

56 
	mdRxšt
,

57 
	mTxPow”ENB³rRB
[
Nrb
],

58 
	mTxPow”ENB³rBlockRecÜd
[
numBlocksDL
][8];

60 
T¿fficMªag”


61 
	mŒafficMªag”
;

64 
	mIoTmaxP”iod1
,

65 
	mIoTmaxP”iod2
,

66 
	mIoTmaxP”iod3
,

67 
	mIoTeNB
,

68 
	mIoTeNBP”RBHi¡
[
Nrb
-
NrbPUCCH
][8],

69 
	mIoTeNB³rRB
[
Nrb
-
NrbPUCCH
],

70 
	mIoTeNB³rRBf‹»d
[
Nrb
-
NrbPUCCH
],

71 
	mX2šds
[
Nrb
-
NrbPUCCH
];

74 şas 
	c­¬tm’tBlock


76 
	mpublic
:

78 
­¬tm’tBlock
();

79 ~
­¬tm’tBlock
();

80 
´št
();

81 
š™Ÿli£
();

83 
CoÜd
 
	mLoÿtiÚ
;

84 
CoÜd
 
	mBlockCoÜds
[
NUMSŒAPT
];

85 
	mex‹riÜBlockW®ls
[
NUMSŒAPT
][4];

89 şas 
	cSeùÜ


91 
	mpublic
:

93 
SeùÜ
();

94 ~
SeùÜ
();

95 
ª‹ÂaGaš
(
dTh‘a
);

96 
ª‹ÂaA‰’
(
dTh‘a
);

97 
ª‹ÂaTe¡
();

98 
´št
();

99 
š™Ÿli£
(
i_SeùÜ
);

102 
	mdB—ršg
;

103 
nB_h¥a_·¿ms
 
	mnB_h¥a_·rs
;

104 
’B_Ée_·¿ms
 
	m’B_Ée_·rs
;

105 
­¬tm’tBlock
 
	m­tBlock
[
BLOCKS³rCELL
];

108 şas 
	cBa£S™e


110 
	mpublic
:

112 
Ba£S™e
();

113 ~
Ba£S™e
();

114 
´št
();

115 
š™Ÿli£
();

117 
CoÜd
 
	mLoÿtiÚ
;

118 
	mª‹ÂaHeight
;

119 
SeùÜ
 
	mSeùÜs
[
MACROSECTORS
];

123 şas 
	cC–lSnifãr


125 
	mpublic
:

127 
C–lSnifãr
();

128 ~
C–lSnifãr
();

129 
m—su»Los£s
();

130 
š™Ÿli£
();

134 
	mdDi¡ªû
,

135 
	mdP©hloss
,

136 
	mdP©hlossW¿µed
,

137 
	mdB—ršg
,

138 
	mdRxpow”
,

139 
	mdRxšt
,

140 
	mdCtoI
;

143 şas 
	cP’‘¿tiÚPošt


145 
	mpublic
:

147 
P’‘¿tiÚPošt
();

148 ~
P’‘¿tiÚPošt
();

151 
CoÜd


152 
	mloÿtiÚ
;

155 
	mdP©hloss
;

158 şas 
	cFemtoS™e


160 
	mpublic
:

162 
FemtoS™e
();

163 ~
FemtoS™e
();

164 
´št
();

165 
š™Ÿli£
();

166 
pow”S‘tšg
(
UE
 *
HUEs
, UE *
MUEs
, 
numMaüoS™es
, 
numMUE
);

168 
CoÜd
 
	mLoÿtiÚ
;

169 
	mª‹ÂaHeight
, 
	m®phaPow”S‘tšg
, 
	mb‘aPow”S‘tšg
;

170 
	mIndexBa£S™e
;

171 
	mIndexSeùÜ
;

172 
	mIndexA±Block
;

173 
	mIndexA±
;

175 
C–lSnifãr


176 
	mûÎD©a
[
SITES
][
MACROSECTORS
],

177 
	mãmtoD©a
[
HeNBS
];

180 
	mULS‹”šgVecãmto
[
numFadšgP©hs
][
numSub·thFadšgChªÃl
];

182 
	mULSÿ‰”AngËsAtFemto
[
numFadšgP©hs
][
numSub·thFadšgChªÃl
];

184 
nB_h¥a_·¿ms
 
	mnB_h¥a_·rs
;

185 
’B_Ée_·¿ms
 
	m’B_Ée_·rs
;

187 
Pow”S‘tšgM‘hod


188 
	mpow”S‘tšgM‘hod
;

192 şas 
	cM‘roS™e


194 
	mpublic
:

196 
M‘roS™e
();

197 ~
M‘roS™e
();

198 
´št
();

199 
š™Ÿli£
();

201 
CoÜd
 
	mLoÿtiÚ
;

202 
	mª‹ÂaHeight
;

203 
	mIndexBa£S™e
;

204 
	mIndexSeùÜ
;

206 
C–lSnifãr


207 
	mûÎD©a
[
SITES
][
MACROSECTORS
],

208 
	mm‘roD©a
[
M‘rÛNBS
];

211 
	mULS‹”šgVecM‘ro
[
numFadšgP©hs
][
numSub·thFadšgChªÃl
];

213 
	mULSÿ‰”AngËsAtM‘ro
[
numFadšgP©hs
][
numSub·thFadšgChªÃl
];

215 
nB_h¥a_·¿ms
 
	mnB_h¥a_·rs
;

216 
’B_Ée_·¿ms
 
	m’B_Ée_·rs
;

	@/home/lyang3/work/src_son/runWorld/channel.cpp

1 
	~<io¡»am
>

2 
	~<m©h.h
>

3 
	~"chªÃl.h
"

4 
	~"¡dlib.h
"

6 
usšg
 
Çme¥aû
 
	g¡d
;

8 
	$FFT
(*
d©a
, cÚ¡ 
isign
, 
Â
)

10 
n
,
mmax
,
m
,
j
,
i¡•
,
i
;

11 
w‹mp
,
wr
,
w´
,
wpi
,
wi
,
th‘a
,
‹m´
,
‹mpi
;

14 
n
=
Â
 << 1;

15 
j
=1;

16 
i
=1;i<
n
;i+=2) {

17 ià(
j
 > 
i
) {

18 
	`SWAP
(
d©a
[
j
-1],d©a[
i
-1]);

19 
	`SWAP
(
d©a
[
j
],d©a[
i
]);

21 
m
=
Â
;

22 
m
 >ğ2 && 
j
 > m) {

23 
j
 -ğ
m
;

24 
m
 >>= 1;

26 
j
 +ğ
m
;

28 
mmax
=2;

29 
n
 > 
mmax
) {

30 
i¡•
=
mmax
 << 1;

31 
th‘a
=
isign
*(6.28318530717959/
mmax
);

32 
w‹mp
=
	`sš
(0.5*
th‘a
);

33 
w´
 = -2.0*
w‹mp
*wtemp;

34 
wpi
=
	`sš
(
th‘a
);

35 
wr
=1.0;

36 
wi
=0.0;

37 
m
=1;m<
mmax
;m+=2) {

38 
i
=
m
;i<=
n
;i+=
i¡•
) {

39 
j
=
i
+
mmax
;

40 
‹m´
=
wr
*
d©a
[
j
-1]-
wi
*data[j];

41 
‹mpi
=
wr
*
d©a
[
j
]+
wi
*data[j-1];

42 
d©a
[
j
-1]=d©a[
i
-1]-
‹m´
;

43 
d©a
[
j
]=d©a[
i
]-
‹mpi
;

44 
d©a
[
i
-1] +ğ
‹m´
;

45 
d©a
[
i
] +ğ
‹mpi
;

47 
wr
=(
w‹mp
=wr)*
w´
-
wi
*
wpi
+wr;

48 
wi
=wi*
w´
+
w‹mp
*
wpi
+wi;

50 
mmax
=
i¡•
;

52 
	}
}

54 
	gUrbªMaüo
::
	$UrbªMaüo
()

56 
i
,
j
;

58 
‹mpChªÃl
[
Nfá
*2],

59 
tÙ®Pow”
 = 0;

60 
D–AoDAoAPow
[
numFadšgP©hs
][4] = {

72 
şu¡”AS©UE
 = 11;

74 
i
=0; i<
numFadšgP©hs
; i++){

75 
chªÃlD–ays
[
i
] = 
D–AoDAoAPow
[i][0]*(1e-9)/(1.0/(
LTESam¶eR©e
*1e6));

76 
chªÃlPow”s
[
i
] = 
	`pow
(10.0, 
D–AoDAoAPow
[i][3]/10.0);

77 
tÙ®Pow”
 =Ù®Pow” + 
chªÃlPow”s
[
i
];

79 
DLSÿ‰”AngËsAtUE
[
i
] = 
D–AoDAoAPow
[i][2];

80 
AÁAngËs
[
i
] = 
D–AoDAoAPow
[i][1]/180.0*
PI
;

83 
i
=0; i<
numFadšgP©hs
; i++){

84 
j
=0; j<
Nfá
*2; j++)

85 
‹mpChªÃl
[
j
] = 0.0;

87 
‹mpChªÃl
[
chªÃlD–ays
[
i
]*2] = 1.0;

88 
	`FFT
(&
‹mpChªÃl
[0], 1, 
Nfá
);

89 
chªÃlPow”s
[
i
] = 
	`sq¹
(chªÃlPow”s[i] / 
tÙ®Pow”
);

91 
j
=0; j<
numC¬r›rIÁ”e¡
/2; j++){

92 
fáRecÜd
[
j
][
i
].
»®
 = 
‹mpChªÃl
[((
Nfá
 - Nfá/2è+ j)*2] * 
chªÃlPow”s
[i];

93 
fáRecÜd
[
j
][
i
].
img
 = 
‹mpChªÃl
[((
Nfá
 - Nfá/2è+ j)*2 + 1] * 
chªÃlPow”s
[i];

95 
fáRecÜd
[
j
+
numC¬r›rIÁ”e¡
/2][
i
].
»®
 = 
‹mpChªÃl
[j*2] * 
chªÃlPow”s
[i];

96 
fáRecÜd
[
j
+
numC¬r›rIÁ”e¡
/2][
i
].
img
 = 
‹mpChªÃl
[j*2 + 1] * 
chªÃlPow”s
[i];

100 
	}
}

102 
	gUrbªMaüo
::~
	$UrbªMaüo
()

104 
	}
}

106 
OutdoÜIndoÜ
::
	$OutdoÜIndoÜ
()

108 
i
,
j
;

110 
‹mpChªÃl
[
Nfá
*2],

111 
tÙ®Pow”
 = 0;

112 
D–AoDAoAPow
[
numFadšgP©hs
][4] = {

124 
şu¡”AS©UE
 = 8;

126 
i
=0; i<
numFadšgP©hs
; i++){

127 
chªÃlD–ays
[
i
] = 
D–AoDAoAPow
[i][0]*(1e-9)/(1.0/(
LTESam¶eR©e
*1e6))+0.4;

128 
chªÃlPow”s
[
i
] = 
	`pow
(10.0, 
D–AoDAoAPow
[i][3]/10.0);

129 
tÙ®Pow”
 =Ù®Pow” + 
chªÃlPow”s
[
i
];

131 
DLSÿ‰”AngËsAtUE
[
i
] = 
D–AoDAoAPow
[i][2];

132 
AÁAngËs
[
i
] = 
D–AoDAoAPow
[i][1]/180.0*
PI
;

135 
i
=0; i<
numFadšgP©hs
; i++){

136 
j
=0; j<
Nfá
*2; j++)

137 
‹mpChªÃl
[
j
] = 0.0;

139 
‹mpChªÃl
[
chªÃlD–ays
[
i
]*2] = 1.0;

140 
	`FFT
(&
‹mpChªÃl
[0], 1, 
Nfá
);

141 
chªÃlPow”s
[
i
] = 
	`sq¹
(chªÃlPow”s[i] / 
tÙ®Pow”
);

143 
j
=0; j<
numC¬r›rIÁ”e¡
/2; j++){

144 
fáRecÜd
[
j
][
i
].
»®
 = 
‹mpChªÃl
[((
Nfá
 - Nfá/2è+ j)*2] * 
chªÃlPow”s
[i];

145 
fáRecÜd
[
j
][
i
].
img
 = 
‹mpChªÃl
[((
Nfá
 - Nfá/2è+ j)*2 + 1] * 
chªÃlPow”s
[i];

147 
fáRecÜd
[
j
+
numC¬r›rIÁ”e¡
/2][
i
].
»®
 = 
‹mpChªÃl
[j*2] * 
chªÃlPow”s
[i];

148 
fáRecÜd
[
j
+
numC¬r›rIÁ”e¡
/2][
i
].
img
 = 
‹mpChªÃl
[j*2 + 1] * 
chªÃlPow”s
[i];

152 
	}
}

154 
	gOutdoÜIndoÜ
::~
	$OutdoÜIndoÜ
()

156 
	}
}

158 
IndoÜHÙ¥Ù
::
	$IndoÜHÙ¥Ù
()

160 
i
,
j
;

162 
‹mpChªÃl
[
Nfá
*2],

163 
tÙ®Pow”
 = 0;

164 
D–AoDAoAPow
[
numFadšgP©hs
][4] = {

176 
şu¡”AS©UE
 = 8;

178 
i
=0; i<
numFadšgP©hs
; i++){

179 
chªÃlD–ays
[
i
] = 
D–AoDAoAPow
[i][0]*(1e-9)/(1.0/(
LTESam¶eR©e
*1e6))+0.4;

180 
chªÃlPow”s
[
i
] = 
	`pow
(10.0, 
D–AoDAoAPow
[i][3]/10.0);

181 
tÙ®Pow”
 =Ù®Pow” + 
chªÃlPow”s
[
i
];

183 
DLSÿ‰”AngËsAtUE
[
i
] = 
D–AoDAoAPow
[i][2];

184 
AÁAngËs
[
i
] = 
D–AoDAoAPow
[i][1]/180.0*
PI
;

187 
i
=0; i<
numFadšgP©hs
; i++){

188 
j
=0; j<
Nfá
*2; j++)

189 
‹mpChªÃl
[
j
] = 0.0;

191 
‹mpChªÃl
[
chªÃlD–ays
[
i
]*2] = 1.0;

192 
	`FFT
(&
‹mpChªÃl
[0], 1, 
Nfá
);

193 
chªÃlPow”s
[
i
] = 
	`sq¹
(chªÃlPow”s[i] / 
tÙ®Pow”
);

195 
j
=0; j<
numC¬r›rIÁ”e¡
/2; j++){

196 
fáRecÜd
[
j
][
i
].
»®
 = 
‹mpChªÃl
[((
Nfá
 - Nfá/2è+ j)*2] * 
chªÃlPow”s
[i];

197 
fáRecÜd
[
j
][
i
].
img
 = 
‹mpChªÃl
[((
Nfá
 - Nfá/2è+ j)*2 + 1] * 
chªÃlPow”s
[i];

199 
fáRecÜd
[
j
+
numC¬r›rIÁ”e¡
/2][
i
].
»®
 = 
‹mpChªÃl
[j*2] * 
chªÃlPow”s
[i];

200 
fáRecÜd
[
j
+
numC¬r›rIÁ”e¡
/2][
i
].
img
 = 
‹mpChªÃl
[j*2 + 1] * 
chªÃlPow”s
[i];

204 
	}
}

206 
	gIndoÜHÙ¥Ù
::~
	$IndoÜHÙ¥Ù
()

208 
	}
}

210 
ChªÃl
::
	$ChªÃl
()

212 
i
, 
j
;

214 
§m¶esP”Block
 = 
numC¬r›rIÁ”e¡
 / 
decim©eR©e
 / 
numBlocksDL
;

215 
§m¶esP”BlockUL
 = (
numC¬r›rIÁ”e¡
-12 * 
NrbPUCCH
è/ 
decim©eR©e
 / (
Nrb
-NrbPUCCH);

216 
§m¶esP”RB
 = 12 / 
decim©eR©e
;

217 
i
=0; i<
numBlocksDL
; i++){

218 
j
=0; j<
numC¬r›rIÁ”e¡
/
decim©eR©e
; j++)

219 
blockAvFadšgDL
[
i
][
j
] = 0;

220 
j
=0; j<
§m¶esP”Block
; j++)

221 
blockAvFadšgDL
[
i
][
j
+i*
§m¶esP”Block
] = 1.0 / samplesPerBlock;

224 
i
=0; i<
Nrb
-
NrbPUCCH
; i++){

225 
j
=0; j<(
numC¬r›rIÁ”e¡
-12 * 
NrbPUCCH
)/
decim©eR©e
; j++)

226 
blockAvFadšgUL
[
i
][
j
] = 0;

227 
j
=0; j<
§m¶esP”BlockUL
; j++)

228 
blockAvFadšgUL
[
i
][
j
+i*
§m¶esP”BlockUL
] = 1.0 / samplesPerBlockUL;

230 
	}
}

232 
	gChªÃl
::~
	$ChªÃl
()

234 
	}
}

236 
šlše
 
	$rÙ
(**
a
, cÚ¡ 
s
, cÚ¡ 
u
, cÚ¡ 
i
,

237 cÚ¡ 
j
, cÚ¡ 
k
, cÚ¡ 
l
)

239 
g
,
h
;

241 
g
=
a
[
i
][
j
];

242 
h
=
a
[
k
][
l
];

243 
a
[
i
][
j
]=
g
-
s
*(
h
+g*
u
);

244 
a
[
k
][
l
]=
h
+
s
*(
g
-h*
u
);

245 
	}
}

247 
	$Jacobi
(**
a
, *
d
, **
v
, &
ÄÙ
, 
n
)

249 
i
,
j
,

,
iq
;

250 
Œesh
,
th‘a
,
u
,
t
,
sm
,
s
,
h
,
g
,
c
;

251 *
b
,*
z
;

253 
b
 = (*è
	`m®loc
((
n
) * ());

254 
z
 = (*è
	`m®loc
((
n
) * ());

256 

=0;<
n
;ip++) {

257 
iq
=0;iq<
n
;iq++è
v
[

][iq]=0.0;

258 
v
[

][ip]=1.0;

260 

=0;<
n
;ip++) {

261 
b
[

]=
d
[]=
a
[ip][ip];

262 
z
[

]=0.0;

264 
ÄÙ
=0;

265 
i
=1;i<=50;i++) {

266 
sm
=0.0;

267 

=0;<
n
-1;ip++) {

268 
iq
=

+1;iq<
n
;iq++)

269 
sm
 +ğ
	`çbs
(
a
[

][
iq
]);

271 ià(
sm
 == 0.0)

273 ià(
i
 < 4)

274 
Œesh
=0.2*
sm
/(
n
*n);

276 
Œesh
=0.0;

277 

=0;<
n
-1;ip++) {

278 
iq
=

+1;iq<
n
;iq++) {

279 
g
=100.0*
	`çbs
(
a
[

][
iq
]);

280 ià(
i
 > 4 && (
	`çbs
(
d
[

])+
g
) == fabs(d[ip])

281 && (
	`çbs
(
d
[
iq
])+
g
) == fabs(d[iq]))

282 
a
[

][
iq
]=0.0;

283 ià(
	`çbs
(
a
[

][
iq
]è> 
Œesh
) {

284 
h
=
d
[
iq
]-d[

];

285 ià((
	`çbs
(
h
)+
g
) == fabs(h))

286 
t
=(
a
[

][
iq
])/
h
;

288 
th‘a
=0.5*
h
/(
a
[

][
iq
]);

289 
t
=1.0/(
	`çbs
(
th‘a
)+
	`sq¹
(1.0+theta*theta));

290 ià(
th‘a
 < 0.0è
t
 = -t;

292 
c
=1.0/
	`sq¹
(1+
t
*t);

293 
s
=
t
*
c
;

294 
u
=
s
/(1.0+
c
);

295 
h
=
t
*
a
[

][
iq
];

296 
z
[

] -ğ
h
;

297 
z
[
iq
] +ğ
h
;

298 
d
[

] -ğ
h
;

299 
d
[
iq
] +ğ
h
;

300 
a
[

][
iq
]=0.0;

301 
j
=0;j<

;j++)

302 
	`rÙ
(
a
,
s
,
u
,
j
,

,j,
iq
);

303 
j
=

+1;j<
iq
;j++)

304 
	`rÙ
(
a
,
s
,
u
,

,
j
,j,
iq
);

305 
j
=
iq
+1;j<
n
;j++)

306 
	`rÙ
(
a
,
s
,
u
,

,
j
,
iq
,j);

307 
j
=0;j<
n
;j++)

308 
	`rÙ
(
v
,
s
,
u
,
j
,

,j,
iq
);

309 ++
ÄÙ
;

313 

=0;<
n
;ip++) {

314 
b
[

] +ğ
z
[ip];

315 
d
[

]=
b
[ip];

316 
z
[

]=0.0;

319 
cout
 << "ToØmªy i‹¿tiÚ š„outšjacobi" << 
’dl
;

320 
	}
}

322 
	$Œed
(**
a
, *
d
, *
e
, 
n
)

324 
l
,
k
,
j
,
i
;

325 
sÿË
,
hh
,
h
,
g
,
f
;

328 
i
=
n
-1;i>0;i--) {

329 
l
=
i
-1;

330 
h
=
sÿË
=0.0;

331 ià(
l
 > 0) {

332 
k
=0;k<
l
+1;k++)

333 
sÿË
 +ğ
	`çbs
(
a
[
i
][
k
]);

334 ià(
sÿË
 == 0.0)

335 
e
[
i
]=
a
[i][
l
];

337 
k
=0;k<
l
+1;k++) {

338 
a
[
i
][
k
] /ğ
sÿË
;

339 
h
 +ğ
a
[
i
][
k
]*a[i][k];

341 
f
=
a
[
i
][
l
];

342 
g
=(
f
 >ğ0.0 ? -
	`sq¹
(
h
) : sqrt(h));

343 
e
[
i
]=
sÿË
*
g
;

344 
h
 -ğ
f
*
g
;

345 
a
[
i
][
l
]=
f
-
g
;

346 
f
=0.0;

347 
j
=0;j<
l
+1;j++) {

349 
a
[
j
][
i
]÷[i][j]/
h
;

350 
g
=0.0;

351 
k
=0;k<
j
+1;k++)

352 
g
 +ğ
a
[
j
][
k
]*a[
i
][k];

353 
k
=
j
+1;k<
l
+1;k++)

354 
g
 +ğ
a
[
k
][
j
]*a[
i
][k];

355 
e
[
j
]=
g
/
h
;

356 
f
 +ğ
e
[
j
]*
a
[
i
][j];

358 
hh
=
f
/(
h
+h);

359 
j
=0;j<
l
+1;j++) {

360 
f
=
a
[
i
][
j
];

361 
e
[
j
]=
g
ó[j]-
hh
*
f
;

362 
k
=0;k<
j
+1;k++)

363 
a
[
j
][
k
] -ğ(
f
*
e
[k]+
g
*a[
i
][k]);

367 
e
[
i
]=
a
[i][
l
];

368 
d
[
i
]=
h
;

371 
d
[0]=0.0;

372 
e
[0]=0.0;

375 
i
=0;i<
n
;i++) {

376 
l
=
i
;

377 ià(
d
[
i
] != 0.0) {

378 
j
=0;j<
l
;j++) {

379 
g
=0.0;

380 
k
=0;k<
l
;k++)

381 
g
 +ğ
a
[
i
][
k
]*a[k][
j
];

382 
k
=0;k<
l
;k++)

383 
a
[
k
][
j
] -ğ
g
*a[k][
i
];

386 
d
[
i
]=
a
[i][i];

387 
a
[
i
][i]=1.0;

388 
j
=0;j<
l
;j++è
a
[j][
i
]=a[i][j]=0.0;

390 
	}
}

392 
	$tqli
(*
d
, *
e
, **
z
, 
n
)

394 
m
,
l
,
™”
,
i
,
k
;

395 
s
,
r
,
p
,
g
,
f
,
dd
,
c
,
b
;

398 
i
=1;i<
n
;i++è
e
[i-1]=e[i];

399 
e
[
n
-1]=0.0;

400 
l
=0;l<
n
;l++) {

401 
™”
=0;

403 
m
=
l
;m<
n
-1;m++) {

404 
dd
=
	`çbs
(
d
[
m
])+fabs(d[m+1]);

405 ià(
	`çbs
(
e
[
m
])+
dd
 == dd) ;

407 ià(
m
 !ğ
l
) {

408 ià(
™”
++ =ğ30è
cout
 << "ToØmªy i‹¿tiÚ š„outšjacobi" << 
’dl
;

409 
g
=(
d
[
l
+1]-d[l])/(2.0*
e
[l]);

410 
r
=
	`sq¹
(
g
*g+1.0);

411 
g
=
d
[
m
]-d[
l
]+
e
[l]/(g+(g >ğ0 ? (
r
 >= 0 ?„ : -r) : (r >= 0 ? -r :„)));

412 
s
=
c
=1.0;

413 
p
=0.0;

414 
i
=
m
-1;i>=
l
;i--) {

415 
f
=
s
*
e
[
i
];

416 
b
=
c
*
e
[
i
];

417 
e
[
i
+1]=(
r
=
	`sq¹
(
f
*f+
g
*g));

418 ià(
r
 == 0.0) {

419 
d
[
i
+1] -ğ
p
;

420 
e
[
m
]=0.0;

423 
s
=
f
/
r
;

424 
c
=
g
/
r
;

425 
g
=
d
[
i
+1]-
p
;

426 
r
=(
d
[
i
]-
g
)*
s
+2.0*
c
*
b
;

427 
d
[
i
+1]=
g
+(
p
=
s
*
r
);

428 
g
=
c
*
r
-
b
;

430 
k
=0;k<
n
;k++) {

431 
f
=
z
[
k
][
i
+1];

432 
z
[
k
][
i
+1]=
s
*z[k][i]+
c
*
f
;

433 
z
[
k
][
i
]=
c
*z[k][i]-
s
*
f
;

436 ià(
r
 =ğ0.0 && 
i
 >ğ
l
) ;

437 
d
[
l
] -ğ
p
;

438 
e
[
l
]=
g
;

439 
e
[
m
]=0.0;

441 } 
m
 !ğ
l
);

443 
	}
}

445 
Com¶ex
 
	$Com¶exMul
(
Com¶ex
 
x
, Com¶ex 
y
){

446 
Com¶ex
 
ResuÉ
;

448 
ResuÉ
.
»®
 = 
x
.»® * 
y
.»® - x.
img
 * y.img;

449 
ResuÉ
.
img
 = 
x
.
»®
 * 
y
.img + x.img * y.real;

451 (
ResuÉ
);

452 
	}
}

454 
Com¶ex
 
	$com¶ex
(
x
, 
y
){

455 
Com¶ex
 
ResuÉ
;

457 
ResuÉ
.
»®
 = 
x
;

458 
ResuÉ
.
img
 = 
y
;

460 (
ResuÉ
);

461 
	}
}

463 
Com¶ex
 
	$pha£2Com¶ex
(
x
){

464 
Com¶ex
 
ResuÉ
;

466 
ResuÉ
.
»®
 = 
	`cos
(
x
);

467 
ResuÉ
.
img
 = 
	`sš
(
x
);

469 (
ResuÉ
);

470 
	}
}

472 
	$Com¶ex2Pha£
(
Com¶ex
 
x
){

473 
pha£
;

474 
pha£
 = 
	`©ª2
(
x
.
img
, x.
»®
);

475 (
pha£
);

476 
	}
}

478 
Com¶ex
 
	$Com¶exAdd
(
Com¶ex
 
x
, Com¶ex 
y
){

479 
Com¶ex
 
ResuÉ
;

481 
ResuÉ
.
»®
 = 
x
.»® + 
y
.real;

482 
ResuÉ
.
img
 = 
x
.img + 
y
.img;

484 (
ResuÉ
);

485 
	}
}

487 
Com¶ex
 
	$Com¶exR—lMul
(
Com¶ex
 
x
, 
y
){

488 
Com¶ex
 
ResuÉ
;

490 
ResuÉ
.
»®
 = 
x
.»® * 
y
;

491 
ResuÉ
.
img
 = 
x
.img * 
y
;

493 (
ResuÉ
);

494 
	}
}

496 
Com¶ex
 
	$Com¶exR—lDiv
(
Com¶ex
 
tİ
, 
bÙtom
){

497 
Com¶ex
 
ResuÉ
;

499 
ResuÉ
.
»®
 = 
tİ
.»® / 
bÙtom
;

500 
ResuÉ
.
img
 = 
tİ
.img / 
bÙtom
;

502 (
ResuÉ
);

503 
	}
}

505 
	$pow”
(
Com¶ex
 
x
){

506 (
x
.
»®
*x.»® + x.
img
*x.img);

507 
	}
}

510 
	$cdá2d
(
n1
, 
n2
, 
isgn
, **
a
, *

, *
w
)

512 
	`makewt
(
nw
, *

, *
w
);

513 
	`b™rv2cŞ
(
n1
, 
n
, *

, **
a
);

514 
	`b™rv2row
(
n
, 
n2
, *

, **
a
);

515 
	`cábcŞ
(
n1
, 
n
, **
a
, *
w
);

516 
	`cábrow
(
n
, 
n2
, **
a
, *
w
);

517 
	`cáfcŞ
(
n1
, 
n
, **
a
, *
w
);

518 
	`cáäow
(
n
, 
n2
, **
a
, *
w
);

519 
n
;

521 
n
 = 
n1
 << 1;

522 ià(
n
 < 
n2
) {

523 
n
 = 
n2
;

525 ià(
n
 > (

[0] << 2)) {

526 
	`makewt
(
n
 >> 2, 

, 
w
);

528 ià(
n2
 > 4) {

529 
	`b™rv2cŞ
(
n1
, 
n2
, 

 + 2, 
a
);

531 ià(
n1
 > 2) {

532 
	`b™rv2row
(
n1
, 
n2
, 

 + 2, 
a
);

534 ià(
isgn
 < 0) {

535 
	`cáfcŞ
(
n1
, 
n2
, 
a
, 
w
);

536 
	`cáäow
(
n1
, 
n2
, 
a
, 
w
);

538 
	`cábcŞ
(
n1
, 
n2
, 
a
, 
w
);

539 
	`cábrow
(
n1
, 
n2
, 
a
, 
w
);

541 
	}
}

543 
	$makewt
(
nw
, *

, *
w
)

545 
	`b™rv2
(
n
, *

, *
a
);

546 
nwh
, 
j
;

547 
d–
, 
x
, 
y
;

549 

[0] = 
nw
;

550 

[1] = 1;

551 ià(
nw
 > 2) {

552 
nwh
 = 
nw
 >> 1;

553 
d–
 = 
	`©ª
(1.0è/ 
nwh
;

554 
w
[0] = 1;

555 
w
[1] = 0;

556 
w
[
nwh
] = 
	`cos
(
d–
 *‚wh);

557 
w
[
nwh
 + 1] = w[nwh];

558 
j
 = 2; j <ğ
nwh
 - 2; j += 2) {

559 
x
 = 
	`cos
(
d–
 * 
j
);

560 
y
 = 
	`sš
(
d–
 * 
j
);

561 
w
[
j
] = 
x
;

562 
w
[
j
 + 1] = 
y
;

563 
w
[
nw
 - 
j
] = 
y
;

564 
w
[
nw
 - 
j
 + 1] = 
x
;

566 
	`b™rv2
(
nw
, 

 + 2, 
w
);

568 
	}
}

571 
	$makeù
(
nc
, *

, *
c
)

573 
nch
, 
j
;

574 
d–
;

576 

[1] = 
nc
;

577 ià(
nc
 > 1) {

578 
nch
 = 
nc
 >> 1;

579 
d–
 = 
	`©ª
(1.0è/ 
nch
;

580 
c
[0] = 0.5;

581 
c
[
nch
] = 0.5 * 
	`cos
(
d–
 *‚ch);

582 
j
 = 1; j <ğ
nch
 - 1; j++) {

583 
c
[
j
] = 0.5 * 
	`cos
(
d–
 * j);

584 
c
[
nc
 - 
j
] = 0.5 * 
	`sš
(
d–
 * j);

587 
	}
}

593 
	$b™rv2
(
n
, *

, *
a
)

595 
j
, 
j1
, 
k
, 
k1
, 
l
, 
m
, 
m2
;

596 
xr
, 
xi
;

598 

[0] = 0;

599 
l
 = 
n
;

600 
m
 = 1;

601 (
m
 << 2è< 
l
) {

602 
l
 >>= 1;

603 
j
 = 0; j <ğ
m
 - 1; j++) {

604 

[
m
 + 
j
] = ip[j] + 
l
;

606 
m
 <<= 1;

608 ià((
m
 << 2è> 
l
) {

609 
k
 = 1; k <ğ
m
 - 1; k++) {

610 
j
 = 0; j <ğ
k
 - 1; j++) {

611 
j1
 = (
j
 << 1è+ 

[
k
];

612 
k1
 = (
k
 << 1è+ 

[
j
];

613 
xr
 = 
a
[
j1
];

614 
xi
 = 
a
[
j1
 + 1];

615 
a
[
j1
] =‡[
k1
];

616 
a
[
j1
 + 1] =‡[
k1
 + 1];

617 
a
[
k1
] = 
xr
;

618 
a
[
k1
 + 1] = 
xi
;

622 
m2
 = 
m
 << 1;

623 
k
 = 1; k <ğ
m
 - 1; k++) {

624 
j
 = 0; j <ğ
k
 - 1; j++) {

625 
j1
 = (
j
 << 1è+ 

[
k
];

626 
k1
 = (
k
 << 1è+ 

[
j
];

627 
xr
 = 
a
[
j1
];

628 
xi
 = 
a
[
j1
 + 1];

629 
a
[
j1
] =‡[
k1
];

630 
a
[
j1
 + 1] =‡[
k1
 + 1];

631 
a
[
k1
] = 
xr
;

632 
a
[
k1
 + 1] = 
xi
;

633 
j1
 +ğ
m2
;

634 
k1
 +ğ
m2
;

635 
xr
 = 
a
[
j1
];

636 
xi
 = 
a
[
j1
 + 1];

637 
a
[
j1
] =‡[
k1
];

638 
a
[
j1
 + 1] =‡[
k1
 + 1];

639 
a
[
k1
] = 
xr
;

640 
a
[
k1
 + 1] = 
xi
;

644 
	}
}

647 
	$b™rv2cŞ
(
n1
, 
n
, *

, **
a
)

649 
i
, 
j
, 
j1
, 
k
, 
k1
, 
l
, 
m
, 
m2
;

650 
xr
, 
xi
;

652 

[0] = 0;

653 
l
 = 
n
;

654 
m
 = 1;

655 (
m
 << 2è< 
l
) {

656 
l
 >>= 1;

657 
j
 = 0; j <ğ
m
 - 1; j++) {

658 

[
m
 + 
j
] = ip[j] + 
l
;

660 
m
 <<= 1;

662 ià((
m
 << 2è> 
l
) {

663 
i
 = 0; i <ğ
n1
 - 1; i++) {

664 
k
 = 1; k <ğ
m
 - 1; k++) {

665 
j
 = 0; j <ğ
k
 - 1; j++) {

666 
j1
 = (
j
 << 1è+ 

[
k
];

667 
k1
 = (
k
 << 1è+ 

[
j
];

668 
xr
 = 
a
[
i
][
j1
];

669 
xi
 = 
a
[
i
][
j1
 + 1];

670 
a
[
i
][
j1
] =‡[i][
k1
];

671 
a
[
i
][
j1
 + 1] =‡[i][
k1
 + 1];

672 
a
[
i
][
k1
] = 
xr
;

673 
a
[
i
][
k1
 + 1] = 
xi
;

678 
m2
 = 
m
 << 1;

679 
i
 = 0; i <ğ
n1
 - 1; i++) {

680 
k
 = 1; k <ğ
m
 - 1; k++) {

681 
j
 = 0; j <ğ
k
 - 1; j++) {

682 
j1
 = (
j
 << 1è+ 

[
k
];

683 
k1
 = (
k
 << 1è+ 

[
j
];

684 
xr
 = 
a
[
i
][
j1
];

685 
xi
 = 
a
[
i
][
j1
 + 1];

686 
a
[
i
][
j1
] =‡[i][
k1
];

687 
a
[
i
][
j1
 + 1] =‡[i][
k1
 + 1];

688 
a
[
i
][
k1
] = 
xr
;

689 
a
[
i
][
k1
 + 1] = 
xi
;

690 
j1
 +ğ
m2
;

691 
k1
 +ğ
m2
;

692 
xr
 = 
a
[
i
][
j1
];

693 
xi
 = 
a
[
i
][
j1
 + 1];

694 
a
[
i
][
j1
] =‡[i][
k1
];

695 
a
[
i
][
j1
 + 1] =‡[i][
k1
 + 1];

696 
a
[
i
][
k1
] = 
xr
;

697 
a
[
i
][
k1
 + 1] = 
xi
;

702 
	}
}

705 
	$b™rv2row
(
n
, 
n2
, *

, **
a
)

707 
i
, 
j
, 
j1
, 
k
, 
k1
, 
l
, 
m
;

708 
xr
, 
xi
;

710 

[0] = 0;

711 
l
 = 
n
;

712 
m
 = 1;

713 (
m
 << 1è< 
l
) {

714 
l
 >>= 1;

715 
j
 = 0; j <ğ
m
 - 1; j++) {

716 

[
m
 + 
j
] = ip[j] + 
l
;

718 
m
 <<= 1;

720 ià((
m
 << 1è> 
l
) {

721 
k
 = 1; k <ğ
m
 - 1; k++) {

722 
j
 = 0; j <ğ
k
 - 1; j++) {

723 
j1
 = 
j
 + 

[
k
];

724 
k1
 = 
k
 + 

[
j
];

725 
i
 = 0; i <ğ
n2
 - 2; i += 2) {

726 
xr
 = 
a
[
j1
][
i
];

727 
xi
 = 
a
[
j1
][
i
 + 1];

728 
a
[
j1
][
i
] =‡[
k1
][i];

729 
a
[
j1
][
i
 + 1] =‡[
k1
][i + 1];

730 
a
[
k1
][
i
] = 
xr
;

731 
a
[
k1
][
i
 + 1] = 
xi
;

736 
k
 = 1; k <ğ
m
 - 1; k++) {

737 
j
 = 0; j <ğ
k
 - 1; j++) {

738 
j1
 = 
j
 + 

[
k
];

739 
k1
 = 
k
 + 

[
j
];

740 
i
 = 0; i <ğ
n2
 - 2; i += 2) {

741 
xr
 = 
a
[
j1
][
i
];

742 
xi
 = 
a
[
j1
][
i
 + 1];

743 
a
[
j1
][
i
] =‡[
k1
][i];

744 
a
[
j1
][
i
 + 1] =‡[
k1
][i + 1];

745 
a
[
k1
][
i
] = 
xr
;

746 
a
[
k1
][
i
 + 1] = 
xi
;

748 
j1
 +ğ
m
;

749 
k1
 +ğ
m
;

750 
i
 = 0; i <ğ
n2
 - 2; i += 2) {

751 
xr
 = 
a
[
j1
][
i
];

752 
xi
 = 
a
[
j1
][
i
 + 1];

753 
a
[
j1
][
i
] =‡[
k1
][i];

754 
a
[
j1
][
i
 + 1] =‡[
k1
][i + 1];

755 
a
[
k1
][
i
] = 
xr
;

756 
a
[
k1
][
i
 + 1] = 
xi
;

761 
	}
}

764 
	$cábcŞ
(
n1
, 
n
, **
a
, *
w
)

766 
i
, 
j
, 
j1
, 
j2
, 
j3
, 
k
, 
k1
, 
ks
, 
l
, 
m
;

767 
wk1r
, 
wk1i
, 
wk2r
, 
wk2i
, 
wk3r
, 
wk3i
;

768 
x0r
, 
x0i
, 
x1r
, 
x1i
, 
x2r
, 
x2i
, 
x3r
, 
x3i
;

770 
i
 = 0; i <ğ
n1
 - 1; i++) {

771 
l
 = 2;

772 (
l
 << 1è< 
n
) {

773 
m
 = 
l
 << 2;

774 
j
 = 0; j <ğ
l
 - 2; j += 2) {

775 
j1
 = 
j
 + 
l
;

776 
j2
 = 
j1
 + 
l
;

777 
j3
 = 
j2
 + 
l
;

778 
x0r
 = 
a
[
i
][
j
] +‡[i][
j1
];

779 
x0i
 = 
a
[
i
][
j
 + 1] +‡[i][
j1
 + 1];

780 
x1r
 = 
a
[
i
][
j
] -‡[i][
j1
];

781 
x1i
 = 
a
[
i
][
j
 + 1] -‡[i][
j1
 + 1];

782 
x2r
 = 
a
[
i
][
j2
] +‡[i][
j3
];

783 
x2i
 = 
a
[
i
][
j2
 + 1] +‡[i][
j3
 + 1];

784 
x3r
 = 
a
[
i
][
j2
] -‡[i][
j3
];

785 
x3i
 = 
a
[
i
][
j2
 + 1] -‡[i][
j3
 + 1];

786 
a
[
i
][
j
] = 
x0r
 + 
x2r
;

787 
a
[
i
][
j
 + 1] = 
x0i
 + 
x2i
;

788 
a
[
i
][
j2
] = 
x0r
 - 
x2r
;

789 
a
[
i
][
j2
 + 1] = 
x0i
 - 
x2i
;

790 
a
[
i
][
j1
] = 
x1r
 - 
x3i
;

791 
a
[
i
][
j1
 + 1] = 
x1i
 + 
x3r
;

792 
a
[
i
][
j3
] = 
x1r
 + 
x3i
;

793 
a
[
i
][
j3
 + 1] = 
x1i
 - 
x3r
;

795 ià(
m
 < 
n
) {

796 
wk1r
 = 
w
[2];

797 
j
 = 
m
; j <ğ
l
 + m - 2; j += 2) {

798 
j1
 = 
j
 + 
l
;

799 
j2
 = 
j1
 + 
l
;

800 
j3
 = 
j2
 + 
l
;

801 
x0r
 = 
a
[
i
][
j
] +‡[i][
j1
];

802 
x0i
 = 
a
[
i
][
j
 + 1] +‡[i][
j1
 + 1];

803 
x1r
 = 
a
[
i
][
j
] -‡[i][
j1
];

804 
x1i
 = 
a
[
i
][
j
 + 1] -‡[i][
j1
 + 1];

805 
x2r
 = 
a
[
i
][
j2
] +‡[i][
j3
];

806 
x2i
 = 
a
[
i
][
j2
 + 1] +‡[i][
j3
 + 1];

807 
x3r
 = 
a
[
i
][
j2
] -‡[i][
j3
];

808 
x3i
 = 
a
[
i
][
j2
 + 1] -‡[i][
j3
 + 1];

809 
a
[
i
][
j
] = 
x0r
 + 
x2r
;

810 
a
[
i
][
j
 + 1] = 
x0i
 + 
x2i
;

811 
a
[
i
][
j2
] = 
x2i
 - 
x0i
;

812 
a
[
i
][
j2
 + 1] = 
x0r
 - 
x2r
;

813 
x0r
 = 
x1r
 - 
x3i
;

814 
x0i
 = 
x1i
 + 
x3r
;

815 
a
[
i
][
j1
] = 
wk1r
 * (
x0r
 - 
x0i
);

816 
a
[
i
][
j1
 + 1] = 
wk1r
 * (
x0r
 + 
x0i
);

817 
x0r
 = 
x3i
 + 
x1r
;

818 
x0i
 = 
x3r
 - 
x1i
;

819 
a
[
i
][
j3
] = 
wk1r
 * (
x0i
 - 
x0r
);

820 
a
[
i
][
j3
 + 1] = 
wk1r
 * (
x0i
 + 
x0r
);

822 
k1
 = 1;

823 
ks
 = -1;

824 
k
 = (
m
 << 1); k <ğ
n
 - m; k += m) {

825 
k1
++;

826 
ks
 = -ks;

827 
wk1r
 = 
w
[
k1
 << 1];

828 
wk1i
 = 
w
[(
k1
 << 1) + 1];

829 
wk2r
 = 
ks
 * 
w
[
k1
];

830 
wk2i
 = 
w
[
k1
 + 
ks
];

831 
wk3r
 = 
wk1r
 - 2 * 
wk2i
 * 
wk1i
;

832 
wk3i
 = 2 * 
wk2i
 * 
wk1r
 - 
wk1i
;

833 
j
 = 
k
; j <ğ
l
 + k - 2; j += 2) {

834 
j1
 = 
j
 + 
l
;

835 
j2
 = 
j1
 + 
l
;

836 
j3
 = 
j2
 + 
l
;

837 
x0r
 = 
a
[
i
][
j
] +‡[i][
j1
];

838 
x0i
 = 
a
[
i
][
j
 + 1] +‡[i][
j1
 + 1];

839 
x1r
 = 
a
[
i
][
j
] -‡[i][
j1
];

840 
x1i
 = 
a
[
i
][
j
 + 1] -‡[i][
j1
 + 1];

841 
x2r
 = 
a
[
i
][
j2
] +‡[i][
j3
];

842 
x2i
 = 
a
[
i
][
j2
 + 1] +‡[i][
j3
 + 1];

843 
x3r
 = 
a
[
i
][
j2
] -‡[i][
j3
];

844 
x3i
 = 
a
[
i
][
j2
 + 1] -‡[i][
j3
 + 1];

845 
a
[
i
][
j
] = 
x0r
 + 
x2r
;

846 
a
[
i
][
j
 + 1] = 
x0i
 + 
x2i
;

847 
x0r
 -ğ
x2r
;

848 
x0i
 -ğ
x2i
;

849 
a
[
i
][
j2
] = 
wk2r
 * 
x0r
 - 
wk2i
 * 
x0i
;

850 
a
[
i
][
j2
 + 1] = 
wk2r
 * 
x0i
 + 
wk2i
 * 
x0r
;

851 
x0r
 = 
x1r
 - 
x3i
;

852 
x0i
 = 
x1i
 + 
x3r
;

853 
a
[
i
][
j1
] = 
wk1r
 * 
x0r
 - 
wk1i
 * 
x0i
;

854 
a
[
i
][
j1
 + 1] = 
wk1r
 * 
x0i
 + 
wk1i
 * 
x0r
;

855 
x0r
 = 
x1r
 + 
x3i
;

856 
x0i
 = 
x1i
 - 
x3r
;

857 
a
[
i
][
j3
] = 
wk3r
 * 
x0r
 - 
wk3i
 * 
x0i
;

858 
a
[
i
][
j3
 + 1] = 
wk3r
 * 
x0i
 + 
wk3i
 * 
x0r
;

862 
l
 = 
m
;

864 ià(
l
 < 
n
) {

865 
j
 = 0; j <ğ
l
 - 2; j += 2) {

866 
j1
 = 
j
 + 
l
;

867 
x0r
 = 
a
[
i
][
j
] -‡[i][
j1
];

868 
x0i
 = 
a
[
i
][
j
 + 1] -‡[i][
j1
 + 1];

869 
a
[
i
][
j
] +ğa[i][
j1
];

870 
a
[
i
][
j
 + 1] +ğa[i][
j1
 + 1];

871 
a
[
i
][
j1
] = 
x0r
;

872 
a
[
i
][
j1
 + 1] = 
x0i
;

876 
	}
}

879 
	$cábrow
(
n
, 
n2
, **
a
, *
w
)

881 
i
, 
j
, 
j1
, 
j2
, 
j3
, 
k
, 
k1
, 
ks
, 
l
, 
m
;

882 
wk1r
, 
wk1i
, 
wk2r
, 
wk2i
, 
wk3r
, 
wk3i
;

883 
x0r
, 
x0i
, 
x1r
, 
x1i
, 
x2r
, 
x2i
, 
x3r
, 
x3i
;

885 
l
 = 1;

886 (
l
 << 1è< 
n
) {

887 
m
 = 
l
 << 2;

888 
j
 = 0; j <ğ
l
 - 1; j++) {

889 
j1
 = 
j
 + 
l
;

890 
j2
 = 
j1
 + 
l
;

891 
j3
 = 
j2
 + 
l
;

892 
i
 = 0; i <ğ
n2
 - 2; i += 2) {

893 
x0r
 = 
a
[
j
][
i
] +‡[
j1
][i];

894 
x0i
 = 
a
[
j
][
i
 + 1] +‡[
j1
][i + 1];

895 
x1r
 = 
a
[
j
][
i
] -‡[
j1
][i];

896 
x1i
 = 
a
[
j
][
i
 + 1] -‡[
j1
][i + 1];

897 
x2r
 = 
a
[
j2
][
i
] +‡[
j3
][i];

898 
x2i
 = 
a
[
j2
][
i
 + 1] +‡[
j3
][i + 1];

899 
x3r
 = 
a
[
j2
][
i
] -‡[
j3
][i];

900 
x3i
 = 
a
[
j2
][
i
 + 1] -‡[
j3
][i + 1];

901 
a
[
j
][
i
] = 
x0r
 + 
x2r
;

902 
a
[
j
][
i
 + 1] = 
x0i
 + 
x2i
;

903 
a
[
j2
][
i
] = 
x0r
 - 
x2r
;

904 
a
[
j2
][
i
 + 1] = 
x0i
 - 
x2i
;

905 
a
[
j1
][
i
] = 
x1r
 - 
x3i
;

906 
a
[
j1
][
i
 + 1] = 
x1i
 + 
x3r
;

907 
a
[
j3
][
i
] = 
x1r
 + 
x3i
;

908 
a
[
j3
][
i
 + 1] = 
x1i
 - 
x3r
;

911 ià(
m
 < 
n
) {

912 
wk1r
 = 
w
[2];

913 
j
 = 
m
; j <ğ
l
 + m - 1; j++) {

914 
j1
 = 
j
 + 
l
;

915 
j2
 = 
j1
 + 
l
;

916 
j3
 = 
j2
 + 
l
;

917 
i
 = 0; i <ğ
n2
 - 2; i += 2) {

918 
x0r
 = 
a
[
j
][
i
] +‡[
j1
][i];

919 
x0i
 = 
a
[
j
][
i
 + 1] +‡[
j1
][i + 1];

920 
x1r
 = 
a
[
j
][
i
] -‡[
j1
][i];

921 
x1i
 = 
a
[
j
][
i
 + 1] -‡[
j1
][i + 1];

922 
x2r
 = 
a
[
j2
][
i
] +‡[
j3
][i];

923 
x2i
 = 
a
[
j2
][
i
 + 1] +‡[
j3
][i + 1];

924 
x3r
 = 
a
[
j2
][
i
] -‡[
j3
][i];

925 
x3i
 = 
a
[
j2
][
i
 + 1] -‡[
j3
][i + 1];

926 
a
[
j
][
i
] = 
x0r
 + 
x2r
;

927 
a
[
j
][
i
 + 1] = 
x0i
 + 
x2i
;

928 
a
[
j2
][
i
] = 
x2i
 - 
x0i
;

929 
a
[
j2
][
i
 + 1] = 
x0r
 - 
x2r
;

930 
x0r
 = 
x1r
 - 
x3i
;

931 
x0i
 = 
x1i
 + 
x3r
;

932 
a
[
j1
][
i
] = 
wk1r
 * (
x0r
 - 
x0i
);

933 
a
[
j1
][
i
 + 1] = 
wk1r
 * (
x0r
 + 
x0i
);

934 
x0r
 = 
x3i
 + 
x1r
;

935 
x0i
 = 
x3r
 - 
x1i
;

936 
a
[
j3
][
i
] = 
wk1r
 * (
x0i
 - 
x0r
);

937 
a
[
j3
][
i
 + 1] = 
wk1r
 * (
x0i
 + 
x0r
);

940 
k1
 = 1;

941 
ks
 = -1;

942 
k
 = (
m
 << 1); k <ğ
n
 - m; k += m) {

943 
k1
++;

944 
ks
 = -ks;

945 
wk1r
 = 
w
[
k1
 << 1];

946 
wk1i
 = 
w
[(
k1
 << 1) + 1];

947 
wk2r
 = 
ks
 * 
w
[
k1
];

948 
wk2i
 = 
w
[
k1
 + 
ks
];

949 
wk3r
 = 
wk1r
 - 2 * 
wk2i
 * 
wk1i
;

950 
wk3i
 = 2 * 
wk2i
 * 
wk1r
 - 
wk1i
;

951 
j
 = 
k
; j <ğ
l
 + k - 1; j++) {

952 
j1
 = 
j
 + 
l
;

953 
j2
 = 
j1
 + 
l
;

954 
j3
 = 
j2
 + 
l
;

955 
i
 = 0; i <ğ
n2
 - 2; i += 2) {

956 
x0r
 = 
a
[
j
][
i
] +‡[
j1
][i];

957 
x0i
 = 
a
[
j
][
i
 + 1] +‡[
j1
][i + 1];

958 
x1r
 = 
a
[
j
][
i
] -‡[
j1
][i];

959 
x1i
 = 
a
[
j
][
i
 + 1] -‡[
j1
][i + 1];

960 
x2r
 = 
a
[
j2
][
i
] +‡[
j3
][i];

961 
x2i
 = 
a
[
j2
][
i
 + 1] +‡[
j3
][i + 1];

962 
x3r
 = 
a
[
j2
][
i
] -‡[
j3
][i];

963 
x3i
 = 
a
[
j2
][
i
 + 1] -‡[
j3
][i + 1];

964 
a
[
j
][
i
] = 
x0r
 + 
x2r
;

965 
a
[
j
][
i
 + 1] = 
x0i
 + 
x2i
;

966 
x0r
 -ğ
x2r
;

967 
x0i
 -ğ
x2i
;

968 
a
[
j2
][
i
] = 
wk2r
 * 
x0r
 - 
wk2i
 * 
x0i
;

969 
a
[
j2
][
i
 + 1] = 
wk2r
 * 
x0i
 + 
wk2i
 * 
x0r
;

970 
x0r
 = 
x1r
 - 
x3i
;

971 
x0i
 = 
x1i
 + 
x3r
;

972 
a
[
j1
][
i
] = 
wk1r
 * 
x0r
 - 
wk1i
 * 
x0i
;

973 
a
[
j1
][
i
 + 1] = 
wk1r
 * 
x0i
 + 
wk1i
 * 
x0r
;

974 
x0r
 = 
x1r
 + 
x3i
;

975 
x0i
 = 
x1i
 - 
x3r
;

976 
a
[
j3
][
i
] = 
wk3r
 * 
x0r
 - 
wk3i
 * 
x0i
;

977 
a
[
j3
][
i
 + 1] = 
wk3r
 * 
x0i
 + 
wk3i
 * 
x0r
;

982 
l
 = 
m
;

984 ià(
l
 < 
n
) {

985 
j
 = 0; j <ğ
l
 - 1; j++) {

986 
j1
 = 
j
 + 
l
;

987 
i
 = 0; i <ğ
n2
 - 2; i += 2) {

988 
x0r
 = 
a
[
j
][
i
] -‡[
j1
][i];

989 
x0i
 = 
a
[
j
][
i
 + 1] -‡[
j1
][i + 1];

990 
a
[
j
][
i
] +ğa[
j1
][i];

991 
a
[
j
][
i
 + 1] +ğa[
j1
][i + 1];

992 
a
[
j1
][
i
] = 
x0r
;

993 
a
[
j1
][
i
 + 1] = 
x0i
;

997 
	}
}

1000 
	$cáfcŞ
(
n1
, 
n
, **
a
, *
w
)

1002 
i
, 
j
, 
j1
, 
j2
, 
j3
, 
k
, 
k1
, 
ks
, 
l
, 
m
;

1003 
wk1r
, 
wk1i
, 
wk2r
, 
wk2i
, 
wk3r
, 
wk3i
;

1004 
x0r
, 
x0i
, 
x1r
, 
x1i
, 
x2r
, 
x2i
, 
x3r
, 
x3i
;

1006 
i
 = 0; i <ğ
n1
 - 1; i++) {

1007 
l
 = 2;

1008 (
l
 << 1è< 
n
) {

1009 
m
 = 
l
 << 2;

1010 
j
 = 0; j <ğ
l
 - 2; j += 2) {

1011 
j1
 = 
j
 + 
l
;

1012 
j2
 = 
j1
 + 
l
;

1013 
j3
 = 
j2
 + 
l
;

1014 
x0r
 = 
a
[
i
][
j
] +‡[i][
j1
];

1015 
x0i
 = 
a
[
i
][
j
 + 1] +‡[i][
j1
 + 1];

1016 
x1r
 = 
a
[
i
][
j
] -‡[i][
j1
];

1017 
x1i
 = 
a
[
i
][
j
 + 1] -‡[i][
j1
 + 1];

1018 
x2r
 = 
a
[
i
][
j2
] +‡[i][
j3
];

1019 
x2i
 = 
a
[
i
][
j2
 + 1] +‡[i][
j3
 + 1];

1020 
x3r
 = 
a
[
i
][
j2
] -‡[i][
j3
];

1021 
x3i
 = 
a
[
i
][
j2
 + 1] -‡[i][
j3
 + 1];

1022 
a
[
i
][
j
] = 
x0r
 + 
x2r
;

1023 
a
[
i
][
j
 + 1] = 
x0i
 + 
x2i
;

1024 
a
[
i
][
j2
] = 
x0r
 - 
x2r
;

1025 
a
[
i
][
j2
 + 1] = 
x0i
 - 
x2i
;

1026 
a
[
i
][
j1
] = 
x1r
 + 
x3i
;

1027 
a
[
i
][
j1
 + 1] = 
x1i
 - 
x3r
;

1028 
a
[
i
][
j3
] = 
x1r
 - 
x3i
;

1029 
a
[
i
][
j3
 + 1] = 
x1i
 + 
x3r
;

1031 ià(
m
 < 
n
) {

1032 
wk1r
 = 
w
[2];

1033 
j
 = 
m
; j <ğ
l
 + m - 2; j += 2) {

1034 
j1
 = 
j
 + 
l
;

1035 
j2
 = 
j1
 + 
l
;

1036 
j3
 = 
j2
 + 
l
;

1037 
x0r
 = 
a
[
i
][
j
] +‡[i][
j1
];

1038 
x0i
 = 
a
[
i
][
j
 + 1] +‡[i][
j1
 + 1];

1039 
x1r
 = 
a
[
i
][
j
] -‡[i][
j1
];

1040 
x1i
 = 
a
[
i
][
j
 + 1] -‡[i][
j1
 + 1];

1041 
x2r
 = 
a
[
i
][
j2
] +‡[i][
j3
];

1042 
x2i
 = 
a
[
i
][
j2
 + 1] +‡[i][
j3
 + 1];

1043 
x3r
 = 
a
[
i
][
j2
] -‡[i][
j3
];

1044 
x3i
 = 
a
[
i
][
j2
 + 1] -‡[i][
j3
 + 1];

1045 
a
[
i
][
j
] = 
x0r
 + 
x2r
;

1046 
a
[
i
][
j
 + 1] = 
x0i
 + 
x2i
;

1047 
a
[
i
][
j2
] = 
x0i
 - 
x2i
;

1048 
a
[
i
][
j2
 + 1] = 
x2r
 - 
x0r
;

1049 
x0r
 = 
x1r
 + 
x3i
;

1050 
x0i
 = 
x1i
 - 
x3r
;

1051 
a
[
i
][
j1
] = 
wk1r
 * (
x0i
 + 
x0r
);

1052 
a
[
i
][
j1
 + 1] = 
wk1r
 * (
x0i
 - 
x0r
);

1053 
x0r
 = 
x3i
 - 
x1r
;

1054 
x0i
 = 
x3r
 + 
x1i
;

1055 
a
[
i
][
j3
] = 
wk1r
 * (
x0r
 + 
x0i
);

1056 
a
[
i
][
j3
 + 1] = 
wk1r
 * (
x0r
 - 
x0i
);

1058 
k1
 = 1;

1059 
ks
 = -1;

1060 
k
 = (
m
 << 1); k <ğ
n
 - m; k += m) {

1061 
k1
++;

1062 
ks
 = -ks;

1063 
wk1r
 = 
w
[
k1
 << 1];

1064 
wk1i
 = 
w
[(
k1
 << 1) + 1];

1065 
wk2r
 = 
ks
 * 
w
[
k1
];

1066 
wk2i
 = 
w
[
k1
 + 
ks
];

1067 
wk3r
 = 
wk1r
 - 2 * 
wk2i
 * 
wk1i
;

1068 
wk3i
 = 2 * 
wk2i
 * 
wk1r
 - 
wk1i
;

1069 
j
 = 
k
; j <ğ
l
 + k - 2; j += 2) {

1070 
j1
 = 
j
 + 
l
;

1071 
j2
 = 
j1
 + 
l
;

1072 
j3
 = 
j2
 + 
l
;

1073 
x0r
 = 
a
[
i
][
j
] +‡[i][
j1
];

1074 
x0i
 = 
a
[
i
][
j
 + 1] +‡[i][
j1
 + 1];

1075 
x1r
 = 
a
[
i
][
j
] -‡[i][
j1
];

1076 
x1i
 = 
a
[
i
][
j
 + 1] -‡[i][
j1
 + 1];

1077 
x2r
 = 
a
[
i
][
j2
] +‡[i][
j3
];

1078 
x2i
 = 
a
[
i
][
j2
 + 1] +‡[i][
j3
 + 1];

1079 
x3r
 = 
a
[
i
][
j2
] -‡[i][
j3
];

1080 
x3i
 = 
a
[
i
][
j2
 + 1] -‡[i][
j3
 + 1];

1081 
a
[
i
][
j
] = 
x0r
 + 
x2r
;

1082 
a
[
i
][
j
 + 1] = 
x0i
 + 
x2i
;

1083 
x0r
 -ğ
x2r
;

1084 
x0i
 -ğ
x2i
;

1085 
a
[
i
][
j2
] = 
wk2r
 * 
x0r
 + 
wk2i
 * 
x0i
;

1086 
a
[
i
][
j2
 + 1] = 
wk2r
 * 
x0i
 - 
wk2i
 * 
x0r
;

1087 
x0r
 = 
x1r
 + 
x3i
;

1088 
x0i
 = 
x1i
 - 
x3r
;

1089 
a
[
i
][
j1
] = 
wk1r
 * 
x0r
 + 
wk1i
 * 
x0i
;

1090 
a
[
i
][
j1
 + 1] = 
wk1r
 * 
x0i
 - 
wk1i
 * 
x0r
;

1091 
x0r
 = 
x1r
 - 
x3i
;

1092 
x0i
 = 
x1i
 + 
x3r
;

1093 
a
[
i
][
j3
] = 
wk3r
 * 
x0r
 + 
wk3i
 * 
x0i
;

1094 
a
[
i
][
j3
 + 1] = 
wk3r
 * 
x0i
 - 
wk3i
 * 
x0r
;

1098 
l
 = 
m
;

1100 ià(
l
 < 
n
) {

1101 
j
 = 0; j <ğ
l
 - 2; j += 2) {

1102 
j1
 = 
j
 + 
l
;

1103 
x0r
 = 
a
[
i
][
j
] -‡[i][
j1
];

1104 
x0i
 = 
a
[
i
][
j
 + 1] -‡[i][
j1
 + 1];

1105 
a
[
i
][
j
] +ğa[i][
j1
];

1106 
a
[
i
][
j
 + 1] +ğa[i][
j1
 + 1];

1107 
a
[
i
][
j1
] = 
x0r
;

1108 
a
[
i
][
j1
 + 1] = 
x0i
;

1112 
	}
}

1115 
	$cáäow
(
n
, 
n2
, **
a
, *
w
)

1117 
i
, 
j
, 
j1
, 
j2
, 
j3
, 
k
, 
k1
, 
ks
, 
l
, 
m
;

1118 
wk1r
, 
wk1i
, 
wk2r
, 
wk2i
, 
wk3r
, 
wk3i
;

1119 
x0r
, 
x0i
, 
x1r
, 
x1i
, 
x2r
, 
x2i
, 
x3r
, 
x3i
;

1121 
l
 = 1;

1122 (
l
 << 1è< 
n
) {

1123 
m
 = 
l
 << 2;

1124 
j
 = 0; j <ğ
l
 - 1; j++) {

1125 
j1
 = 
j
 + 
l
;

1126 
j2
 = 
j1
 + 
l
;

1127 
j3
 = 
j2
 + 
l
;

1128 
i
 = 0; i <ğ
n2
 - 2; i += 2) {

1129 
x0r
 = 
a
[
j
][
i
] +‡[
j1
][i];

1130 
x0i
 = 
a
[
j
][
i
 + 1] +‡[
j1
][i + 1];

1131 
x1r
 = 
a
[
j
][
i
] -‡[
j1
][i];

1132 
x1i
 = 
a
[
j
][
i
 + 1] -‡[
j1
][i + 1];

1133 
x2r
 = 
a
[
j2
][
i
] +‡[
j3
][i];

1134 
x2i
 = 
a
[
j2
][
i
 + 1] +‡[
j3
][i + 1];

1135 
x3r
 = 
a
[
j2
][
i
] -‡[
j3
][i];

1136 
x3i
 = 
a
[
j2
][
i
 + 1] -‡[
j3
][i + 1];

1137 
a
[
j
][
i
] = 
x0r
 + 
x2r
;

1138 
a
[
j
][
i
 + 1] = 
x0i
 + 
x2i
;

1139 
a
[
j2
][
i
] = 
x0r
 - 
x2r
;

1140 
a
[
j2
][
i
 + 1] = 
x0i
 - 
x2i
;

1141 
a
[
j1
][
i
] = 
x1r
 + 
x3i
;

1142 
a
[
j1
][
i
 + 1] = 
x1i
 - 
x3r
;

1143 
a
[
j3
][
i
] = 
x1r
 - 
x3i
;

1144 
a
[
j3
][
i
 + 1] = 
x1i
 + 
x3r
;

1147 ià(
m
 < 
n
) {

1148 
wk1r
 = 
w
[2];

1149 
j
 = 
m
; j <ğ
l
 + m - 1; j++) {

1150 
j1
 = 
j
 + 
l
;

1151 
j2
 = 
j1
 + 
l
;

1152 
j3
 = 
j2
 + 
l
;

1153 
i
 = 0; i <ğ
n2
 - 2; i += 2) {

1154 
x0r
 = 
a
[
j
][
i
] +‡[
j1
][i];

1155 
x0i
 = 
a
[
j
][
i
 + 1] +‡[
j1
][i + 1];

1156 
x1r
 = 
a
[
j
][
i
] -‡[
j1
][i];

1157 
x1i
 = 
a
[
j
][
i
 + 1] -‡[
j1
][i + 1];

1158 
x2r
 = 
a
[
j2
][
i
] +‡[
j3
][i];

1159 
x2i
 = 
a
[
j2
][
i
 + 1] +‡[
j3
][i + 1];

1160 
x3r
 = 
a
[
j2
][
i
] -‡[
j3
][i];

1161 
x3i
 = 
a
[
j2
][
i
 + 1] -‡[
j3
][i + 1];

1162 
a
[
j
][
i
] = 
x0r
 + 
x2r
;

1163 
a
[
j
][
i
 + 1] = 
x0i
 + 
x2i
;

1164 
a
[
j2
][
i
] = 
x0i
 - 
x2i
;

1165 
a
[
j2
][
i
 + 1] = 
x2r
 - 
x0r
;

1166 
x0r
 = 
x1r
 + 
x3i
;

1167 
x0i
 = 
x1i
 - 
x3r
;

1168 
a
[
j1
][
i
] = 
wk1r
 * (
x0i
 + 
x0r
);

1169 
a
[
j1
][
i
 + 1] = 
wk1r
 * (
x0i
 - 
x0r
);

1170 
x0r
 = 
x3i
 - 
x1r
;

1171 
x0i
 = 
x3r
 + 
x1i
;

1172 
a
[
j3
][
i
] = 
wk1r
 * (
x0r
 + 
x0i
);

1173 
a
[
j3
][
i
 + 1] = 
wk1r
 * (
x0r
 - 
x0i
);

1176 
k1
 = 1;

1177 
ks
 = -1;

1178 
k
 = (
m
 << 1); k <ğ
n
 - m; k += m) {

1179 
k1
++;

1180 
ks
 = -ks;

1181 
wk1r
 = 
w
[
k1
 << 1];

1182 
wk1i
 = 
w
[(
k1
 << 1) + 1];

1183 
wk2r
 = 
ks
 * 
w
[
k1
];

1184 
wk2i
 = 
w
[
k1
 + 
ks
];

1185 
wk3r
 = 
wk1r
 - 2 * 
wk2i
 * 
wk1i
;

1186 
wk3i
 = 2 * 
wk2i
 * 
wk1r
 - 
wk1i
;

1187 
j
 = 
k
; j <ğ
l
 + k - 1; j++) {

1188 
j1
 = 
j
 + 
l
;

1189 
j2
 = 
j1
 + 
l
;

1190 
j3
 = 
j2
 + 
l
;

1191 
i
 = 0; i <ğ
n2
 - 2; i += 2) {

1192 
x0r
 = 
a
[
j
][
i
] +‡[
j1
][i];

1193 
x0i
 = 
a
[
j
][
i
 + 1] +‡[
j1
][i + 1];

1194 
x1r
 = 
a
[
j
][
i
] -‡[
j1
][i];

1195 
x1i
 = 
a
[
j
][
i
 + 1] -‡[
j1
][i + 1];

1196 
x2r
 = 
a
[
j2
][
i
] +‡[
j3
][i];

1197 
x2i
 = 
a
[
j2
][
i
 + 1] +‡[
j3
][i + 1];

1198 
x3r
 = 
a
[
j2
][
i
] -‡[
j3
][i];

1199 
x3i
 = 
a
[
j2
][
i
 + 1] -‡[
j3
][i + 1];

1200 
a
[
j
][
i
] = 
x0r
 + 
x2r
;

1201 
a
[
j
][
i
 + 1] = 
x0i
 + 
x2i
;

1202 
x0r
 -ğ
x2r
;

1203 
x0i
 -ğ
x2i
;

1204 
a
[
j2
][
i
] = 
wk2r
 * 
x0r
 + 
wk2i
 * 
x0i
;

1205 
a
[
j2
][
i
 + 1] = 
wk2r
 * 
x0i
 - 
wk2i
 * 
x0r
;

1206 
x0r
 = 
x1r
 + 
x3i
;

1207 
x0i
 = 
x1i
 - 
x3r
;

1208 
a
[
j1
][
i
] = 
wk1r
 * 
x0r
 + 
wk1i
 * 
x0i
;

1209 
a
[
j1
][
i
 + 1] = 
wk1r
 * 
x0i
 - 
wk1i
 * 
x0r
;

1210 
x0r
 = 
x1r
 - 
x3i
;

1211 
x0i
 = 
x1i
 + 
x3r
;

1212 
a
[
j3
][
i
] = 
wk3r
 * 
x0r
 + 
wk3i
 * 
x0i
;

1213 
a
[
j3
][
i
 + 1] = 
wk3r
 * 
x0i
 - 
wk3i
 * 
x0r
;

1218 
l
 = 
m
;

1220 ià(
l
 < 
n
) {

1221 
j
 = 0; j <ğ
l
 - 1; j++) {

1222 
j1
 = 
j
 + 
l
;

1223 
i
 = 0; i <ğ
n2
 - 2; i += 2) {

1224 
x0r
 = 
a
[
j
][
i
] -‡[
j1
][i];

1225 
x0i
 = 
a
[
j
][
i
 + 1] -‡[
j1
][i + 1];

1226 
a
[
j
][
i
] +ğa[
j1
][i];

1227 
a
[
j
][
i
 + 1] +ğa[
j1
][i + 1];

1228 
a
[
j1
][
i
] = 
x0r
;

1229 
a
[
j1
][
i
 + 1] = 
x0i
;

1233 
	}
}

1236 
	$rábcŞ
(
n1
, 
n
, **
a
, 
nc
, *
c
)

1238 
i
, 
j
, 
k
, 
kk
, 
ks
;

1239 
wkr
, 
wki
, 
xr
, 
xi
, 
yr
, 
yi
;

1241 
ks
 = (
nc
 << 2è/ 
n
;

1242 
i
 = 0; i <ğ
n1
 - 1; i++) {

1243 
kk
 = 0;

1244 
k
 = (
n
 >> 1) - 2; k >= 2; k -= 2) {

1245 
j
 = 
n
 - 
k
;

1246 
kk
 +ğ
ks
;

1247 
wkr
 = 0.5 - 
c
[
kk
];

1248 
wki
 = 
c
[
nc
 - 
kk
];

1249 
xr
 = 
a
[
i
][
k
] -‡[i][
j
];

1250 
xi
 = 
a
[
i
][
k
 + 1] +‡[i][
j
 + 1];

1251 
yr
 = 
wkr
 * 
xr
 - 
wki
 * 
xi
;

1252 
yi
 = 
wkr
 * 
xi
 + 
wki
 * 
xr
;

1253 
a
[
i
][
k
] -ğ
yr
;

1254 
a
[
i
][
k
 + 1] -ğ
yi
;

1255 
a
[
i
][
j
] +ğ
yr
;

1256 
a
[
i
][
j
 + 1] -ğ
yi
;

1259 
	}
}

1262 
	$ráfcŞ
(
n1
, 
n
, **
a
, 
nc
, *
c
)

1264 
i
, 
j
, 
k
, 
kk
, 
ks
;

1265 
wkr
, 
wki
, 
xr
, 
xi
, 
yr
, 
yi
;

1267 
ks
 = (
nc
 << 2è/ 
n
;

1268 
i
 = 0; i <ğ
n1
 - 1; i++) {

1269 
kk
 = 0;

1270 
k
 = (
n
 >> 1) - 2; k >= 2; k -= 2) {

1271 
j
 = 
n
 - 
k
;

1272 
kk
 +ğ
ks
;

1273 
wkr
 = 0.5 - 
c
[
kk
];

1274 
wki
 = 
c
[
nc
 - 
kk
];

1275 
xr
 = 
a
[
i
][
k
] -‡[i][
j
];

1276 
xi
 = 
a
[
i
][
k
 + 1] +‡[i][
j
 + 1];

1277 
yr
 = 
wkr
 * 
xr
 + 
wki
 * 
xi
;

1278 
yi
 = 
wkr
 * 
xi
 - 
wki
 * 
xr
;

1279 
a
[
i
][
k
] -ğ
yr
;

1280 
a
[
i
][
k
 + 1] -ğ
yi
;

1281 
a
[
i
][
j
] +ğ
yr
;

1282 
a
[
i
][
j
 + 1] -ğ
yi
;

1285 
	}
}

1288 
	$dùbsub
(
n1
, 
n2
, **
a
, 
nc
, *
c
)

1290 
kk1
, 
kk2
, 
ks1
, 
ks2
, 
n1h
, 
j1
, 
k1
, 
k2
;

1291 
w1r
, 
w1i
, 
wkr
, 
wki
, 
wjr
, 
wji
, 
x0r
, 
x0i
, 
x1r
, 
x1i
;

1293 
ks1
 = 
nc
 / 
n1
;

1294 
ks2
 = 
nc
 / 
n2
;

1295 
n1h
 = 
n1
 >> 1;

1296 
kk1
 = 
ks1
;

1297 
k1
 = 1; k1 <ğ
n1h
 - 1; k1++) {

1298 
j1
 = 
n1
 - 
k1
;

1299 
w1r
 = 2 * 
c
[
kk1
];

1300 
w1i
 = 2 * 
c
[
nc
 - 
kk1
];

1301 
kk1
 +ğ
ks1
;

1302 
kk2
 = 
ks2
;

1303 
k2
 = 2; k2 <ğ
n2
 - 2; k2 += 2) {

1304 
x0r
 = 
w1r
 * 
c
[
kk2
];

1305 
x0i
 = 
w1i
 * 
c
[
kk2
];

1306 
x1r
 = 
w1r
 * 
c
[
nc
 - 
kk2
];

1307 
x1i
 = 
w1i
 * 
c
[
nc
 - 
kk2
];

1308 
wkr
 = 
x0r
 - 
x1i
;

1309 
wki
 = 
x0i
 + 
x1r
;

1310 
wji
 = 
x0r
 + 
x1i
;

1311 
wjr
 = 
x0i
 - 
x1r
;

1312 
kk2
 +ğ
ks2
;

1313 
x0r
 = 
wkr
 * 
a
[
k1
][
k2
] - 
wki
 *‡[k1][k2 + 1];

1314 
x0i
 = 
wkr
 * 
a
[
k1
][
k2
 + 1] + 
wki
 *‡[k1][k2];

1315 
x1r
 = 
wjr
 * 
a
[
j1
][
k2
] - 
wji
 *‡[j1][k2 + 1];

1316 
x1i
 = 
wjr
 * 
a
[
j1
][
k2
 + 1] + 
wji
 *‡[j1][k2];

1317 
a
[
k1
][
k2
] = 
x0r
 + 
x1i
;

1318 
a
[
k1
][
k2
 + 1] = 
x0i
 - 
x1r
;

1319 
a
[
j1
][
k2
] = 
x1r
 + 
x0i
;

1320 
a
[
j1
][
k2
 + 1] = 
x1i
 - 
x0r
;

1322 
wkr
 = 
w1r
 * 0.5;

1323 
wki
 = 
w1i
 * 0.5;

1324 
wjr
 = 
w1r
 * 
c
[
kk2
];

1325 
wji
 = 
w1i
 * 
c
[
kk2
];

1326 
x0r
 = 
a
[
k1
][0] +‡[
j1
][0];

1327 
x0i
 = 
a
[
k1
][1] -‡[
j1
][1];

1328 
x1r
 = 
a
[
k1
][0] -‡[
j1
][0];

1329 
x1i
 = 
a
[
k1
][1] +‡[
j1
][1];

1330 
a
[
k1
][0] = 
wkr
 * 
x0r
 - 
wki
 * 
x0i
;

1331 
a
[
k1
][1] = 
wkr
 * 
x0i
 + 
wki
 * 
x0r
;

1332 
a
[
j1
][0] = -
wjr
 * 
x1r
 + 
wji
 * 
x1i
;

1333 
a
[
j1
][1] = 
wjr
 * 
x1i
 + 
wji
 * 
x1r
;

1335 
w1r
 = 2 * 
c
[
kk1
];

1336 
kk2
 = 
ks2
;

1337 
k2
 = 2; k2 <ğ
n2
 - 2; k2 += 2) {

1338 
wkr
 = 2 * 
c
[
kk2
];

1339 
wki
 = 2 * 
c
[
nc
 - 
kk2
];

1340 
wjr
 = 
w1r
 * 
wkr
;

1341 
wji
 = 
w1r
 * 
wki
;

1342 
kk2
 +ğ
ks2
;

1343 
x0i
 = 
wkr
 * 
a
[0][
k2
 + 1] + 
wki
 *‡[0][k2];

1344 
a
[0][
k2
] = 
wkr
 *‡[0][k2] - 
wki
 *‡[0][k2 + 1];

1345 
a
[0][
k2
 + 1] = 
x0i
;

1346 
x0i
 = 
wjr
 * 
a
[
n1h
][
k2
 + 1] + 
wji
 *‡[n1h][k2];

1347 
a
[
n1h
][
k2
] = 
wjr
 *‡[n1h][k2] - 
wji
 *‡[n1h][k2 + 1];

1348 
a
[
n1h
][
k2
 + 1] = 
x0i
;

1350 
a
[0][1] *ğ
w1r
;

1351 
a
[
n1h
][0] *ğ
w1r
;

1352 
a
[
n1h
][1] *= 0.5;

1353 
	}
}

1356 
	$dùfsub
(
n1
, 
n2
, **
a
, 
nc
, *
c
)

1358 
kk1
, 
kk2
, 
ks1
, 
ks2
, 
n1h
, 
j1
, 
k1
, 
k2
;

1359 
w1r
, 
w1i
, 
wkr
, 
wki
, 
wjr
, 
wji
, 
x0r
, 
x0i
, 
x1r
, 
x1i
;

1361 
ks1
 = 
nc
 / 
n1
;

1362 
ks2
 = 
nc
 / 
n2
;

1363 
n1h
 = 
n1
 >> 1;

1364 
kk1
 = 
ks1
;

1365 
k1
 = 1; k1 <ğ
n1h
 - 1; k1++) {

1366 
j1
 = 
n1
 - 
k1
;

1367 
w1r
 = 2 * 
c
[
kk1
];

1368 
w1i
 = 2 * 
c
[
nc
 - 
kk1
];

1369 
kk1
 +ğ
ks1
;

1370 
kk2
 = 
ks2
;

1371 
k2
 = 2; k2 <ğ
n2
 - 2; k2 += 2) {

1372 
x0r
 = 
w1r
 * 
c
[
kk2
];

1373 
x0i
 = 
w1i
 * 
c
[
kk2
];

1374 
x1r
 = 
w1r
 * 
c
[
nc
 - 
kk2
];

1375 
x1i
 = 
w1i
 * 
c
[
nc
 - 
kk2
];

1376 
wkr
 = 
x0r
 - 
x1i
;

1377 
wki
 = 
x0i
 + 
x1r
;

1378 
wji
 = 
x0r
 + 
x1i
;

1379 
wjr
 = 
x0i
 - 
x1r
;

1380 
kk2
 +ğ
ks2
;

1381 
x0r
 = 
a
[
k1
][
k2
] -‡[
j1
][k2 + 1];

1382 
x0i
 = 
a
[
j1
][
k2
] +‡[
k1
][k2 + 1];

1383 
x1r
 = 
a
[
j1
][
k2
] -‡[
k1
][k2 + 1];

1384 
x1i
 = 
a
[
k1
][
k2
] +‡[
j1
][k2 + 1];

1385 
a
[
k1
][
k2
] = 
wkr
 * 
x0r
 + 
wki
 * 
x0i
;

1386 
a
[
k1
][
k2
 + 1] = 
wkr
 * 
x0i
 - 
wki
 * 
x0r
;

1387 
a
[
j1
][
k2
] = 
wjr
 * 
x1r
 + 
wji
 * 
x1i
;

1388 
a
[
j1
][
k2
 + 1] = 
wjr
 * 
x1i
 - 
wji
 * 
x1r
;

1390 
x0r
 = 2 * 
c
[
kk2
];

1391 
wjr
 = 
x0r
 * 
w1r
;

1392 
wji
 = 
x0r
 * 
w1i
;

1393 
x0r
 = 
w1r
 * 
a
[
k1
][0] + 
w1i
 *‡[k1][1];

1394 
x0i
 = 
w1r
 * 
a
[
k1
][1] - 
w1i
 *‡[k1][0];

1395 
x1r
 = -
wjr
 * 
a
[
j1
][0] + 
wji
 *‡[j1][1];

1396 
x1i
 = 
wjr
 * 
a
[
j1
][1] + 
wji
 *‡[j1][0];

1397 
a
[
k1
][0] = 
x0r
 + 
x1r
;

1398 
a
[
k1
][1] = 
x1i
 + 
x0i
;

1399 
a
[
j1
][0] = 
x0r
 - 
x1r
;

1400 
a
[
j1
][1] = 
x1i
 - 
x0i
;

1402 
w1r
 = 2 * 
c
[
kk1
];

1403 
kk2
 = 
ks2
;

1404 
k2
 = 2; k2 <ğ
n2
 - 2; k2 += 2) {

1405 
wkr
 = 2 * 
c
[
kk2
];

1406 
wki
 = 2 * 
c
[
nc
 - 
kk2
];

1407 
wjr
 = 
w1r
 * 
wkr
;

1408 
wji
 = 
w1r
 * 
wki
;

1409 
kk2
 +ğ
ks2
;

1410 
x0i
 = 
wkr
 * 
a
[0][
k2
 + 1] - 
wki
 *‡[0][k2];

1411 
a
[0][
k2
] = 
wkr
 *‡[0][k2] + 
wki
 *‡[0][k2 + 1];

1412 
a
[0][
k2
 + 1] = 
x0i
;

1413 
x0i
 = 
wjr
 * 
a
[
n1h
][
k2
 + 1] - 
wji
 *‡[n1h][k2];

1414 
a
[
n1h
][
k2
] = 
wjr
 *‡[n1h][k2] + 
wji
 *‡[n1h][k2 + 1];

1415 
a
[
n1h
][
k2
 + 1] = 
x0i
;

1417 
w1r
 *= 2;

1418 
a
[0][0] *= 2;

1419 
a
[0][1] *ğ
w1r
;

1420 
a
[
n1h
][0] *ğ
w1r
;

1421 
	}
}

1424 
	$d¡bsub
(
n1
, 
n2
, **
a
, 
nc
, *
c
)

1426 
kk1
, 
kk2
, 
ks1
, 
ks2
, 
n1h
, 
j1
, 
k1
, 
k2
;

1427 
w1r
, 
w1i
, 
wkr
, 
wki
, 
wjr
, 
wji
, 
x0r
, 
x0i
, 
x1r
, 
x1i
;

1429 
ks1
 = 
nc
 / 
n1
;

1430 
ks2
 = 
nc
 / 
n2
;

1431 
n1h
 = 
n1
 >> 1;

1432 
kk1
 = 
ks1
;

1433 
k1
 = 1; k1 <ğ
n1h
 - 1; k1++) {

1434 
j1
 = 
n1
 - 
k1
;

1435 
w1r
 = 2 * 
c
[
kk1
];

1436 
w1i
 = 2 * 
c
[
nc
 - 
kk1
];

1437 
kk1
 +ğ
ks1
;

1438 
kk2
 = 
ks2
;

1439 
k2
 = 2; k2 <ğ
n2
 - 2; k2 += 2) {

1440 
x0r
 = 
w1r
 * 
c
[
kk2
];

1441 
x0i
 = 
w1i
 * 
c
[
kk2
];

1442 
x1r
 = 
w1r
 * 
c
[
nc
 - 
kk2
];

1443 
x1i
 = 
w1i
 * 
c
[
nc
 - 
kk2
];

1444 
wkr
 = 
x0r
 - 
x1i
;

1445 
wki
 = 
x0i
 + 
x1r
;

1446 
wji
 = 
x0r
 + 
x1i
;

1447 
wjr
 = 
x0i
 - 
x1r
;

1448 
kk2
 +ğ
ks2
;

1449 
x0r
 = 
wkr
 * 
a
[
k1
][
k2
] - 
wki
 *‡[k1][k2 + 1];

1450 
x0i
 = 
wkr
 * 
a
[
k1
][
k2
 + 1] + 
wki
 *‡[k1][k2];

1451 
x1r
 = 
wjr
 * 
a
[
j1
][
k2
] - 
wji
 *‡[j1][k2 + 1];

1452 
x1i
 = 
wjr
 * 
a
[
j1
][
k2
 + 1] + 
wji
 *‡[j1][k2];

1453 
a
[
k1
][
k2
] = 
x1i
 - 
x0r
;

1454 
a
[
k1
][
k2
 + 1] = 
x1r
 + 
x0i
;

1455 
a
[
j1
][
k2
] = 
x0i
 - 
x1r
;

1456 
a
[
j1
][
k2
 + 1] = 
x0r
 + 
x1i
;

1458 
wkr
 = 
w1r
 * 0.5;

1459 
wki
 = 
w1i
 * 0.5;

1460 
wjr
 = 
w1r
 * 
c
[
kk2
];

1461 
wji
 = 
w1i
 * 
c
[
kk2
];

1462 
x0r
 = 
a
[
k1
][0] +‡[
j1
][0];

1463 
x0i
 = 
a
[
k1
][1] -‡[
j1
][1];

1464 
x1r
 = 
a
[
k1
][0] -‡[
j1
][0];

1465 
x1i
 = 
a
[
k1
][1] +‡[
j1
][1];

1466 
a
[
k1
][1] = 
wkr
 * 
x0r
 - 
wki
 * 
x0i
;

1467 
a
[
k1
][0] = 
wkr
 * 
x0i
 + 
wki
 * 
x0r
;

1468 
a
[
j1
][1] = -
wjr
 * 
x1r
 + 
wji
 * 
x1i
;

1469 
a
[
j1
][0] = 
wjr
 * 
x1i
 + 
wji
 * 
x1r
;

1471 
w1r
 = 2 * 
c
[
kk1
];

1472 
kk2
 = 
ks2
;

1473 
k2
 = 2; k2 <ğ
n2
 - 2; k2 += 2) {

1474 
wkr
 = 2 * 
c
[
kk2
];

1475 
wki
 = 2 * 
c
[
nc
 - 
kk2
];

1476 
wjr
 = 
w1r
 * 
wkr
;

1477 
wji
 = 
w1r
 * 
wki
;

1478 
kk2
 +ğ
ks2
;

1479 
x0i
 = 
wkr
 * 
a
[0][
k2
 + 1] + 
wki
 *‡[0][k2];

1480 
a
[0][
k2
 + 1] = 
wkr
 *‡[0][k2] - 
wki
 *‡[0][k2 + 1];

1481 
a
[0][
k2
] = 
x0i
;

1482 
x0i
 = 
wjr
 * 
a
[
n1h
][
k2
 + 1] + 
wji
 *‡[n1h][k2];

1483 
a
[
n1h
][
k2
 + 1] = 
wjr
 *‡[n1h][k2] - 
wji
 *‡[n1h][k2 + 1];

1484 
a
[
n1h
][
k2
] = 
x0i
;

1486 
a
[0][1] *ğ
w1r
;

1487 
a
[
n1h
][0] *ğ
w1r
;

1488 
a
[
n1h
][1] *= 0.5;

1489 
	}
}

1492 
	$d¡fsub
(
n1
, 
n2
, **
a
, 
nc
, *
c
)

1494 
kk1
, 
kk2
, 
ks1
, 
ks2
, 
n1h
, 
j1
, 
k1
, 
k2
;

1495 
w1r
, 
w1i
, 
wkr
, 
wki
, 
wjr
, 
wji
, 
x0r
, 
x0i
, 
x1r
, 
x1i
;

1497 
ks1
 = 
nc
 / 
n1
;

1498 
ks2
 = 
nc
 / 
n2
;

1499 
n1h
 = 
n1
 >> 1;

1500 
kk1
 = 
ks1
;

1501 
k1
 = 1; k1 <ğ
n1h
 - 1; k1++) {

1502 
j1
 = 
n1
 - 
k1
;

1503 
w1r
 = 2 * 
c
[
kk1
];

1504 
w1i
 = 2 * 
c
[
nc
 - 
kk1
];

1505 
kk1
 +ğ
ks1
;

1506 
kk2
 = 
ks2
;

1507 
k2
 = 2; k2 <ğ
n2
 - 2; k2 += 2) {

1508 
x0r
 = 
w1r
 * 
c
[
kk2
];

1509 
x0i
 = 
w1i
 * 
c
[
kk2
];

1510 
x1r
 = 
w1r
 * 
c
[
nc
 - 
kk2
];

1511 
x1i
 = 
w1i
 * 
c
[
nc
 - 
kk2
];

1512 
wkr
 = 
x0r
 - 
x1i
;

1513 
wki
 = 
x0i
 + 
x1r
;

1514 
wji
 = 
x0r
 + 
x1i
;

1515 
wjr
 = 
x0i
 - 
x1r
;

1516 
kk2
 +ğ
ks2
;

1517 
x0r
 = 
a
[
j1
][
k2
 + 1] -‡[
k1
][k2];

1518 
x0i
 = 
a
[
k1
][
k2
 + 1] +‡[
j1
][k2];

1519 
x1r
 = 
a
[
k1
][
k2
 + 1] -‡[
j1
][k2];

1520 
x1i
 = 
a
[
j1
][
k2
 + 1] +‡[
k1
][k2];

1521 
a
[
k1
][
k2
] = 
wkr
 * 
x0r
 + 
wki
 * 
x0i
;

1522 
a
[
k1
][
k2
 + 1] = 
wkr
 * 
x0i
 - 
wki
 * 
x0r
;

1523 
a
[
j1
][
k2
] = 
wjr
 * 
x1r
 + 
wji
 * 
x1i
;

1524 
a
[
j1
][
k2
 + 1] = 
wjr
 * 
x1i
 - 
wji
 * 
x1r
;

1526 
x0r
 = 2 * 
c
[
kk2
];

1527 
wjr
 = 
x0r
 * 
w1r
;

1528 
wji
 = 
x0r
 * 
w1i
;

1529 
x0r
 = 
w1r
 * 
a
[
k1
][1] + 
w1i
 *‡[k1][0];

1530 
x0i
 = 
w1r
 * 
a
[
k1
][0] - 
w1i
 *‡[k1][1];

1531 
x1r
 = -
wjr
 * 
a
[
j1
][1] + 
wji
 *‡[j1][0];

1532 
x1i
 = 
wjr
 * 
a
[
j1
][0] + 
wji
 *‡[j1][1];

1533 
a
[
k1
][0] = 
x0r
 + 
x1r
;

1534 
a
[
k1
][1] = 
x1i
 + 
x0i
;

1535 
a
[
j1
][0] = 
x0r
 - 
x1r
;

1536 
a
[
j1
][1] = 
x1i
 - 
x0i
;

1538 
w1r
 = 2 * 
c
[
kk1
];

1539 
kk2
 = 
ks2
;

1540 
k2
 = 2; k2 <ğ
n2
 - 2; k2 += 2) {

1541 
wkr
 = 2 * 
c
[
kk2
];

1542 
wki
 = 2 * 
c
[
nc
 - 
kk2
];

1543 
wjr
 = 
w1r
 * 
wkr
;

1544 
wji
 = 
w1r
 * 
wki
;

1545 
kk2
 +ğ
ks2
;

1546 
x0i
 = 
wkr
 * 
a
[0][
k2
] - 
wki
 *‡[0][k2 + 1];

1547 
a
[0][
k2
] = 
wkr
 *‡[0][k2 + 1] + 
wki
 *‡[0][k2];

1548 
a
[0][
k2
 + 1] = 
x0i
;

1549 
x0i
 = 
wjr
 * 
a
[
n1h
][
k2
] - 
wji
 *‡[n1h][k2 + 1];

1550 
a
[
n1h
][
k2
] = 
wjr
 *‡[n1h][k2 + 1] + 
wji
 *‡[n1h][k2];

1551 
a
[
n1h
][
k2
 + 1] = 
x0i
;

1553 
w1r
 *= 2;

1554 
a
[0][0] *= 2;

1555 
a
[0][1] *ğ
w1r
;

1556 
a
[
n1h
][0] *ğ
w1r
;

1557 
	}
}

	@/home/lyang3/work/src_son/runWorld/channel.h

1 
	~"runWÜld.h
"

3 
	#numC¬r›rIÁ”e¡
 
Nrb
*12

	)

4 
	#Nfá
 
Nrb
/50*1024

	)

5 
	#SWAP
(
a
,
b
è
‹m´
=×);×)=(b);(b)=
	)
tempr

6 
	#decim©eR©e
 3

	)

8 
	sCom¶ex
{

9 
	m»®
, 
	mimg
;

12 şas 
	cUrbªMaüo


14 
	mpublic
:

16 
UrbªMaüo
();

17 ~
UrbªMaüo
();

21 
	mşu¡”AS©UE
,

22 
	mchªÃlD–ays
[
numSub·thFadšgChªÃl
];

24 
Com¶ex


25 
	mfáRecÜd
[
numC¬r›rIÁ”e¡
][
numSub·thFadšgChªÃl
];

28 
	mchªÃlPow”s
[
numSub·thFadšgChªÃl
],

29 
	mDLSÿ‰”AngËsAtUE
[
numSub·thFadšgChªÃl
],

30 
	mAÁAngËs
[
numSub·thFadšgChªÃl
];

34 şas 
	cOutdoÜIndoÜ


36 
	mpublic
:

38 
OutdoÜIndoÜ
();

39 ~
OutdoÜIndoÜ
();

43 
	mşu¡”AS©UE
,

44 
	mchªÃlD–ays
[
numSub·thFadšgChªÃl
];

46 
Com¶ex


47 
	mfáRecÜd
[
numC¬r›rIÁ”e¡
][
numSub·thFadšgChªÃl
];

50 
	mchªÃlPow”s
[
numSub·thFadšgChªÃl
],

51 
	mDLSÿ‰”AngËsAtUE
[
numSub·thFadšgChªÃl
],

52 
	mAÁAngËs
[
numSub·thFadšgChªÃl
];

56 şas 
	cIndoÜHÙ¥Ù


58 
	mpublic
:

60 
IndoÜHÙ¥Ù
();

61 ~
IndoÜHÙ¥Ù
();

65 
	mşu¡”AS©UE
,

66 
	mchªÃlD–ays
[
numSub·thFadšgChªÃl
];

68 
Com¶ex


69 
	mfáRecÜd
[
numC¬r›rIÁ”e¡
][
numSub·thFadšgChªÃl
];

72 
	mchªÃlPow”s
[
numSub·thFadšgChªÃl
],

73 
	mDLSÿ‰”AngËsAtUE
[
numSub·thFadšgChªÃl
],

74 
	mAÁAngËs
[
numSub·thFadšgChªÃl
];

79 şas 
	cChªÃl


81 
	mpublic
:

83 
ChªÃl
();

84 ~
ChªÃl
();

87 
UrbªMaüo


88 
	murbªMaüo
;

90 
OutdoÜIndoÜ


91 
	moutdoÜIndoÜ
;

93 
IndoÜHÙ¥Ù


94 
	mšdoÜHÙ¥Ù
;

97 
	mblockAvFadšgDL
[
numBlocksDL
][
numC¬r›rIÁ”e¡
/
decim©eR©e
],

98 
	mblockAvFadšgUL
[
Nrb
-
NrbPUCCH
][(
numC¬r›rIÁ”e¡
-12 * NrbPUCCH)/
decim©eR©e
];

101 
	m§m¶esP”Block
,

102 
	m§m¶esP”BlockUL
,

103 
	m§m¶esP”RB
;

107 
Jacobi
(**
a
, *
d
, **
v
, &
ÄÙ
, 
n
);

108 
Œed
(**
a
, *
d
, *
e
, 
n
);

109 
tqli
(*
d
, *
e
, **
z
, 
n
);

111 
cdá2d
(, , , **, *, *);

113 
Com¶ex
 
Com¶exMul
(Com¶ex 
x
, Com¶ex 
y
);

114 
Com¶ex
 
com¶ex
(
x
, 
y
);

115 
Com¶ex
 
pha£2Com¶ex
(
x
);

116 
Com¶ex
 
Com¶exAdd
(Com¶ex 
x
, Com¶ex 
y
);

117 
Com¶ex
 
Com¶exR—lMul
(Com¶ex 
x
, 
y
);

118 
Com¶ex
 
Com¶exR—lDiv
(Com¶ex 
tİ
,
bÙtom
);

119 
Com¶ex2Pha£
(
Com¶ex
 
x
);

120 
pow”
(
Com¶ex
 
x
);

	@/home/lyang3/work/src_son/runWorld/fading.cpp

1 
	~<io¡»am
>

2 
	~<f¡»am
>

3 
	~<m©h.h
>

5 
	~"wÜld.h
"

6 
	~"¿ndom.h
"

8 
usšg
 
Çme¥aû
 
	g¡d
;

10 
	gWÜld
::
	$In™Fadšg
( ){

13 
m—nAngË
,

14 
Ïmda
,

15 
di¡1ms
;

18 
iUE
, 
i
, 
j
, 
iS™e
, 
iSeùÜ
;

20 
Ïmda
 = 3e8 / (
C¬rF»q
*1e6);

21 
di¡1ms
 = (1e-3è* (
MAXSPEED
*1000/3600);

24 
iUE
=0; iUE<
numMaüoUEs
; iUE++){

27 
iS™e
 = 
UEs
[
iUE
].
ueLTEd©a
.
iS”všgS™e
;

28 
iSeùÜ
 = 
UEs
[
iUE
].
ueLTEd©a
.
iS”všgSeùÜ
;

30 
m—nAngË
 = 
UEs
[
iUE
].
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dB—ršg
;

32 
i
=0; i<
numFadšgP©hs
; i++){

33 
UEs
[
iUE
].
AÁAngËs
[
i
] = (
m—nAngË
 + 
chªÃl
.
urbªMaüo
.AÁAngËs[i])*180.0/
PI
;

34 ià(
UEs
[
iUE
].
AÁAngËs
[
i
] > 180)

35 
UEs
[
iUE
].
AÁAngËs
[
i
] = UEs[iUE].AntAngles[i] - 360;

36 ià(
UEs
[
iUE
].
AÁAngËs
[
i
] < -180)

37 
UEs
[
iUE
].
AÁAngËs
[
i
] = UEs[iUE].AntAngles[i] + 360;

39 
UEs
[
iUE
].
AÁGaš
[
i
] = 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
	`ª‹ÂaA‰’
(UEs[iUE].
AÁAngËs
[i]);

40 
UEs
[
iUE
].
DLS‹”šgVec
[
i
] = 1.0;

41 
j
=0; j<
NªtsBSRx
; j++){

42 
UEs
[
iUE
].
ULS‹”šgVec
[
i
][
j
] = 
	`pha£2Com¶ex
(2*
PI
*j * 
AÁS·cšgMaüo
 * 
	`sš
(UEs[iUE].
AÁAngËs
[i]*PI/180));

46 
i
=0; i<
numFadšgP©hs
; i++){

47 
j
=0; j<
numSub·thFadšgChªÃl
; j++){

48 ià(
UEs
[
iUE
].
ueD•loym’tTy³
 =ğ
maüoUeOutdoÜ
){

49 
UEs
[
iUE
].
DLSÿ‰”AngËsAtUE
[
i
][
j
] = (
chªÃl
.
urbªMaüo
.DLScatterAnglesAtUE[i]

50 + (0.5 - 
	`¿n1
(&
iS“d
))*
chªÃl
.
urbªMaüo
.
şu¡”AS©UE
è* 
PI
 / 180;

53 
UEs
[
iUE
].
DLSÿ‰”AngËsAtUE
[
i
][
j
] = (
chªÃl
.
outdoÜIndoÜ
.DLScatterAnglesAtUE[i]

54 + (0.5 - 
	`¿n1
(&
iS“d
))*
chªÃl
.
outdoÜIndoÜ
.
şu¡”AS©UE
è* 
PI
 / 180;

56 
UEs
[
iUE
].
DL·thPha£s
[
i
][
j
] = 2 * 
PI
 * 
	`¿n1
(&
iS“d
);

57 
UEs
[
iUE
].
DLd–Pha£s
[
i
][
j
] = 2 * 
PI
 * 
	`cos
(UEs[iUE].
DLSÿ‰”AngËsAtUE
[i][j]è* 
di¡1ms
 / 
Ïmda
;

58 
UEs
[
iUE
].
UL·thPha£s
[
i
][
j
] = 2 * 
PI
 * 
	`¿n1
(&
iS“d
);

59 
UEs
[
iUE
].
ULd–Pha£s
[
i
][
j
] = 2 * 
PI
 * 
	`cos
(
	`¿n1
(&
iS“d
è* 2 * PIè* 
di¡1ms
 / 
Ïmda
;

65 
iUE
=0; iUE<
numHomeUE
; iUE++){

66 
i
=0; i<
numFadšgP©hs
; i++){

67 
HUEs
[
iUE
].
DLS‹”šgVec
[
i
] = 1.0;

69 
j
=0; j<
numSub·thFadšgChªÃl
; j++){

70 ià(
HUEs
[
iUE
].
ueD•loym’tTy³
 =ğ
ãmtoUeIndoÜ
){

71 
HUEs
[
iUE
].
DLSÿ‰”AngËsAtUE
[
i
][
j
] = (
chªÃl
.
šdoÜHÙ¥Ù
.DLScatterAnglesAtUE[i]

72 + (0.5 - 
	`¿n1
(&
iS“d
))*
chªÃl
.
šdoÜHÙ¥Ù
.
şu¡”AS©UE
è* 
PI
 / 180;

75 
HUEs
[
iUE
].
DLSÿ‰”AngËsAtUE
[
i
][
j
] = (
chªÃl
.
outdoÜIndoÜ
.DLScatterAnglesAtUE[i]

76 + (0.5 - 
	`¿n1
(&
iS“d
))*
chªÃl
.
outdoÜIndoÜ
.
şu¡”AS©UE
è* 
PI
 / 180;

78 
HUEs
[
iUE
].
DL·thPha£s
[
i
][
j
] = 2 * 
PI
 * 
	`¿n1
(&
iS“d
);

79 
HUEs
[
iUE
].
DLd–Pha£s
[
i
][
j
] = 2 * 
PI
 * 
	`cos
(HUEs[iUE].
DLSÿ‰”AngËsAtUE
[i][j]è* 
di¡1ms
 / 
Ïmda
;

80 
HUEs
[
iUE
].
UL·thPha£s
[
i
][
j
] = 2 * 
PI
 * 
	`¿n1
(&
iS“d
);

81 
HUEs
[
iUE
].
ULd–Pha£s
[
i
][
j
] = 2 * 
PI
 * 
	`cos
(
	`¿n1
(&
iS“d
è* 2 * PIè* 
di¡1ms
 / 
Ïmda
;

82 
HUEs
[
iUE
].
ULSÿ‰”AngËsAtFemto
[
i
][
j
] = 
chªÃl
.
šdoÜHÙ¥Ù
.
AÁAngËs
[i] + (0.5 - 
	`¿n1
(&
iS“d
)è* 5 * 
PI
 / 180;

88 
iUE
=0; iUE<
numHomeUE
; iUE++){

89 
i
=0; i<
numFadšgP©hs
; i++){

90 
j
=0; j<
numSub·thFadšgChªÃl
; j++){

91 
HeNBS™es
[
iUE
].
ULSÿ‰”AngËsAtFemto
[
i
][
j
] = (
chªÃl
.
šdoÜHÙ¥Ù
.
AÁAngËs
[i]

92 + (0.5 - 
	`¿n1
(&
iS“d
)è* 5è* 
PI
 / 180;

93 
HeNBS™es
[
iUE
].
ULS‹”šgVecãmto
[
i
][
j
] = 1;

97 
	}
}

99 
	gWÜld
::
	$UlFadšg
(
nTTIs
){

101 
ULP”BlockSumFadPow”
[
Nrb
-
NrbPUCCH
],

102 
rg‘IoT
 = 8,

103 
diffTh»sh
 = 2,

104 
IÁ”fP”C–l
,

105 
txPowP”RB
,

106 
S³rBlock
[
Nrb
-
NrbPUCCH
],

107 
m—nVecIoT
[
Nrb
-
NrbPUCCH
];

109 
Com¶ex


110 
ULsummedP©hPha£s
[
numFadšgP©hs
],

111 
ULsummedP©hPha£sMuÉAÁs
[
numFadšgP©hs
][2],

112 
ULçdšg
[(
numC¬r›rIÁ”e¡
-12 * 
NrbPUCCH
)/
decim©eR©e
];

115 
iUE
, 
iS™e
, 
iSeùÜ
, 
iAÁ
,

116 
i
,
j
,

117 
RBsP”BlockDL
,

118 
X2IndToWr™e
,

119 
X2IndToR—d
,

120 
h¬qInd
,

121 
highIÁ”f
,

122 
medIÁ”f
,

123 
Ëngth_ul
,

124 
hi¡ÜicH¬qInd
;

126 
RBsP”BlockDL
 = 
Nrb
/
numBlocksDL
;

127 
h¬qInd
 = 
nTTIs
 % 8;

128 
hi¡ÜicH¬qInd
 = ((
nTTIs
 + 4 ) % 8);

129 
X2IndToWr™e
 = 
nTTIs
 % 8;

130 
X2IndToR—d
 = ((
nTTIs
 + 6 ) % 8);

132 
Ëngth_ul
 = 
numC¬r›rIÁ”e¡
 - 12 * 
NrbPUCCH
;

134 
i
=0; i<
Nrb
-
NrbPUCCH
; i++)

135 
m—nVecIoT
[
i
] = 1.0 / (
Nrb
-
NrbPUCCH
);

137 
iS™e
=0; iS™e<
numMaüoS™es
; iSite++){

138 
iSeùÜ
=0; iSeùÜ<
MACROSECTORS
; iSector++){

139 
IÁ”fP”C–l
 = 
	`dBm2Lš—rW
(
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
dRxšt
è/ 
Nrb
;

140 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
IoTeNB
 = 
IÁ”fP”C–l
 / 12 / 
th”m®P”SymbŞMaüo
;

142 
IÁ”fP”C–l
 = 10 * 
	`log10
(
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
IoTeNB
);

143 
i
=0; i<
Nrb
-
NrbPUCCH
; i++){

144 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
IoTeNB³rRB
[
i
] = 
IÁ”fP”C–l
;

147 ià(
nTTIs
 < 4)

148 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
IoTeNB³rRBf‹»d
[
i
] = 7;

150 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
IoTeNB³rRBf‹»d
[
i
] = 
X2f‹rCÛff
 * Sites[iSite].Sectors[iSector].enB_lte_pars.IoTeNBperRBfiltered[i]

151 + (1 - 
X2f‹rCÛff
è* 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
IoTeNB³rRB
[
i
];

152 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
IoTeNBP”RBHi¡
[
i
][
X2IndToWr™e
] = S™es[iS™e].SeùÜs[iSeùÜ].’B_Ée_·rs.
IoTeNB³rRBf‹»d
[i];

154 ià(
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
IoTeNBP”RBHi¡
[
i
][
X2IndToR—d
] > 
th»shX2HighIÁ”f
){

155 
highIÁ”f
 = 1;

156 
medIÁ”f
 = 0;

158 ià(
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
IoTeNBP”RBHi¡
[
i
][
X2IndToR—d
] > 
th»shX2LowIÁ”f
){

159 
medIÁ”f
 = 1;

160 
highIÁ”f
 = 0;

163 
highIÁ”f
 = 0;

164 
medIÁ”f
 = 0;

166 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
X2šds
[
i
] = -1 + (
medIÁ”f
 + 2 * 
highIÁ”f
);

171 
iS™e
=0; iS™e<
numHeNB
; iSite++){

172 
IÁ”fP”C–l
 = 
	`dBm2Lš—rW
(
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
dRxšt
è/ 
Nrb
;

173 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
IoTeNB
 = 
IÁ”fP”C–l
 / 12 / 
th”m®P”SymbŞFemto
;

175 
IÁ”fP”C–l
 = 10 * 
	`log10
(
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
IoTeNB
);

176 
i
=0; i<
Nrb
-
NrbPUCCH
; i++){

177 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
IoTeNB³rRB
[
i
] = 
IÁ”fP”C–l
;

180 ià(
nTTIs
 < 4)

181 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
IoTeNB³rRBf‹»d
[
i
] = 7;

183 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
IoTeNB³rRBf‹»d
[
i
] = 
X2f‹rCÛff
 * HeNBSites[iSite].enB_lte_pars.IoTeNBperRBfiltered[i]

184 + (1 - 
X2f‹rCÛff
è* 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
IoTeNB³rRB
[
i
];

186 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
IoTeNBP”RBHi¡
[
i
][
X2IndToWr™e
] = HeNBS™es[iS™e].’B_Ée_·rs.
IoTeNB³rRBf‹»d
[i];

187 ià(
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
IoTeNBP”RBHi¡
[
i
][
X2IndToR—d
] > 
th»shX2HighIÁ”f
){

188 
highIÁ”f
 = 1;

189 
medIÁ”f
 = 0;

191 ià(
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
IoTeNBP”RBHi¡
[
i
][
X2IndToR—d
] > 
th»shX2LowIÁ”f
){

192 
medIÁ”f
 = 1;

193 
highIÁ”f
 = 0;

196 
highIÁ”f
 = 0;

197 
medIÁ”f
 = 0;

199 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
X2šds
[
i
] = -1 + (
medIÁ”f
 + 2 * 
highIÁ”f
);

204 
iUE
=0; iUE<
numMaüoUEs
; iUE++){

206 
i
=0; i<
Nrb
-
NrbPUCCH
; i++){

207 
ULP”BlockSumFadPow”
[
i
] = 0;

208 
S³rBlock
[
i
] = 0;

210 
iAÁ
=0; iAÁ<
NªtsBSRx
; iAnt++){

211 
i
=0; i<
numFadšgP©hs
; i++){

212 
ULsummedP©hPha£s
[
i
] = 
	`com¶ex
(0,0);

213 
j
=0; j<
numSub·thFadšgChªÃl
; j++){

214 
ULsummedP©hPha£s
[
i
] = 
	`Com¶exAdd
(ULsummedP©hPha£s[i], 
	`pha£2Com¶ex
(
UEs
[
iUE
].
UL·thPha£s
[i][
j
]));

216 
ULsummedP©hPha£s
[
i
] = 
	`Com¶exR—lDiv
(ULsummedP©hPha£s[i], 
	`sq¹
((
numSub·thFadšgChªÃl
)));

217 
ULsummedP©hPha£s
[
i
] = 
	`Com¶exR—lMul
(ULsummedP©hPha£s[i], 
UEs
[
iUE
].
AÁGaš
[i]);

219 
ULsummedP©hPha£sMuÉAÁs
[
i
][
iAÁ
] = 
	`Com¶exMul
(
ULsummedP©hPha£s
[i], 
UEs
[
iUE
].
ULS‹”šgVec
[i][iAnt]);

222 
i
=0; i<
Ëngth_ul
/
decim©eR©e
; i++){

223 
ULçdšg
[
i
] = 
	`com¶ex
(0,0);

224 
j
=0; j<
numFadšgP©hs
; j++){

225 ià(
UEs
[
iUE
].
ueD•loym’tTy³
 =ğ
maüoUeOutdoÜ
)

226 
ULçdšg
[
i
] = 
	`Com¶exAdd
(ULçdšg[i], 
	`Com¶exMul
(
chªÃl
.
urbªMaüo
.
fáRecÜd
[i*
decim©eR©e
][
j
],

227 
ULsummedP©hPha£sMuÉAÁs
[
j
][
iAÁ
]));

229 
ULçdšg
[
i
] = 
	`Com¶exAdd
(ULçdšg[i], 
	`Com¶exMul
(
chªÃl
.
outdoÜIndoÜ
.
fáRecÜd
[i*
decim©eR©e
][
j
],

230 
ULsummedP©hPha£sMuÉAÁs
[
j
][
iAÁ
]));

232 ià(
nTTIs
 == 0)

233 
j
=0; j<8; j++)

234 
UEs
[
iUE
].
ULFadšgAÎ
[
i
][
iAÁ
][
j
] = 
ULçdšg
[i];

236 
UEs
[
iUE
].
ULFadšgAÎ
[
i
][
iAÁ
][
h¬qInd
] = 
ULçdšg
[i];

239 
i
=0; i<
Nrb
-
NrbPUCCH
; i++){

240 
j
=0; j<
Ëngth_ul
/
decim©eR©e
; j++)

241 
ULP”BlockSumFadPow”
[
i
] = ULP”BlockSumFadPow”[i] + 
chªÃl
.
blockAvFadšgUL
[i][
j
] * 
	`pow”
(
ULçdšg
[j]);

245 ià(
nTTIs
 == 0){

246 
i
=0; i<
Nrb
-
NrbPUCCH
; i++)

247 
j
=0; j<8; j++)

248 
UEs
[
iUE
].
ULP”BlockSumFadPow”RecÜd
[
i
][
j
] = 
ULP”BlockSumFadPow”
[i];

251 
i
=0; i<
Nrb
-
NrbPUCCH
; i++)

252 
UEs
[
iUE
].
ULP”BlockSumFadPow”RecÜd
[
i
][
h¬qInd
] = 
ULP”BlockSumFadPow”
[i];

255 
txPowP”RB
 = 
	`dBm2Lš—rW
(
UEs
[
iUE
].
ueLTEd©a
.
dTxpow”
)/(
Nrb
-
NrbPUCCH
)/12.0;

256 
IÁ”fP”C–l
 = 
	`dBm2Lš—rW
(
S™es
[
UEs
[
iUE
].
ueLTEd©a
.
iS”všgS™e
].
SeùÜs
[UEs[iUE].ueLTEd©a.
iS”všgSeùÜ
].
’B_Ée_·rs
.
dRxšt
è/ 
Nrb
;

257 
i
=0; i<
Nrb
-
NrbPUCCH
; i++){

258 
UEs
[
iUE
].
ulS”všgRxš”RB
[
i
] = 
IÁ”fP”C–l
;

259 
S³rBlock
[
i
] = 
UEs
[
iUE
].
ulTxPow”UE³rRB
[i][
hi¡ÜicH¬qInd
] / 12.0

260 * 
	`dB2R—l
(-
UEs
[
iUE
].
ueLTEd©a
.
ûÎD©a
[UEs[iUE].ueLTEd©a.
iS”všgS™e
][UEs[iUE].ueLTEd©a.
iS”všgSeùÜ
].
dP©hlossNoB—ršg
)

261 * 
UEs
[
iUE
].
ULP”BlockSumFadPow”RecÜd
[
i
][
hi¡ÜicH¬qInd
];

262 ià(
nTTIs
 == 0)

263 
UEs
[
iUE
].
sumNIf‹»dUL
[
i
] = 
th”m®P”SymbŞMaüo
 + UEs[iUE].
ulS”všgRxš”RB
[i] / 12.0;

265 
UEs
[
iUE
].
sumNIf‹»dUL
[
i
] = 0.9 * UEs[iUE].sumNIf‹»dUL[i] + 0.1 * (
th”m®P”SymbŞMaüo
 + UEs[iUE].
ulS”všgRxš”RB
[i] / 12.0);

267 
UEs
[
iUE
].
SNR_UL
[
i
] = 
S³rBlock
[i] / UEs[iUE].
sumNIf‹»dUL
[i];

272 
iUE
=0; iUE<
numHomeUE
; iUE++){

274 
i
=0; i<
Nrb
-
NrbPUCCH
; i++){

275 
ULP”BlockSumFadPow”
[
i
] = 0;

277 
iAÁ
=0; iAÁ<
NªtsBSRx
; iAnt++){

278 
i
=0; i<
numFadšgP©hs
; i++){

279 
ULsummedP©hPha£s
[
i
] = 
	`com¶ex
(0,0);

280 
j
=0; j<
numSub·thFadšgChªÃl
; j++){

282 
HUEs
[
iUE
].
ULS‹”šgVec
[
i
][
iAÁ
] = 
	`pha£2Com¶ex
(2*
PI
*iAÁ * 
AÁS·cšgFemto
 * 
	`sš
(HUEs[iUE].
ULSÿ‰”AngËsAtFemto
[i][
j
]));

284 
ULsummedP©hPha£s
[
i
] = 
	`Com¶exAdd
(ULsummedP©hPha£s[i], 
	`Com¶exMul
(
	`pha£2Com¶ex
(
HUEs
[
iUE
].
UL·thPha£s
[i][
j
]),

285 
HUEs
[
iUE
].
ULS‹”šgVec
[
i
][
iAÁ
]));

288 
ULsummedP©hPha£s
[
i
] = 
	`Com¶exR—lDiv
(ULsummedP©hPha£s[i], 
	`sq¹
((
numSub·thFadšgChªÃl
)));

290 
ULsummedP©hPha£sMuÉAÁs
[
i
][
iAÁ
] = 
ULsummedP©hPha£s
[i];

293 
i
=0; i<
Ëngth_ul
/
decim©eR©e
; i++){

294 
ULçdšg
[
i
] = 
	`com¶ex
(0,0);

295 
j
=0; j<
numFadšgP©hs
; j++){

296 ià(
HUEs
[
iUE
].
ueD•loym’tTy³
 =ğ
ãmtoUeIndoÜ
)

297 
ULçdšg
[
i
] = 
	`Com¶exAdd
(ULçdšg[i], 
	`Com¶exMul
(
chªÃl
.
šdoÜHÙ¥Ù
.
fáRecÜd
[i*
decim©eR©e
][
j
],

298 
ULsummedP©hPha£sMuÉAÁs
[
j
][
iAÁ
]));

300 
ULçdšg
[
i
] = 
	`Com¶exAdd
(ULçdšg[i], 
	`Com¶exMul
(
chªÃl
.
outdoÜIndoÜ
.
fáRecÜd
[i*
decim©eR©e
][
j
],

301 
ULsummedP©hPha£sMuÉAÁs
[
j
][
iAÁ
]));

303 ià(
nTTIs
 == 0)

304 
j
=0; j<8; j++)

305 
HUEs
[
iUE
].
ULFadšgAÎ
[
i
][
iAÁ
][
j
] = 
ULçdšg
[i];

307 
HUEs
[
iUE
].
ULFadšgAÎ
[
i
][
iAÁ
][
h¬qInd
] = 
ULçdšg
[i];

310 
i
=0; i<
Nrb
-
NrbPUCCH
; i++){

311 
j
=0; j<
Ëngth_ul
/
decim©eR©e
; j++)

312 
ULP”BlockSumFadPow”
[
i
] = ULP”BlockSumFadPow”[i] + 
chªÃl
.
blockAvFadšgUL
[i][
j
] * 
	`pow”
(
ULçdšg
[j]);

316 ià(
nTTIs
 == 0){

317 
i
=0; i<
Nrb
-
NrbPUCCH
; i++)

318 
j
=0; j<8; j++)

319 
HUEs
[
iUE
].
ULP”BlockSumFadPow”RecÜd
[
i
][
j
] = 
ULP”BlockSumFadPow”
[i];

322 
i
=0; i<
Nrb
-
NrbPUCCH
; i++)

323 
HUEs
[
iUE
].
ULP”BlockSumFadPow”RecÜd
[
i
][
h¬qInd
] = 
ULP”BlockSumFadPow”
[i];

326 
txPowP”RB
 = 
	`dBm2Lš—rW
(
HUEs
[
iUE
].
ueLTEd©a
.
dTxpow”
)/(
Nrb
-
NrbPUCCH
)/12.0;

327 
IÁ”fP”C–l
 = 
	`dBm2Lš—rW
(
HeNBS™es
[
HUEs
[
iUE
].
ueLTEd©a
.
iS”všgFemto
].
’B_Ée_·rs
.
dRxšt
è/ 
Nrb
;

328 
i
=0; i<
Nrb
-
NrbPUCCH
; i++){

329 
HUEs
[
iUE
].
ulS”všgRxš”RB
[
i
] = 
IÁ”fP”C–l
;

330 
S³rBlock
[
i
] = 
HUEs
[
iUE
].
ulTxPow”UE³rRB
[i][
hi¡ÜicH¬qInd
] / 12.0

331 * 
	`dB2R—l
(-
HUEs
[
iUE
].
ueLTEd©a
.
ãmtoD©a
[HUEs[iUE].ueLTEd©a.
iS”všgFemto
].
dP©hloss
)

332 * 
HUEs
[
iUE
].
ULP”BlockSumFadPow”RecÜd
[
i
][
hi¡ÜicH¬qInd
];

333 ià(
nTTIs
 == 0)

334 
HUEs
[
iUE
].
sumNIf‹»dUL
[
i
] = 
th”m®P”SymbŞFemto
 + HUEs[iUE].
ulS”všgRxš”RB
[i] / 12.0;

336 
HUEs
[
iUE
].
sumNIf‹»dUL
[
i
] = 0.9 * HUEs[iUE].sumNIf‹»dUL[i] + 0.1 * (
th”m®P”SymbŞMaüo
 + HUEs[iUE].
ulS”všgRxš”RB
[i] / 12.0);

338 
HUEs
[
iUE
].
SNR_UL
[
i
] = 
S³rBlock
[i] / HUEs[iUE].
sumNIf‹»dUL
[i];

343 
iUE
=0; iUE<
numMaüoUEs
; iUE++){

344 
i
=0; i<
numFadšgP©hs
; i++){

345 
j
=0; j<
numSub·thFadšgChªÃl
; j++){

346 
UEs
[
iUE
].
UL·thPha£s
[
i
][
j
] = UEs[iUE].UL·thPha£s[i][j] + UEs[iUE].
ULd–Pha£s
[i][j];

350 
iUE
=0; iUE<
numHomeUE
; iUE++){

351 
i
=0; i<
numFadšgP©hs
; i++){

352 
j
=0; j<
numSub·thFadšgChªÃl
; j++){

353 
HUEs
[
iUE
].
UL·thPha£s
[
i
][
j
] = HUEs[iUE].UL·thPha£s[i][j] + HUEs[iUE].
ULd–Pha£s
[i][j];

357 
	}
}

359 
	gWÜld
::
	$DlFadšg
(
nTTIs
){

361 
DLP”BlockSumFadPow”
[
numBlocksDL
];

363 
Com¶ex


364 
DLsummedP©hPha£s
[
numFadšgP©hs
],

365 
DLçdšg
[
numC¬r›rIÁ”e¡
/
decim©eR©e
];

368 
iUE
, 
iS™e
, 
iSeùÜ
,

369 
i
,
j
,

370 
RBsP”BlockDL
,

371 
h¬qInd
,

372 
hi¡ÜicH¬qInd
;

374 
RBsP”BlockDL
 = 
Nrb
/
numBlocksDL
;

375 
h¬qInd
 = 
nTTIs
 % 8;

376 
hi¡ÜicH¬qInd
 = ((
nTTIs
 + 4 ) % 8);

379 
iS™e
=0; iS™e<
numMaüoS™es
; iSite++)

380 
iSeùÜ
=0; iSeùÜ<
MACROSECTORS
; iSector++){

381 
i
=0; i<
numBlocksDL
; i++){

382 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
TxPow”ENB³rBlockRecÜd
[
i
][
h¬qInd
] = 0.0;

384 
j
=0; j<
RBsP”BlockDL
; j++)

385 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
TxPow”ENB³rBlockRecÜd
[
i
][
h¬qInd
] = Sites[iSite].Sectors[iSector].enB_lte_pars.TxPowerENBperBlockRecord[i][harqInd]

386 + 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
TxPow”ENB³rRB
[
j
+
i
*
RBsP”BlockDL
];

388 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
TxPow”ENB³rBlockRecÜd
[
i
][
h¬qInd
] = Sites[iSite].Sectors[iSector].enB_lte_pars.TxPowerENBperBlockRecord[i][harqInd]

389 / 
RBsP”BlockDL
;

393 
iS™e
=0; iS™e<
numHeNB
; iSite++){

394 
i
=0; i<
numBlocksDL
; i++){

395 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
TxPow”ENB³rBlockRecÜd
[
i
][
h¬qInd
] = 0.0;

397 
j
=0; j<
RBsP”BlockDL
; j++)

398 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
TxPow”ENB³rBlockRecÜd
[
i
][
h¬qInd
] = HeNBSites[iSite].enB_lte_pars.TxPowerENBperBlockRecord[i][harqInd]

399 + 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
TxPow”ENB³rRB
[
j
+
i
*
RBsP”BlockDL
];

401 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
TxPow”ENB³rBlockRecÜd
[
i
][
h¬qInd
] = HeNBSites[iSite].enB_lte_pars.TxPowerENBperBlockRecord[i][harqInd]

402 / 
RBsP”BlockDL
;

407 
iUE
=0; iUE<
numMaüoUEs
; iUE++){

408 
i
=0; i<
numFadšgP©hs
; i++){

409 
DLsummedP©hPha£s
[
i
] = 
	`com¶ex
(0,0);

410 
j
=0; j<
numSub·thFadšgChªÃl
; j++){

411 
DLsummedP©hPha£s
[
i
] = 
	`Com¶exAdd
(DLsummedP©hPha£s[i], 
	`Com¶exR—lMul
(
	`pha£2Com¶ex
(
UEs
[
iUE
].
DL·thPha£s
[i][
j
]),

412 
UEs
[
iUE
].
DLS‹”šgVec
[
i
]));

414 
DLsummedP©hPha£s
[
i
] = 
	`Com¶exR—lDiv
(DLsummedP©hPha£s[i], 
	`sq¹
((
numSub·thFadšgChªÃl
)));

416 
DLsummedP©hPha£s
[
i
] = 
	`Com¶exR—lMul
(DLsummedP©hPha£s[i], 
UEs
[
iUE
].
AÁGaš
[i]);

419 
i
=0; i<
numC¬r›rIÁ”e¡
/
decim©eR©e
; i++){

420 
DLçdšg
[
i
] = 
	`com¶ex
(0,0);

421 
j
=0; j<
numFadšgP©hs
; j++){

422 ià(
UEs
[
iUE
].
ueD•loym’tTy³
 =ğ
maüoUeOutdoÜ
)

423 
DLçdšg
[
i
] = 
	`Com¶exAdd
(DLçdšg[i], 
	`Com¶exMul
(
chªÃl
.
urbªMaüo
.
fáRecÜd
[i*
decim©eR©e
][
j
],

424 
DLsummedP©hPha£s
[
j
]));

426 
DLçdšg
[
i
] = 
	`Com¶exAdd
(DLçdšg[i], 
	`Com¶exMul
(
chªÃl
.
outdoÜIndoÜ
.
fáRecÜd
[i*
decim©eR©e
][
j
],

427 
DLsummedP©hPha£s
[
j
]));

429 ià(
nTTIs
 == 0)

430 
j
=0; j<8; j++)

431 
UEs
[
iUE
].
DLFadšgAÎ
[
i
][
j
] = 
DLçdšg
[i];

433 
UEs
[
iUE
].
DLFadšgAÎ
[
i
][
h¬qInd
] = 
DLçdšg
[i];

436 
i
=0; i<
numBlocksDL
; i++){

437 
DLP”BlockSumFadPow”
[
i
] = 0;

438 
j
=0; j<
numC¬r›rIÁ”e¡
/
decim©eR©e
; j++)

439 
DLP”BlockSumFadPow”
[
i
] = DLP”BlockSumFadPow”[i] + 
chªÃl
.
blockAvFadšgDL
[i][
j
] * 
	`pow”
(
DLçdšg
[j]);

442 ià(
nTTIs
 == 0){

443 
i
=0; i<
numBlocksDL
; i++)

444 
j
=0; j<8; j++)

445 
UEs
[
iUE
].
DLP”BlockSumFadPow”RecÜd
[
i
][
j
] = 
DLP”BlockSumFadPow”
[i];

448 
i
=0; i<
numBlocksDL
; i++)

449 
UEs
[
iUE
].
DLP”BlockSumFadPow”RecÜd
[
i
][
h¬qInd
] = 
DLP”BlockSumFadPow”
[i];

452 
i
=0; i<
numBlocksDL
; i++){

453 
UEs
[
iUE
].
sumIÁ”ã»nû³rBlock
[
i
] = 0.0;

455 
iS™e
=0; iS™e<
numMaüoS™es
; iSite++)

456 
iSeùÜ
=0; iSeùÜ<
MACROSECTORS
; iSector++){

458 if(
iS™e
 !ğ
UEs
[
iUE
].
ueLTEd©a
.
iS”všgS™e
 || 
iSeùÜ
 !ğUEs[iUE].ueLTEd©a.
iS”všgSeùÜ
)

459 
UEs
[
iUE
].
sumIÁ”ã»nû³rBlock
[
i
] = UEs[iUE].sumInterferenceperBlock[i] +

460 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
TxPow”ENB³rBlockRecÜd
[
i
][
hi¡ÜicH¬qInd
]

461 * 
	`dB2R—l
(-
UEs
[
iUE
].
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dP©hlossW¿µed
);

465 
iS™e
=0; iS™e<
numHeNB
; iSite++)

466 
UEs
[
iUE
].
sumIÁ”ã»nû³rBlock
[
i
] = UEs[iUE].sumInterferenceperBlock[i] +

467 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
TxPow”ENB³rBlockRecÜd
[
i
][
hi¡ÜicH¬qInd
]

468 * 
	`dB2R—l
(-
UEs
[
iUE
].
ueLTEd©a
.
ãmtoD©a
[
iS™e
].
dP©hlossW¿µed
);

470 ià(
nTTIs
 == 0)

471 
UEs
[
iUE
].
sumNIf‹»d
[
i
] = 
th”m®P”SymbŞUE
 + UEs[iUE].
sumIÁ”ã»nû³rBlock
[i] / 12.0;

473 
UEs
[
iUE
].
sumNIf‹»d
[
i
] = UEs[iUE].sumNIf‹»d[i] * 0.9 + (
th”m®P”SymbŞUE
 + UEs[iUE].
sumIÁ”ã»nû³rBlock
[i] / 12.0) * 0.1;

478 
UEs
[
iUE
].
	`ÿlcDLCQI
(
nTTIs
);

482 
iUE
=0; iUE<
numHomeUE
; iUE++){

483 
i
=0; i<
numFadšgP©hs
; i++){

484 
DLsummedP©hPha£s
[
i
] = 
	`com¶ex
(0,0);

485 
j
=0; j<
numSub·thFadšgChªÃl
; j++){

486 
DLsummedP©hPha£s
[
i
] = 
	`Com¶exAdd
(DLsummedP©hPha£s[i], 
	`Com¶exR—lMul
(
	`pha£2Com¶ex
(
HUEs
[
iUE
].
DL·thPha£s
[i][
j
]),

487 
HUEs
[
iUE
].
DLS‹”šgVec
[
i
]));

489 
DLsummedP©hPha£s
[
i
] = 
	`Com¶exR—lDiv
(DLsummedP©hPha£s[i], 
	`sq¹
(10.0));

493 
i
=0; i<
numC¬r›rIÁ”e¡
/
decim©eR©e
; i++){

494 
DLçdšg
[
i
] = 
	`com¶ex
(0,0);

495 
j
=0; j<
numFadšgP©hs
; j++){

496 ià(
HUEs
[
iUE
].
ueD•loym’tTy³
 =ğ
ãmtoUeIndoÜ
)

497 
DLçdšg
[
i
] = 
	`Com¶exAdd
(DLçdšg[i], 
	`Com¶exMul
(
chªÃl
.
šdoÜHÙ¥Ù
.
fáRecÜd
[i*
decim©eR©e
][
j
],

498 
DLsummedP©hPha£s
[
j
]));

500 
DLçdšg
[
i
] = 
	`Com¶exAdd
(DLçdšg[i], 
	`Com¶exMul
(
chªÃl
.
outdoÜIndoÜ
.
fáRecÜd
[i*
decim©eR©e
][
j
],

501 
DLsummedP©hPha£s
[
j
]));

503 ià(
nTTIs
 == 0)

504 
j
=0; j<8; j++)

505 
HUEs
[
iUE
].
DLFadšgAÎ
[
i
][
j
] = 
DLçdšg
[i];

507 
HUEs
[
iUE
].
DLFadšgAÎ
[
i
][
h¬qInd
] = 
DLçdšg
[i];

510 
i
=0; i<
numBlocksDL
; i++){

511 
DLP”BlockSumFadPow”
[
i
] = 0;

512 
j
=0; j<
numC¬r›rIÁ”e¡
/
decim©eR©e
; j++)

513 
DLP”BlockSumFadPow”
[
i
] = DLP”BlockSumFadPow”[i] + 
chªÃl
.
blockAvFadšgDL
[i][
j
] * 
	`pow”
(
DLçdšg
[j]);

516 ià(
nTTIs
 == 0){

517 
i
=0; i<
numBlocksDL
; i++)

518 
j
=0; j<8; j++)

519 
HUEs
[
iUE
].
DLP”BlockSumFadPow”RecÜd
[
i
][
j
] = 
DLP”BlockSumFadPow”
[i];

522 
i
=0; i<
numBlocksDL
; i++)

523 
HUEs
[
iUE
].
DLP”BlockSumFadPow”RecÜd
[
i
][
h¬qInd
] = 
DLP”BlockSumFadPow”
[i];

526 
i
=0; i<
numBlocksDL
; i++){

527 
HUEs
[
iUE
].
sumIÁ”ã»nû³rBlock
[
i
] = 0.0;

529 
iS™e
=0; iS™e<
numMaüoS™es
; iSite++)

530 
iSeùÜ
=0; iSeùÜ<
MACROSECTORS
; iSector++){

532 
HUEs
[
iUE
].
sumIÁ”ã»nû³rBlock
[
i
] = HUEs[iUE].sumInterferenceperBlock[i] +

533 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
TxPow”ENB³rBlockRecÜd
[
i
][
hi¡ÜicH¬qInd
]

534 * 
	`dB2R—l
(-
HUEs
[
iUE
].
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dP©hlossW¿µed
);

538 
iS™e
=0; iS™e<
numHeNB
; iSite++)

539 if(
iS™e
 !ğ
HUEs
[
iUE
].
ueLTEd©a
.
iS”všgFemto
)

540 
HUEs
[
iUE
].
sumIÁ”ã»nû³rBlock
[
i
] = HUEs[iUE].sumInterferenceperBlock[i] +

541 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
TxPow”ENB³rBlockRecÜd
[
i
][
hi¡ÜicH¬qInd
]

542 * 
	`dB2R—l
(-
HUEs
[
iUE
].
ueLTEd©a
.
ãmtoD©a
[
iS™e
].
dP©hlossW¿µed
);

544 ià(
nTTIs
 == 0)

545 
HUEs
[
iUE
].
sumNIf‹»d
[
i
] = 
th”m®P”SymbŞUE
 + HUEs[iUE].
sumIÁ”ã»nû³rBlock
[i] / 12.0;

547 
HUEs
[
iUE
].
sumNIf‹»d
[
i
] = HUEs[iUE].sumNIf‹»d[i] * 0.9 + (
th”m®P”SymbŞUE
 + HUEs[iUE].
sumIÁ”ã»nû³rBlock
[i] / 12.0) * 0.1;

550 
HUEs
[
iUE
].
	`ÿlcDLCQI
(
nTTIs
);

554 
iUE
=0; iUE<
numMaüoUEs
; iUE++){

555 
i
=0; i<
numFadšgP©hs
; i++){

556 
j
=0; j<
numSub·thFadšgChªÃl
; j++){

557 
UEs
[
iUE
].
DL·thPha£s
[
i
][
j
] = UEs[iUE].DL·thPha£s[i][j] + UEs[iUE].
DLd–Pha£s
[i][j];

561 
iUE
=0; iUE<
numHomeUE
; iUE++){

562 
i
=0; i<
numFadšgP©hs
; i++){

563 
j
=0; j<
numSub·thFadšgChªÃl
; j++){

564 
HUEs
[
iUE
].
DL·thPha£s
[
i
][
j
] = HUEs[iUE].DL·thPha£s[i][j] + HUEs[iUE].
DLd–Pha£s
[i][j];

568 
	}
}

	@/home/lyang3/work/src_son/runWorld/floorPlan.cpp

1 
	~"æoÜPÏn.h
"

2 
	~"runWÜld.h
"

3 
	~"¡dlib.h
"

4 
	~"¡ršg.h
"

6 
usšg
 
Çme¥aû
 
	g¡d
;

9 
	gFloÜ¶ªs
::
	$FloÜ¶ªs
()

11 
tÙ®FloÜs
 = 0;

12 
numW®ls
 = 0;

13 
numT¿v–P©hSeg
 = 0;

14 
w®l_couÁ
 = 0;

15 
æoÜW®l_couÁ
 = 0;

16 
hŞe_couÁ
 = 0;

17 
numFloÜs
 = 0;

18 
w®lHeight
 = 10.5;

19 
quadH©aBÜd”X
[0] = 2000;

20 
quadH©aBÜd”Y
[0] = 2000;

21 
quadH©aBÜd”X
[1] = 0;

22 
quadH©aBÜd”Y
[1] = 0;

23 
quadH©aBÜd”X
[2] = -2000;

24 
quadH©aBÜd”Y
[2] = -2000;

25 
quadH©aBÜd”X
[3] = 0;

26 
quadH©aBÜd”Y
[3] = 0;

27 
Œav–P©hHeight
 = 1.0;

29 
	}
};

31 
	gFloÜ¶ªs
::~
	$FloÜ¶ªs
()

33 
	`ä“
(
w®ls
);

34 
	`ä“
(
Œav–P©h
);

35 
	`ä“
(
w®l_¶aûs
);

36 
	`ä“
(
æoÜW®l_¶aûs
);

37 
	`ä“
(
hŞe_¶aûs
);

38 
	}
};

40 
	gFloÜ¶ªs
::
	$R—dšFe
(
FILE
* 
feIÅut
)

43 
lše
[100];

44 
‹¡
;

45 *
šdexT
;

47 
lše1
 = 0,

48 
pŞylše
 = 0,

49 
pošt
 = 0,

50 
blocky
 = 0,

51 
’d£c
 = 0,

52 
LWPOLYLINE
[1000],

53 
ãmtoPOINT
[100],

54 
ByBlock
[1000],

55 
ENDSEC_‹mp
[100],

56 
ENDSEC
;

59 
i
, 
j
, 
hh
,

60 
maximum
,

61 
sizes
,

62 
found
 = 0,

63 
byblockpŞylše
[1000],

64 
afãùed_¶
 = 0,

65 
numpŞy
 = 0,

66 
pŞyw®ls
 = 0,

67 
tÙ®W®ls
 = 0;

69 
PŞyD©a


70 *
pŞyd©a
;

72 
of¡»am


73 
æoÜ¶ª
;

76 *
w®lPÏû
,

77 *
æoÜW®lPÏû
,

78 *
hŞ•Ïû
;

80 
	`fg‘s
(
lše
, 100, 
feIÅut
è!ğ
NULL
){

82 
‹¡
 = 
	`¡ºcmp
("LWPOLYLINE", 
lše
, 10);

83 ià(
‹¡
 == 0){

84 
LWPOLYLINE
[
pŞylše
] = 
lše1
;

85 
pŞylše
 =…olyline + 1;

88 
‹¡
 = 
	`¡ºcmp
("POINT", 
lše
, 5);

89 ià(
‹¡
 == 0){

90 
ãmtoPOINT
[
pošt
] = 
lše1
;

91 
pošt
 =…oint + 1;

98 
‹¡
 = 
	`¡ºcmp
("ByBlock", 
lše
, 7);

99 ià(
‹¡
 == 0){

100 
ByBlock
[
blocky
] = 
lše1
;

101 
blocky
 = blocky + 1;

106 
‹¡
 = 
	`¡ºcmp
("ENDSEC", 
lše
, 6);

107 ià(
‹¡
 == 0){

108 
ENDSEC_‹mp
[
’d£c
] = 
lše1
;

109 
’d£c
 =ƒndsec + 1;

115 
lše1
++;

118 ià(
pošt
 == 0)

119 
maximum
 = 
LWPOLYLINE
[
pŞylše
 - 1];

121 
maximum
 = 
	`max
(
LWPOLYLINE
[
pŞylše
 - 1], 
ãmtoPOINT
[
pošt
 - 1]);

123 
i
 = 0; i < 
’d£c
; i++){

124 ià(
maximum
 < 
ENDSEC_‹mp
[
i
] && 
found
 == 0){

125 
ENDSEC
 = 
ENDSEC_‹mp
[
i
];

126 
found
 = 1;

131 ià(
blocky
 > 0){

132 
i
 = 0; i < 
blocky
; i++){

133 
j
 = 0; j < 
pŞylše
; j++){

134 ià(
ByBlock
[
i
] =ğ
LWPOLYLINE
[
j
] + 10){

135 
byblockpŞylše
[
afãùed_¶
] = 
LWPOLYLINE
[
j
];

136 
afãùed_¶
++;

142 
pŞyd©a
 = (
PŞyD©a
 *)
	`m®loc
((
pŞylše
)* (PolyData));

143 ià(
pošt
 == 0){

144 
LWPOLYLINE
[
pŞylše
] = 
ENDSEC
;

145 
pŞylše
 =…olyline + 1;

148 
i
 = 1; i < 
pŞylše
; i++){

149 
sizes
 = 
LWPOLYLINE
[
i
] - LWPOLYLINE[i - 1];

150 ià(
sizes
< 20){

151 
cout
 << "Fill in heigth value for femtocell in LiteCAD or„emove…oint";

152 
cout
 << "andƒnter…oint details in Matlab";

155 ià((
sizes
 > 20) && (sizes < 28)){

156 
cout
 << "Pleaseƒnsurehat wallype is filled in for your…olylines in LiteCAD";

157 
	`ex™
(0);

160 ià(
sizes
 != 20){

161 
pŞyd©a
[
numpŞy
].
numLšes
 = 
sizes
;

162 
pŞyd©a
[
numpŞy
].
lšeS¹
 = 
LWPOLYLINE
[
i
 - 1];

163 
pŞyd©a
[
numpŞy
].
šdByBlock
 = 0;

164 
j
 = 0; j < 
afãùed_¶
; j++){

165 ià(
pŞyd©a
[
numpŞy
].
lšeS¹
 =ğ
byblockpŞylše
[
j
])

166 
pŞyd©a
[
numpŞy
].
šdByBlock
 = 1;

168 
numpŞy
 =‚umpoly + 1;

173 
i
 = 0; i < 
numpŞy
; i++){

174 ià(
pŞyd©a
[
i
].
šdByBlock
 != 1){

175 
pŞyw®ls
 = 1;

176 
j
 = 
pŞyd©a
[
i
].
numLšes
 - 30;

178 ià((
j
 < 0) || ((j % 4) != 0)){

179 
j
 = 
pŞyd©a
[
i
].
numLšes
 - 28;

180 ià((
j
 < 0) || ((j % 4) != 0)){

181 
cout
 << "Using only„ectangle‡nd…olynomial?";

182 
	`ex™
(0);

185 
pŞyd©a
[
i
].
šdW®lHeight
 = 0;

188 
pŞyd©a
[
i
].
šdW®lHeight
 = 1;

190 
pŞyw®ls
 =…Şyw®l + 
j
 / 4;

191 
pŞyd©a
[
i
].
numPŞylšes
 = 
pŞyw®ls
;

194 
pŞyw®ls
 = 1;

195 
j
 = 
pŞyd©a
[
i
].
numLšes
 - 32;

196 ià((
j
 < 0) || ((j % 4) != 0)){

197 
j
 = 
pŞyd©a
[
i
].
numLšes
 - 30;

198 ià((
j
 < 0) || ((j % 4) != 0)){

199 
cout
 << "Using only„ectangle‡nd…olynomial?";

200 
	`ex™
(0);

203 
pŞyd©a
[
i
].
šdW®lHeight
 = 0;

206 
pŞyd©a
[
i
].
šdW®lHeight
 = 1;

208 
pŞyw®ls
 =…Şyw®l + 
j
 / 4;

209 
pŞyd©a
[
i
].
numPŞylšes
 = 
pŞyw®ls
;

211 
tÙ®W®ls
 =Ù®W®l + 
pŞyw®ls
;

214 
‹¡
 = 
	`f£ek
(
feIÅut
, 0, 
SEEK_SET
);

215 
W®l
* 
w®lsTemp
 = (W®È*)
	`m®loc
((
tÙ®W®ls
)* (Wall));

216 
lše1
 = 0;

217 
i
 = 0;

218 
j
 = 0;

219 
i
 < 
numpŞy
){

220 
	`fg‘s
(
lše
, 100, 
feIÅut
è!ğ
NULL
){

221 
	`cÚv”tFromSŒšg
(
‹¡
, 
lše
);

222 ià(
lše1
 =ğ
pŞyd©a
[
i
].
lšeS¹
 + 8){

223 
tÙ®FloÜs
 = 
	`max
ÑÙ®FloÜs, ()
‹¡
);

224 
hh
 = 0; hh < 
pŞyd©a
[
i
].
numPŞylšes
; hh++)

225 
w®lsTemp
[
j
 + 
hh
].
æoÜNumb”
 = 
‹¡
;

227 ià(
lše1
 =ğ
pŞyd©a
[
i
].
lšeS¹
 + 10 +…Şyd©a[i].
šdByBlock
 * 2){

228 ià(
‹¡
 == 12){

229 
pŞyd©a
[
i
].
æoÜTy³
 = 1;

230 
w®lsTemp
[
j
].
NÙe
 = 1;

231 
w®lsTemp
[
j
].
w®lTy³
 = 
‹¡
 - 9;

232 
numFloÜs
++;

234 ià(
‹¡
 == 13){

235 
pŞyd©a
[
i
].
æoÜTy³
 = 2;

236 
w®lsTemp
[
j
].
NÙe
 = 2;

237 
w®lsTemp
[
j
].
w®lTy³
 = 
‹¡
 - 9;

239 ià(
‹¡
 == 50){

240 
pŞyd©a
[
i
].
æoÜTy³
 = 3;

241 
w®lsTemp
[
j
].
NÙe
 = 3;

242 
w®lsTemp
[
j
].
w®lTy³
 = 0;

245 
pŞyd©a
[
i
].
æoÜTy³
 = 0;

246 
w®lsTemp
[
j
].
NÙe
 = 0;

247 
w®lsTemp
[
j
].
w®lTy³
 = 
‹¡
 - 9;

249 
hh
 = 1; hh < 
pŞyd©a
[
i
].
numPŞylšes
; hh++){

250 
w®lsTemp
[
j
 + 
hh
].
NÙe
 = wallsTemp[j].Note;

251 
w®lsTemp
[
j
 + 
hh
].
w®lTy³
 = wallsTemp[j].wallType;

253 ià(
pŞyd©a
[
i
].
æoÜTy³
 == 3)

254 
numT¿v–P©hSeg
 =‚umT¿v–P©hSeg + 
pŞyd©a
[
i
].
numPŞylšes
;

256 
numW®ls
 =‚umW®l + 
pŞyd©a
[
i
].
numPŞylšes
;

257 ià(
pŞyd©a
[
i
].
æoÜTy³
 == 0)

258 
w®l_couÁ
 = w®l_couÁ + 
pŞyd©a
[
i
].
numPŞylšes
;

259 ià(
pŞyd©a
[
i
].
æoÜTy³
 == 1)

261 
æoÜW®l_couÁ
 = floÜW®l_couÁ + 
pŞyd©a
[
i
].
numPŞylšes
;

262 
æoÜs
[
numFloÜs
 - 1].
numW®ls
 = 
pŞyd©a
[
i
].
numPŞylšes
;

263 
æoÜs
[
numFloÜs
 - 1].
šdexW®ls
 = (*)
	`m®loc
((
pŞyd©a
[
i
].
numPŞylšes
) * ());

264 
hh
 = 0; hh < 
pŞyd©a
[
i
].
numPŞylšes
; hh++)

265 
æoÜs
[
numFloÜs
 - 1].
šdexW®ls
[
hh
] = 
j
 + hh;

268 
hŞe_couÁ
 = hŞe_couÁ + 
pŞyd©a
[
i
].
numPŞylšes
;

271 ià(
lše1
 =ğ
pŞyd©a
[
i
].
lšeS¹
 + 12 +…Şyd©a[i].
šdByBlock
 * 2){

272 ià(
pŞyd©a
[
i
].
šdW®lHeight
 =ğ0 ||…Şyd©a[i].
æoÜTy³
 == 2 ||…olydata[i].floorType == 1)

273 
w®lsTemp
[
j
].
w®lHeight
 = 0;

275 ià(
pŞyd©a
[
i
].
æoÜTy³
 == 3)

276 
w®lsTemp
[
j
].
w®lHeight
 = 
‹¡
 - 1;

278 
w®lsTemp
[
j
].
w®lHeight
 = (
‹¡
 - 1.0) / 100;

280 
hh
 = 1; hh < 
pŞyd©a
[
i
].
numPŞylšes
; hh++){

281 
w®lsTemp
[
j
 + 
hh
].
w®lHeight
 = wallsTemp[j].wallHeight;

284 ià(
lše1
 >ğ
pŞyd©a
[
i
].
lšeS¹
 + 20 +…Şyd©a[i].
šdByBlock
 * 2 +…Şyd©a[i].
šdW®lHeight
 * 2 &&

285 
lše1
 <ğ
pŞyd©a
[
i
].
lšeS¹
 + 26 +…Şyd©a[i].
šdByBlock
 * 2 +…Şyd©a[i].
šdW®lHeight
 * 2 + (pŞyd©a[i].
numPŞylšes
 - 1) * 4){

288 
hh
 = 0; hh < 
pŞyd©a
[
i
].
numPŞylšes
; hh++){

290 ià(
lše1
 =ğ
pŞyd©a
[
i
].
lšeS¹
 + 20 +…Şyd©a[i].
šdByBlock
 * 2 +…Şyd©a[i].
šdW®lHeight
 * 2 + 
hh
 * 4)

291 
w®lsTemp
[
j
 + 
hh
].
x1
 = 
‹¡
;

292 ià(
lše1
 =ğ
pŞyd©a
[
i
].
lšeS¹
 + 22 +…Şyd©a[i].
šdByBlock
 * 2 +…Şyd©a[i].
šdW®lHeight
 * 2 + 
hh
 * 4)

293 
w®lsTemp
[
j
 + 
hh
].
y1
 = 
‹¡
;

294 ià(
lše1
 =ğ
pŞyd©a
[
i
].
lšeS¹
 + 24 +…Şyd©a[i].
šdByBlock
 * 2 +…Şyd©a[i].
šdW®lHeight
 * 2 + 
hh
 * 4)

295 
w®lsTemp
[
j
 + 
hh
].
x2
 = 
‹¡
;

296 ià(
lše1
 =ğ
pŞyd©a
[
i
].
lšeS¹
 + 26 +…Şyd©a[i].
šdByBlock
 * 2 +…Şyd©a[i].
šdW®lHeight
 * 2 + 
hh
 * 4)

297 
w®lsTemp
[
j
 + 
hh
].
y2
 = 
‹¡
;

300 ià(
lše1
 =ğ
pŞyd©a
[
i
].
lšeS¹
 + 26 +…Şyd©a[i].
šdByBlock
 * 2 +…Şyd©a[i].
šdW®lHeight
 * 2 + (pŞyd©a[i].
numPŞylšes
 - 1) * 4){

301 
j
 = j + 
pŞyd©a
[
i
].
numPŞylšes
;

302 
i
++;

305 
lše1
++;

309 
šdexT
 = (*)
	`m®loc
((
tÙ®W®ls
)* ());

310 
i
 = 1; i <ğ
tÙ®FloÜs
; i++)

311 
accumuÏ‹dHeight
[
i
 - 1] = 
w®lHeight
 * i;

313 
Œav–P©h
 = (
T¿v–P©h
 *)
	`m®loc
((
numT¿v–P©hSeg
)* (TravelPath));

314 
w®l_¶aûs
 = (*)
	`m®loc
((
w®l_couÁ
)* ());

315 
æoÜW®l_¶aûs
 = (*)
	`m®loc
((
æoÜW®l_couÁ
)* ());

316 
hŞe_¶aûs
 = (*)
	`m®loc
((
hŞe_couÁ
)* ());

317 
w®ls
 = (
W®l
 *)
	`m®loc
((
numW®ls
)* (Wall));

318 
w®lPÏû
 = 
w®l_¶aûs
;

319 
æoÜW®lPÏû
 = 
æoÜW®l_¶aûs
;

320 
hŞ•Ïû
 = 
hŞe_¶aûs
;

321 
j
 = 0;

322 
lše1
 = 0;

323 
hh
 = 0;

325 
æoÜs
[0].
numW®ls
 = 0;

326 
i
 = 0; i < 
tÙ®W®ls
; i++){

327 ià(
w®lsTemp
[
i
].
NÙe
 == 3){

328 
Œav–P©h
[
lše1
].
x1
 = 
w®lsTemp
[
i
].x1;

329 
Œav–P©h
[
lše1
].
y1
 = 
w®lsTemp
[
i
].y1;

330 
Œav–P©h
[
lše1
].
z1
 = 
Œav–P©hHeight
;

331 
Œav–P©h
[
lše1
].
x2
 = 
w®lsTemp
[
i
].x2;

332 
Œav–P©h
[
lše1
].
y2
 = 
w®lsTemp
[
i
].y2;

333 
Œav–P©h
[
lše1
].
z2
 = 
Œav–P©hHeight
;

335 
Œav–P©h
[
lše1
].
height
 = 
Œav–P©hHeight
;

336 
Œav–P©h
[
lše1
].
æoÜ
 = 
w®lsTemp
[
i
].
æoÜNumb”
;

337 
Œav–P©h
[
lše1
].
šdSegm’t
 = 
w®lsTemp
[
i
].
w®lHeight
;

339 
lše1
++;

342 
w®lsTemp
[
j
] = w®lsTemp[
i
];

345 
w®lsTemp
[
j
].
x1
 = wallsTemp[j].x1 / 1000.0;

346 
w®lsTemp
[
j
].
x2
 = wallsTemp[j].x2 / 1000.0;

347 
w®lsTemp
[
j
].
x3
 = wallsTemp[j].x3 / 1000.0;

348 
w®lsTemp
[
j
].
x4
 = wallsTemp[j].x4 / 1000.0;

349 
w®lsTemp
[
j
].
y1
 = wallsTemp[j].y1 / 1000.0;

350 
w®lsTemp
[
j
].
y2
 = wallsTemp[j].y2 / 1000.0;

351 
w®lsTemp
[
j
].
y3
 = wallsTemp[j].y3 / 1000.0;

352 
w®lsTemp
[
j
].
y4
 = wallsTemp[j].y4 / 1000.0;

354 ià(
w®lsTemp
[
i
].
NÙe
 == 0){

355 *
w®lPÏû
 = 
j
;

356 
w®lPÏû
++;

357 
w®lsTemp
[
j
].
z1
 = 
accumuÏ‹dHeight
[w®lsTemp[j].
æoÜNumb”
 - 1] - 
w®lHeight
;

358 
w®lsTemp
[
j
].
z2
 = w®lsTemp[j].
z1
;

359 
w®lsTemp
[
j
].
x3
 = w®lsTemp[j].
x1
;

360 
w®lsTemp
[
j
].
y3
 = w®lsTemp[j].
y1
;

361 
w®lsTemp
[
j
].
z3
 = 
accumuÏ‹dHeight
[w®lsTemp[j].
æoÜNumb”
 - 1];

362 
w®lsTemp
[
j
].
x4
 = w®lsTemp[j].
x2
;

363 
w®lsTemp
[
j
].
y4
 = w®lsTemp[j].
y2
;

364 
w®lsTemp
[
j
].
z4
 = w®lsTemp[j].
z3
;

366 ià(
w®lsTemp
[
i
].
NÙe
 == 1){

367 *
æoÜW®lPÏû
 = 
j
;

368 
æoÜW®lPÏû
++;

369 
w®lsTemp
[
j
].
z1
 = 
accumuÏ‹dHeight
[w®lsTemp[j].
æoÜNumb”
 - 1] - 
w®lHeight
;

370 
w®lsTemp
[
j
].
z2
 = w®lsTemp[j].
z1
;

371 
w®lsTemp
[
j
].
x3
 = 0;

372 
w®lsTemp
[
j
].
y3
 = 0;

373 
w®lsTemp
[
j
].
z3
 = w®lsTemp[j].
z1
;

374 
w®lsTemp
[
j
].
x4
 = 0;

375 
w®lsTemp
[
j
].
y4
 = 0;

376 
w®lsTemp
[
j
].
z4
 = w®lsTemp[j].
z1
;

378 
quadH©aBÜd”X
[0] = 
	`mš
(quadH©aBÜd”X[0], 
w®lsTemp
[
j
].
x1
);

379 
quadH©aBÜd”X
[0] = 
	`mš
(quadH©aBÜd”X[0], 
w®lsTemp
[
j
].
x2
);

380 
quadH©aBÜd”Y
[0] = 
	`mš
(quadH©aBÜd”Y[0], 
w®lsTemp
[
j
].
y1
);

381 
quadH©aBÜd”Y
[0] = 
	`mš
(quadH©aBÜd”Y[0], 
w®lsTemp
[
j
].
y2
);

382 
quadH©aBÜd”X
[2] = 
	`max
(quadH©aBÜd”X[2], 
w®lsTemp
[
j
].
x1
);

383 
quadH©aBÜd”X
[2] = 
	`max
(quadH©aBÜd”X[2], 
w®lsTemp
[
j
].
x2
);

384 
quadH©aBÜd”Y
[2] = 
	`max
(quadH©aBÜd”Y[2], 
w®lsTemp
[
j
].
y1
);

385 
quadH©aBÜd”Y
[2] = 
	`max
(quadH©aBÜd”Y[2], 
w®lsTemp
[
j
].
y2
);

388 *
hŞ•Ïû
 = 
j
;

389 
hŞ•Ïû
++;

390 
w®lsTemp
[
j
].
z1
 = 
accumuÏ‹dHeight
[w®lsTemp[j].
æoÜNumb”
 - 1] - 
w®lHeight
;

391 
w®lsTemp
[
j
].
z2
 = w®lsTemp[j].
z1
;

392 
w®lsTemp
[
j
].
x3
 = 0;

393 
w®lsTemp
[
j
].
y3
 = 0;

394 
w®lsTemp
[
j
].
z3
 = 
accumuÏ‹dHeight
[w®lsTemp[j].
æoÜNumb”
 - 1];

395 
w®lsTemp
[
j
].
x4
 = 0;

396 
w®lsTemp
[
j
].
y4
 = 0;

397 
w®lsTemp
[
j
].
z4
 = w®lsTemp[j].
z3
;

399 ià(
w®lsTemp
[
j
].
æoÜNumb”
 == 1){

400 
æoÜs
[0].
numW®ls
++;

401 
w®ls
[
hh
] = 
w®lsTemp
[
j
];

402 
šdexT
[
i
] = 
hh
;

403 
hh
++;

405 
j
++;

408 
quadH©aBÜd”X
[1] = quadHataBorderX[0];

409 
quadH©aBÜd”Y
[1] = quadHataBorderY[2];

410 
quadH©aBÜd”X
[3] = quadHataBorderX[2];

411 
quadH©aBÜd”Y
[3] = quadHataBorderY[0];

413 
j
 = 2; j <ğ
tÙ®FloÜs
; j++)

414 
i
 = 0; i < 
numW®ls
; i++){

415 ià(
w®lsTemp
[
i
].
æoÜNumb”
 =ğ
j
){

416 
æoÜs
[
j
 - 1].
numW®ls
++;

417 
w®ls
[
hh
] = 
w®lsTemp
[
i
];

418 
šdexT
[
i
] = 
hh
;

419 
hh
++;

423 
hh
 = 0;

424 
i
 = 0; i < 
numFloÜs
; i++){

425 
æoÜs
[
i
].
šdexW®ls
 = (*)
	`m®loc
((æoÜs[i].
numW®ls
) * ());

426 
j
 = 0; j < 
æoÜs
[
i
].
numW®ls
; j++){

427 
æoÜs
[
i
].
šdexW®ls
[
j
] = 
hh
;

428 
hh
++;

432 
æoÜ¶ª
.
	`İ’
("Floorplan/wn_test_wall_data.txt");

434 
i
 = 0; i < 4; i++)

435 
æoÜ¶ª
 << 
i
 << "\t" << 
quadH©aBÜd”X
[i] << "\t" << 
quadH©aBÜd”Y
[i] << "\n";

437 
i
 = 0; i < 
numFloÜs
; i++){

438 
j
 = 0; j < 
æoÜs
[
i
].
numW®ls
; j++){

439 
æoÜ¶ª
 << 
i
 << "\t" << 
j
 << "\t";

440 
æoÜ¶ª
 << 
w®ls
[
æoÜs
[
i
].
šdexW®ls
[
j
]].
x1
 << "\t";

441 
æoÜ¶ª
 << 
w®ls
[
æoÜs
[
i
].
šdexW®ls
[
j
]].
y1
 << "\t";

442 
æoÜ¶ª
 << 
w®ls
[
æoÜs
[
i
].
šdexW®ls
[
j
]].
x2
 << "\t";

443 
æoÜ¶ª
 << 
w®ls
[
æoÜs
[
i
].
šdexW®ls
[
j
]].
y2
 << "\n";

448 
	`ä“
(
šdexT
);

449 
	`ä“
(
pŞyd©a
);

450 
	`ä“
(
w®lsTemp
);

451 
cout
 << "[runWÜld] [S³cific] Fšish floÜ¶ª." << 
’dl
;

453 
æoÜ¶ª
.
	`şo£
();

454 
	}
}

456 
	gFloÜ¶ªs
::
	$š™Ÿli£
()

459 
	}
}

461 
	gFloÜ¶ªs
::
	$äequ’cyPlIÁ”p
(
w®l_ty³
, 
äeq_MHz
){

463 
¶
,

464 
F»q_bªds
[5] = { 900, 1800, 2100, 3000, 5000 };

466 
i
, 
šd
;

468 
w®l_d©a_m©rix
[11][5] = { 5, 7, 8, 12, 14,

480 
i
 = 0; i < 5; i++){

481 ià(
äeq_MHz
 =ğ
F»q_bªds
[
i
]){

482 
¶
 = 
w®l_d©a_m©rix
[
w®l_ty³
 - 1][
i
];

483 
i
 = 6;

486 ià(
äeq_MHz
 < 
F»q_bªds
[
i
 + 1]){

488 
¶
 = 
w®l_d©a_m©rix
[
w®l_ty³
 - 1][
i
] + (wall_data_matrix[wall_type - 1][i + 1] - wall_data_matrix[wall_type - 1][i])

489 * (
äeq_MHz
 - 
F»q_bªds
[
i
]) / (Freq_bands[i + 1] - Freq_bands[i]);

490 
i
 = 6;

494  
¶
;

495 
	}
}

499 
	g‹m¶©e
 <
şass
 
	gT
>

500 
	$cÚv”tFromSŒšg
(
T
 &
v®ue
, cÚ¡ 
¡d
::
¡ršg
 &
s
) {

501 
¡d
::
¡ršg¡»am
 
	`ss
(
s
);

502 
ss
 >> 
v®ue
;

503 
	}
}

	@/home/lyang3/work/src_son/runWorld/floorPlan.h

1 
	~<io¡»am
>

2 
	~<f¡»am
>

3 
	~<m©h.h
>

4 
	~<s¡»am
>

5 
	~<¡ršg
>

7 
usšg
 
Çme¥aû
 
	g¡d
;

9 şas 
	cW®l


11 
	mpublic
:

13 
x1
,

14 
	my1
,

15 
	mz1
,

16 
	mx2
,

17 
	my2
,

18 
	mz2
,

19 
	mx3
,

20 
	my3
,

21 
	mz3
,

22 
	mx4
,

23 
	my4
,

24 
	mz4
;

27 
	mæoÜNumb”
,

28 
	mw®lTy³
,

45 
	mw®lHeight
,

47 
	mNÙe
;

50 şas 
	cFloÜ


52 
	mpublic
:

54 
æoÜHeight
;

57 
	mæoÜNumb”
,

58 
	mnumW®ls
,

59 *
	mšdexW®ls
;

62 şas 
	cT¿v–P©h


64 
	mpublic
:

66 
šdSegm’t
,

67 
	mæoÜ
;

69 
	mx1
,

70 
	my1
,

71 
	mz1
,

72 
	mx2
,

73 
	my2
,

74 
	mz2
,

75 
	mheight
;

78 şas 
	cPŞyD©a


80 
	mpublic
:

82 
numLšes
,

83 
	mlšeS¹
,

84 
	mnumPŞylšes
,

85 
	mšdByBlock
,

86 
	mæoÜTy³
,

87 
	mšdW®lHeight
;

90 şas 
	cFloÜ¶ªs


92 
	mpublic
:

94 
FloÜ¶ªs
();

95 ~
FloÜ¶ªs
();

96 
R—dšFe
(
FILE
* 
feIÅut
);

97 
äequ’cyPlIÁ”p
(
w®l_ty³
, 
äeq_MHz
);

98 
š™Ÿli£
();

101 
W®l
* 
	mw®ls
;

102 
FloÜ
 
	mæoÜs
[200];

103 
T¿v–P©h
* 
	mŒav–P©h
;

104 
	mtÙ®FloÜs
;

105 
	mnumW®ls
,

106 
	mnumFloÜs
;

107 
	mnumT¿v–P©hSeg
;

109 
	mw®l_couÁ
,

110 
	mæoÜW®l_couÁ
,

111 
	mhŞe_couÁ
;

113 *
	mw®l_¶aûs
,

114 *
	mæoÜW®l_¶aûs
,

115 *
	mhŞe_¶aûs
;

118 
	mquadH©aBÜd”X
[4],

119 
	mquadH©aBÜd”Y
[4],

120 
	mw®lHeight
,

121 
	mŒav–P©hHeight
,

122 
	maccumuÏ‹dHeight
[6];

124 
	mIndexSeùÜ
;

125 
	mIndexA±Block
;

126 
	mIndexA±
;

129 
	g‹m¶©e
 <
şass
 
	gT
>

130 
cÚv”tFromSŒšg
(
T
 &, cÚ¡ 
¡d
::
¡ršg
 &);

	@/home/lyang3/work/src_son/runWorld/geometry.cpp

1 
	~<io¡»am
>

2 
	~<m©h.h
>

3 
	~"runWÜld.h
"

4 
	~"geom‘ry.h
"

6 
usšg
 
Çme¥aû
 
	g¡d
;

8 
	gCoÜd
::
	$CoÜd
()

10 
dX
 = 0.0;

11 
dY
 = 0.0;

12 
	}
}

14 
	gCoÜd
::
	$CoÜd
(
dA
, 
dB
)

16 
dX
 = 
dA
;

17 
dY
 = 
dB
;

18 
	}
}

20 
	gCoÜd
::
	$´št
()

22 
cout
 << "x: " << 
dX
 << " m y: " << 
dY
 << " m ";

23 
	}
}

25 
	gCoÜd
::~
	$CoÜd
()

27 
	}
}

29 
	$Di¡ªû
(
CoÜd
 
A
, CoÜd 
B
)

31  
	`sq¹
Ğ
	`pow
(
B
.
dX
-
A
.dX, 2.0è+…owĞB.
dY
-A.dY, 2.0) );

32 
	}
}

34 
	$Di¡ªû3D
(
CoÜd
 
A
, CoÜd 
B
, 
HeightA
, 
HeightB
)

36  
	`sq¹
Ğ
	`pow
(
B
.
dX
-
A
.dX, 2.0è+…owĞB.
dY
-A.dY, 2.0è+…owĞ
HeightA
-
HeightB
, 2.0));

37 
	}
}

39 
	$B—ršgFromSeùÜ
(
iSeùÜ
, 
CoÜd
 
S™eLoc
, CoÜd 
UELoc
)

42 
dB—ršg
 = 0.0;

45 
dB—ršg
 = 
	`©ª2
((
UELoc
.
dX
-
S™eLoc
.dX), (UELoc.
dY
 - SiteLoc.dY));

48 
dB—ršg
 -ğ(2.0*
PI
/(1.0*
MACROSECTORS
))*(
iSeùÜ
+0.5);

50 ià(
dB—ršg
 < -
PI
){

51 
dB—ršg
 +ğ2.0*
PI
;

54 ià(
dB—ršg
 > 
PI
){

55 
dB—ršg
 -ğ2.0*
PI
;

58  
dB—ršg
;

59 
	}
}

62 
	$AdddBm
 (
ddBm1
, 
ddBm2
) {

64 
dSumdBm
 = 0.0;

66 
dSumdBm
 = 10.0 * 
	`log10
(
	`pow
(10.0, 
ddBm1
/10.0è+…ow(10.0, 
ddBm2
/10.0));

68  
dSumdBm
;

69 
	}
}

71 
	$SubdBm
 (
ddBm1
, 
ddBm2
) {

73 
dSubdBm
 = 0.0;

75 
dSubdBm
 = 10.0 * 
	`log10
(
	`pow
(10.0, 
ddBm1
/10.0è-…ow(10.0, 
ddBm2
/10.0));

77  
dSubdBm
;

78 
	}
}

80 
	$dB2R—l
 (
ddBm
){

82  
	`pow
(10.0, 
ddBm
/10.0);

83 
	}
}

85 
	$dBm2Lš—rW
 (
ddBm
){

87  
	`pow
(10.0, 
ddBm
/10.0) / 1000.0;

88 
	}
}

90 
CoÜd
 
	$ÿlcIÁ”SeùiÚ
(
a12
, 
a22
, 
d1
, 
d2
){

92 
CoÜd
 
co
;

94 
c12
, 
c21
, 
c11
, 
c22
;

96 
c21
 = 1.0 / (
a12
 - 
a22
);

97 
c12
 = 
a12
 * 
c21
;

98 
c11
 = 1 - 
c12
;

99 
c22
 = -
c21
;

101 
co
.
dX
 = 
c11
*
d1
 + 
c12
*
d2
;

102 
co
.
dY
 = 
c21
*
d1
 + 
c22
*
d2
;

103  
co
;

104 
	}
}

	@/home/lyang3/work/src_son/runWorld/geometry.h

2 şas 
	cCoÜd


4 
	mpublic
:

6 
CoÜd
();

7 
CoÜd
(
dA
, 
dB
);

8 
´št
();

9 ~
CoÜd
();

12 
	mdX
,

13 
	mdY
;

16 
Di¡ªû
(
CoÜd
 
A
, CoÜd 
B
);

17 
Di¡ªû3D
(
CoÜd
 
A
, CoÜd 
B
, 
HeightA
, 
HeightB
);

18 
B—ršgFromSeùÜ
(
iSeùÜ
, 
CoÜd
 
S™eLoÿtiÚ
, CoÜd 
UELoÿtiÚ
);

20 
AdddBm
 (
ddBm1
, 
ddBm2
);

21 
SubdBm
 (
ddBm1
, 
ddBm2
);

22 
dB2R—l
 (
ddBm
);

23 
dBm2Lš—rW
 (
ddBm
);

25 
CoÜd
 
ÿlcIÁ”SeùiÚ
(
a12
, 
a22
, 
d1
, 
d2
);

27 
sum_ÿp_maüo_1Ïy”_DL
(*
tÙ®C­Max
,*
numRBsMax
,
maxRBs
,
NªtsUeRx
, *
equivChªBe¡_»
, *
equivChªBe¡_im
, 
S·¿m
, 
®pha
, 
b‘a
, *
NItoU£
,
NumBlocksDL
, *
be¡Ind
, 
§m¶esP”RB
, 
maxTÙ®P”AÁTxPow”
, 
maxTxPow”P”RB
, 
mšPwrP”UE
);

28 
sum_ÿp_ãmto_1Ïy”_DL
(*
tÙ®C­Max
,*
numRBsMax
,
maxRBs
,
NªtsUeRx
, *
equivChªBe¡_»
, *
equivChªBe¡_im
, 
S·¿m
, 
®pha
, 
b‘a
, *
NItoU£
,
NumBlocksDL
, *
be¡Ind
, 
§m¶esP”RB
, 
maxTÙ®P”AÁTxPow”
, 
maxTxPow”P”RB
, 
mšPwrP”UE
, *
RBsizes
, 
nRBsizes
, 
§m¶esP”Block
);

29 
sum_ÿp_maüo_1Ïy”_UL
(*
tÙ®C­Max
,*
numRBsMax
,*
numRBsMš
,
maxRBs
,
NªtsUeRx
, *
equivChªBe¡_»
, *
equivChªBe¡_im
, 
S·¿m
, 
®pha
, 
b‘a
, *
NItoU£
, 
maxTÙ®P”AÁTxPow”UE
, 
maxTxPow”P”RB
, 
§m¶esP”RB
, 
buffStus
, 
ULmaxMCS
);

30 
sum_ÿp_ãmto_1Ïy”_UL
(*
tÙ®C­Max
,*
numRBsMax
,*
numRBsMš
,
maxRBs
,
NªtsUeRx
, *
equivChªBe¡_»
, *
equivChªBe¡_im
, 
S·¿m
, 
®pha
, 
b‘a
, *
NItoU£
, 
maxTÙ®P”AÁTxPow”UE
, 
maxTxPow”P”RB
, 
§m¶esP”RB
, *
RBsizes
, 
nRBsizes
, 
buffStus
, 
ULmaxMCS
);

32 
log2­´ox
(
š
);

	@/home/lyang3/work/src_son/runWorld/homeNetwork.cpp

1 
	~<io¡»am
>

2 
	~<f¡»am
>

3 
	~<m©h.h
>

5 
	~"wÜld.h
"

6 
	~"¿ndom.h
"

7 
	~"·thloss.h
"

9 
usšg
 
Çme¥aû
 
	g¡d
;

11 
	gWÜld
::
	$ÿlcSnifãr
(
CoÜd
 
coPošt
, 
C–lSnifãr
 
ûÎD©aPt
[][
MACROSECTORS
]){

13 
iS™e
,

14 
iSeùÜ
,

15 
i
;

17 
CoÜd


18 
s™eCoPošt
;

21 
dDi¡ªû
,

22 
dP©hlossTemp
,

23 
dP©hloss
[
SITES
],

24 
dP©hlossNoB—ršg
[
SITES
],

25 
dB—ršg
[
SITES
],

26 
dP©hlossW¿µed
;

29 
iS™e
 = 0; iS™< 
numMaüoS™es
; iSite++) {

31 
iSeùÜ
 = 0; iSeùÜ < 
MACROSECTORS
; iSector++) {

33 
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dP©hloss
 = 1000;

34 
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dP©hlossW¿µed
 = 1000;

35 
i
 = 0; i < 
numMaüoS™es
; i++) {

37 
s™eCoPošt
.
dX
 = 
S™es
[
iS™e
].
LoÿtiÚ
.dX - 
di¥ÏûVec
[
i
].dX;

38 
s™eCoPošt
.
dY
 = 
S™es
[
iS™e
].
LoÿtiÚ
.dY - 
di¥ÏûVec
[
i
].dY;

40 
dDi¡ªû
 = 
	`Di¡ªû3D
(
coPošt
, 
s™eCoPošt
, 
BSANTHEIGHT
, 
FEMTOANTHEIGHT
);

42 ià(
dDi¡ªû
 < 10.0){

43 
dDi¡ªû
 = 10.0;

46 
dP©hlossTemp
 = 
	`dPlCOST231Okumu¿H©a
((
dDi¡ªû
/1000.0), 2000.0, 30.0, 1.5, 
Œue
);

49 
dP©hlossTemp
 +ğ
Ex‹riÜW®lP’‘¿tiÚLoss
 + 
ShadowšgStdDevFemto
 * 
	`¿n1
(&
iS“d
);

52 
dB—ršg
[
i
] = 
	`B—ršgFromSeùÜ
(
iSeùÜ
, 
s™eCoPošt
, 
coPošt
);

53 
dP©hloss
[
i
] = 
dP©hlossTemp
 - 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
	`ª‹ÂaGaš
(180.0*
dB—ršg
[i]/
PI
);

56 ià(
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dP©hloss
 > dP©hloss[
i
]){

57 
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dP©hloss
 = dP©hloss[
i
];

58 
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dB—ršg


59 ğ
dB—ršg
[
i
];

62 
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dP©hlossW¿µed
 = -
	`AdddBm
(-
dP©hloss
[
i
],

63 -
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dP©hlossW¿µed
);

66 
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dRxpow”


67 ğ
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
dTxpow”


68 - 
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dP©hloss
;

73 
iS™e
 = 0; iS™< 
numHeNB
; iSite++) {

76 
	}
}

78 
CoÜd
 
	gWÜld
::
	$ÿlcP’‘¿tiÚPošt
(
UE
 
ue
, 
FemtoS™e
 
ãmtoBS
){

81 
kvec
, 
cvec
,

82 
x1
, 
x2
, 
y1
, 
y2
,

83 
y‹¡1
, 
y‹¡2
, 
x‹¡1
, 
x‹¡2
;

85 
CoÜd


86 
³ÃŒ©iÚPošt
;

88 
kvec
 = (
ãmtoBS
.
LoÿtiÚ
.
dY
 - 
ue
.LoÿtiÚ.dYè/ (ãmtoBS.LoÿtiÚ.
dX
 - ue.Location.dX);

89 
cvec
 = 
ue
.
LoÿtiÚ
.
dY
 - 
kvec
 * ue.LoÿtiÚ.
dX
;

91 
x1
=
S™es
[
ãmtoBS
.
IndexBa£S™e
].
SeùÜs
[ãmtoBS.
IndexSeùÜ
].
­tBlock
[ãmtoBS.
IndexA±Block
].
ex‹riÜBlockW®ls
[0][0];

92 
x2
=
S™es
[
ãmtoBS
.
IndexBa£S™e
].
SeùÜs
[ãmtoBS.
IndexSeùÜ
].
­tBlock
[ãmtoBS.
IndexA±Block
].
ex‹riÜBlockW®ls
[0][1];

93 
y1
=
S™es
[
ãmtoBS
.
IndexBa£S™e
].
SeùÜs
[ãmtoBS.
IndexSeùÜ
].
­tBlock
[ãmtoBS.
IndexA±Block
].
ex‹riÜBlockW®ls
[0][2];

94 
y2
=
S™es
[
ãmtoBS
.
IndexBa£S™e
].
SeùÜs
[ãmtoBS.
IndexSeùÜ
].
­tBlock
[ãmtoBS.
IndexA±Block
].
ex‹riÜBlockW®ls
[1][3];

96 
y‹¡1
 = 
kvec
 * 
x1
 + 
cvec
;

97 
y‹¡2
 = 
kvec
 * 
x2
 + 
cvec
;

98 
x‹¡1
 = (
y1
-
cvec
è/ 
kvec
;

99 
x‹¡2
 = (
y2
-
cvec
è/ 
kvec
;

101 ià((
y‹¡1
>=
y1
è&& (y‹¡1<=
y2
è&& (
ue
.
LoÿtiÚ
.
dX
<=
x1
)) {

103 
³ÃŒ©iÚPošt
.
dX
=
x1
;

104 
³ÃŒ©iÚPošt
.
dY
=
y‹¡1
;

107 ià((
y‹¡2
>=
y1
è&& (y‹¡2<=
y2
è&& (
ue
.
LoÿtiÚ
.
dX
>=
x2
)) {

109 
³ÃŒ©iÚPošt
.
dX
=
x2
;

110 
³ÃŒ©iÚPošt
.
dY
=
y‹¡2
;

113 ià((
x‹¡1
>=
x1
è&& (x‹¡1<=
x2
è&& (
ue
.
LoÿtiÚ
.
dY
<=
y1
)) {

115 
³ÃŒ©iÚPošt
.
dX
=
x‹¡1
;

116 
³ÃŒ©iÚPošt
.
dY
=
y1
;

121 
³ÃŒ©iÚPošt
.
dX
=
x‹¡2
;

122 
³ÃŒ©iÚPošt
.
dY
=
y2
;

126  
³ÃŒ©iÚPošt
;

127 
	}
}

129 
	gWÜld
::
	$ÿlcFemtoPoštLos£s
(
UE
 
ue
, 
C–lm—su»s
 *
ãmtoD©aPt
){

131 
iS™e
,

132 
nFloÜs
,

133 
nW®ls
,

134 
i
;

136 
CoÜd


137 
s™eCoPošt
;

140 
dDi¡ªû3D
,

141 
dDi¡ªû2D
,

142 
dP©hlossTemp
,

143 
dP©hlossW¿µed
,

144 
dP‹mp
,

145 
dP©hloss
;

147 
CoÜd


148 
³ÃŒ©iÚPošt
;

150 
dDi¡ªû2D
 = 
	`sq¹
((10 * 
y¿ngeW®ls
)*(10 * y¿ngeW®ls)+(2 * 
x¿ngeW®ls
)*(2 * xrangeWalls))/2;

151 ià(
d•loym’tTy³
 =ğ
SUBURBAN
)

152 
nW®ls
 = 0;

154 
nW®ls
 = 
ReùGridDim’siÚX
 - 1 + 
ReùGridDim’siÚY
 - 1;

156 
Ùh”CÚŒMax
 = 
	`dPlFemtoInIn_P¬tŸl
(
dDi¡ªû2D
, 
nW®ls
, 0, 
Œue
,rue);

159 
iS™e
 = 0; iS™< 
numHeNB
; iSite++) {

161 ià((
ue
.
ueD•loym’tTy³
 =ğ
maüoUeInFemto
 || ue.ueD•loym’tTy³ =ğ
ãmtoUeIndoÜ
) &&

162 (
ue
.
IndexBa£S™e
 =ğ
HeNBS™es
[
iS™e
].IndexBa£S™&& ue.
IndexSeùÜ
 =ğHeNBS™es[iS™e].IndexSeùÜ && ue.
IndexA±Block
 == HeNBSites[iSite].IndexAptBlock))

165 
dDi¡ªû2D
 = 
	`Di¡ªû
(
ue
.
LoÿtiÚ
, 
HeNBS™es
[
iS™e
].Location);

166 
dDi¡ªû3D
 = 
	`Di¡ªû3D
(
ue
.
LoÿtiÚ
, 
HeNBS™es
[
iS™e
].LoÿtiÚ, HeNBS™es[iS™e].
ª‹ÂaHeight
, ue.
Height
);

168 ià(
d•loym’tTy³
 =ğ
APTBLOCKMODEL
)

169 
nW®ls
 = (
	`abs
(
ue
.
LoÿtiÚ
.
dX
-
HeNBS™es
[
iS™e
].LoÿtiÚ.dX)-
x¿ngeW®ls
)/2/xrangeWalls +

170 (
	`abs
(
ue
.
LoÿtiÚ
.
dY
-
HeNBS™es
[
iS™e
].LoÿtiÚ.dY)-
y¿ngeW®ls
)/2/yrangeWalls;

172 
nW®ls
 = 0;

174 
nFloÜs
 = 0;

177 
dP©hloss
 = 
	`dPlFemtoInIn_G’”ic
(
dDi¡ªû3D
, 
dDi¡ªû2D
, 
nW®ls
, 
nFloÜs
, 
Œue
,rue);

178 
dP©hloss
 = dP©hlos - 
FEMTOANTGAIN
 - 
UeAÁGaš
;

179 
dP©hlossW¿µed
 = 
dP©hloss
;

203 
³ÃŒ©iÚPošt
 = 
	`ÿlcP’‘¿tiÚPošt
(
ue
, 
HeNBS™es
[
iS™e
]);

205 
dDi¡ªû2D
 = 
	`Di¡ªû
(
HeNBS™es
[
iS™e
].
LoÿtiÚ
, 
³ÃŒ©iÚPošt
);

206 ià(
d•loym’tTy³
 =ğ
APTBLOCKMODEL
)

207 
nW®ls
 = (
dDi¡ªû2D
-
x¿ngeW®ls
)/2/xrangeWalls;

209 
nW®ls
 = 0;

211 
nFloÜs
 = 0;

214 
dP©hloss
 = 
	`dPlFemtoInIn_P¬tŸl
(
dDi¡ªû2D
, 
nW®ls
, 
nFloÜs
, 
Œue
,rue);

216 
dP©hloss
 +ğ
Ex‹riÜW®lP’‘¿tiÚLoss
;

218 ià(
ue
.
ueD•loym’tTy³
 =ğ
maüoUeIndoÜ
)

219 
dP©hloss
 +ğ
Ùh”MaüoUEP’‘¿tiÚ
;

220 if(
ue
.
ueD•loym’tTy³
 =ğ
maüoUeInFemto
 || ue.ueD•loym’tTy³ =ğ
ãmtoUeIndoÜ
){

222 
dP©hloss
 +ğ
Ex‹riÜW®lP’‘¿tiÚLoss
 + 
Ùh”CÚŒMax
 * 
	`¿n1
(&
iS“d
);

224 
dP©hloss
 = dP©hlos - 
FEMTOANTGAIN
 - 
UeAÁGaš
;

227 
dP©hlossTemp
 = 1000;

228 
dP©hlossW¿µed
 = 1000;

229 
i
 = 0; i < 
numMaüoS™es
; i++) {

230 
s™eCoPošt
.
dX
 = 
³ÃŒ©iÚPošt
.dX + 
di¥ÏûVec
[
i
].dX;

231 
s™eCoPošt
.
dY
 = 
³ÃŒ©iÚPošt
.dY + 
di¥ÏûVec
[
i
].dY;

232 
dDi¡ªû2D
 = 
	`Di¡ªû
(
ue
.
LoÿtiÚ
, 
s™eCoPošt
);

233 
dP‹mp
 = 
dP©hloss
 + 
	`dPlFemtoInOut_G’”ic
(
C¬rF»q
, 
dDi¡ªû2D
, 
Œue
,rue);

235 ià(
dP©hlossTemp
 > 
dP‹mp
)

236 
dP©hlossTemp
 = 
dP‹mp
;

238 
dP©hlossW¿µed
 = -
	`AdddBm
(-
dP‹mp
, -dPathlossWrapped);

240 
dP©hloss
 = 
dP©hlossTemp
;

243 
ãmtoD©aPt
[
iS™e
].
dP©hlossW¿µed
 = dPathlossWrapped;

244 
ãmtoD©aPt
[
iS™e
].
dP©hloss
 = dPathloss;

245 
ãmtoD©aPt
[
iS™e
].
dRxpow”
 = 
HeNBS™es
[iS™e].
’B_Ée_·rs
.
dTxpow”


246 - 
ãmtoD©aPt
[
iS™e
].
dP©hloss
;

250 
	}
}

253 
	gWÜld
::
	$š™Ÿli£HomeN‘wÜk
(
dIÁ”S™eDi¡ªû
) {

256 
iHeNB
=0, 
numA±sP”Block
, 
iS™es
, 
iSeùs
, 
iFemtos
, 
i
, 
dÚe
, 
iBlock
, 
ncŞ
, 
Äow
,

257 
iS™es2
, 
iSeùs2
;

259 
ãmtoRadiusMax
;

261 
cout
 << "[runWorld] "

262 << "[WÜld::£tupN‘wÜk] S‘u°HomN‘wÜk" << 
’dl
;

265 
ãmtoRadiusMax
=
dIÁ”S™eDi¡ªû
*1.389119;

266 
dISD
 = 
dIÁ”S™eDi¡ªû
;

269 ià(
d•loym’tTy³
 =ğ
APTBLOCKMODEL
)

271 
numA±sP”Block
 = 
´obAùiveA·¹m’t
 * 
ReùGridDim’siÚX
 * 
ReùGridDim’siÚY
 * 
A±NumFloÜs
;

273 
numHeNB
 = 
numMaüoS™es
 * 
MACROSECTORS
 * 
BLOCKS³rCELL
 * 
numA±sP”Block
;

275 
iS™es
=0; iS™es<
numMaüoS™es
; iSites++){

276 
iSeùs
=0; iSeùs<
MACROSECTORS
; iSects++){

277 
iBlock
=0; iBlock<
BLOCKS³rCELL
; iBlock++){

278 
dÚe
 = 0;

279 
dÚe
 == 0){

280 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
LoÿtiÚ
 = 
	`§m¶eSeùÜ
(iSects);

281 ià(
	`sq¹
(
	`pow
(
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
LoÿtiÚ
.
dX
, 2.0)+pow(S™es[iS™es].SeùÜs[iSeùs].­tBlock[iBlock].LoÿtiÚ.
dY
, 2.0)è>ğ
mšS•¬©iÚA±Maüo
){

282 
dÚe
 = 1;

283 
i
=1; i<=
iBlock
 && 
dÚe
 == 1; i++){

284 ià(
	`Di¡ªû
(
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
LoÿtiÚ
, S™es[iS™es].SeùÜs[iSeùs].­tBlock[iBlock-1].LoÿtiÚè< 
mšS•¬©iÚA±A±
)

285 
dÚe
 = 0;

287 
iS™es2
=0; iS™es2<
iS™es
 && 
dÚe
 == 1; iSites2++){

288 
iSeùs2
=0; iSeùs2<
iSeùs
 && 
dÚe
 == 1; iSects2++){

289 
i
=0; i<
BLOCKS³rCELL
; i++){

290 ià(
	`Di¡ªû
(
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
LoÿtiÚ
, S™es[
iS™es2
].SeùÜs[
iSeùs2
].­tBlock[
i
].LoÿtiÚè< 
mšS•¬©iÚA±A±
)

291 
dÚe
 = 0;

297 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
LoÿtiÚ
.
dX
 = Sites[iSites].Sectors[iSects].aptBlock[iBlock].Location.dX + Sites[iSites].Location.dX;

298 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
LoÿtiÚ
.
dY
 = Sites[iSites].Sectors[iSects].aptBlock[iBlock].Location.dY + Sites[iSites].Location.dY;

300 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
BlockCoÜds
[0].
dX
 = S™es[iS™es].SeùÜs[iSeùs].­tBlock[iBlock].
LoÿtiÚ
.dX;

301 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
BlockCoÜds
[0].
dY
 = S™es[iS™es].SeùÜs[iSeùs].­tBlock[iBlock].
LoÿtiÚ
.dY - 3 * 
y¿ngeW®ls
;

302 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
ex‹riÜBlockW®ls
[0][0] = S™es[iS™es].SeùÜs[iSeùs].­tBlock[iBlock].
LoÿtiÚ
.
dX
 - 
ReùGridDim’siÚX
 * 
x¿ngeW®ls
;

303 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
ex‹riÜBlockW®ls
[0][1] = S™es[iS™es].SeùÜs[iSeùs].­tBlock[iBlock].
LoÿtiÚ
.
dX
 + 
ReùGridDim’siÚX
 * 
x¿ngeW®ls
;

304 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
ex‹riÜBlockW®ls
[0][2] = S™es[iS™es].SeùÜs[iSeùs].­tBlock[iBlock].
LoÿtiÚ
.
dY
 - 5 * 
y¿ngeW®ls
;

305 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
ex‹riÜBlockW®ls
[0][3] = S™es[iS™es].SeùÜs[iSeùs].­tBlock[iBlock].
LoÿtiÚ
.
dY
 - 1 * 
y¿ngeW®ls
;

307 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
BlockCoÜds
[1].
dX
 = S™es[iS™es].SeùÜs[iSeùs].­tBlock[iBlock].
LoÿtiÚ
.dX;

308 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
BlockCoÜds
[1].
dY
 = S™es[iS™es].SeùÜs[iSeùs].­tBlock[iBlock].
LoÿtiÚ
.dY + 3 * 
y¿ngeW®ls
;

309 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
ex‹riÜBlockW®ls
[1][0] = S™es[iS™es].SeùÜs[iSeùs].­tBlock[iBlock].
LoÿtiÚ
.
dX
 - 
ReùGridDim’siÚX
 * 
x¿ngeW®ls
;

310 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
ex‹riÜBlockW®ls
[1][1] = S™es[iS™es].SeùÜs[iSeùs].­tBlock[iBlock].
LoÿtiÚ
.
dX
 + 
ReùGridDim’siÚX
 * 
x¿ngeW®ls
;

311 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
ex‹riÜBlockW®ls
[1][2] = S™es[iS™es].SeùÜs[iSeùs].­tBlock[iBlock].
LoÿtiÚ
.
dY
 + 1 * 
y¿ngeW®ls
;

312 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
ex‹riÜBlockW®ls
[1][3] = S™es[iS™es].SeùÜs[iSeùs].­tBlock[iBlock].
LoÿtiÚ
.
dY
 + 5 * 
y¿ngeW®ls
;

314 
iFemtos
=0; iFemtos<
numA±sP”Block
; iFemtos++){

315 
dÚe
 = 0;

316 
HeNBS™es
[
iHeNB
].
IndexBa£S™e
 = 
iS™es
;

317 
HeNBS™es
[
iHeNB
].
IndexSeùÜ
 = 
iSeùs
;

318 
HeNBS™es
[
iHeNB
].
IndexA±Block
 = 
iBlock
;

319 
dÚe
 == 0){

320 
HeNBS™es
[
iHeNB
].
IndexA±
 = 
	`¿n1
(&
iS“d
è* 
ReùGridDim’siÚX
 * 
ReùGridDim’siÚY
;

321 ià(
HeNBS™es
[
iHeNB
].
IndexA±
 < 
ReùGridDim’siÚX
 * 
ReùGridDim’siÚY
){

322 
dÚe
 = 1;

323 
i
=1; i<=
iFemtos
 && 
dÚe
 == 1; i++){

324 ià(
HeNBS™es
[
iHeNB
].
IndexA±
 =ğHeNBS™es[iHeNB-
i
].IndexApt)

325 
dÚe
 = 0;

330 
ncŞ
 = 
HeNBS™es
[
iHeNB
].
IndexA±
 % 
ReùGridDim’siÚX
;

331 
Äow
 = 
HeNBS™es
[
iHeNB
].
IndexA±
 / 
ReùGridDim’siÚX
;

333 
HeNBS™es
[
iHeNB
].
LoÿtiÚ
.
dX
 = 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
BlockCoÜds
[
Äow
/2].dX - 
ReùGridDim’siÚX
 * 
x¿ngeW®ls
 + (2 * 
ncŞ
 + 1) * xrangeWalls;

334 
HeNBS™es
[
iHeNB
].
LoÿtiÚ
.
dY
 = 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
BlockCoÜds
[
Äow
/2].dY + (Òrow % 2)*2 - 1è* 
y¿ngeW®ls
;

335 
HeNBS™es
[
iHeNB
].
ª‹ÂaHeight
 = 
FEMTOANTHEIGHT
 + (
A±NumFloÜs
-1è* 
A±FloÜHeight
;

337 
HeNBS™es
[
iHeNB
].
LoÿtiÚ
.
dX
 = HeNBS™es[iHeNB].LoÿtiÚ.dX + (1 - 2.0 * 
	`¿n1
(&
iS“d
)è* 
x¿ngeFemtoENB
;

338 
HeNBS™es
[
iHeNB
].
LoÿtiÚ
.
dY
 = HeNBS™es[iHeNB].LoÿtiÚ.dY + (1 - 2.0 * 
	`¿n1
(&
iS“d
)è* 
y¿ngeFemtoENB
;

339 
HeNBS™es
[
iHeNB
].
	`š™Ÿli£
();

340 
iHeNB
++;

346 ià(
d•loym’tTy³
 =ğ
SUBURBAN
){

347 
iHeNB
 = 0; iHeNB < 
HeNBS
; iHeNB++) {

348 
HeNBS™es
[
iHeNB
].
LoÿtiÚ
.
dX
 = 
ãmtoRadiusMax
 * 
	`sš
(2.0 * 
PI
 * (iHeNB - 1.0)/6.0);

349 
HeNBS™es
[
iHeNB
].
LoÿtiÚ
.
dY
 = 
ãmtoRadiusMax
 * 
	`cos
(2.0 * 
PI
 * (iHeNB - 1.0)/6.0);

350 
HeNBS™es
[
iHeNB
].
	`š™Ÿli£
();

354 
	}
}

357 
	gWÜld
::
	$š™Ÿli£HomeU£rs
(){

359 
iUE
 = 0,

360 
iHeNB
;

362 
CoÜd


363 
CoÜdU£r
;

365 
numHomeUE
 = 
numHeNB
 * 
numHUEsP”HeNB
;

367 
cout
 << "[runWorld] "

369 << 
numHeNB
 << 
’dl
;

371 
iUE
 < 
numHomeUE
) {

373 
CoÜdU£r
.
dX
 = 
x¿ngeFemtoUE
 * (2.0 * 
	`¿n1
(&
iS“d
) - 1.0);

374 
CoÜdU£r
.
dY
 = 
y¿ngeFemtoUE
 * (2.0 * 
	`¿n1
(&
iS“d
) - 1.0);

377 ià(
	`sq¹
(
	`pow
(
CoÜdU£r
.
dX
,2.0è+…ow(CoÜdU£r.
dY
,2.0)è> 
mšS•¬©iÚUEFemto
) {

378 
iHeNB
 = 
iUE
 / 
numHUEsP”HeNB
;

379 
HUEs
[
iUE
].
	`š™Ÿli£
();

380 
HUEs
[
iUE
].
LoÿtiÚ
.
dX
 = 
HeNBS™es
[
iHeNB
].LoÿtiÚ.dX + 
CoÜdU£r
.dX;

381 
HUEs
[
iUE
].
LoÿtiÚ
.
dY
 = 
HeNBS™es
[
iHeNB
].LoÿtiÚ.dY + 
CoÜdU£r
.dY;

382 ià((
	`abs
(
HUEs
[
iUE
].
LoÿtiÚ
.
dX
-
S™es
[
HeNBS™es
[
iHeNB
].
IndexBa£S™e
].
SeùÜs
[HeNBS™es[iHeNB].
IndexSeùÜ
].
­tBlock
[HeNBS™es[iHeNB].
IndexA±Block
].LoÿtiÚ.dXè< 5*
x¿ngeW®ls
)

383 && (
	`abs
(
HUEs
[
iHeNB
].
LoÿtiÚ
.
dY
-
S™es
[
HeNBS™es
[iHeNB].
IndexBa£S™e
].
SeùÜs
[HeNBS™es[iHeNB].
IndexSeùÜ
].
­tBlock
[HeNBS™es[iHeNB].
IndexA±Block
].LoÿtiÚ.dYè< 5*
y¿ngeW®ls
))

384 
HUEs
[
iUE
].
ueD•loym’tTy³
 = 
ãmtoUeIndoÜ
;

386 
HUEs
[
iUE
].
ueD•loym’tTy³
 = 
ãmtoUeOutdoÜ
;

387 
HUEs
[
iUE
].
Height
 = 
UeAÁ’ÇHeight
;

388 
HUEs
[
iUE
].
v
.
dS³ed
 = 3 * 
	`¿n1
(&
iS“d
);

389 
HUEs
[
iUE
].
v
.
dDœeùiÚ
 = 
PI
 * (2.0 * 
	`¿n1
(&
iS“d
) - 1.0);

391 
HUEs
[
iUE
].
IndexBa£S™e
 = 
HeNBS™es
[
iHeNB
].IndexBaseSite;

392 
HUEs
[
iUE
].
IndexSeùÜ
 = 
HeNBS™es
[
iHeNB
].IndexSector;

393 
HUEs
[
iUE
].
IndexA±Block
 = 
HeNBS™es
[
iHeNB
].IndexAptBlock;

394 
HUEs
[
iUE
].
IndexA±
 = 
HeNBS™es
[
iHeNB
].IndexApt;

395 
HUEs
[
iUE
].
ueHSPAd©a
.
iS”všgFemto
 = 
iHeNB
;

396 
HUEs
[
iUE
].
ueLTEd©a
.
iS”všgFemto
 = 
iHeNB
;

398 
iUE
++;

403 
	}
}

	@/home/lyang3/work/src_son/runWorld/metroNetwork.cpp

1 
	~"wÜld.h
"

2 
	~"¿ndom.h
"

3 
	~"·thloss.h
"

4 
	~<lim™s
>

6 
	$poštInPŞy
(
nv”t
, *
v”tx
, *
v”ty
, 
‹¡x
, 
‹¡y
)

8 
i
, 
j
, 
c
 = 0;

9 
i
 = 0, 
j
 = 
nv”t
-1; i <‚vert; j = i++) {

10 iàĞ((
v”ty
[
i
]>
‹¡y
è!ğ(v”ty[
j
]>testy)) &&

11 (
‹¡x
 < (
v”tx
[
j
]-v”tx[
i
]è* (
‹¡y
-
v”ty
[i]) / (verty[j]-verty[i]) + vertx[i]) )

12 
c
 = !c;

14  
c
;

15 
	}
}

17 
	gWÜld
::
	$‹¡LoÿtiÚUE
(
UE
 *
ue
, 
FloÜ¶ªs
* 
æoÜ¶ª
){

20 
iS™es
, 
iSeùs
, 
iBlock
;

22 
ue
[0].
ueD•loym’tTy³
 = 
maüoUeOutdoÜ
;

23 
iS™es
=0; iS™es<
numMaüoS™es
; iSites++){

24 
iSeùs
=0; iSeùs<
MACROSECTORS
; iSects++){

25 
iBlock
=0; iBlock<
BLOCKS³rCELL
 && 
numHeNB
>0; iBlock++){

26 ià((
	`abs
(
ue
[0].
LoÿtiÚ
.
dX
-
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].LoÿtiÚ.dXè< 10*
x¿ngeW®ls
è&& (abs(ue[0].LoÿtiÚ.
dY
-S™es[iS™es].SeùÜs[iSeùs].­tBlock[iBlock].LoÿtiÚ.dYè< 5*
y¿ngeW®ls
)){

27 
ue
[0].
ueD•loym’tTy³
 = 
maüoUeInFemto
;

28 
ue
[0].
IndexBa£S™e
 = 
iS™es
;

29 
ue
[0].
IndexSeùÜ
 = 
iSeùs
;

30 
ue
[0].
IndexA±Block
 = 
iBlock
;

36 
i
, 
j
, 
c
=0;

37 
v”tx
[1000], 
v”ty
[1000];

38 
i
=0; i<
æoÜ¶ª
[0].
numFloÜs
 && 
c
==0; i++){

39 
j
=0; j<
æoÜ¶ª
[0].
æoÜs
[
i
].
numW®ls
; j++){

40 
v”tx
[
j
] = 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
æoÜs
[
i
].
šdexW®ls
[j]].
x1
;

41 
v”ty
[
j
] = 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
æoÜs
[
i
].
šdexW®ls
[j]].
y1
;

43 
c
 = 
	`poštInPŞy
(
æoÜ¶ª
[0].
æoÜs
[
i
].
numW®ls
, &
v”tx
[0], &
v”ty
[0], 
ue
[0].
LoÿtiÚ
.
dX
, ue[0].LoÿtiÚ.
dY
);

46 if(
c
 == 1){

47 
ue
[0].
ueD•loym’tTy³
 = 
maüoUeIndoÜ
;

50 if(
ue
[0].
LoÿtiÚ
.
dX
 >ğ
æoÜ¶ª
[0].
quadH©aBÜd”X
[0] && ue[0].LoÿtiÚ.dX <ğæoÜ¶ª[0].quadH©aBÜd”X[2] && ue[0].LoÿtiÚ.
dY
 >ğæoÜ¶ª[0].
quadH©aBÜd”Y
[0] && ue[0].Location.dY <= floorplan[0].quadHataBorderY[2]){

52 
ue
[0].
ueD•loym’tTy³
 = 
maüoUeOutdoÜ
;

55 
ue
[0].
Height
 = 
UeAÁ’ÇHeight
;

56 
ue
[0].
v
.
dS³ed
 = 0;

57 
ue
[0].
v
.
dDœeùiÚ
 = 0;

58 
ue
[0].
ueHSPAd©a
.
iS”všgFemto
 = -1;

59 
ue
[0].
ueLTEd©a
.
iS”všgFemto
 = -1;

60 
	}
}

62 
	gWÜld
::
	$š™Ÿli£M‘roN‘wÜk
(
dIÁ”S™eDi¡ªû
){

63 
cout
 << "[runWorld] "

64 << "[WÜld::£tupN‘wÜk] S‘u°M‘rØN‘wÜk" << 
’dl
;

66 
FILE


67 *
feIÅutM‘roCÚfig
;

69 
lše
[100];

71 
šdex
,

72 
‹mp
;

74 

;

77 ià((
feIÅutM‘roCÚfig
 = 
	`fİ’
("FloÜ¶ª/m‘roCÚfig.txt", "r")è=ğ
NULL
){

78 
cout
 << "No metroConfig fileƒxists. \n";

79 
	`ex™
(1);

82 ifĞ
	`fg‘s
Ğ
lše
, 100, 
feIÅutM‘roCÚfig
 ) !ğ
NULL
){

83 
	`fsÿnf
Ğ
feIÅutM‘roCÚfig
, "%d\n", &
numM‘roBS
 );

84 ifĞ
	`fg‘s
Ğ
lše
, 100, 
feIÅutM‘roCÚfig
 ) !ğ
NULL
){

85 
šdex
=0; index<
numM‘roBS
; index++){

86 
	`fsÿnf
Ğ
feIÅutM‘roCÚfig
, "%d ", &
‹mp
);

87 
	`fsÿnf
Ğ
feIÅutM‘roCÚfig
, "%à", &

);

88 
m‘roS™es
[
šdex
].
LoÿtiÚ
.
dX
 = 

;

89 
	`fsÿnf
Ğ
feIÅutM‘roCÚfig
, "%à", &

);

90 
m‘roS™es
[
šdex
].
LoÿtiÚ
.
dY
 = 

;

91 
	`fsÿnf
Ğ
feIÅutM‘roCÚfig
, "%f\n", &

);

92 
m‘roS™es
[
šdex
].
ª‹ÂaHeight
 = 

;

94 
m‘roS™es
[
šdex
].
	`š™Ÿli£
();

100 
	`fşo£
Ğ
feIÅutM‘roCÚfig
 );

101 
	}
}

103 
	gWÜld
::
	$ÿlcM‘roPoštLos£s
(
UE
 
ue
, 
C–lm—su»s
 *
m‘roD©aPt
, 
FloÜ¶ªs
* 
æoÜ¶ª
){

105 
i
, 
j
,

106 
iS™e
;

107 
CoÜd


108 
coUE
,

109 
coBS
;

111 
dDi¡ªû3D
,

112 
‹mpP’eLoss
;

114 
coUE
 = 
ue
.
LoÿtiÚ
;

115 
iS™e
 = 0; iS™< 
numM‘roBS
; iSite++) {

116 
coBS
 = 
m‘roS™es
[
iS™e
].
LoÿtiÚ
;

117 
dDi¡ªû3D
 = 
	`Di¡ªû3D
(
coUE
, 
coBS
, 
m‘roS™es
[
iS™e
].
ª‹ÂaHeight
, 
ue
.
Height
);

119 ià(
ue
.
ueD•loym’tTy³
 =ğ
maüoUeInFemto
 || ue.ueD•loym’tTy³ =ğ
ãmtoUeIndoÜ
)

120 
m‘roD©aPt
[
iS™e
].
dP©hloss
 = 0;

122 if(
ue
.
ueD•loym’tTy³
 =ğ
maüoUeIndoÜ
)

123 
m‘roD©aPt
[
iS™e
].
dP©hloss
 = 0;

126 
m‘roD©aPt
[
iS™e
].
dP©hloss
 = 
Ex‹riÜW®lP’‘¿tiÚLoss
 + 
Ùh”CÚŒMax
 * 
	`¿n1
(&
iS“d
);

128 
‹mpP’eLoss
 = 
	`p2pP’‘¿tiÚLoss
(
ue
.
LoÿtiÚ
, ue.
Height
, 
m‘roS™es
[
iS™e
].LoÿtiÚ, m‘roS™es[iS™e].
ª‹ÂaHeight
, 
æoÜ¶ª
);

131 if(
ue
.
ueD•loym’tTy³
 =ğ
maüoUeOutdoÜNLOS
){

132 ià(
‹mpP’eLoss
 > 0)

133 
m‘roD©aPt
[
iS™e
].
dP©hloss
 +ğ
	`dPlM‘roFemtoOutOut
(
dDi¡ªû3D
, 2100.0, 
m‘roS™es
[iS™e].
ª‹ÂaHeight
, 1.5, 
çl£
);

135 
m‘roD©aPt
[
iS™e
].
dP©hloss
 +ğ
	`dPlM‘roFemtoOutOut
(
dDi¡ªû3D
, 2100.0, 
m‘roS™es
[iS™e].
ª‹ÂaHeight
, 1.5, 
Œue
);

137 if(
ue
.
ueD•loym’tTy³
 =ğ
maüoUeIndoÜ
)

138 
m‘roD©aPt
[
iS™e
].
dP©hloss
 +ğ
	`dPlM‘roFemtoOutOut
(
dDi¡ªû3D
, 2100.0, 
m‘roS™es
[iS™e].
ª‹ÂaHeight
, 1.5, 
çl£
);

141 
m‘roD©aPt
[
iS™e
].
dP©hloss
 +ğ
	`dPlH©a
(
dDi¡ªû3D
, 
C¬rF»q
, 
m‘roS™es
[iS™e].
ª‹ÂaHeight
, 
UeAÁ’ÇHeight
, 
çl£
è+ 
‹mpP’eLoss
/2;

144 
m‘roD©aPt
[
iS™e
].
dP©hloss
 = m‘roD©aPt[iS™e].dP©hlos - 
METROANTGAIN
 - 
UeAÁGaš
;

145 
m‘roD©aPt
[
iS™e
].
dP©hlossW¿µed
 = m‘roD©aPt[iS™e].
dP©hloss
;

146 
m‘roD©aPt
[
iS™e
].
dRxpow”
 = 
m‘roS™es
[iS™e].
’B_Ée_·rs
.
dTxpow”


147 - 
m‘roD©aPt
[
iS™e
].
dP©hloss
;

149 
	}
}

151 
	gWÜld
::
	$p2pP’‘¿tiÚLoss
(
CoÜd
 
coUE
, 
heightUE
, CoÜd 
coBS
, 
heightBS
, 
FloÜ¶ªs
* 
æoÜ¶ª
){

153 
³ÃLoss
 = 0,

154 
¦İe_å
,

155 
¦İe_w1w2
,

156 
z_š‹r
,

157 
dl
,

158 
dw
,

159 
x_max_å
, 
x_mš_å
, 
y_max_å
, 
y_mš_å
,

160 
x_w_max
, 
x_w_mš
, 
y_w_max
, 
y_w_mš
;

162 
CoÜd


163 
š‹rSeùPošt
,

164 
š‹rs
[100];

167 
i
, 
j
,

168 
dim1
 = 0,

169 
dim2
 = 0,

170 
dim1_l
, 
dim1_w
,

171 
æoÜW®lCouÁ
[300],

172 
üos£d_w®ls
 = 0;

175 
•sÚ
 = 0.0000000001,

177 
LW_w®ls
 = 0;

179 
W®l


180 
w®ls_OI
[100];

182 
heightUE
 = heightUE + 1;

183 ià(
heightBS
 < 3.5)

184 
heightBS
 = heightBS + 1;

186 
i
=0; i<300; i++)

187 
æoÜW®lCouÁ
[
i
] = 0;

189 
i
=0; i<
æoÜ¶ª
[0].
w®l_couÁ
; i++){

190 
¦İe_å
 = (
coUE
.
dX
 - 
coBS
.dXè/ (coUE.
dY
 - coBS.dY);

191 
¦İe_w1w2
 = (
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
x2
 - floÜ¶ª[0].w®ls[æoÜ¶ª[0].w®l_¶aûs[i]].
x1
)

192 / (
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
y2
 - floÜ¶ª[0].w®ls[æoÜ¶ª[0].w®l_¶aûs[i]].
y1
);

198 ià((
	`abs
(
¦İe_å
)>0è&& (abs(¦İe_å)<
num”ic_lim™s
<>::
	`šfš™y
Ğ)è&& (abs(
¦İe_w1w2
)>0) && (abs(slope_w1w2)<numeric_limits<>::infinity( ))){

200 
dl
 = 
coUE
.
dX
 - 
¦İe_å
 * coUE.
dY
;

201 
dw
 = 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
x1
 - 
¦İe_w1w2
 * floÜ¶ª[0].w®ls[æoÜ¶ª[0].w®l_¶aûs[i]].
y1
;

202 
š‹rSeùPošt
 = 
	`ÿlcIÁ”SeùiÚ
(-
¦İe_å
, -
¦İe_w1w2
, 
dl
, 
dw
);

204 
z_š‹r
 = 
heightBS
 + (
heightUE
 - heightBSè* (
š‹rSeùPošt
.
dY
 - 
coBS
.dYè/ (
coUE
.dY - coBS.dY);

207 ià((
	`abs
(
¦İe_å
è> 
•sÚ
è&& (abs(¦İe_åè< 
num”ic_lim™s
<>::
	`šfš™y
Ğ)è&& (abs(
¦İe_w1w2
) ==‚umeric_limits<>::infinity( ))){

213 
š‹rSeùPošt
.
dY
 = 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
y1
;

214 
š‹rSeùPošt
.
dX
 = 
coBS
.dX + (
coUE
.dX - coBS.dXè* (
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
y1
 - coBS.
dY
) / (coUE.dY - coBS.dY);

215 
z_š‹r
 = 
heightBS
 + (
heightUE
 - heightBSè* (
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
y1
 - 
coBS
.
dY
è/ (
coUE
.dY - coBS.dY);

217 ià((
	`abs
(
¦İe_å
è=ğ
num”ic_lim™s
<>::
	`šfš™y
Ğ)è&& (abs(
¦İe_w1w2
è> 
•sÚ
) && (abs(slope_w1w2) <‚umeric_limits<>::infinity( ))){

225 
š‹rSeùPošt
.
dY
 = 
coBS
.dY;

226 
š‹rSeùPošt
.
dX
 = (š‹rSeùPošt.
dY
 - (
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
y1
 - floÜ¶ª[0].w®ls[æoÜ¶ª[0].w®l_¶aûs[i]].
x1
 / 
¦İe_w1w2
)) * slope_w1w2;

227 
z_š‹r
 = 
heightBS
 + (
heightUE
 - heightBSè* (
š‹rSeùPošt
.
dX
 - 
coBS
.dXè/ (
coUE
.dX - coBS.dX);

229 ià((
	`abs
(
¦İe_å
è> 
•sÚ
è&& (abs(¦İe_åè< 
num”ic_lim™s
<>::
	`šfš™y
Ğ)è&& (abs(
¦İe_w1w2
) <=ƒpsilon) && (abs(slope_w1w2) >= 0)){

235 
š‹rSeùPošt
.
dX
 = 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
x1
;

236 
š‹rSeùPošt
.
dY
 = (
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
x1
 - (
coUE
.
dX
 - 
¦İe_å
 * coUE.dY)) / slope_fp;

237 
z_š‹r
 = 
heightBS
 + (
heightUE
 - heightBSè* (
š‹rSeùPošt
.
dY
 - 
coBS
.dYè/ (
coUE
.dY - coBS.dY);

239 ià((
	`abs
(
¦İe_å
è<ğ
•sÚ
è&& (abs(¦İe_åè>ğ0è&& (abs(
¦İe_w1w2
è>ƒpsÚè&& (abs(¦İe_w1w2è< 
num”ic_lim™s
<>::
	`šfš™y
( ))){

245 
š‹rSeùPošt
.
dX
 = 
coUE
.dX;

246 
š‹rSeùPošt
.
dY
 = (
coUE
.
dX
 - (
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
x1
 - 
¦İe_w1w2
 * floÜ¶ª[0].w®ls[æoÜ¶ª[0].w®l_¶aûs[i]].
y1
)) / slope_w1w2;

247 
z_š‹r
 = 
heightBS
 + (
heightUE
 - heightBSè* (
š‹rSeùPošt
.
dY
 - 
coBS
.dYè/ (
coUE
.dY - coBS.dY);

249 ià((
	`abs
(
¦İe_å
è<ğ
•sÚ
è&& (abs(¦İe_åè>ğ0è&& (abs(
¦İe_w1w2
è=ğ
num”ic_lim™s
<>::
	`šfš™y
( ))){

250 
š‹rSeùPošt
.
dX
 = 
coUE
.dX;

251 
š‹rSeùPošt
.
dY
 = 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
y1
;

252 
z_š‹r
 = 
heightBS
 + (
heightUE
 - heightBSè* (
š‹rSeùPošt
.
dY
 - 
coBS
.dYè/ (
coUE
.dY - coBS.dY);

254 ià((
	`abs
(
¦İe_å
è=ğ
num”ic_lim™s
<>::
	`šfš™y
Ğ)è&& (abs(
¦İe_w1w2
è<ğ
•sÚ
) && (abs(slope_w1w2) >= 0)){

257 
š‹rSeùPošt
.
dX
 = 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
x1
;

258 
š‹rSeùPošt
.
dY
 = 
coUE
.dY;

259 
z_š‹r
 = 
heightBS
 + (
heightUE
 - heightBSè* (
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
x1
 - 
coBS
.
dX
è/ (
coUE
.dX - coBS.dX);

264 ià(
coUE
.
dX
 > 
coBS
.dX){

265 
x_max_å
 = 
coUE
.
dX
;

266 
x_mš_å
 = 
coBS
.
dX
;

269 
x_max_å
 = 
coBS
.
dX
;

270 
x_mš_å
 = 
coUE
.
dX
;

273 ià(
coUE
.
dY
 > 
coBS
.dY){

274 
y_max_å
 = 
coUE
.
dY
;

275 
y_mš_å
 = 
coBS
.
dY
;

278 
y_max_å
 = 
coBS
.
dY
;

279 
y_mš_å
 = 
coUE
.
dY
;

282 ià(((
x_max_å
 - 
š‹rSeùPošt
.
dX
 - 
•sÚ
 > 0è|| ((
	`abs
(x_max_fp - interSectPoint.dX) <=ƒpsilon) && (abs(x_max_fp - interSectPoint.dX)) >= 0))

283 &&((
x_mš_å
 - 
š‹rSeùPošt
.
dX
 + 
•sÚ
<0è|| ((
	`abs
(x_min_fp - interSectPoint.dX) <=ƒpsilon) && (abs(x_min_fp - interSectPoint.dX)) >= 0))

284 &&((
y_max_å
 - 
š‹rSeùPošt
.
dY
 - 
•sÚ
>0è|| ((
	`abs
(y_max_fp - interSectPoint.dY) <=ƒpsilon) && (abs(y_max_fp - interSectPoint.dY)) >= 0))

285 &&((
y_mš_å
 - 
š‹rSeùPošt
.
dY
 + 
•sÚ
<0è|| ((
	`abs
(y_min_fp - interSectPoint.dY) <=ƒpsilon) && (abs(y_min_fp - interSectPoint.dY)) >= 0)))

287 
dim1_l
 = 1;

290 
dim1_l
 = 0;

292 ià(
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
x1
 - floÜ¶ª[0].w®ls[æoÜ¶ª[0].w®l_¶aûs[i]].
x2
 > 
•sÚ
){

293 
x_w_max
 = 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
x1
;

294 
x_w_mš
 = 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
x2
;

297 
x_w_max
 = 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
x2
;

298 
x_w_mš
 = 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
x1
;

301 ià(
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
y1
 - floÜ¶ª[0].w®ls[æoÜ¶ª[0].w®l_¶aûs[i]].
y2
 > 
•sÚ
){

302 
y_w_max
 = 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
y1
;

303 
y_w_mš
 = 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
y2
;

306 
y_w_max
 = 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
y2
;

307 
y_w_mš
 = 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
y1
;

310 ià(((
x_w_max
 - 
š‹rSeùPošt
.
dX
 - 
•sÚ
 > 0è|| ((
	`abs
(x_w_max - interSectPoint.dX) <=ƒpsilon) && (abs(x_w_max - interSectPoint.dX)) >= 0))

311 &&((
x_w_mš
 - 
š‹rSeùPošt
.
dX
 + 
•sÚ
<0è|| ((
	`abs
(x_w_min - interSectPoint.dX) <=ƒpsilon) && (abs(x_w_min - interSectPoint.dX)) >= 0))

312 &&((
y_w_max
 - 
š‹rSeùPošt
.
dY
 - 
•sÚ
>0è|| ((
	`abs
(y_w_max - interSectPoint.dY) <=ƒpsilon) && (abs(y_w_max - interSectPoint.dY)) >= 0))

313 &&((
y_w_mš
 - 
š‹rSeùPošt
.
dY
 + 
•sÚ
<0è|| ((
	`abs
(y_w_min - interSectPoint.dY) <=ƒpsilon) && (abs(y_w_min - interSectPoint.dY)) >= 0)))

315 
dim1_w
 = 1;

318 
dim1_w
 = 0;

320 
dim1
 = 
dim1_l
 & 
dim1_w
;

322 ià(
dim1
){

326 ià(
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
z3
 - floÜ¶ª[0].w®ls[æoÜ¶ª[0].w®l_¶aûs[i]].
z1
 > 
•sÚ
)

327 iàĞ((
z_š‹r
 - 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
z1
 - 
•sÚ
 > 0)

328 || ((
	`abs
(
z_š‹r
 - 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
z1
è<ğ
•sÚ
)

329 && (
	`abs
(
z_š‹r
 - 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
z1
) >= 0)))

330 && ((
z_š‹r
 - 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
z3
 + 
•sÚ
 < 0)

331 || ((
	`abs
(
z_š‹r
 - 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
z3
è<ğ
•sÚ
)

332 && (
	`abs
(
z_š‹r
 - 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
z3
) >= 0))) )

333 
dim2
 = 1;

335 
dim2
 = 0;

337 iàĞ((
z_š‹r
 - 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
z3
 - 
•sÚ
 > 0)

338 || ((
	`abs
(
z_š‹r
 - 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
z3
è<ğ
•sÚ
)

339 && (
	`abs
(
z_š‹r
 - 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
z3
) >= 0)))

340 && ((
z_š‹r
 - 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
z1
 + 
•sÚ
 < 0)

341 || ((
	`abs
(
z_š‹r
 - 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
z1
è<ğ
•sÚ
)

342 && (
	`abs
(
z_š‹r
 - 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
w®l_¶aûs
[
i
]].
z1
) >= 0))) )

343 
dim2
 = 1;

345 
dim2
 = 0;

348 
dim2
 = 0;

350 ià(
dim1
 && 
dim2
){

351 
w®ls_OI
[
üos£d_w®ls
] = 
æoÜ¶ª
[0].
w®ls
[
i
];

352 
š‹rs
[
üos£d_w®ls
] = 
š‹rSeùPošt
;

353 
üos£d_w®ls
 = crossed_walls + 1;

363 
mšHeight
,

364 
maxHeight
;

366 
å_æoÜ1
 = 0,

367 
å_æoÜ2
 = 0,

368 
üos£d_æoÜs
 = 0,

369 
šdexCros£dFloÜ
[6];

371 ià(
heightUE
 - 
heightBS
 > 0){

372 
maxHeight
 = 
heightUE
;

373 
mšHeight
 = 
heightBS
;

376 
maxHeight
 = 
heightBS
;

377 
mšHeight
 = 
heightUE
;

380 
i
=0; i<
æoÜ¶ª
[0].
tÙ®FloÜs
; i++){

381 ià((
mšHeight
 >ğ
æoÜ¶ª
[0].
accumuÏ‹dHeight
[
i
]-æoÜ¶ª[0].
w®lHeight
) && (minHeight < floorplan[0].accumulatedHeight[i]))

382 
å_æoÜ1
 = 
i
;

384 ià((
maxHeight
 >ğ
æoÜ¶ª
[0].
accumuÏ‹dHeight
[
i
]-æoÜ¶ª[0].
w®lHeight
) && (maxHeight < floorplan[0].accumulatedHeight[i]))

385 
å_æoÜ2
 = 
i
;

386 ià((
maxHeight
 >ğ
æoÜ¶ª
[0].
accumuÏ‹dHeight
[
i
]-æoÜ¶ª[0].
w®lHeight
) && (maxHeight > floorplan[0].accumulatedHeight[i]))

387 
å_æoÜ2
 = 
i
+1;

390 
CoÜd
 
š‹rSeùW®l
;

392 
couÁCrossX
 = 0,

393 
šdexX
[100],

394 
couÁCrossY
 = 0,

395 
šdexY
[100];

397 
t
, 
c
=0;

398 
v”tx
[300], 
v”ty
[300];

399 
üos£d_æoÜs
 = 
	`abs
(
å_æoÜ2
-
å_æoÜ1
);

400 
t
=0;<
üos£d_æoÜs
;++){

401 
šdexCros£dFloÜ
[
t
] = 
å_æoÜ1
 +;

402 
z_š‹r
 = 
æoÜ¶ª
[0].
accumuÏ‹dHeight
[
šdexCros£dFloÜ
[
t
]];

403 
š‹rSeùPošt
.
dX
 = 
coBS
.dX + (
coUE
.dX - coBS.dXè* (
z_š‹r
 - 
heightBS
è/ (
heightUE
 - heightBS);

404 
š‹rSeùPošt
.
dY
 = 
coBS
.dY + (
coUE
.dY - coBS.dYè* (
z_š‹r
 - 
heightBS
è/ (
heightUE
 - heightBS);

406 
i
=0; i<
æoÜ¶ª
[0].
numFloÜs
 && 
c
==0; i++){

407 
j
=0; j<
æoÜ¶ª
[0].
æoÜs
[
i
].
numW®ls
; j++){

408 
v”tx
[
j
] = 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
æoÜs
[
i
].
šdexW®ls
[j]].
x1
;

409 
v”ty
[
j
] = 
æoÜ¶ª
[0].
w®ls
[æoÜ¶ª[0].
æoÜs
[
i
].
šdexW®ls
[j]].
y1
;

411 
c
 = 
	`poštInPŞy
(
æoÜ¶ª
[0].
æoÜs
[
i
].
numW®ls
, &
v”tx
[0], &
v”ty
[0], 
š‹rSeùPošt
.
dX
, iÁ”SeùPošt.
dY
);

415 
æoÜP’eLoss
;

416 ià(
c
 == 1){

417 ià(
üos£d_æoÜs
 < 2)

418 
üos£d_æoÜs
 = 1;

419 
æoÜP’eLoss
 = 
	`pow
((
üos£d_æoÜs
), (üos£d_æoÜs+2.0)/(üos£d_æoÜs+1.0è- 0.46è* 
æoÜ¶ª
[0].
	`äequ’cyPlIÁ”p
(3, 
C¬rF»q
);

420 
³ÃLoss
 =…’eLos + 
æoÜP’eLoss
;

422 
i
=0; i<
üos£d_w®ls
; i++){

423 
³ÃLoss
 =…’eLos + 
æoÜ¶ª
[0].
	`äequ’cyPlIÁ”p
(
w®ls_OI
[
i
].
w®lTy³
, 
C¬rF»q
);

425  
³ÃLoss
;

426 
	}
}

	@/home/lyang3/work/src_son/runWorld/mobility/ConstantPosition.cpp

2 
	~"CÚ¡ªtPos™iÚ.h
"

4 
	gCÚ¡ªtPos™iÚ
::
	$CÚ¡ªtPos™iÚ
()

6 
	`S‘Mob™yMod–
 (
Mob™y
::
CONSTANT_POSITION
);

7 
	`S‘AbsŞu‹Pos™iÚ
 (
NULL
);

8 
	}
}

10 
	gCÚ¡ªtPos™iÚ
::~
	$CÚ¡ªtPos™iÚ
()

12 
	`D–‘eAbsŞu‹Pos™iÚ
 ();

13 
	}
}

16 
	gCÚ¡ªtPos™iÚ
::
	$Upd©ePos™iÚ
 (
time
)

17 {
	}
}

	@/home/lyang3/work/src_son/runWorld/mobility/ConstantPosition.h

1 #iâdeà
CONSTANTPOSITION_H_


2 
	#CONSTANTPOSITION_H_


	)

4 
	~"Mob™y.h
"

6 şas 
	cCÚ¡ªtPos™iÚ
: 
public
 
Mob™y
 {

7 
public
:

8 
CÚ¡ªtPos™iÚ
();

9 
	mvœtu®
 ~
CÚ¡ªtPos™iÚ
();

11 
vœtu®
 
Upd©ePos™iÚ
 (
time
);

	@/home/lyang3/work/src_son/runWorld/mobility/Mobility.cpp

3 
	~"Mob™y.h
"

4 
	~"../compÚ’tMªag”s/N‘wÜkMªag”.h
"

5 
	~"../ÃtwÜkTİŞogy/C–l.h
"

6 
	~"../lßd-·¿m‘”s.h
"

8 
	gMob™y
::
	$Mob™y
()

10 
m_AbsŞu‹Pos™iÚ
 = 
NULL
;

11 
	}
}

13 
	gMob™y
::~
	$Mob™y
()

15 
d–‘e
 
m_AbsŞu‹Pos™iÚ
;

16 
	}
}

19 
	gMob™y
::
	$S‘NodeID
 (
id
)

21 
m_nodeID
 = 
id
;

22 
	}
}

25 
	gMob™y
::
	$G‘NodeID
 () const

27  
m_nodeID
;

28 
	}
}

31 
	gMob™y
::
	$S‘Mob™yMod–
(
Mob™yMod–
 
mod–
)

33 
m_mob™yMod–
 = 
mod–
;

34 
	}
}

36 
	gMob™y
::
Mob™yMod–


37 
Mob™y
::
	$G‘Mob™yMod–
() const

39  
m_mob™yMod–
;

40 
	}
}

43 
	gMob™y
::
	$S‘AbsŞu‹Pos™iÚ
 (
C¬‹sŸnCoÜdš©es
 *
pos™iÚ
)

45 ià(
pos™iÚ
 =ğ
NULL
)

47 
m_AbsŞu‹Pos™iÚ
 = 
NULL
;

51 ià(
m_AbsŞu‹Pos™iÚ
 =ğ
NULL
)

53 
m_AbsŞu‹Pos™iÚ
 = 
Ãw
 
	`C¬‹sŸnCoÜdš©es
 ();

56 
m_AbsŞu‹Pos™iÚ
->
	`S‘CoÜdš©eX
 (
pos™iÚ
->
	`G‘CoÜdš©eX
 ());

57 
m_AbsŞu‹Pos™iÚ
->
	`S‘CoÜdš©eY
 (
pos™iÚ
->
	`G‘CoÜdš©eY
 ());

58 
	}
}

60 
C¬‹sŸnCoÜdš©es
*

61 
	gMob™y
::
	$G‘AbsŞu‹Pos™iÚ
 () const

63  
m_AbsŞu‹Pos™iÚ
;

64 
	}
}

67 
	gMob™y
::
	$D–‘eAbsŞu‹Pos™iÚ
 ()

69 
d–‘e
 
m_AbsŞu‹Pos™iÚ
;

70 
	}
}

73 
	gMob™y
::
	$S‘S³ed
 (
¥“d
)

75 
m_¥“d
 = 
¥“d
;

76 
	}
}

79 
	gMob™y
::
	$G‘S³ed
 () const

81  
m_¥“d
;

82 
	}
}

85 
	gMob™y
::
	$S‘S³edDœeùiÚ
 (
¥“dDœeùiÚ
)

87 
m_¥“dDœeùiÚ
 = 
¥“dDœeùiÚ
;

88 
	}
}

91 
	gMob™y
::
	$G‘S³edDœeùiÚ
 () const

93  
m_¥“dDœeùiÚ
;

94 
	}
}

97 
	gMob™y
::
	$S‘Pos™iÚLa¡Upd©e
 (
time
)

99 
m_pos™iÚLa¡Upd©e
 = 
time
;

100 
	}
}

103 
	gMob™y
::
	$G‘Pos™iÚLa¡Upd©e
 () const

105  
m_pos™iÚLa¡Upd©e
;

106 
	}
}

109 
	gMob™y
::
	$S‘Hªdov”
 (
boŞ
 
hªdov”
)

111 
m_hªdov”
 = 
hªdov”
;

112 
	}
}

114 
boŞ


115 
	gMob™y
::
	$G‘Hªdov”
 () const

117  
m_hªdov”
;

118 
	}
}

121 
	gMob™y
::
	$S‘La¡Hªdov”Time
 (
Ï¡HOtime
)

123 
m_hªdov”La¡Run
 = 
Ï¡HOtime
;

124 
	}
}

127 
	gMob™y
::
	$G‘La¡Hªdov”Time
 () const

129  
m_hªdov”La¡Run
;

130 
	}
}

133 
	gMob™y
::
	$G‘TİŞogyBÜd”
 ()

135 
nbC–l
 = 
N‘wÜkMªag”
::
	`In™
()->
	`G‘NbC–l
();

137 
nbC–l
)

140  (
N‘wÜkMªag”
::
	`In™
()->
	`G‘C–lByID
 (0)->
	`G‘Radius
 () * 1000);

143  ((2.6 * 
N‘wÜkMªag”
::
	`In™
()->
	`G‘C–lByID
 (0)->
	`G‘Radius
 ()) * 1000);

146  ((4. * 
N‘wÜkMªag”
::
	`In™
()->
	`G‘C–lByID
 (0)->
	`G‘Radius
 ()) * 1000);

152 
	}
}

	@/home/lyang3/work/src_son/runWorld/mobility/Mobility.h

1 #iâdeà
MOBILITY_H_


2 
	#MOBILITY_H_


	)

4 
	~"../cÜe/ÿ¹esŸnCoodrdš©es/C¬‹sŸnCoÜdš©es.h
"

5 
	~<¡dio.h
>

6 
	~<¡dlib.h
>

8 şas 
	cMob™y
 {

9 
	mpublic
:

10 
Mob™y
();

11 
	mvœtu®
 ~
Mob™y
();

13 
	eMob™yMod–
 {

14 
	mCONSTANT_POSITION
,

15 
	mRANDOM_DIRECTION
,

16 
	mRANDOM_WALK
,

17 
	mRANDOM_WAYPOINT


21 
S‘NodeID
 (
id
);

23 
	$G‘NodeID
 () const;

26 
	`S‘Mob™yMod–
(
Mob™yMod–
 
mod–
);

27 
Mob™y
::
Mob™yMod–


28 
	$G‘Mob™yMod–
() const;

31 
	`S‘AbsŞu‹Pos™iÚ
 (
C¬‹sŸnCoÜdš©es
 *
pos™iÚ
);

32 
C¬‹sŸnCoÜdš©es
*

33 
	$G‘AbsŞu‹Pos™iÚ
 () const;

35 
	`D–‘eAbsŞu‹Pos™iÚ
 ();

37 
vœtu®
 
	`Upd©ePos™iÚ
 (
time
) = 0;

40 
	`S‘S³ed
 (
¥“d
);

42 
	$G‘S³ed
 () const;

44 
	`S‘S³edDœeùiÚ
 (
¥“dDœeùiÚ
);

46 
	$G‘S³edDœeùiÚ
 () const;

49 
	`S‘Pos™iÚLa¡Upd©e
 (
time
);

51 
	$G‘Pos™iÚLa¡Upd©e
 () const;

54 
	`S‘Hªdov”
 (
boŞ
 
hªdov”
);

55 
boŞ


56 
	$G‘Hªdov”
 () const;

58 
	`S‘La¡Hªdov”Time
 (
Ï¡HOtime
);

60 
	$G‘La¡Hªdov”Time
 () const;

63 
	`G‘TİŞogyBÜd”
 ();

66 
´iv©e
:

67 
m_nodeID
;

69 
Mob™yMod–
 
m_mob™yMod–
;

71 
C¬‹sŸnCoÜdš©es
 *
m_AbsŞu‹Pos™iÚ
;

72 
m_¥“d
;

73 
m_¥“dDœeùiÚ
;

74 
m_pos™iÚLa¡Upd©e
;

75 
boŞ
 
m_hªdov”
;

76 
m_hªdov”La¡Run
;

77 
	}
};

	@/home/lyang3/work/src_son/runWorld/mobility/RandomDirection.cpp

4 
	~"RªdomDœeùiÚ.h
"

5 
	~"../compÚ’tMªag”s/N‘wÜkMªag”.h
"

6 
	~"../deviû/G©eway.h
"

7 
	~"../deviû/ENodeB.h
"

8 
	~"../deviû/U£rEqum’t.h
"

9 
	~"../lßd-·¿m‘”s.h
"

11 
	gRªdomDœeùiÚ
::
	$RªdomDœeùiÚ
()

13 
	`S‘Mob™yMod–
(
Mob™y
::
RANDOM_DIRECTION
);

14 
	`S‘S³ed
 (0);

15 
	`S‘S³edDœeùiÚ
 (0.0);

16 
	`S‘Pos™iÚLa¡Upd©e
 (0.0);

17 
	`S‘Hªdov”
 (
çl£
);

18 
	`S‘La¡Hªdov”Time
 (0.0);

19 
	`S‘AbsŞu‹Pos™iÚ
 (
NULL
);

20 
	}
}

22 
	gRªdomDœeùiÚ
::~
	$RªdomDœeùiÚ
()

24 
	`D–‘eAbsŞu‹Pos™iÚ
 ();

25 
	}
}

28 
	gRªdomDœeùiÚ
::
	$Upd©ePos™iÚ
 (
time
)

30 #ifdeà
MOBILITY_DEBUG


31 
¡d
::
cout
 << "\ˆSTART MOBILITY MODEL fÜ "<< 
	`G‘NodeID
 (è<< std::
’dl
;

34 ià(
	`G‘S³ed
 () == 0)

36 #ifdeà
MOBILITY_DEBUG


37 
¡d
::
cout
 << "\t\ˆ¥“d = 0 -->…os™iÚ ha nÙ b“Àupd©ed!"<< std::
’dl
;

42 
timeIÁ”v®
 = 
time
 - 
	`G‘Pos™iÚLa¡Upd©e
 ();

44 
U£rEqum’t
 *
thisNode
 = 
N‘wÜkMªag”
::
	`In™
 ()->
	`G‘U£rEqum’tByID
 (
	`G‘NodeID
 ());

45 
C–l
 *
thisC–l
 = 
thisNode
->
	`G‘C–l
 ();

48 
N‘wÜkNode
 *
rg‘Node
 = 
thisNode
->
	`G‘T¬g‘Node
 ();

50 #ifdeà
MOBILITY_DEBUG


51 
¡d
::
cout
 << "MOBILITY_DEBUG: U£¸ID: " << 
	`G‘NodeID
 ()

53 
N‘wÜkMªag”
::
	`In™
()->
	`G‘C–lIDFromPos™iÚ
 (
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eX
(),

54 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eY
())

55 << "\n\ˆIn™ŸÈPos™iÚ (X): " << 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eX
()

56 << "\n\ˆIn™ŸÈPos™iÚ (Y): " << 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eY
()

57 << "\n\ˆS³ed: " << 
	`G‘S³ed
()

58 << "\n\ˆS³ed DœeùiÚ: " << 
	`G‘S³edDœeùiÚ
()

59 << "\n\ˆTimLa¡ Upd©e: " << 
	`G‘Pos™iÚLa¡Upd©e
()

60 << "\n\ˆTimIÁ”v®: " << 
timeIÁ”v®


61 << 
¡d
::
’dl
;

63 #ifdeà
MOBILITY_DEBUG_TAB


64 
¡d
::
cout
 << 
	`G‘NodeID
 () << ""

65 << 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eX
() << " "

66 << 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eY
() << " "

67 << 
	`G‘S³ed
() << " "

68 << 
	`G‘S³edDœeùiÚ
() << " "

69 << 
	`G‘Pos™iÚLa¡Upd©e
() << " "

70 << 
timeIÁ”v®
 << " "

71 << 
¡d
::
’dl
;

74 
shiá
 = 
timeIÁ”v®
 * (
	`G‘S³ed
()*(1000.0/3600.0));

76 
shiá_y
 =

77 
shiá
 * 
	`sš
 (
	`G‘S³edDœeùiÚ
());

78 
shiá_x
 =

79 
shiá
 * 
	`cos
 (
	`G‘S³edDœeùiÚ
());

81 
C¬‹sŸnCoÜdš©es
 *
ÃwPos™iÚ
 =

82 
Ãw
 
	`C¬‹sŸnCoÜdš©es
(
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eX
()+
shiá_x
,

83 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eY
()+
shiá_y
);

86 
C¬‹sŸnCoÜdš©es
 *
ENodeBPos™iÚ
 = 
rg‘Node
->
	`G‘Mob™yMod–
 ()->
	`G‘AbsŞu‹Pos™iÚ
 ();

88 cÚ¡ 
pi
 = 3.1415926;

89 
azimut
 = 
ÃwPos™iÚ
->
	`G‘PŞ¬Azimut
 (
ENodeBPos™iÚ
);

90 
ÃwDi¡ªûFromTheENodeB
 = 
ÃwPos™iÚ
->
	`G‘Di¡ªû
 (
ENodeBPos™iÚ
);

93 ià(
ÃwDi¡ªûFromTheENodeB
 <ğ(
thisC–l
->
	`G‘MšDi¡ªû
() * 1000))

112 ià(
ÃwDi¡ªûFromTheENodeB
 > (
thisC–l
->
	`G‘Radius
()*1000))

114 ià(
	`G‘Hªdov”
()=ğ
çl£
)

117 
C¬‹sŸnCoÜdš©es
 *
CÜ»ùiÚ
 =

118 
Ãw
 
	`C¬‹sŸnCoÜdš©es
 ((
ÃwDi¡ªûFromTheENodeB
 - (
thisC–l
->
	`G‘Radius
()*1000)è* 
	`cos
(
azimut
),

119 (
ÃwDi¡ªûFromTheENodeB
 - (
thisC–l
->
	`G‘Radius
()*1000)è* 
	`sš
(
azimut
));

121 
ÃwPos™iÚ
->
	`S‘CoÜdš©eX
ÒewPos™iÚ->
	`G‘CoÜdš©eX
(è- 
CÜ»ùiÚ
->GetCoordinateX());

122 
ÃwPos™iÚ
->
	`S‘CoÜdš©eY
ÒewPos™iÚ->
	`G‘CoÜdš©eY
(è- 
CÜ»ùiÚ
->GetCoordinateY());

124 
¥“dDœeùiÚ
 = ()(
	`¿nd
() %360) * ((2*3.14)/360);

125 
	`S‘S³edDœeùiÚ
(
¥“dDœeùiÚ
);

127 
d–‘e
 
CÜ»ùiÚ
;

129 ià(
ÃwPos™iÚ
->
	`G‘Di¡ªû
(0.0, 0.0è>ğ
	`G‘TİŞogyBÜd”
 ())

131 
C¬‹sŸnCoÜdš©es
 *
CÜ»ùiÚ
 =

132 
Ãw
 
	`C¬‹sŸnCoÜdš©es
 ((
ÃwDi¡ªûFromTheENodeB
 - (
thisC–l
->
	`G‘Radius
()*1000)è* 
	`cos
(
azimut
),

133 (
ÃwDi¡ªûFromTheENodeB
 - (
thisC–l
->
	`G‘Radius
()*1000)è* 
	`sš
(
azimut
));

135 
ÃwPos™iÚ
->
	`S‘CoÜdš©eX
ÒewPos™iÚ->
	`G‘CoÜdš©eX
(è- 
CÜ»ùiÚ
->GetCoordinateX());

136 
ÃwPos™iÚ
->
	`S‘CoÜdš©eY
ÒewPos™iÚ->
	`G‘CoÜdš©eY
(è- 
CÜ»ùiÚ
->GetCoordinateY());

138 
¥“dDœeùiÚ
 = ()(
	`¿nd
() %360) * ((2*3.14)/360);

139 
	`S‘S³edDœeùiÚ
(
¥“dDœeùiÚ
);

141 
d–‘e
 
CÜ»ùiÚ
;

145 
	`S‘AbsŞu‹Pos™iÚ
(
ÃwPos™iÚ
);

146 
	`S‘Pos™iÚLa¡Upd©e
 (
time
);

148 #ifdeà
MOBILITY_DEBUG


149 
¡d
::
cout
 << "\n\ˆFš® Pos™iÚ (X): " << 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eX
()

150 << "\n\ˆFš® Pos™iÚ (Y): " << 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eY
()

151 << 
¡d
::
’dl
;

153 #ifdeà
MOBILITY_DEBUG_TAB


154 
¡d
::
cout
 << 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eX
() << " "

155 << 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eY
()

156 << 
¡d
::
’dl
;

159 
d–‘e
 
ÃwPos™iÚ
;

160 
	}
}

	@/home/lyang3/work/src_son/runWorld/mobility/RandomDirection.h

1 #iâdeà
LINEARTRAJECTORY_H_


2 
	#LINEARTRAJECTORY_H_


	)

4 
	~"Mob™y.h
"

6 şas 
	cRªdomDœeùiÚ
 :
public
 
Mob™y
 {

7 
public
:

8 
RªdomDœeùiÚ
();

9 
	mvœtu®
 ~
RªdomDœeùiÚ
();

12 
Upd©ePos™iÚ
 (
time
);

	@/home/lyang3/work/src_son/runWorld/mobility/RandomWalk.cpp

1 
	~"RªdomW®k.h
"

2 
	~"../compÚ’tMªag”s/N‘wÜkMªag”.h
"

3 
	~"../deviû/G©eway.h
"

4 
	~"../deviû/ENodeB.h
"

5 
	~"../deviû/U£rEqum’t.h
"

6 
	~"../lßd-·¿m‘”s.h
"

9 
	gRªdomW®k
::
	$RªdomW®k
()

11 
	`S‘Mob™yMod–
(
Mob™y
::
RANDOM_WALK
);

12 
	`S‘S³ed
 (0);

13 
	`S‘S³edDœeùiÚ
 (0.0);

14 
	`S‘Pos™iÚLa¡Upd©e
 (0.0);

15 
	`S‘Hªdov”
 (
çl£
);

16 
	`S‘La¡Hªdov”Time
 (0.0);

17 
	`S‘AbsŞu‹Pos™iÚ
 (
NULL
);

18 
m_š‹rv®
 = 0.;

19 
m_Ï¡TimeDœeùiÚChªge
 = 0.;

20 
	}
}

22 
	gRªdomW®k
::~
	$RªdomW®k
()

24 
	`D–‘eAbsŞu‹Pos™iÚ
 ();

25 
	}
}

28 
	gRªdomW®k
::
	$Upd©ePos™iÚ
(
time
)

30 #ifdeà
MOBILITY_DEBUG


31 
¡d
::
cout
 << "\ˆSTART MOBILITY MODEL fÜ "<< 
	`G‘NodeID
 (è<< std::
’dl
;

34 ià(
	`G‘S³ed
 () == 0)

36 #ifdeà
MOBILITY_DEBUG


37 
¡d
::
cout
 << "\t\ˆ¥“d = 0 -->…os™iÚ ha nÙ b“Àupd©ed!"<< std::
’dl
;

42 
timeIÁ”v®
 = 
time
 - 
	`G‘Pos™iÚLa¡Upd©e
 ();

44 
U£rEqum’t
 *
thisNode
 = 
N‘wÜkMªag”
::
	`In™
 ()->
	`G‘U£rEqum’tByID
 (
	`G‘NodeID
 ());

45 
C–l
 *
thisC–l
 = 
thisNode
->
	`G‘C–l
 ();

46 
N‘wÜkNode
 *
rg‘Node
 = 
thisNode
->
	`G‘T¬g‘Node
 ();

48 #ifdeà
MOBILITY_DEBUG


49 
¡d
::
cout
 << "MOBILITY_DEBUG: U£¸ID: " << 
	`G‘NodeID
 ()

51 
N‘wÜkMªag”
::
	`In™
()->
	`G‘C–lIDFromPos™iÚ
 (
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eX
(),

52 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eY
())

53 << "\n\ˆIn™ŸÈPos™iÚ (X): " << 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eX
()

54 << "\n\ˆIn™ŸÈPos™iÚ (Y): " << 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eY
()

55 << "\n\ˆS³ed: " << 
	`G‘S³ed
()

56 << "\n\ˆS³ed DœeùiÚ: " << 
	`G‘S³edDœeùiÚ
()

57 << "\n\ˆTimLa¡ Upd©e: " << 
	`G‘Pos™iÚLa¡Upd©e
()

58 << "\n\ˆTimIÁ”v®: " << 
timeIÁ”v®


59 << 
¡d
::
’dl
;

61 #ifdeà
MOBILITY_DEBUG_TAB


62 
¡d
::
cout
 << 
	`G‘NodeID
 () << ""

63 << 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eX
() << " "

64 << 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eY
() << " "

65 << 
	`G‘S³ed
() << " "

66 << 
	`G‘S³edDœeùiÚ
() << " "

67 << 
	`G‘Pos™iÚLa¡Upd©e
() << " "

68 << 
timeIÁ”v®
 << " "

69 << 
¡d
::
’dl
;

72 
shiá
 = 
timeIÁ”v®
 * (
	`G‘S³ed
()*(1000.0/3600.0));

74 
shiá_y
 =

75 
shiá
 * 
	`sš
 (
	`G‘S³edDœeùiÚ
());

76 
shiá_x
 =

77 
shiá
 * 
	`cos
 (
	`G‘S³edDœeùiÚ
());

79 
C¬‹sŸnCoÜdš©es
 *
ÃwPos™iÚ
 =

80 
Ãw
 
	`C¬‹sŸnCoÜdš©es
(
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eX
()+
shiá_x
,

81 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eY
()+
shiá_y
);

83 
C¬‹sŸnCoÜdš©es
 *
ENodeBPos™iÚ
 = 
rg‘Node
->
	`G‘Mob™yMod–
 ()->
	`G‘AbsŞu‹Pos™iÚ
 ();

85 cÚ¡ 
pi
 = 3.1415926;

86 
azimut
 = 
ÃwPos™iÚ
->
	`G‘PŞ¬Azimut
 (
ENodeBPos™iÚ
);

87 
ÃwDi¡ªûFromTheENodeB
 = 
ÃwPos™iÚ
->
	`G‘Di¡ªû
 (
ENodeBPos™iÚ
);

89 ià(
ÃwDi¡ªûFromTheENodeB
 <ğ(
thisC–l
->
	`G‘MšDi¡ªû
() * 1000))

91 
C¬‹sŸnCoÜdš©es
 *
CÜ»ùiÚ
 =

92 
Ãw
 
	`C¬‹sŸnCoÜdš©es
 (((
thisC–l
->
	`G‘MšDi¡ªû
()*1000è- 
ÃwDi¡ªûFromTheENodeB
è* 
	`cos
(
azimut
),

93 ((
thisC–l
->
	`G‘MšDi¡ªû
()*1000è- 
ÃwDi¡ªûFromTheENodeB
è* 
	`sš
(
azimut
));

95 
ÃwPos™iÚ
->
	`S‘CoÜdš©eX
ÒewPos™iÚ->
	`G‘CoÜdš©eX
(è+ 
CÜ»ùiÚ
->GetCoordinateX());

96 
ÃwPos™iÚ
->
	`S‘CoÜdš©eY
ÒewPos™iÚ->
	`G‘CoÜdš©eY
(è+ 
CÜ»ùiÚ
->GetCoordinateY());

98 ià((
azimut
 > 
	`G‘S³edDœeùiÚ
 ()-
pi
/2) && (azimut < GetSpeedDirection ()+pi/2))

100 
¥“dDœeùiÚ
 = ()(
	`¿nd
() %360) * ((2*3.14)/360);

101 
	`S‘S³edDœeùiÚ
(
¥“dDœeùiÚ
);

104 
d–‘e
 
CÜ»ùiÚ
;

106 ià(
ÃwDi¡ªûFromTheENodeB
 > (
thisC–l
->
	`G‘Radius
()*1000))

108 ià(
	`G‘Hªdov”
()=ğ
çl£
)

111 
C¬‹sŸnCoÜdš©es
 *
CÜ»ùiÚ
 =

112 
Ãw
 
	`C¬‹sŸnCoÜdš©es
 ((
ÃwDi¡ªûFromTheENodeB
 - (
thisC–l
->
	`G‘Radius
()*1000)è* 
	`cos
(
azimut
),

113 (
ÃwDi¡ªûFromTheENodeB
 - (
thisC–l
->
	`G‘Radius
()*1000)è* 
	`sš
(
azimut
));

115 
ÃwPos™iÚ
->
	`S‘CoÜdš©eX
ÒewPos™iÚ->
	`G‘CoÜdš©eX
(è- 
CÜ»ùiÚ
->GetCoordinateX());

116 
ÃwPos™iÚ
->
	`S‘CoÜdš©eY
ÒewPos™iÚ->
	`G‘CoÜdš©eY
(è- 
CÜ»ùiÚ
->GetCoordinateY());

118 
¥“dDœeùiÚ
 = ()(
	`¿nd
() %360) * ((2*3.14)/360);

119 
	`S‘S³edDœeùiÚ
(
¥“dDœeùiÚ
);

121 
d–‘e
 
CÜ»ùiÚ
;

123 ià(
ÃwPos™iÚ
->
	`G‘Di¡ªû
(0.0, 0.0è>ğ
	`G‘TİŞogyBÜd”
 ())

125 
C¬‹sŸnCoÜdš©es
 *
CÜ»ùiÚ
 =

126 
Ãw
 
	`C¬‹sŸnCoÜdš©es
 ((
ÃwDi¡ªûFromTheENodeB
 - (
thisC–l
->
	`G‘Radius
()*1000)è* 
	`cos
(
azimut
),

127 (
ÃwDi¡ªûFromTheENodeB
 - (
thisC–l
->
	`G‘Radius
()*1000)è* 
	`sš
(
azimut
));

129 
ÃwPos™iÚ
->
	`S‘CoÜdš©eX
ÒewPos™iÚ->
	`G‘CoÜdš©eX
(è- 
CÜ»ùiÚ
->GetCoordinateX());

130 
ÃwPos™iÚ
->
	`S‘CoÜdš©eY
ÒewPos™iÚ->
	`G‘CoÜdš©eY
(è- 
CÜ»ùiÚ
->GetCoordinateY());

132 
¥“dDœeùiÚ
 = ()(
	`¿nd
() %360) * ((2*3.14)/360);

133 
	`S‘S³edDœeùiÚ
(
¥“dDœeùiÚ
);

135 
d–‘e
 
CÜ»ùiÚ
;

139 
	`S‘AbsŞu‹Pos™iÚ
(
ÃwPos™iÚ
);

140 
	`S‘Pos™iÚLa¡Upd©e
 (
time
);

142 #ifdeà
MOBILITY_DEBUG


143 
¡d
::
cout
 << "\n\ˆFš® Pos™iÚ (X): " << 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eX
()

144 << "\n\ˆFš® Pos™iÚ (Y): " << 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eY
()

145 << 
¡d
::
’dl
;

147 #ifdeà
MOBILITY_DEBUG_TAB


148 
¡d
::
cout
 << 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eX
() << " "

149 << 
	`G‘AbsŞu‹Pos™iÚ
()->
	`G‘CoÜdš©eY
()

150 << 
¡d
::
’dl
;

153 
d–‘e
 
ÃwPos™iÚ
;

155 ià(
time
 - 
m_Ï¡TimeDœeùiÚChªge
 >ğ
m_š‹rv®
)

157 
¥“dDœeùiÚ
 = ()(
	`¿nd
() %360) * ((2*3.14)/360);

158 
	`S‘S³edDœeùiÚ
(
¥“dDœeùiÚ
);

160 
av”ageDi¡ªû
;

161 
a
;

162 
b
;

164 ià(
	`G‘S³ed
()==3)

166 
av”ageDi¡ªû
 = 200;

168 ià(
	`G‘S³ed
() ==30)

170 
av”ageDi¡ªû
 = 400;

172 ià(
	`G‘S³ed
()==120)

174 
av”ageDi¡ªû
 = 1000;

178 
av”ageDi¡ªû
 = 200;

181 
a
 = 
av”ageDi¡ªû
 - 100;

182 
b
 = 
av”ageDi¡ªû
 + 100;

184 
di¡ªû
 = (è(
	`¿nd
() %1001);

185 
di¡ªû
 = distance/1000;

186 
di¡ªû
 = 
a
 + (di¡ªû * (
b
-a));

188 
m_š‹rv®
 = 
di¡ªû
 / (
	`G‘S³ed
()/3.6);

189 
m_Ï¡TimeDœeùiÚChªge
 = 
time
;

191 
	}
}

	@/home/lyang3/work/src_son/runWorld/mobility/RandomWalk.h

2 #iâdeà
RANDOMWALK_H_


3 
	#RANDOMWALK_H_


	)

5 
	~"Mob™y.h
"

7 şas 
	cRªdomW®k
 :
public
 
Mob™y
 {

8 
public
:

9 
RªdomW®k
();

10 
	mvœtu®
 ~
RªdomW®k
();

13 
Upd©ePos™iÚ
 (
time
);

15 
	m´iv©e
:

16 
m_š‹rv®
;

17 
	mm_Ï¡TimeDœeùiÚChªge
;

	@/home/lyang3/work/src_son/runWorld/mobility/RandomWaypoint.cpp

4 
	~"RªdomWaypošt.h
"

5 
	~"../compÚ’tMªag”s/N‘wÜkMªag”.h
"

6 
	~"../deviû/G©eway.h
"

7 
	~"../deviû/ENodeB.h
"

8 
	~"../deviû/U£rEqum’t.h
"

9 
	~"../lßd-·¿m‘”s.h
"

12 
	gRªdomWaypošt
::
	$RªdomWaypošt
()

14 
	`S‘Mob™yMod–
(
Mob™y
::
RANDOM_WAYPOINT
);

15 
	`S‘S³ed
 (0);

16 
	`S‘S³edDœeùiÚ
 (0.0);

17 
	`S‘Pos™iÚLa¡Upd©e
 (0.0);

18 
	`S‘Hªdov”
 (
çl£
);

19 
	`S‘La¡Hªdov”Time
 (0.0);

20 
	`S‘AbsŞu‹Pos™iÚ
 (
NULL
);

21 
	}
}

23 
	gRªdomWaypošt
::~
	$RªdomWaypošt
()

25 
	`D–‘eAbsŞu‹Pos™iÚ
 ();

26 
	}
}

29 
	gRªdomWaypošt
::
	$Upd©ePos™iÚ
(
time
)

32 
	}
}

	@/home/lyang3/work/src_son/runWorld/mobility/RandomWaypoint.h

2 #iâdeà
RANDOMWAYPOINT_H_


3 
	#RANDOMWAYPOINT_H_


	)

5 
	~"Mob™y.h
"

7 şas 
	cRªdomWaypošt
 :
public
 
Mob™y
{

8 
public
:

9 
RªdomWaypošt
();

10 
	mvœtu®
 ~
RªdomWaypošt
();

13 
Upd©ePos™iÚ
 (
time
);

	@/home/lyang3/work/src_son/runWorld/networkManager.cpp

1 
	~<m©h.h
>

2 
	~"ÃtwÜkMªag”.h
"

5 
	gN‘wÜkMªag”
::
	$N‘wÜkMªag”
()

8 
	}
}

10 
N‘wÜkMªag”
::~
	$N‘wÜkMªag”
()

13 
	}
}

15 
	$sum_ÿp_maüo_1Ïy”_DL
(*
tÙ®C­Max
,*
numRBsMax
,
maxRBs
,
NªtsUeRx
, *
equivChªBe¡_»
, *
equivChªBe¡_im
, 
S·¿m
, 
®pha
, 
b‘a
, *
NItoU£
,
NumBlocksDL
, *
be¡Ind
, 
§m¶esP”RB
, 
maxTÙ®P”AÁTxPow”
, 
maxTxPow”P”RB
, 
mšPwrP”UE
)

17 
n1
,
n2
,
n3
,
off1
,
off£t
,
šds
,
šdsNI
,
tmp
,
ofámp
,
lim™
;

18 
tÙ®C­
,
sumChªPow”
,
S
,
pow”ToU£
;

19 
´eC®cVec
[400];

20 
div1
,
div3
,
div4
,
div6
;

21 
div2
[200];

22 
div5
,
tÙ®C­IÁ
;

24 *
numRBsMax
=0;

25 *
tÙ®C­Max
=0.0;

26 
div1
=1.0/()(
§m¶esP”RB
*
maxRBs
);

31 
n2
=0;‚2<
NumBlocksDL
;‚2++) {

32 
div2
[
n2
]=1.0/(*(
NItoU£
+n2));

35 
n2
=0;‚2<
§m¶esP”RB
*
maxRBs
;‚2++) {

37 
sumChªPow”
=0.0;

38 
šds
=
n2
;

39 
šdsNI
=
	`æoÜ
(
n2
*
NumBlocksDL
*
div1
);

40 
ofámp
=
NªtsUeRx
*
šds
;

41 
n3
=0;‚3<
NªtsUeRx
;‚3++) {

43 
off1
=
n3
+
ofámp
;

44 
sumChªPow”
+ğ*(
equivChªBe¡_»
+
off1
è* (*ÓquivChªBe¡_»+off1)è+ *(
equivChªBe¡_im
+off1) * (*(equivChanBest_im+off1));

47 
S
=
S·¿m
*
sumChªPow”
;

48 
´eC®cVec
[
n2
]=
b‘a
*
S
*
div2
[
šdsNI
];

55 
div3
=()
NumBlocksDL
/()
maxRBs
;

56 
div5
=
maxRBs
/
NumBlocksDL
*
§m¶esP”RB
;

57 
div6
=1.0/()
§m¶esP”RB
*0.125;

59 
n1
=0;‚1<
maxRBs
;‚1++) {

60 
div4
=1.0/()(
n1
+1);

61 
tÙ®C­
=0;

62 
tÙ®C­IÁ
=0;

63 
tmp
=
	`æoÜ
(
n1
*
div3
);

64 
off£t
=(è*(
be¡Ind
+
tmp
)-1;

66 
pow”ToU£
=
maxTÙ®P”AÁTxPow”
*
div4
;

67 ià(
pow”ToU£
>
maxTxPow”P”RB
) {

68 
pow”ToU£
=
maxTxPow”P”RB
;

70 ià(
pow”ToU£
<
mšPwrP”UE
*
div4
) {

71 
pow”ToU£
=
mšPwrP”UE
*
div4
;

74 ià(
off£t
>-1) {

75 
ofámp
=
off£t
*
div5
;

76 
lim™
=
§m¶esP”RB
*(
n1
+1);

77 
n2
=0;‚2<
lim™
;‚2++) {

78 
šds
=
ofámp
+
n2
;

80 
tÙ®C­IÁ
+=
	`log2­´ox
(1.0+
pow”ToU£
*
´eC®cVec
[
šds
]);

84 
tÙ®C­
=()
tÙ®C­IÁ
;

85 
tÙ®C­
=
®pha
*tÙ®C­*
div6
;

89 ià(
tÙ®C­
>*
tÙ®C­Max
) {

90 *
tÙ®C­Max
=
tÙ®C­
;

91 *
numRBsMax
=
n1
+1;

96 
	}
}

98 
	$sum_ÿp_ãmto_1Ïy”_DL
(*
tÙ®C­Max
,*
numRBsMax
,
maxRBs
,
NªtsUeRx
, *
equivChªBe¡_»
, *
equivChªBe¡_im
, 
S·¿m
, 
®pha
, 
b‘a
, *
NItoU£
,
NumBlocksDL
, *
be¡Ind
, 
§m¶esP”RB
, 
maxTÙ®P”AÁTxPow”
, 
maxTxPow”P”RB
, 
mšPwrP”UE
, *
RBsizes
, 
nRBsizes
, 
§m¶esP”Block
)

101 
n1
,
n2
,
n3
,
off1
,
off£t
,
šds
,
šdsNI
,
tmp
,
ofámp
,
lim™
,
n1Ãw
 ;

102 
tÙ®C­
,
sumChªPow”
,
S
,
pow”ToU£
;

103 
´eC®cVec
[400];

104 
div3
,
div4
,
div6
;

105 
div2
;

106 
div5
,
tÙ®C­IÁ
;

109 *
numRBsMax
=0;

110 *
tÙ®C­Max
=0.0;

113 
šdsNI
=-1;

115 
n2
=0;‚2<
§m¶esP”RB
*
maxRBs
;‚2++) {

116 ià((
n2
%
§m¶esP”Block
)==0) {

117 
šdsNI
++;

118 
div2
=1.0/(*(
NItoU£
+
šdsNI
));

120 
sumChªPow”
=0.0;

121 
šds
=
n2
;

123 
ofámp
=
NªtsUeRx
*
šds
;

124 
n3
=0;‚3<
NªtsUeRx
;‚3++) {

126 
off1
=
n3
+
ofámp
;

127 
sumChªPow”
+ğ*(
equivChªBe¡_»
+
off1
è* (*ÓquivChªBe¡_»+off1)è+ *(
equivChªBe¡_im
+off1) * (*(equivChanBest_im+off1));

130 
S
=
S·¿m
*
sumChªPow”
;

131 
´eC®cVec
[
n2
]=
b‘a
*
S
*
div2
;

138 
div3
=()
NumBlocksDL
/()
maxRBs
;

139 
div5
=
maxRBs
/
NumBlocksDL
*
§m¶esP”RB
;

140 
div6
=1.0/()
§m¶esP”RB
*0.125;

142 
n1
=0;‚1<
nRBsizes
;‚1++) {

143 
n1Ãw
=(è*(
RBsizes
+
n1
)-1;

145 ià(
n1Ãw
<
maxRBs
) {

147 
div4
=1.0/()(
n1Ãw
+1);

148 
tÙ®C­
=0;

149 
tÙ®C­IÁ
=0;

150 
tmp
=
	`æoÜ
(
n1Ãw
*
div3
);

151 
off£t
=(è*(
be¡Ind
+
tmp
)-1;

153 
pow”ToU£
=
maxTÙ®P”AÁTxPow”
*
div4
;

154 ià(
pow”ToU£
>
maxTxPow”P”RB
) {

155 
pow”ToU£
=
maxTxPow”P”RB
;

157 ià(
pow”ToU£
<
mšPwrP”UE
*
div4
) {

158 
pow”ToU£
=
mšPwrP”UE
*
div4
;

162 ià(
off£t
>-1) {

163 
ofámp
=
off£t
*
div5
;

164 
lim™
=
§m¶esP”RB
*(
n1Ãw
+1);

165 
n2
=0;‚2<
lim™
;‚2++) {

166 
šds
=
ofámp
+
n2
;

168 
tÙ®C­IÁ
+=
	`log2­´ox
(1.0+
pow”ToU£
*
´eC®cVec
[
šds
]);

174 
tÙ®C­
=()
tÙ®C­IÁ
;

175 
tÙ®C­
=
®pha
*tÙ®C­*
div6
;

179 ià(
tÙ®C­
>*
tÙ®C­Max
) {

180 *
tÙ®C­Max
=
tÙ®C­
;

181 *
numRBsMax
=
n1Ãw
+1;

194 
	}
}

196 
	$log2­´ox
(
š
)

199 
tmpAccum
,
štmp
;

200 
outSÿË
;

202 
v
;

203 
r
;

204 
shiá
;

206 
štmp
=
š
;

209 ià(
štmp
<=15.0) {

210 
outSÿË
=0;

211 
tmpAccum
=
štmp
*intmp;

212 
tmpAccum
=tmpAccum*tmpAccum;

213 
tmpAccum
=tmpAccum*tmpAccum;

216 ià(
štmp
<=255.0) {

217 
outSÿË
=1;

218 
tmpAccum
=
štmp
*intmp;

219 
tmpAccum
=tmpAccum*tmpAccum;

222 ià(
štmp
<511.0) {

223 
outSÿË
=2;

224 
tmpAccum
=
štmp
*intmp;

227 
outSÿË
=3;

228 
tmpAccum
=
štmp
;

231 
v
=()(
tmpAccum
);

233 
r
 = (
v
 > 0xFFFF) << 4; v >>=„;

234 
shiá
 = (
v
 > 0xFF ) << 3; v >>ğshiá; 
r
 |= shift;

235 
shiá
 = (
v
 > 0xF ) << 2; v >>ğshiá; 
r
 |= shift;

236 
shiá
 = (
v
 > 0x3 ) << 1; v >>ğshiá; 
r
 |= shift;

237 
r
 |ğ(
v
 >> 1);

240 
r
ô<<
outSÿË
;

242  
r
;

243 
	}
}

246 
	$sum_ÿp_maüo_1Ïy”_UL
(*
tÙ®C­Max
,*
numRBsMax
,*
numRBsMš
,
maxRBs
,
NªtsUeRx
, *
equivChªBe¡_»
, *
equivChªBe¡_im
, 
S·¿m
, 
®pha
, 
b‘a
, *
NItoU£
, 
maxTÙ®P”AÁTxPow”UE
, 
maxTxPow”P”RB
, 
§m¶esP”RB
, 
buffStus
, 
ULmaxMCS
)

249 
n1
,
n2
,
n3
,
off1
,
off£t
,
šds
,
šdsNI
,
tmp
,
tÙ®C­IÁ
 ;

250 
tÙ®C­
,
sumChªPow”
,
S
,
pow”ToU£
,
div1
,
div3
,
ÿpTmp
,
tmpD
;

251 
´eC®cVec
[400];

252 
div2
[100];

256 
div3
=1.0/()
§m¶esP”RB
;

258 
n2
=0;‚2<
maxRBs
;‚2++) {

259 
div2
[
n2
]=1.0/(*(
NItoU£
+n2));

264 
n2
=0;‚2<
§m¶esP”RB
*
maxRBs
;‚2++) {

266 
sumChªPow”
=0.0;

267 
šds
=
n2
;

268 
šdsNI
=
	`æoÜ
(
n2
*
div3
);

271 
n3
=0;‚3<
NªtsUeRx
;‚3++) {

273 
off1
=
n3
+
NªtsUeRx
*
šds
;

275 
sumChªPow”
+ğ*(
equivChªBe¡_»
+
off1
è* (*ÓquivChªBe¡_»+off1)è+ *(
equivChªBe¡_im
+off1) * (*(equivChanBest_im+off1));

278 
S
=
S·¿m
*
sumChªPow”
;

279 
´eC®cVec
[
n2
]=
b‘a
*
S
*
div2
[
šdsNI
];

284 *
numRBsMax
=0.0;

285 *
numRBsMš
=0.0;

286 *
tÙ®C­Max
=0.0;

287 
div1
=1.0/(()
§m¶esP”RB
)*
®pha
*0.125;

291 
n1
=0;‚1<
maxRBs
;‚1++) {

293 
tÙ®C­
=0;

294 
tÙ®C­IÁ
=0;

296 
pow”ToU£
=
maxTÙ®P”AÁTxPow”UE
/(()(
n1
+1));

298 ià(
pow”ToU£
>
maxTxPow”P”RB
) {

299 
pow”ToU£
=
maxTxPow”P”RB
;

303 
n2
=0;‚2<
§m¶esP”RB
*(
n1
+1);‚2++) {

305 
tÙ®C­IÁ
+=
	`log2­´ox
(1+
pow”ToU£
*
´eC®cVec
[
n2
]);

309 
tÙ®C­
=()
tÙ®C­IÁ
;

311 
tÙ®C­
ñÙ®C­*
div1
;

314 ià(
tÙ®C­
>*
tÙ®C­Max
) {

315 *
tÙ®C­Max
=
tÙ®C­
;

316 *
numRBsMax
=()(
n1
+1);

319 
tmpD
=()
buffStus
/()(
n1
+1);

322 ià((
tÙ®C­
>ğ()
buffStus
)&&(*
numRBsMš
==0.0)&&(
tmpD
<=
ULmaxMCS
)) {

323 *
numRBsMš
=()(
n1
+1);

324 
ÿpTmp
=
tÙ®C­
;

329 ià(*
numRBsMš
>0.1) {

330 *
tÙ®C­Max
=
ÿpTmp
;

334 
	}
}

337 
	$sum_ÿp_ãmto_1Ïy”_UL
(*
tÙ®C­Max
,*
numRBsMax
,*
numRBsMš
,
maxRBs
,
NªtsUeRx
, *
equivChªBe¡_»
, *
equivChªBe¡_im
, 
S·¿m
, 
®pha
, 
b‘a
, *
NItoU£
, 
maxTÙ®P”AÁTxPow”UE
, 
maxTxPow”P”RB
, 
§m¶esP”RB
, *
RBsizes
,
nRBsizes
, 
buffStus
, 
ULmaxMCS
)

340 
n1
,
n2
,
n3
,
off1
,
off£t
,
šds
,
šdsNI
,
tmp
,
tÙ®C­IÁ
,
n1Ãw
,
lim™
,
n4
 ;

341 
tÙ®C­
,
sumChªPow”
,
S
,
pow”ToU£
,
div1
,
div3
,
ÿpTmp
,
tmpD
;

342 
´eC®cVec
[400];

343 
div2
;

346 
šdsNI
=-1;

347 
n2
=0;‚2<
§m¶esP”RB
*
maxRBs
;‚2++) {

349 ià((
n2
%
§m¶esP”RB
)==0) {

350 
šdsNI
+=1;

351 
div2
=1.0/(*(
NItoU£
+
šdsNI
));

353 
sumChªPow”
=0.0;

354 
šds
=
n2
;

357 
n3
=0;‚3<
NªtsUeRx
;‚3++) {

359 
off1
=
n3
+
NªtsUeRx
*
šds
;

360 
sumChªPow”
+ğ*(
equivChªBe¡_»
+
off1
è* (*ÓquivChªBe¡_»+off1)è+ *(
equivChªBe¡_im
+off1) * (*(equivChanBest_im+off1));

363 
S
=
S·¿m
*
sumChªPow”
;

364 
´eC®cVec
[
n2
]=
b‘a
*
S
*
div2
;

368 *
numRBsMax
=0;

369 *
tÙ®C­Max
=0.0;

370 
div1
=1.0/(()
§m¶esP”RB
)*
®pha
*0.125;

373 
n1
=0;‚1<
nRBsizes
;‚1++) {

375 ià(((è*(
RBsizes
+
n1
))<
maxRBs
) {

376 
n1Ãw
=(è*(
RBsizes
+
n1
)-1;

377 
tÙ®C­
=0;

378 
tÙ®C­IÁ
=0;

380 
pow”ToU£
=
maxTÙ®P”AÁTxPow”UE
/(()(
n1Ãw
+1));

382 ià(
pow”ToU£
>
maxTxPow”P”RB
) {

383 
pow”ToU£
=
maxTxPow”P”RB
;

386 
lim™
=
§m¶esP”RB
*(
n1Ãw
+1);

388 
n4
=0;‚4<
lim™
;‚4++) {

390 
tÙ®C­IÁ
+=
	`log2­´ox
(1.0+
pow”ToU£
*
´eC®cVec
[
n4
]);

394 
tÙ®C­
=()
tÙ®C­IÁ
;

396 
tÙ®C­
ñÙ®C­*
div1
;

399 ià(
tÙ®C­
>*
tÙ®C­Max
) {

400 *
tÙ®C­Max
=
tÙ®C­
;

401 *
numRBsMax
=
n1Ãw
+1;

404 
tmpD
=()
buffStus
/()(
n1Ãw
+1);

405 ià((
tÙ®C­
>ğ()
buffStus
)&&(*
numRBsMš
==0.0)&&(
tmpD
<=
ULmaxMCS
)) {

406 *
numRBsMš
=()(
n1Ãw
+1);

407 
ÿpTmp
=
tÙ®C­
;

414 ià(*
numRBsMš
>0.1) {

415 *
tÙ®C­Max
=
ÿpTmp
;

417 
	}
}

	@/home/lyang3/work/src_son/runWorld/networkManager.h

1 şas 
	cN‘wÜkMªag”


3 
	mpublic
:

4 
N‘wÜkMªag”
();

5 ~
N‘wÜkMªag”
();

7 
	m´iv©e
:

9 
numHeNB
, 
	md•loym’tTy³
;

11 
	mReùGridDim’siÚX
, 
	mReùGridDim’siÚY
, 
	mA±NumFloÜs
;

13 
	m´obAùiveA·¹m’t
;

15 
	mdISD
;

19 
sum_ÿp_maüo_1Ïy”_DL
(*
tÙ®C­Max
,*
numRBsMax
,
maxRBs
,
NªtsUeRx
, *
equivChªBe¡_»
, *
equivChªBe¡_im
, 
S·¿m
, 
®pha
, 
b‘a
, *
NItoU£
,
NumBlocksDL
, *
be¡Ind
, 
§m¶esP”RB
, 
maxTÙ®P”AÁTxPow”
, 
maxTxPow”P”RB
, 
mšPwrP”UE
);

20 
sum_ÿp_ãmto_1Ïy”_DL
(*
tÙ®C­Max
,*
numRBsMax
,
maxRBs
,
NªtsUeRx
, *
equivChªBe¡_»
, *
equivChªBe¡_im
, 
S·¿m
, 
®pha
, 
b‘a
, *
NItoU£
,
NumBlocksDL
, *
be¡Ind
, 
§m¶esP”RB
, 
maxTÙ®P”AÁTxPow”
, 
maxTxPow”P”RB
, 
mšPwrP”UE
, *
RBsizes
, 
nRBsizes
, 
§m¶esP”Block
);

21 
sum_ÿp_maüo_1Ïy”_UL
(*
tÙ®C­Max
,*
numRBsMax
,*
numRBsMš
,
maxRBs
,
NªtsUeRx
, *
equivChªBe¡_»
, *
equivChªBe¡_im
, 
S·¿m
, 
®pha
, 
b‘a
, *
NItoU£
, 
maxTÙ®P”AÁTxPow”UE
, 
maxTxPow”P”RB
, 
§m¶esP”RB
, 
buffStus
, 
ULmaxMCS
);

22 
sum_ÿp_ãmto_1Ïy”_UL
(*
tÙ®C­Max
,*
numRBsMax
,*
numRBsMš
,
maxRBs
,
NªtsUeRx
, *
equivChªBe¡_»
, *
equivChªBe¡_im
, 
S·¿m
, 
®pha
, 
b‘a
, *
NItoU£
, 
maxTÙ®P”AÁTxPow”UE
, 
maxTxPow”P”RB
, 
§m¶esP”RB
, *
RBsizes
, 
nRBsizes
, 
buffStus
, 
ULmaxMCS
);

25 
log2­´ox
(
š
);

	@/home/lyang3/work/src_son/runWorld/pathloss.cpp

1 
	~<m©h.h
>

7 
	$dF»e¥aû
(
dDi¡ªû
, 
dF»qu’cy
){

8  (20.0*
	`log10
(
dF»qu’cy
è+ 20.0*log10(
dDi¡ªû
) + 32.45);

9 
	}
}

14 
	$dPlFemtoInIn_G’”ic
(
dDi¡ªû3D
, 
dDi¡ªû2D
, 
nW®ls
, 
nFloÜs
, 
boŞ
 
b3GPP
, boŞ 
bResid’tŸl
)

16 
·thLoss
;

18 ià(
bResid’tŸl
){

20 ià(
b3GPP
){

22 
·thLoss
 = 38.46 + 20*
	`log10
(
dDi¡ªû3D
è+ 0.7*
dDi¡ªû2D
 + 5*
nW®ls
;

24 ià(
nFloÜs
 > 0)

25 
·thLoss
 =…©hLos + 18.3*
	`pow
(
nFloÜs
,((nFloors+2)/(nFloors+1)-0.46));

31 ià(
b3GPP
){

38  
·thLoss
;

39 
	}
}

42 
	$dPlFemtoInIn_P¬tŸl
(
dDi¡ªû2D
, 
nW®ls
, 
nFloÜs
, 
boŞ
 
b3GPP
, boŞ 
bResid’tŸl
)

44 
·thLoss
;

46 ià(
bResid’tŸl
){

48 ià(
b3GPP
){

50 
·thLoss
=0.7*
dDi¡ªû2D
+5*
nW®ls
;

52 ià(
nFloÜs
 > 0)

53 
·thLoss
õ©hLoss+18.3* 
	`pow
(
nFloÜs
,((nFloors+2)/(nFloors+1)-0.46));

59 ià(
b3GPP
){

66  
·thLoss
;

67 
	}
}

70 
	$dPlFemtoInOut_G’”ic
(
C¬r›rF»
, 
dDi¡ªû2D
, 
boŞ
 
b3GPP
, boŞ 
bResid’tŸl
)

72 
·thLoss
, 
‹mp
;

74 
Di¡B»akPošt
 = 20.69;

75 
dB³rDecPo¡BP
 = 37.6;

77 
‹mp
 = 
	`log10
(
dDi¡ªû2D
);

78 ià(
bResid’tŸl
){

80 ià(
b3GPP
){

82 
·thLoss
 = 32.4 + 20.0*
	`log10
(
C¬r›rF»
*0.001è+ (20.0*
‹mp
);

84 ià(
dDi¡ªû2D
 > 
Di¡B»akPošt
)

85 
·thLoss
 =…©hLos + (
dB³rDecPo¡BP
 - 20)*(
‹mp
 - 
	`log10
(
Di¡B»akPošt
));

91 ià(
b3GPP
){

98  
·thLoss
;

99 
	}
}

104 
	$dPlFemtoInIn_S³cific
()

108 
	}
}

111 
	$dPlFemtoInOut_S³cific
()

115 
	}
}

120 
	$dPlM‘roFemtoOutOut
(
dDi¡
, 
dF»q
, 
dhB
,

121 
dhR
, 
boŞ
 
bLOS
)

123 
L_FS
;

124 
dF»q
 = dFreq / 1000;

125 ià(
dDi¡
 < 0.5)

126 
dDi¡
 = 0.5;

128 ià(
bLOS
) {

130 
L_FS
 = 40.0*
	`log10
(
dDi¡
è+ 9.45 - 17.3*log10(
dhB
è- 17.3*log10(
dhR
è+ 2.7*log10(
dF»q
/5.0);

134 
L_FS
 = 40.0*
	`log10
(
dDi¡
è+ 9.45 - 17.3*log10(
dhB
è- 17.3*log10(
dhR
è+ 2.7*log10(
dF»q
/5.0)

135 + 20 - 12.5*1.84 + 10 *1.84*
	`log10
(
dhB
è+ 3*log10(
dF»q
/5.0);

138  
L_FS
;

139 
	}
}

142 
	$dPlM‘roMaüoCOST231
(
dDi¡
, 
dF»q
, 
dhB
,

143 
dhR
, 
boŞ
 
bLOS
)

145 
¶
;

146 
dF»q
 = dFreq / 1000;

148 ià(
bLOS
) {

150 
¶
 = 40.0*
	`log10
(
dDi¡
è+ 13.7 - 14.0*log10(
dhB
è- 14.0*log10(
dhR
è+ 6*log10(
dF»q
/5.0);

154 
¶
 = (44.9 - 
	`log10
(
dhB
))*log10(
dDi¡
è+ 34.46 + 5.83*log10(dhBè+ 23*log10(
dF»q
/5.0);

156  
¶
;

157 
	}
}

160 
	$dPlM‘roMaüoFF3GPPH‘N‘
(
boŞ
 
bLOS
)

162 ià(
bLOS
) {

169 
	}
}

178 
	$dPlCOST231Okumu¿H©a
(
dDi¡
, 
dF»q
, 
dhB
,

179 
dhR
, 
boŞ
 
bM‘ro
)

182 
dAhr
,

183 
dPl_UrbªSuburbª
;

186 
dAhr
 = (1.1*
	`log10
(
dF»q
)-0.7)*
dhR
 - (1.56*log10(dFreq)-0.8);

188 
dPl_UrbªSuburbª
 = 46.3 + 33.9*
	`log10
(
dF»q
è- 13.82*
	`log
(
dhB
è- 
dAhr


189 + (44.9 - 6.55*
	`log10
(
dhB
))*log10(
dDi¡
);

192 ià(
bM‘ro
){

193  (
dPl_UrbªSuburbª
 + 3.0);

196  
dPl_UrbªSuburbª
;

199 
	}
}

208 
	$dPlH©a
(
dDi¡
, 
dF»q
, 
dhB
, 
dhR
, 
boŞ
 
bM‘ro
)

211 
dCH
,

212 
dPl_Urbª
;

214 
dPl_Urbª
 = 69.55 + 26.16 * 
	`log10
(
dF»q
è- 13.82 *†og10(
dhB
)

215 + (44.9 - 6.55 * 
	`log10
(
dhB
)è*†og10(
dDi¡
);

219 ià(
bM‘ro
){

220 ià(
dF»q
 > 200.0){

221 
dCH
 = 3.2 * 
	`pow
((
	`log10
(11.75 * 
dhR
)), 2.0) - 4.97;

224 
dCH
 = 8.29 * 
	`pow
((
	`log10
(1.54 * 
dhR
)), 2.0) - 1.1;

228 
dCH
 = 0.8 + ((1.1 * 
	`log10
(
dF»q
è- 0.7è* 
dhR
) - (1.56 *†og10(dFreq));

231  (
dPl_Urbª
 - 
dCH
);

232 
	}
}

	@/home/lyang3/work/src_son/runWorld/pathloss.h

1 
dF»e¥aû
(
dDi¡ªû
, 
dF»qu’cy
);

2 
dPlFemtoInIn_G’”ic
(
dDi¡ªû3D
, 
dDi¡ªû2D
, 
nW®ls
, 
nFloÜs
, 
boŞ
 
b3GPP
, boŞ 
bResid’tŸl
);

3 
dPlFemtoInIn_P¬tŸl
(
dDi¡ªû2D
, 
nW®ls
, 
nFloÜs
, 
boŞ
 
b3GPP
, boŞ 
bResid’tŸl
);

4 
dPlFemtoInOut_G’”ic
(
dF»q
, 
dDi¡ªû2D
, 
boŞ
 
b3GPP
, boŞ 
bResid’tŸl
);

5 
dPlFemtoInIn_S³cific
();

6 
dPlFemtoInOut_S³cific
();

7 
dPlM‘roFemtoOutOut
(
dDi¡
, 
dF»q
, 
dhB
,

8 
dhR
, 
boŞ
 
bLOS
);

9 
dPlM‘roMaüoCOST231
(
dDi¡
, 
dF»q
, 
dhB
,

10 
dhR
, 
boŞ
 
bLOS
);

11 
dPlM‘roMaüoFF3GPPH‘N‘
(
boŞ
 
bLOS
);

12 
dPlCOST231Okumu¿H©a
(
dDi¡
, 
dF»q
, 
dhB
, 
dhR
, 
boŞ
 
bM‘ro
);

13 
dPlH©a
(
dDi¡
, 
dF»q
, 
dhB
, 
dhR
, 
boŞ
 
bM‘ro
);

	@/home/lyang3/work/src_son/runWorld/pathloss_test.cpp

1 
	~"·thloss.h
"

2 
	~<io¡»am
>

3 
	~<f¡»am
>

4 
usšg
 
Çme¥aû
 
	g¡d
;

9 
	$‹¡P©hloss
(){

11 
boŞ


12 
b3GPP
,

13 
bResid’tŸl
,

14 
bM‘ro
;

17 
dP©hloss
,

18 
dDi¡ªû
,

19 
dF»qu’cy
,

20 
dhB
,

21 
dhR
;

23 
of¡»am


24 
feF»e¥aûloss
,

25 
fePlFemtoInIn_G’”ic
,

26 
fePlFemtoInOut_G’”ic
,

27 
feCOST231OkH©a
,

28 
feH©a
;

31 
feF»e¥aûloss
.
	`İ’
("Results/Freespaceloss.txt");

32 
dF»qu’cy
 = 2000.0;

33 
dDi¡ªû
 = 0.1; dDistance < 10.0; dDistance += 0.1){

34 
dP©hloss
 = 
	`dF»e¥aû
(
dDi¡ªû
, 
dF»qu’cy
);

35 
feF»e¥aûloss
 << 
dDi¡ªû
 << "\t" << 
dP©hloss
 << 
’dl
;

37 
feF»e¥aûloss
.
	`şo£
();

40 
feCOST231OkH©a
.
	`İ’
("Results/COST231OkHata.txt");

41 
dF»qu’cy
 = 2000.0;

42 
dhB
 = 30.0;

43 
dhR
 = 1.5;

44 
dDi¡ªû
 = 1.0; dDistance <= 20.0; dDistance += 0.1){

46 
bM‘ro
 = 
çl£
;

47 
dP©hloss
 = 
	`dPlCOST231Okumu¿H©a
(
dDi¡ªû
, 
dF»qu’cy
, 
dhB
, 
dhR
, 
bM‘ro
);

48 
feCOST231OkH©a
 << 
dDi¡ªû
 << "\t" << 
dP©hloss
;

50 
bM‘ro
 = 
Œue
;

51 
dP©hloss
 = 
	`dPlCOST231Okumu¿H©a
(
dDi¡ªû
, 
dF»qu’cy
, 
dhB
, 
dhR
, 
bM‘ro
);

52 
feCOST231OkH©a
 << "\t" << 
dP©hloss
 << 
’dl
;

54 
feCOST231OkH©a
.
	`şo£
();

57 
feH©a
.
	`İ’
("Results/Hata.txt");

58 
dF»qu’cy
 = 150.0;

59 
dhB
 = 30.0;

60 
dhR
 = 1.5;

61 
dDi¡ªû
 = 1.0; dDistance <= 20.0; dDistance += 0.1){

64 
dF»qu’cy
 = 150.0;

66 
bM‘ro
 = 
çl£
;

67 
dP©hloss
 = 
	`dPlH©a
(
dDi¡ªû
, 
dF»qu’cy
, 
dhB
, 
dhR
, 
bM‘ro
);

68 
feH©a
 << 
dDi¡ªû
 << "\t" << 
dP©hloss
;

70 
bM‘ro
 = 
Œue
;

71 
dP©hloss
 = 
	`dPlH©a
(
dDi¡ªû
, 
dF»qu’cy
, 
dhB
, 
dhR
, 
bM‘ro
);

72 
feH©a
 << "\t" << 
dP©hloss
;

75 
dF»qu’cy
 = 1500.0;

77 
bM‘ro
 = 
çl£
;

78 
dP©hloss
 = 
	`dPlH©a
(
dDi¡ªû
, 
dF»qu’cy
, 
dhB
, 
dhR
, 
bM‘ro
);

79 
feH©a
 << "\t" << 
dP©hloss
;

81 
bM‘ro
 = 
Œue
;

82 
dP©hloss
 = 
	`dPlH©a
(
dDi¡ªû
, 
dF»qu’cy
, 
dhB
, 
dhR
, 
bM‘ro
);

83 
feH©a
 << "\t" << 
dP©hloss
 << 
’dl
;

86 
feH©a
.
	`şo£
();

150 
fePlFemtoInOut_G’”ic
.
	`şo£
();

152 
	}
}

	@/home/lyang3/work/src_son/runWorld/pathloss_test.h

1 
‹¡P©hloss
();

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/AMCModule.cpp

4 
	~"AMCModuË.h
"

5 
	~"../../lßd-·¿m‘”s.h
"

6 
	~<m©h.h
>

7 
	~"io¡»am
"

9 
	gCQIIndex
[15] = {

15 
	gM­CQIToMCS
[15] = {

21 
	gEffic›ncyFÜCQIIndex
[15] = {

27 
	gMCSIndex
[32] = {

36 
	gModuÏtiÚSchemeFÜMCSIndex
[32] = {

45 
	gEffic›ncyFÜMCSIndex
[32] = {

74 
	gSINRFÜCQIIndex
[15] = {

81 
	gT¿n¥ÜtBlockSize
[32] = {

90 
	gAMCModuË
::
	$AMCModuË
()

91 {
	}
}

93 
AMCModuË
::~
	$AMCModuË
()

94 {
	}
}

97 
AMCModuË
::
	$G‘CQIFromEffic›ncy
 (
Effic›ncy
)

99 
cqi
 = 1;

100 
Effic›ncyFÜCQIIndex
[
cqi
] < 
Effic›ncy
 && cqi <= 14)

102 
cqi
++;

104  
cqi
;

105 
	}
}

108 
	gAMCModuË
::
	$G‘CQIFromSšr
 (
sšr
)

110 
cqi
 = 1;

111 
SINRFÜCQIIndex
[
cqi
] < 
sšr
 && cqi <= 14)

113 
cqi
++;

115  
cqi
;

116 
	}
}

119 
	gAMCModuË
::
	$G‘SšrFromCQI
 (
cqi
)

121 
sšr
 = 
SINRFÜCQIIndex
[
cqi
-1];

122  
sšr
;

123 
	}
}

126 
	gAMCModuË
::
	$G‘MCSFromCQI
 (
cqi
)

128  
M­CQIToMCS
 [
cqi
-1];

129 
	}
}

132 
	gAMCModuË
::
	$G‘CQIFromMCS
 (
mcs
)

134 
i
=0; i<15; i++)

136 ià(
mcs
 =ğ
M­CQIToMCS
[
i
])

137  (
i
+1);

139 
	}
}

142 
	gAMCModuË
::
	$G‘MCSIndexFromEffic›ncy
(
effic›ncy
)

144 
mcs
 = 1;

145 
Effic›ncyFÜMCSIndex
[
mcs
] < 
effic›ncy
 && mcs < 30)

147 
mcs
++;

149  
mcs
;

150 
	}
}

153 
	gAMCModuË
::
	$G‘TBSizeFromMCS
 (
mcs
)

155  
T¿n¥ÜtBlockSize
[
mcs
];

156 
	}
}

159 
	gAMCModuË
::
	$G‘Effic›ncyFromCQI
 (
cqi
)

161 
mcs
 = 
	`G‘MCSFromCQI
 (
cqi
);

162 
b™s
 = 
	`G‘TBSizeFromMCS
 (
mcs
);

164 
eff
 = (
b™s
/0.001)/180000.;

165  
eff
;

166 
	}
}

168 
	g¡d
::
veùÜ
<>

169 
AMCModuË
::
C»©eCqiF“dbacks
 (
¡d
::
veùÜ
<> 
sšr
)

171 #ifdeà
TEST_CQI_FEEDBACKS


172 
¡d
::
cout
 << "C»©šg CQI f“dbacks" << std::
’dl
;

175 
	g¡d
::
veùÜ
<> 
cqi
;

176 
	g¡d
::
veùÜ
<>::
™”©Ü
 
™
;

178 
	g™
 = 
sšr
.
begš
 (); iˆ!ğsšr.
’d
 (); it++)

180 
	gsšr_
 = (*
™
);

182 
	gcqi_
 = 
G‘CQIFromSšr
 (
sšr_
);

184 #ifdeà
TEST_CQI_FEEDBACKS


185 
	g¡d
::
cout
 << "\ˆsš¸" << 
sšr_
 << " cq˜" << 
cqi_
 << 
¡d
::
’dl
;

188 
	gcqi
.
push_back
 (
cqi_
);

191  
	gcqi
;

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/AMCModule.h

3 #iâdeà
AMCModuË_H_


4 
	#AMCModuË_H_


	)

6 
	~<veùÜ
>

11 şas 
	cAMCModuË
 {

12 
	mpublic
:

13 
AMCModuË
();

14 
	mvœtu®
 ~
AMCModuË
();

17 
G‘CQIFromEffic›ncy
 (
sšr
);

19 
G‘MCSIndexFromEffic›ncy
(
¥eù¿lEffic›ncy
);

21 
G‘MCSFromCQI
 (
cqi
);

23 
G‘CQIFromMCS
 (
mcs
);

25 
G‘TBSizeFromMCS
 (
mcs
);

27 
G‘Effic›ncyFromCQI
 (
cqi
);

29 
G‘CQIFromSšr
 (
sšr
);

31 
G‘SšrFromCQI
 (
cqi
);

33 
	m¡d
::
veùÜ
<> 
C»©eCqiF“dbacks
 (
¡d
::veùÜ<> 
sšr
);

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/enb-mac-entity.cc

4 
	~"’b-mac-’t™y.h
"

5 
	~"../·ck‘/Pack‘.h
"

6 
	~"../·ck‘/·ck‘-bur¡.h
"

7 
	~"AMCModuË.h
"

8 
	~"../../cÜe/id—lMes§ges/id—l-cÚŒŞ-mes§ges.h
"

9 
	~"../../deviû/N‘wÜkNode.h
"

10 
	~"·ck‘-scheduËr/·ck‘-scheduËr.h
"

11 
	~"../../deviû/U£rEqum’t.h
"

12 
	~"../../deviû/ENodeB.h
"

13 
	~"../../lßd-·¿m‘”s.h
"

16 
	gEnbMacEÁ™y
::
	$EnbMacEÁ™y
 ()

18 
	`S‘AmcModuË
 (
Ãw
 
	`AMCModuË
 ());

19 
	`S‘Deviû
 (
NULL
);

20 
m_dowÆškScheduËr
 = 
NULL
;

21 
m_u¶škScheduËr
 = 
NULL
;

22 
	}
}

25 
	gEnbMacEÁ™y
::~
	$EnbMacEÁ™y
 ()

27 
d–‘e
 
m_dowÆškScheduËr
;

28 
d–‘e
 
m_u¶škScheduËr
;

29 
	`De¡roy
 ();

30 
	}
}

34 
	gEnbMacEÁ™y
::
	$S‘U¶škPack‘ScheduËr
 (
Pack‘ScheduËr
* 
s
)

36 
m_u¶škScheduËr
 = 
s
;

37 
	}
}

41 
	gEnbMacEÁ™y
::
	$S‘DowÆškPack‘ScheduËr
 (
Pack‘ScheduËr
* 
s
)

43 
m_dowÆškScheduËr
 = 
s
;

44 
	}
}

47 
Pack‘ScheduËr
*

48 
	gEnbMacEÁ™y
::
	$G‘U¶škPack‘ScheduËr
 ()

50  
m_u¶škScheduËr
;

51 
	}
}

54 
Pack‘ScheduËr
*

55 
	gEnbMacEÁ™y
::
	$G‘DowÆškPack‘ScheduËr
 ()

57  
m_dowÆškScheduËr
;

58 
	}
}

62 
	gEnbMacEÁ™y
::
	$ReûiveCqiId—lCÚŒŞMes§ge
 (
CqiId—lCÚŒŞMes§ge
* 
msg
)

64 #ifdeà
TEST_CQI_FEEDBACKS


65 
¡d
::
cout
 << "ReûiveId—lCÚŒŞMes§g(MACèäom " << 
msg
->
	`G‘SourûDeviû
 ()->
	`G‘IDN‘wÜkNode
 ()

66 << "Ø" << 
msg
->
	`G‘De¡š©iÚDeviû
 ()->
	`G‘IDN‘wÜkNode
 (è<< 
¡d
::
’dl
;

69 
CqiId—lCÚŒŞMes§ge
::
CqiF“dbacks
 *
cqi
 = 
msg
->
	`G‘Mes§ge
 ();

71 
U£rEqum’t
* 
ue
 = (U£rEqum’t*è
msg
->
	`G‘SourûDeviû
 ();

72 
ENodeB
* 
’b
 = (ENodeB*è
	`G‘Deviû
 ();

73 
ENodeB
::
U£rEqum’tRecÜd
* 
»cÜd
 = 
’b
->
	`G‘U£rEqum’tRecÜd
 (
ue
->
	`G‘IDN‘wÜkNode
 ());

75 ià(
»cÜd
 !ğ
NULL
)

77 
¡d
::
veùÜ
<> 
cqiF“dback
;

78 
CqiId—lCÚŒŞMes§ge
::
CqiF“dbacks
::
™”©Ü
 
™
 = 
cqi
->
	`begš
 (); iˆ!ğcqi->
	`’d
 (); it++)

80 
cqiF“dback
.
	`push_back
 ((*
™
).
m_cqi
);

83 #ifdeà
TEST_CQI_FEEDBACKS


84 
¡d
::
cout
 << "\t CQI: ";

85 
i
 = 0; i < 
cqiF“dback
.
	`size
 (); i++)

87 
¡d
::
cout
 << 
cqiF“dback
.
	`©
 (
i
) << " ";

89 
¡d
::
cout
 << std::
’dl
;

92 #ifdeà
AMC_MAPPING


93 
¡d
::
cout
 << "\t CQI: ";

94 
i
 = 0; i < 
cqiF“dback
.
	`size
 (); i++)

96 
¡d
::
cout
 << 
cqiF“dback
.
	`©
 (
i
) << " ";

98 
¡d
::
cout
 << std::
’dl
;

100 
¡d
::
cout
 << "\t MCS: ";

101 
i
 = 0; i < 
cqiF“dback
.
	`size
 (); i++)

103 
¡d
::
cout
 << 
	`G‘AmcModuË
 ()->
	`G‘MCSFromCQI
 (
cqiF“dback
.
	`©
 (
i
)) << " ";

105 
¡d
::
cout
 << std::
’dl
;

107 
¡d
::
cout
 << "\t TB: ";

108 
i
 = 0; i < 
cqiF“dback
.
	`size
 (); i++)

110 
¡d
::
cout
 << 
	`G‘AmcModuË
 ()->
	`G‘TBSizeFromMCS
(

111 
	`G‘AmcModuË
 ()->
	`G‘MCSFromCQI
 (
cqiF“dback
.
	`©
 (
i
))) << " ";

113 
¡d
::
cout
 << std::
’dl
;

117 
»cÜd
->
	`S‘CQI
 (
cqiF“dback
);

122 
¡d
::
cout
 << "ERROR:„eûived cq˜äom unknow ue!"<< std::
’dl
;

125 
d–‘e
 
msg
;

126 
	}
}

130 
	gEnbMacEÁ™y
::
	$S’dPdcchM­Id—lCÚŒŞMes§ge
 (
PdcchM­Id—lCÚŒŞMes§ge
* 
msg
)

132 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/enb-mac-entity.h

2 #iâdeà
ENB_MAC_ENTITY_H


3 
	#ENB_MAC_ENTITY_H


	)

5 
	~<li¡
>

6 
	~"mac-’t™y.h
"

13 
şass
 
	gPack‘ScheduËr
;

14 
şass
 
	gCqiId—lCÚŒŞMes§ge
;

15 
şass
 
	gPdcchM­Id—lCÚŒŞMes§ge
;

17 şas 
	cEnbMacEÁ™y
 : 
public
 
MacEÁ™y


19 
public
:

21 
EnbMacEÁ™y
 ();

22 
	mvœtu®
 ~
EnbMacEÁ™y
 ();

25 
S‘U¶škPack‘ScheduËr
 (
Pack‘ScheduËr
* 
s
);

26 
S‘DowÆškPack‘ScheduËr
 (
Pack‘ScheduËr
* 
s
);

27 
Pack‘ScheduËr
* 
G‘U¶škPack‘ScheduËr
 ();

28 
Pack‘ScheduËr
* 
G‘DowÆškPack‘ScheduËr
 ();

30 
ReûiveCqiId—lCÚŒŞMes§ge
 (
CqiId—lCÚŒŞMes§ge
* 
msg
);

31 
S’dPdcchM­Id—lCÚŒŞMes§ge
 (
PdcchM­Id—lCÚŒŞMes§ge
* 
msg
);

33 
	m´iv©e
:

35 
Pack‘ScheduËr
* 
m_u¶škScheduËr
;

36 
Pack‘ScheduËr
* 
	mm_dowÆškScheduËr
;

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/harq-manager.cpp

10 
	~"h¬q-mªag”.h
"

12 
	gH¬qMªag”
::
	$H¬qMªag”
() {

15 
	}
}

17 
H¬qMªag”
::~
	$H¬qMªag”
() {

19 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/harq-manager.h

4 #iâdeà
HARQMANAGER_H_


5 
	#HARQMANAGER_H_


	)

7 şas 
	cH¬qMªag”
 {

8 
	mpublic
:

9 
H¬qMªag”
();

10 
	mvœtu®
 ~
H¬qMªag”
();

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/mac-entity.cc

3 
	~"mac-’t™y.h
"

4 
	~"../·ck‘/Pack‘.h
"

5 
	~"../../deviû/N‘wÜkNode.h
"

6 
	~"AMCModuË.h
"

7 
	~"h¬q-mªag”.h
"

9 
	gMacEÁ™y
::
	$MacEÁ™y
 ()

10 {
	}
}

13 
MacEÁ™y
::~
	$MacEÁ™y
 ()

15 
d–‘e
 
m_amcModuË
;

16 
m_deviû
 = 
NULL
;

17 
	}
}

20 
	gMacEÁ™y
::
	$De¡roy
 ()

22 
d–‘e
 
m_amcModuË
;

23 
d–‘e
 
m_h¬qmªag”
;

24 
m_deviû
 = 
NULL
;

25 
	}
}

28 
	gMacEÁ™y
::
	$S‘Deviû
 (
N‘wÜkNode
* 
d
)

30 
m_deviû
 = 
d
;

31 
	}
}

33 
N‘wÜkNode
*

34 
	gMacEÁ™y
::
	$G‘Deviû
 ()

36  
m_deviû
;

37 
	}
}

40 
	gMacEÁ™y
::
	$S‘AmcModuË
 (
AMCModuË
* 
amc
)

42 
m_amcModuË
 = 
amc
;

43 
	}
}

45 
AMCModuË
*

46 
	gMacEÁ™y
::
	$G‘AmcModuË
 () const

48  
m_amcModuË
;

49 
	}
}

51 
H¬qMªag”
*

52 
	gMacEÁ™y
::
	$G‘H¬qMªag”
 ()

54  
m_h¬qmªag”
;

55 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/mac-entity.h

2 #iâdeà
MAC_ENTITY_H


3 
	#MAC_ENTITY_H


	)

5 
	~<li¡
>

7 
şass
 
	gPack‘
;

8 
şass
 
	gN‘wÜkNode
;

9 
şass
 
	gAMCModuË
;

10 
şass
 
	gH¬qMªag”
;

16 şas 
	cMacEÁ™y


18 
	mpublic
:

20 
MacEÁ™y
 ();

21 
	mvœtu®
 ~
MacEÁ™y
 ();

23 
De¡roy
 ();

25 
S‘Deviû
 (
N‘wÜkNode
* 
d
);

26 
N‘wÜkNode
* 
G‘Deviû
 ();

28 
S‘AmcModuË
 (
AMCModuË
* 
amcModuË
);

29 
AMCModuË
* 
	$G‘AmcModuË
 () const;

31 
H¬qMªag”
* 
	`G‘H¬qMªag”
 ();

33 
´iv©e
:

34 
N‘wÜkNode
* 
m_deviû
;

35 
AMCModuË
* 
m_amcModuË
;

36 
H¬qMªag”
* 
m_h¬qmªag”
;

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/delay-edd-rule-downlink-packet-scheduler.cpp

2 
	~"d–ay-edd-ruË-dowÆšk-·ck‘-scheduËr.h
"

3 
	~"../mac-’t™y.h
"

4 
	~"../../·ck‘/Pack‘.h
"

5 
	~"../../·ck‘/·ck‘-bur¡.h
"

6 
	~"../../../deviû/N‘wÜkNode.h
"

7 
	~"../../../æows/¿dio-b—»r.h
"

8 
	~"../../../´ÙocŞSck/¼c/¼c-’t™y.h
"

9 
	~"../../../æows/­¶iÿtiÚ/AµliÿtiÚ.h
"

10 
	~"../../../deviû/ENodeB.h
"

11 
	~"../../../´ÙocŞSck/mac/AMCModuË.h
"

12 
	~"../../../phy/Ée-phy.h
"

13 
	~"../../../cÜe/¥eùrum/bªdwidth-mªag”.h
"

14 
	~"../../../cÜe/id—lMes§ges/id—l-cÚŒŞ-mes§ges.h
"

15 
	~"../../../æows/QoS/QoSP¬am‘”s.h
"

16 
	~"../../../æows/MacQueue.h
"

18 
	gD–ayEddRuËDowÆškPack‘ScheduËr
::
	$D–ayEddRuËDowÆškPack‘ScheduËr
()

20 
	`S‘MacEÁ™y
 (0);

21 
	`C»©eFlowsToScheduË
 ();

22 
	}
}

24 
	gD–ayEddRuËDowÆškPack‘ScheduËr
::~
	$D–ayEddRuËDowÆškPack‘ScheduËr
()

26 
	`De¡roy
 ();

27 
	}
}

31 
	gD–ayEddRuËDowÆškPack‘ScheduËr
::
	$Compu‹SchedulšgM‘ric
 (
RadioB—»r
 *
b—»r
, 
¥eù¿lEffic›ncy
, 
subChªÃl
)

33 
m‘ric
;

35 ià((
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_INFINITE_BUFFER
)

37 (
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_CBR
))

39 
m‘ric
 = (
¥eù¿lEffic›ncy
 * 180000.)

41 
b—»r
->
	`G‘Av”ageT¿nsmissiÚR©e
();

43 #ifdeà
SCHEDULER_DEBUG


44 
¡d
::
cout
 << "METRIC: " << 
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚID
 ()

45 << " " << 
¥eù¿lEffic›ncy


46 << " " << 
b—»r
->
	`G‘Av”ageT¿nsmissiÚR©e
 ()

47 << " --> " << 
m‘ric


48 << 
¡d
::
’dl
;

54 
maxD–ay
 = 
b—»r
->
	`G‘QoSP¬am‘”s
 ()->
	`G‘MaxD–ay
 ();

55 
h—dOfLšeD–ay
 = 
b—»r
->
	`G‘H—dOfLšePack‘D–ay
 ();

57 
m‘ric
 = 
maxD–ay
 - 
h—dOfLšeD–ay
;

59 ià(
m‘ric
 < 0.000001) metric = 0.000001;

62  
m‘ric
;

63 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/delay-edd-rule-downlink-packet-scheduler.h

2 #iâdeà
DELAY_EDD_RULE_DOWNLINK_PACKET_SCHEDULER_H_


3 
	#DELAY_EDD_RULE_DOWNLINK_PACKET_SCHEDULER_H_


	)

5 
	~"dowÆšk-·ck‘-scheduËr.h
"

14 şas 
	cD–ayEddRuËDowÆškPack‘ScheduËr
 : 
public
 
DowÆškPack‘ScheduËr
 {

15 
public
:

16 
D–ayEddRuËDowÆškPack‘ScheduËr
();

17 
	mvœtu®
 ~
D–ayEddRuËDowÆškPack‘ScheduËr
();

19 
vœtu®
 
Compu‹SchedulšgM‘ric
 (
RadioB—»r
 *
b—»r
, 
¥eù¿lEffic›ncy
, 
subChªÃl
);

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/dl-exp-packet-scheduler.cpp

3 
	~"dl-exp-·ck‘-scheduËr.h
"

4 
	~"../mac-’t™y.h
"

5 
	~"../../·ck‘/Pack‘.h
"

6 
	~"../../·ck‘/·ck‘-bur¡.h
"

7 
	~"../../../deviû/N‘wÜkNode.h
"

8 
	~"../../../æows/¿dio-b—»r.h
"

9 
	~"../../../´ÙocŞSck/¼c/¼c-’t™y.h
"

10 
	~"../../../æows/­¶iÿtiÚ/AµliÿtiÚ.h
"

11 
	~"../../../deviû/ENodeB.h
"

12 
	~"../../../´ÙocŞSck/mac/AMCModuË.h
"

13 
	~"../../../phy/Ée-phy.h
"

14 
	~"../../../cÜe/¥eùrum/bªdwidth-mªag”.h
"

15 
	~"../../../æows/QoS/QoSFÜEXP.h
"

16 
	~"../../../æows/MacQueue.h
"

18 
	gDL_EXP_Pack‘ScheduËr
::
	$DL_EXP_Pack‘ScheduËr
()

20 
	`S‘MacEÁ™y
 (0);

21 
	`C»©eFlowsToScheduË
 ();

22 
	}
}

24 
	gDL_EXP_Pack‘ScheduËr
::~
	$DL_EXP_Pack‘ScheduËr
()

26 
	`De¡roy
 ();

27 
	}
}

30 
	gDL_EXP_Pack‘ScheduËr
::
	$DoScheduË
 ()

32 #ifdeà
SCHEDULER_DEBUG


33 
¡d
::
cout
 << "Start DL…acket scheduler for‚ode "

34 << 
	`G‘MacEÁ™y
 ()->
	`G‘Deviû
 ()->
	`G‘IDN‘wÜkNode
()<< 
¡d
::
’dl
;

37 
	`Upd©eAv”ageT¿nsmissiÚR©e
 ();

38 
	`CheckFÜDLDrİPack‘s
 ();

39 
	`S–eùFlowsToScheduË
 ();

40 
	`Compu‹AW
 ();

42 ià(
	`G‘FlowsToScheduË
 ()->
	`size
() == 0)

46 
	`RBsAÎoÿtiÚ
 ();

49 
	`StİScheduË
 ();

50 
	}
}

53 
	gDL_EXP_Pack‘ScheduËr
::
	$Compu‹SchedulšgM‘ric
 (
RadioB—»r
 *
b—»r
, 
¥eù¿lEffic›ncy
, 
subChªÃl
)

63 
m‘ric
;

65 ià((
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_INFINITE_BUFFER
)

67 (
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_CBR
))

69 
m‘ric
 = (
¥eù¿lEffic›ncy
 * 180000.)

71 
b—»r
->
	`G‘Av”ageT¿nsmissiÚR©e
();

76 
QoSFÜEXP
 *
qos
 = (QoSFÜEXP*è
b—»r
->
	`G‘QoSP¬am‘”s
 ();

78 
HOL
 = 
b—»r
->
	`G‘H—dOfLšePack‘D–ay
 ();

79 
®ç
 = -
	`log10
(
qos
->
	`G‘DrİProbab™y
()è/ qos->
	`G‘MaxD–ay
 ();

80 
avgAW
 = 
	`G‘AW
 ();

81 
AW
 = 
®ç
 * 
HOL
;

83 ià(
AW
 < 0.000001)

84 
AW
=0;

86 
AW_avgAW
 = 
AW
 - 
avgAW
;

88 ià(
AW_avgAW
 < 0.000001)

89 
AW_avgAW
=0;

91 
m‘ric
 = 
	`exp
 ( 
AW_avgAW
 /

92 (1 + 
	`sq¹
 (
	`G‘AW
 ())) )

94 ((
¥eù¿lEffic›ncy
 * 180000.)

96 
b—»r
->
	`G‘Av”ageT¿nsmissiÚR©e
());

99  
m‘ric
;

100 
	}
}

104 
	gDL_EXP_Pack‘ScheduËr
::
	$Compu‹AW
 ()

106 
FlowsToScheduË
 *
æowsToScheduË
 = 
	`G‘FlowsToScheduË
 ();

107 
FlowsToScheduË
::
™”©Ü
 
™”
;

108 
FlowToScheduË
 *
æow
;

110 #ifdeà
SCHEDULER_DEBUG


111 
¡d
::
cout
 << "Compu‹AW" << std::
’dl
;

114 
m_aW
 = 0;

115 
nbFlow
 = 0;

116 
™”
 = 
æowsToScheduË
->
	`begš
(); i‹¸!ğæowsToScheduË->
	`’d
(); iter++)

118 
æow
 = *
™”
;

119 
RadioB—»r
 *
b—»r
 = 
æow
->
	`G‘B—»r
 ();

121 ià(
b—»r
->
	`HasPack‘s
 ())

123 ià((
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_TRACE_BASED
)

125 (
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_VOIP
))

127 
QoSFÜEXP
 *
qos
 = (QoSFÜEXP*è
b—»r
->
	`G‘QoSP¬am‘”s
 ();

128 
aWi
 = - (
	`log10
 (
qos
->
	`G‘DrİProbab™y
())

130 
qos
->
	`G‘MaxD–ay
 ());

131 
HOL
 = 
b—»r
->
	`G‘H—dOfLšePack‘D–ay
 ();

132 
aWi
 =‡W˜* 
HOL
;

133 
m_aW
 +ğ
aWi
;

134 
nbFlow
++;

139 
m_aW
 = m_aW/
nbFlow
;

141 ià(
m_aW
 < 0.000001)

142 
m_aW
=0;

143 
	}
}

146 
	gDL_EXP_Pack‘ScheduËr
::
	$G‘AW
 () const

148  
m_aW
;

149 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/dl-exp-packet-scheduler.h

2 #iâdeà
DL_EXP_PACKET_SCHEDULER_H_


3 
	#DL_EXP_PACKET_SCHEDULER_H_


	)

5 
	~"dowÆšk-·ck‘-scheduËr.h
"

7 şas 
	cDL_EXP_Pack‘ScheduËr
 : 
public
 
DowÆškPack‘ScheduËr
 {

8 
public
:

9 
DL_EXP_Pack‘ScheduËr
();

10 
	mvœtu®
 ~
DL_EXP_Pack‘ScheduËr
();

12 
vœtu®
 
DoScheduË
 ();

14 
vœtu®
 
Compu‹SchedulšgM‘ric
 (
RadioB—»r
 *
b—»r
, 
¥eù¿lEffic›ncy
, 
subChªÃl
);

16 
Compu‹AW
 ();

17 
	$G‘AW
 () const;

19 
´iv©e
:

20 
m_aW
;

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/dl-fls-packet-scheduler.cpp

21 
	~"dl-æs-·ck‘-scheduËr.h
"

22 
	~"../mac-’t™y.h
"

23 
	~"../../·ck‘/Pack‘.h
"

24 
	~"../../·ck‘/·ck‘-bur¡.h
"

25 
	~"../../../deviû/N‘wÜkNode.h
"

26 
	~"../../../æows/¿dio-b—»r.h
"

27 
	~"../../../´ÙocŞSck/¼c/¼c-’t™y.h
"

28 
	~"../../../æows/­¶iÿtiÚ/AµliÿtiÚ.h
"

29 
	~"../../../deviû/ENodeB.h
"

30 
	~"../../../´ÙocŞSck/mac/AMCModuË.h
"

31 
	~"../../../phy/Ée-phy.h
"

32 
	~"../../../cÜe/¥eùrum/bªdwidth-mªag”.h
"

33 
	~"../../../æows/QoS/QoSFÜFLS.h
"

34 
	~"../../../æows/MacQueue.h
"

36 
	gDL_FLS_Pack‘ScheduËr
::
	$DL_FLS_Pack‘ScheduËr
()

37 {
	}
}

39 
DL_FLS_Pack‘ScheduËr
::~
	$DL_FLS_Pack‘ScheduËr
()

40 {
	}
}

43 
DL_FLS_Pack‘ScheduËr
::
	$S‘Low”Lev–ScheduËrTy³
 (
Low”Lev–ScheduËrTy³
 
ty³
)

44 {
	}
}

46 
DL_FLS_Pack‘ScheduËr
::
Low”Lev–ScheduËrTy³


47 
DL_FLS_Pack‘ScheduËr
::
	$G‘Low”Lev–ScheduËrTy³
 () const

49  
m_low”Lev–ScheduËrTy³
;

50 
	}
}

53 
	gDL_FLS_Pack‘ScheduËr
::
	$DoScheduË
 ()

54 {
	}
}

57 
DL_FLS_Pack‘ScheduËr
::
	$DoStİScheduË
 ()

58 {
	}
}

61 
DL_FLS_Pack‘ScheduËr
::
	$Compu‹SchedulšgM‘ric
 (
RadioB—»r
 *
b—»r
, 
¥eù¿lEffic›ncy
, 
subChªÃl
)

62 { 0;
	}
}

65 
	gDL_FLS_Pack‘ScheduËr
::
	$RunCÚŒŞLaw
 ()

66 {
	}
}

69 
DL_FLS_Pack‘ScheduËr
::
	$S–eù_RT_FlowsToScheduË
 ()

70 {
	}
}

73 
DL_FLS_Pack‘ScheduËr
::
	$S–eù_NRT_FlowsToScheduË
 ()

74 {
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/dl-fls-packet-scheduler.h

2 #iâdeà
DL_FLS_PACKET_SCHEDULER_H_


3 
	#DL_FLS_PACKET_SCHEDULER_H_


	)

5 
	~"dowÆšk-·ck‘-scheduËr.h
"

7 şas 
	cDL_FLS_Pack‘ScheduËr
 : 
public
 
DowÆškPack‘ScheduËr
 {

8 
public
:

9 
DL_FLS_Pack‘ScheduËr
();

10 
	mvœtu®
 ~
DL_FLS_Pack‘ScheduËr
();

12 
	eLow”Lev–ScheduËrTy³
 {

13 
	mMAXIMUM_THROUGHPUT
,

14 
	mPROPORTIONAL_FAIR


17 
S‘Low”Lev–ScheduËrTy³
 (
Low”Lev–ScheduËrTy³
 
ty³
);

18 
Low”Lev–ScheduËrTy³
 
	$G‘Low”Lev–ScheduËrTy³
 () const;

20 
vœtu®
 
	`DoScheduË
 ();

21 
vœtu®
 
	`DoStİScheduË
 ();

23 
	`RunCÚŒŞLaw
 ();

27 
vœtu®
 
	`Compu‹SchedulšgM‘ric
 (
RadioB—»r
 *
b—»r
, 
¥eù¿lEffic›ncy
, 
subChªÃl
);

30 
	`S–eù_RT_FlowsToScheduË
 ();

33 
	`S–eù_NRT_FlowsToScheduË
 ();

37 
´iv©e
:

38 
boŞ
 
m_runCÚŒŞLaw
;

39 
m_subF¿meCouÁ”
;

41 
Low”Lev–ScheduËrTy³
 
m_low”Lev–ScheduËrTy³
;

42 
	}
};

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/dl-mlwdf-packet-scheduler.cpp

3 
	~"dl-mlwdf-·ck‘-scheduËr.h
"

4 
	~"../mac-’t™y.h
"

5 
	~"../../·ck‘/Pack‘.h
"

6 
	~"../../·ck‘/·ck‘-bur¡.h
"

7 
	~"../../../deviû/N‘wÜkNode.h
"

8 
	~"../../../æows/¿dio-b—»r.h
"

9 
	~"../../../´ÙocŞSck/¼c/¼c-’t™y.h
"

10 
	~"../../../æows/­¶iÿtiÚ/AµliÿtiÚ.h
"

11 
	~"../../../deviû/ENodeB.h
"

12 
	~"../../../´ÙocŞSck/mac/AMCModuË.h
"

13 
	~"../../../phy/Ée-phy.h
"

14 
	~"../../../cÜe/¥eùrum/bªdwidth-mªag”.h
"

15 
	~"../../../æows/QoS/QoSFÜM_LWDF.h
"

16 
	~"../../../æows/MacQueue.h
"

18 
	gDL_MLWDF_Pack‘ScheduËr
::
	$DL_MLWDF_Pack‘ScheduËr
()

20 
	`S‘MacEÁ™y
 (0);

21 
	`C»©eFlowsToScheduË
 ();

22 
	}
}

24 
	gDL_MLWDF_Pack‘ScheduËr
::~
	$DL_MLWDF_Pack‘ScheduËr
()

26 
	`De¡roy
 ();

27 
	}
}

31 
	gDL_MLWDF_Pack‘ScheduËr
::
	$DoScheduË
 ()

33 #ifdeà
SCHEDULER_DEBUG


34 
¡d
::
cout
 << "Start DL…acket scheduler for‚ode "

35 << 
	`G‘MacEÁ™y
 ()->
	`G‘Deviû
 ()->
	`G‘IDN‘wÜkNode
()<< 
¡d
::
’dl
;

38 
	`Upd©eAv”ageT¿nsmissiÚR©e
 ();

39 
	`CheckFÜDLDrİPack‘s
 ();

40 
	`S–eùFlowsToScheduË
 ();

42 ià(
	`G‘FlowsToScheduË
 ()->
	`size
() == 0)

46 
	`RBsAÎoÿtiÚ
 ();

49 
	`StİScheduË
 ();

50 
	}
}

53 
	gDL_MLWDF_Pack‘ScheduËr
::
	$Compu‹SchedulšgM‘ric
 (
RadioB—»r
 *
b—»r
, 
¥eù¿lEffic›ncy
, 
subChªÃl
)

63 
m‘ric
;

65 ià((
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_INFINITE_BUFFER
)

67 (
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_CBR
))

69 
m‘ric
 = (
¥eù¿lEffic›ncy
 * 180000.)

71 
b—»r
->
	`G‘Av”ageT¿nsmissiÚR©e
();

73 #ifdeà
SCHEDULER_DEBUG


74 
¡d
::
cout
 << "METRIC: " << 
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚID
 ()

75 << " " << 
¥eù¿lEffic›ncy


76 << " " << 
b—»r
->
	`G‘Av”ageT¿nsmissiÚR©e
 ()

77 << " --> " << 
m‘ric


78 << 
¡d
::
’dl
;

85 
QoSFÜM_LWDF
 *
qos
 = (QoSFÜM_LWDF*è
b—»r
->
	`G‘QoSP¬am‘”s
 ();

87 
a
 = (-
	`log10
 (
qos
->
	`G‘DrİProbab™y
())è/ qos->
	`G‘MaxD–ay
 ();

88 
HOL
 = 
b—»r
->
	`G‘H—dOfLšePack‘D–ay
 ();

90 
m‘ric
 = (
a
 * 
HOL
)

92 ((
¥eù¿lEffic›ncy
 * 180000.)

94 
b—»r
->
	`G‘Av”ageT¿nsmissiÚR©e
 ());

96 #ifdeà
SCHEDULER_DEBUG


97 
¡d
::
cout
 << "METRIC: " << 
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚID
 ()

98 << " " << 
a


99 << " " << 
SimuÏtÜ
::
	`In™
()->
	`Now
()

100 << " " << 
b—»r
->
	`G‘MacQueue
()->
	`P“k
().
	`G‘TimeSmp
()

101 << " " << 
HOL


102 << " " << 
¥eù¿lEffic›ncy


103 << " " << 
b—»r
->
	`G‘Av”ageT¿nsmissiÚR©e
 ()

104 << " --> " << 
m‘ric


105 << 
¡d
::
’dl
;

110  
m‘ric
;

111 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/dl-mlwdf-packet-scheduler.h

4 #iâdeà
DL_MLWDF_PACKET_SCHEDULER_H_


5 
	#DL_MLWDF_PACKET_SCHEDULER_H_


	)

7 
	~"dowÆšk-·ck‘-scheduËr.h
"

9 şas 
	cDL_MLWDF_Pack‘ScheduËr
 : 
public
 
DowÆškPack‘ScheduËr
 {

10 
public
:

11 
DL_MLWDF_Pack‘ScheduËr
();

12 
	mvœtu®
 ~
DL_MLWDF_Pack‘ScheduËr
();

14 
vœtu®
 
DoScheduË
 ();

16 
vœtu®
 
Compu‹SchedulšgM‘ric
 (
RadioB—»r
 *
b—»r
, 
¥eù¿lEffic›ncy
, 
subChªÃl
);

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/dl-pf-packet-scheduler.cpp

2 
	~"dl-pf-·ck‘-scheduËr.h
"

3 
	~"../mac-’t™y.h
"

4 
	~"../../·ck‘/Pack‘.h
"

5 
	~"../../·ck‘/·ck‘-bur¡.h
"

6 
	~"../../../deviû/N‘wÜkNode.h
"

7 
	~"../../../æows/¿dio-b—»r.h
"

8 
	~"../../../´ÙocŞSck/¼c/¼c-’t™y.h
"

9 
	~"../../../æows/­¶iÿtiÚ/AµliÿtiÚ.h
"

10 
	~"../../../deviû/ENodeB.h
"

11 
	~"../../../´ÙocŞSck/mac/AMCModuË.h
"

12 
	~"../../../phy/Ée-phy.h
"

13 
	~"../../../cÜe/¥eùrum/bªdwidth-mªag”.h
"

14 
	~"../../../cÜe/id—lMes§ges/id—l-cÚŒŞ-mes§ges.h
"

16 
	gDL_PF_Pack‘ScheduËr
::
	$DL_PF_Pack‘ScheduËr
()

18 
	`S‘MacEÁ™y
 (0);

19 
	`C»©eFlowsToScheduË
 ();

20 
	}
}

22 
	gDL_PF_Pack‘ScheduËr
::~
	$DL_PF_Pack‘ScheduËr
()

24 
	`De¡roy
 ();

25 
	}
}

29 
	gDL_PF_Pack‘ScheduËr
::
	$Compu‹SchedulšgM‘ric
 (
RadioB—»r
 *
b—»r
, 
¥eù¿lEffic›ncy
, 
subChªÃl
)

38 
m‘ric
 = (
¥eù¿lEffic›ncy
 * 180000.)

40 
b—»r
->
	`G‘Av”ageT¿nsmissiÚR©e
();

42  
m‘ric
;

43 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/dl-pf-packet-scheduler.h

2 #iâdeà
DLPFPACKETSCHEDULER_H_


3 
	#DLPFPACKETSCHEDULER_H_


	)

5 
	~"dowÆšk-·ck‘-scheduËr.h
"

7 şas 
	cDL_PF_Pack‘ScheduËr
 : 
public
 
DowÆškPack‘ScheduËr
 {

8 
public
:

9 
DL_PF_Pack‘ScheduËr
();

10 
	mvœtu®
 ~
DL_PF_Pack‘ScheduËr
();

12 
vœtu®
 
Compu‹SchedulšgM‘ric
 (
RadioB—»r
 *
b—»r
, 
¥eù¿lEffic›ncy
, 
subChªÃl
);

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/downlink-packet-scheduler.cpp

3 
	~"dowÆšk-·ck‘-scheduËr.h
"

4 
	~"../mac-’t™y.h
"

5 
	~"../../·ck‘/Pack‘.h
"

6 
	~"../../·ck‘/·ck‘-bur¡.h
"

7 
	~"../../../deviû/N‘wÜkNode.h
"

8 
	~"../../../æows/¿dio-b—»r.h
"

9 
	~"../../../´ÙocŞSck/¼c/¼c-’t™y.h
"

10 
	~"../../../æows/­¶iÿtiÚ/AµliÿtiÚ.h
"

11 
	~"../../../deviû/ENodeB.h
"

12 
	~"../../../´ÙocŞSck/mac/AMCModuË.h
"

13 
	~"../../../phy/Ée-phy.h
"

14 
	~"../../../cÜe/¥eùrum/bªdwidth-mªag”.h
"

15 
	~"../../../æows/MacQueue.h
"

16 
	~"../../../ut™y/“sm-efãùive-sšr.h
"

18 
	gDowÆškPack‘ScheduËr
::
	$DowÆškPack‘ScheduËr
()

19 {
	}
}

21 
DowÆškPack‘ScheduËr
::~
	$DowÆškPack‘ScheduËr
()

23 
	`De¡roy
 ();

24 
	}
}

26 
	gDowÆškPack‘ScheduËr
::
	$S–eùFlowsToScheduË
 ()

28 #ifdeà
SCHEDULER_DEBUG


29 
¡d
::
cout
 << "\ˆS–eù Flow tØscheduË" << std::
’dl
;

32 
RrcEÁ™y
 *
¼c
 = 
	`G‘MacEÁ™y
 ()->
	`G‘Deviû
 ()->
	`G‘PrÙocŞSck
 ()->
	`G‘RrcEÁ™y
 ();

33 
RrcEÁ™y
::
RadioB—»rsCÚš”
* 
b—»rs
 = 
¼c
->
	`G‘RadioB—»rCÚš”
 ();

36 
¡d
::
veùÜ
<
RadioB—»r
* >::
™”©Ü
 
™
 = 
b—»rs
->
	`begš
 (); iˆ!ğb—»rs->
	`’d
 (); it++)

39 
RadioB—»r
 *
b—»r
 = (*
™
);

40 ià(
b—»r
->
	`HasPack‘s
 (è&& b—»r->
	`G‘De¡š©iÚ
 ()->
	`G‘NodeS‹
 (è=ğ
N‘wÜkNode
::
STATE_ACTIVE
)

43 
d©aToT¿nsm™
;

44 ià(
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_INFINITE_BUFFER
)

46 
d©aToT¿nsm™
 = 100000000;

50 
d©aToT¿nsm™
 = 
b—»r
->
	`G‘QueueSize
 ();

54 
ENodeB
 *
’b
 = (ENodeB*è
	`G‘MacEÁ™y
 ()->
	`G‘Deviû
 ();

55 
ENodeB
::
U£rEqum’tRecÜd
 *
ueRecÜd
 = 
’b
->
	`G‘U£rEqum’tRecÜd
 (
b—»r
->
	`G‘De¡š©iÚ
 ()->
	`G‘IDN‘wÜkNode
 ());

56 
¡d
::
veùÜ
<> 
¥eù¿lEffic›ncy
;

57 
¡d
::
veùÜ
<> 
cqiF“dbacks
 = 
ueRecÜd
->
	`G‘CQI
 ();

58 
numb”OfCqi
 = 
cqiF“dbacks
.
	`size
 ();

59 
i
 = 0; i < 
numb”OfCqi
; i++)

61 
sEff
 = 
	`G‘MacEÁ™y
 ()->
	`G‘AmcModuË
 ()->
	`G‘Effic›ncyFromCQI
 (
cqiF“dbacks
.
	`©
 (
i
));

62 
¥eù¿lEffic›ncy
.
	`push_back
 (
sEff
);

66 
	`In£¹FlowToScheduË
(
b—»r
, 
d©aToT¿nsm™
, 
¥eù¿lEffic›ncy
, 
cqiF“dbacks
);

71 
	}
}

74 
	gDowÆškPack‘ScheduËr
::
	$DoScheduË
 ()

76 #ifdeà
SCHEDULER_DEBUG


77 
¡d
::
cout
 << "Start DL…acket scheduler for‚ode "

78 << 
	`G‘MacEÁ™y
 ()->
	`G‘Deviû
 ()->
	`G‘IDN‘wÜkNode
()<< 
¡d
::
’dl
;

81 
	`Upd©eAv”ageT¿nsmissiÚR©e
 ();

82 
	`S–eùFlowsToScheduË
 ();

84 ià(
	`G‘FlowsToScheduË
 ()->
	`size
() == 0)

88 
	`RBsAÎoÿtiÚ
 ();

91 
	`StİScheduË
 ();

92 
	}
}

95 
	gDowÆškPack‘ScheduËr
::
	$DoStİScheduË
 ()

97 #ifdeà
SCHEDULER_DEBUG


98 
¡d
::
cout
 << "\ˆC»©šg Pack‘ Bur¡" << std::
’dl
;

101 
Pack‘Bur¡
* 
pb
 = 
Ãw
 
	`Pack‘Bur¡
 ();

104 
FlowsToScheduË
 *
æowsToScheduË
 = 
	`G‘FlowsToScheduË
 ();

106 
FlowsToScheduË
::
™”©Ü
 
™
 = 
æowsToScheduË
->
	`begš
 (); iˆ!ğæowsToScheduË->
	`’d
 (); it++)

108 
FlowToScheduË
 *
æow
 = (*
™
);

110 
avaabËBy‹s
 = 
æow
->
	`G‘AÎoÿ‹dB™s
 ()/8;

112 ià(
avaabËBy‹s
 > 0)

117 #ifdeà
SCHEDULER_DEBUG


118 
¡d
::
cout
 << "\t -->‡dd…ackets for flow "

119 << 
æow
->
	`G‘B—»r
 ()->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚID
 (è<< 
¡d
::
’dl
;

122 
RlcEÁ™y
 *
¾c
 = 
æow
->
	`G‘B—»r
 ()->
	`G‘RlcEÁ™y
 ();

123 
Pack‘Bur¡
* 
pb2
 = 
¾c
->
	`T¿nsmissiÚProûdu»
 (
avaabËBy‹s
);

125 #ifdeà
SCHEDULER_DEBUG


126 
¡d
::
cout
 << "\t\ˆ‚b oà·ck‘s: " << 
pb2
->
	`G‘NPack‘s
 (è<< std::
’dl
;

129 ià(
pb2
->
	`G‘NPack‘s
 () > 0)

131 
¡d
::
li¡
<
Pack‘
*> 
·ck‘s
 = 
pb2
->
	`G‘Pack‘s
 ();

132 
¡d
::
li¡
<
Pack‘
* >::
™”©Ü
 
™
;

133 
™
 = 
·ck‘s
.
	`begš
 (); iˆ!ğ·ck‘s.
	`’d
 (); it++)

135 #ifdeà
SCHEDULER_DEBUG


136 
¡d
::
cout
 << "\t\ˆ‡dded…ack‘ oàby‹ " << (*
™
)->
	`G‘Size
 (è<< std::
’dl
;

140 
Pack‘
 *
p
 = (*
™
);

141 
pb
->
	`AddPack‘
 (
p
->
	`Cİy
 ());

144 
d–‘e
 
pb2
;

154 #ifdeà
SCHEDULER_DEBUG


155 ià(
pb
->
	`G‘NPack‘s
 () == 0)

156 
¡d
::
cout
 << "\ˆS’d oÆy„eã»nû symbŞs" << std::
’dl
;

159 
	`G‘MacEÁ™y
 ()->
	`G‘Deviû
 ()->
	`S’dPack‘Bur¡
 (
pb
);

160 
	}
}

163 
	gDowÆškPack‘ScheduËr
::
	$RBsAÎoÿtiÚ
 ()

165 #ifdeà
SCHEDULER_DEBUG


166 
¡d
::
cout
 << " ---- RBs Allocation";

170 
FlowsToScheduË
* 
æows
 = 
	`G‘FlowsToScheduË
 ();

171 
nbOfRBs
 = 
	`G‘MacEÁ™y
 ()->
	`G‘Deviû
 ()->
	`G‘Phy
 ()->
	`G‘BªdwidthMªag”
 ()->
	`G‘DlSubChªÃls
 ().
	`size
 ();

174 
m‘rics
[100][100];

175 
i
 = 0; i < 
nbOfRBs
; i++)

177 
j
 = 0; j < 
æows
->
	`size
 (); j++)

179 
m‘rics
[
i
][
j
] = 
	`Compu‹SchedulšgM‘ric
 (
æows
->
	`©
 (j)->
	`G‘B—»r
 (),

180 
æows
->
	`©
 (
j
)->
	`G‘S³ù¿lEffic›ncy
 ().© (
i
),

181 
i
);

185 #ifdeà
SCHEDULER_DEBUG


186 
¡d
::
cout
 << ",‡vaabË RB " << 
nbOfRBs
 << ", flow " << 
æows
->
	`size
 (è<< std::
’dl
;

187 
ii
 = 0; i˜< 
æows
->
	`size
 (); ii++)

189 
¡d
::
cout
 << "\t metrics for flow "

190 << 
æows
->
	`©
 (
ii
)->
	`G‘B—»r
 ()->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚID
 () << ":";

191 
jj
 = 0; jj < 
nbOfRBs
; jj++)

193 
¡d
::
cout
 << " " << 
m‘rics
[
jj
][
ii
];

195 
¡d
::
cout
 << std::
’dl
;

201 
s
 = 0; s < 
nbOfRBs
; s++)

203 
rg‘M‘ric
 = 0;

204 
boŞ
 
RBIsAÎoÿ‹d
 = 
çl£
;

205 
FlowToScheduË
* 
scheduËdFlow
;

207 
k
 = 0; k < 
æows
->
	`size
 (); k++)

209 ià(
m‘rics
[
s
][
k
] > 
rg‘M‘ric
)

211 
rg‘M‘ric
 = 
m‘rics
[
s
][
k
];

212 
RBIsAÎoÿ‹d
 = 
Œue
;

213 
scheduËdFlow
 = 
æows
->
	`©
 (
k
);

217 ià(
RBIsAÎoÿ‹d
)

219 
scheduËdFlow
->
	`G‘Li¡OfAÎoÿ‹dRBs
()->
	`push_back
 (
s
);

221 #ifdeà
SCHEDULER_DEBUG


222 
¡d
::
cout
 << "\ˆ*** RB " << 
s
 << "‡ssignedohe "

223 " flow " << 
scheduËdFlow
->
	`G‘B—»r
 ()->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚID
 ()

224 << 
¡d
::
’dl
;

231 
AMCModuË
 *
amc
 = 
	`G‘MacEÁ™y
 ()->
	`G‘AmcModuË
 ();

232 
PdcchM­Id—lCÚŒŞMes§ge
 *
pdcchMsg
 = 
Ãw
 
	`PdcchM­Id—lCÚŒŞMes§ge
 ();

234 
FlowsToScheduË
::
™”©Ü
 
™
 = 
æows
->
	`begš
 (); iˆ!ğæows->
	`’d
 (); it++)

236 
FlowToScheduË
 *
æow
 = (*
™
);

237 ià(
æow
->
	`G‘Li¡OfAÎoÿ‹dRBs
 ()->
	`size
 () > 0)

240 
¡d
::
veùÜ
<> 
e¡im©edSšrV®ues
;

241 
rb
 = 0;„b < 
æow
->
	`G‘Li¡OfAÎoÿ‹dRBs
 ()->
	`size
 ();„b++ )

243 
sšr
 = 
amc
->
	`G‘SšrFromCQI
 (

244 
æow
->
	`G‘CqiF“dbacks
 ().
	`©
 (æow->
	`G‘Li¡OfAÎoÿ‹dRBs
 ()->© (
rb
)));

246 
e¡im©edSšrV®ues
.
	`push_back
 (
sšr
);

250 
efãùiveSšr
 = 
	`G‘EesmEfãùiveSšr
 (
e¡im©edSšrV®ues
);

253 
mcs
 = 
amc
->
	`G‘MCSFromCQI
 (amc->
	`G‘CQIFromSšr
 (
efãùiveSšr
));

256 
Œª¥ÜtBlockSize
 = 
amc
->
	`G‘TBSizeFromMCS
 (
mcs
);

257 
b™sToT¿nsm™
 = 
Œª¥ÜtBlockSize
 * 
æow
->
	`G‘Li¡OfAÎoÿ‹dRBs
 ()->
	`size
 ();

258 
æow
->
	`Upd©eAÎoÿ‹dB™s
 (
b™sToT¿nsm™
);

260 #ifdeà
SCHEDULER_DEBUG


261 
¡d
::
cout
 << "\t\ˆ--> flow " << 
æow
->
	`G‘B—»r
 ()->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚID
 ()

263 "\n\t\t\ˆnb oàRB " << 
æow
->
	`G‘Li¡OfAÎoÿ‹dRBs
 ()->
	`size
 () <<

264 "\n\t\t\ˆefãùiveSš¸" << 
efãùiveSšr
 <<

265 "\n\t\t\ˆtb " << 
Œª¥ÜtBlockSize
 <<

266 "\n\t\t\ˆb™sToT¿nsm™ " << 
b™sToT¿nsm™


267 << 
¡d
::
’dl
;

271 
rb
 = 0;„b < 
æow
->
	`G‘Li¡OfAÎoÿ‹dRBs
 ()->
	`size
 ();„b++ )

273 
pdcchMsg
->
	`AddNewRecÜd
 (
PdcchM­Id—lCÚŒŞMes§ge
::
DOWNLINK
,

274 
æow
->
	`G‘Li¡OfAÎoÿ‹dRBs
 ()->
	`©
 (
rb
),

275 
æow
->
	`G‘B—»r
 ()->
	`G‘De¡š©iÚ
 (),

276 
mcs
);

281 ià(
pdcchMsg
->
	`G‘Mes§ge
()->
	`size
 () > 0)

283 
	`G‘MacEÁ™y
 ()->
	`G‘Deviû
 ()->
	`G‘Phy
 ()->
	`S’dId—lCÚŒŞMes§ge
 (
pdcchMsg
);

285 
d–‘e
 
pdcchMsg
;

286 
	}
}

290 
	gDowÆškPack‘ScheduËr
::
	$Upd©eAv”ageT¿nsmissiÚR©e
 ()

292 
RrcEÁ™y
 *
¼c
 = 
	`G‘MacEÁ™y
 ()->
	`G‘Deviû
 ()->
	`G‘PrÙocŞSck
 ()->
	`G‘RrcEÁ™y
 ();

293 
RrcEÁ™y
::
RadioB—»rsCÚš”
* 
b—»rs
 = 
¼c
->
	`G‘RadioB—»rCÚš”
 ();

295 
¡d
::
veùÜ
<
RadioB—»r
* >::
™”©Ü
 
™
 = 
b—»rs
->
	`begš
 (); iˆ!ğb—»rs->
	`’d
 (); it++)

297 
RadioB—»r
 *
b—»r
 = (*
™
);

298 
b—»r
->
	`Upd©eAv”ageT¿nsmissiÚR©e
 ();

300 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/downlink-packet-scheduler.h

3 #iâdeà
DOWNLINKPACKETSCHEDULER_H_


4 
	#DOWNLINKPACKETSCHEDULER_H_


	)

6 
	~"·ck‘-scheduËr.h
"

8 şas 
	cDowÆškPack‘ScheduËr
: 
public
 
Pack‘ScheduËr
 {

9 
public
:

10 
DowÆškPack‘ScheduËr
();

11 
	mvœtu®
 ~
DowÆškPack‘ScheduËr
();

13 
S–eùFlowsToScheduË
 ();

15 
vœtu®
 
DoScheduË
 ();

16 
vœtu®
 
DoStİScheduË
 ();

18 
vœtu®
 
RBsAÎoÿtiÚ
 ();

19 
vœtu®
 
Compu‹SchedulšgM‘ric
 (
RadioB—»r
 *
b—»r
, 
¥eù¿lEffic›ncy
, 
subChªÃl
) = 0;

21 
Upd©eAv”ageT¿nsmissiÚR©e
 ();

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/exp-rule-downlink-packet-scheduler.cpp

2 
	~"exp-ruË-dowÆšk-·ck‘-scheduËr.h
"

3 
	~"../mac-’t™y.h
"

4 
	~"../../·ck‘/Pack‘.h
"

5 
	~"../../·ck‘/·ck‘-bur¡.h
"

6 
	~"../../../deviû/N‘wÜkNode.h
"

7 
	~"../../../æows/¿dio-b—»r.h
"

8 
	~"../../../´ÙocŞSck/¼c/¼c-’t™y.h
"

9 
	~"../../../æows/­¶iÿtiÚ/AµliÿtiÚ.h
"

10 
	~"../../../deviû/ENodeB.h
"

11 
	~"../../../´ÙocŞSck/mac/AMCModuË.h
"

12 
	~"../../../phy/Ée-phy.h
"

13 
	~"../../../cÜe/¥eùrum/bªdwidth-mªag”.h
"

14 
	~"../../../cÜe/id—lMes§ges/id—l-cÚŒŞ-mes§ges.h
"

15 
	~"../../../æows/QoS/QoSP¬am‘”s.h
"

16 
	~"../../../æows/MacQueue.h
"

18 
	gExpRuËDowÆškPack‘ScheduËr
::
	$ExpRuËDowÆškPack‘ScheduËr
()

20 
	`S‘MacEÁ™y
 (0);

21 
	`C»©eFlowsToScheduË
 ();

22 
	}
}

24 
	gExpRuËDowÆškPack‘ScheduËr
::~
	$ExpRuËDowÆškPack‘ScheduËr
()

26 
	`De¡roy
 ();

27 
	}
}

32 
	gExpRuËDowÆškPack‘ScheduËr
::
	$DoScheduË
 ()

34 #ifdeà
SCHEDULER_DEBUG


35 
¡d
::
cout
 << "Start EXP RULE…acket scheduler for‚ode "

36 << 
	`G‘MacEÁ™y
 ()->
	`G‘Deviû
 ()->
	`G‘IDN‘wÜkNode
()<< 
¡d
::
’dl
;

39 
	`Upd©eAv”ageT¿nsmissiÚR©e
 ();

40 
	`CheckFÜDLDrİPack‘s
 ();

41 
	`S–eùFlowsToScheduË
 ();

42 
	`Compu‹Av”ageOfHOLD–ays
 ();

44 ià(
	`G‘FlowsToScheduË
 ()->
	`size
() == 0)

48 
	`RBsAÎoÿtiÚ
 ();

51 
	`StİScheduË
 ();

52 
	}
}

56 
	gExpRuËDowÆškPack‘ScheduËr
::
	$Compu‹Av”ageOfHOLD–ays
 ()

58 
avgHOL
 = 0.;

59 
nbFlows
 = 0;

60 
FlowsToScheduË
 *
æowsToScheduË
 = 
	`G‘FlowsToScheduË
 ();

61 
FlowsToScheduË
::
™”©Ü
 
™”
;

62 
FlowToScheduË
 *
æow
;

64 
™”
 = 
æowsToScheduË
->
	`begš
 (); i‹¸!ğæowsToScheduË->
	`’d
 (); iter++)

66 
æow
 = (*
™”
);

67 ià(
æow
->
	`G‘B—»r
 ()->
	`HasPack‘s
 ())

69 ià((
æow
->
	`G‘B—»r
 ()->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 ()

70 =ğ
AµliÿtiÚ
::
APPLICATION_TYPE_TRACE_BASED
)

72 (
æow
->
	`G‘B—»r
 ()->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 ()

73 =ğ
AµliÿtiÚ
::
APPLICATION_TYPE_VOIP
))

75 
avgHOL
 +ğ
æow
->
	`G‘B—»r
 ()->
	`G‘H—dOfLšePack‘D–ay
 ();

76 
nbFlows
++;

81 
m_avgHOLD–ayes
 = 
avgHOL
/
nbFlows
;

82 
	}
}

86 
	gExpRuËDowÆškPack‘ScheduËr
::
	$Compu‹SchedulšgM‘ric
 (
RadioB—»r
 *
b—»r
, 
¥eù¿lEffic›ncy
, 
subChªÃl
)

88 #ifdeà
SCHEDULER_DEBUG


89 
¡d
::
cout
 << "\t ComputeSchedulingMetric for flow "

90 << 
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚID
 (è<< 
¡d
::
’dl
;

93 
m‘ric
;

95 ià((
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_INFINITE_BUFFER
)

97 (
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_CBR
))

99 
m‘ric
 = (
¥eù¿lEffic›ncy
 * 180000.)

101 
b—»r
->
	`G‘Av”ageT¿nsmissiÚR©e
();

103 #ifdeà
SCHEDULER_DEBUG


104 
¡d
::
cout
 << "\t\ˆnÚ„—Ètimæow: m‘riøğ" << 
m‘ric
 << std::
’dl
;

110 
QoSP¬am‘”s
 *
qos
 = 
b—»r
->
	`G‘QoSP¬am‘”s
 ();

111 
HOL
 = 
b—»r
->
	`G‘H—dOfLšePack‘D–ay
 ();

112 
rg‘D–ay
 = 
qos
->
	`G‘MaxD–ay
 ();

115 
num”©Ü
 = (6/
rg‘D–ay
è* 
HOL
;

116 
d’omš©Ü
 = (1 + 
	`sq¹
 (
m_avgHOLD–ayes
));

117 
weight
 = (
¥eù¿lEffic›ncy
 * 180000.)

119 
b—»r
->
	`G‘Av”ageT¿nsmissiÚR©e
();

121 
m‘ric
 = (
	`exp
 (
num”©Ü
 / 
d’omš©Ü
)è* 
weight
;

123 #ifdeà
SCHEDULER_DEBUG


124 
¡d
::
cout
 << "\t\t„ealime flow: "

125 "\n\t\t\ˆHOL = " << 
HOL
 <<

126 "\n\t\t\ˆrg‘ d–ay = " << 
rg‘D–ay
 <<

127 "\n\t\t\ˆm_avgHOLD–aye ğ" << 
m_avgHOLD–ayes
 <<

128 "\n\t\t\ˆ¥eù¿lEffic›ncy = " << 
¥eù¿lEffic›ncy
 <<

129 "\n\t\t\ˆavg„©ğ" << 
b—»r
->
	`G‘Av”ageT¿nsmissiÚR©e
() <<

130 "\n\t\t\ˆnum”©Ü " << 
num”©Ü
 <<

131 "\n\t\t\ˆd’omš©Ü " << 
d’omš©Ü
 <<

132 "\n\t\t\ˆweighˆğ" << 
weight
 <<

133 "\n\t\ˆ--> m‘riøğ" << 
m‘ric
 << 
¡d
::
’dl
;

137  
m‘ric
;

138 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/exp-rule-downlink-packet-scheduler.h

2 #iâdeà
EXP_RULE_DOWNLINK_PACKET_SCHEDULER_H_


3 
	#EXP_RULE_DOWNLINK_PACKET_SCHEDULER_H_


	)

5 
	~"dowÆšk-·ck‘-scheduËr.h
"

7 şas 
	cExpRuËDowÆškPack‘ScheduËr
 : 
public
 
DowÆškPack‘ScheduËr
 {

8 
public
:

9 
ExpRuËDowÆškPack‘ScheduËr
();

10 
	mvœtu®
 ~
ExpRuËDowÆškPack‘ScheduËr
();

12 
vœtu®
 
DoScheduË
 ();

14 
Compu‹Av”ageOfHOLD–ays
 ();

15 
vœtu®
 
Compu‹SchedulšgM‘ric
 (
RadioB—»r
 *
b—»r
, 
¥eù¿lEffic›ncy
, 
subChªÃl
);

17 
	m´iv©e
:

18 
m_avgHOLD–ayes
;

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/log-rule-downlink-packet-scheduler.cpp

2 
	~"log-ruË-dowÆšk-·ck‘-scheduËr.h
"

3 
	~"../mac-’t™y.h
"

4 
	~"../../·ck‘/Pack‘.h
"

5 
	~"../../·ck‘/·ck‘-bur¡.h
"

6 
	~"../../../deviû/N‘wÜkNode.h
"

7 
	~"../../../æows/¿dio-b—»r.h
"

8 
	~"../../../´ÙocŞSck/¼c/¼c-’t™y.h
"

9 
	~"../../../æows/­¶iÿtiÚ/AµliÿtiÚ.h
"

10 
	~"../../../deviû/ENodeB.h
"

11 
	~"../../../´ÙocŞSck/mac/AMCModuË.h
"

12 
	~"../../../phy/Ée-phy.h
"

13 
	~"../../../cÜe/¥eùrum/bªdwidth-mªag”.h
"

14 
	~"../../../cÜe/id—lMes§ges/id—l-cÚŒŞ-mes§ges.h
"

15 
	~"../../../æows/QoS/QoSP¬am‘”s.h
"

16 
	~"../../../æows/MacQueue.h
"

18 
	gLogRuËDowÆškPack‘ScheduËr
::
	$LogRuËDowÆškPack‘ScheduËr
()

20 
	`S‘MacEÁ™y
 (0);

21 
	`C»©eFlowsToScheduË
 ();

22 
	}
}

24 
	gLogRuËDowÆškPack‘ScheduËr
::~
	$LogRuËDowÆškPack‘ScheduËr
()

26 
	`De¡roy
 ();

27 
	}
}

30 
	gLogRuËDowÆškPack‘ScheduËr
::
	$DoScheduË
 ()

32 #ifdeà
SCHEDULER_DEBUG


33 
¡d
::
cout
 << "Start LOG RULE…acket scheduler for‚ode "

34 << 
	`G‘MacEÁ™y
 ()->
	`G‘Deviû
 ()->
	`G‘IDN‘wÜkNode
()<< 
¡d
::
’dl
;

37 
	`Upd©eAv”ageT¿nsmissiÚR©e
 ();

39 
	`CheckFÜDLDrİPack‘s
 ();

41 
	`S–eùFlowsToScheduË
 ();

43 ià(
	`G‘FlowsToScheduË
 ()->
	`size
() == 0)

47 
	`RBsAÎoÿtiÚ
 ();

50 
	`StİScheduË
 ();

51 
	}
}

55 
	gLogRuËDowÆškPack‘ScheduËr
::
	$Compu‹SchedulšgM‘ric
 (
RadioB—»r
 *
b—»r
, 
¥eù¿lEffic›ncy
, 
subChªÃl
)

57 
m‘ric
;

59 ià((
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_INFINITE_BUFFER
)

61 (
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_CBR
))

63 
m‘ric
 = (
¥eù¿lEffic›ncy
 * 180000.)

65 
b—»r
->
	`G‘Av”ageT¿nsmissiÚR©e
();

69 
QoSP¬am‘”s
 *
qos
 = 
b—»r
->
	`G‘QoSP¬am‘”s
 ();

70 
HOL
 = 
b—»r
->
	`G‘H—dOfLšePack‘D–ay
 ();

71 
rg‘D–ay
 = 
qos
->
	`G‘MaxD–ay
 ();

74 
logT”m
 = 
	`log
 (1.1 + ( (5 * 
HOL
è/ 
rg‘D–ay
 ));

75 
weight
 = (
¥eù¿lEffic›ncy
 * 180000.)

77 
b—»r
->
	`G‘Av”ageT¿nsmissiÚR©e
();

79 
m‘ric
 = 
logT”m
 * 
weight
;

82  
m‘ric
;

83 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/log-rule-downlink-packet-scheduler.h

2 #iâdeà
LOG_RULE_DOWNLINK_PACKET_SCHEDULER_H_


3 
	#LOG_RULE_DOWNLINK_PACKET_SCHEDULER_H_


	)

5 
	~"dowÆšk-·ck‘-scheduËr.h
"

7 şas 
	cLogRuËDowÆškPack‘ScheduËr
 : 
public
 
DowÆškPack‘ScheduËr
 {

8 
public
:

9 
LogRuËDowÆškPack‘ScheduËr
();

10 
	mvœtu®
 ~
LogRuËDowÆškPack‘ScheduËr
();

12 
vœtu®
 
DoScheduË
 ();

14 
vœtu®
 
Compu‹SchedulšgM‘ric
 (
RadioB—»r
 *
b—»r
, 
¥eù¿lEffic›ncy
, 
subChªÃl
);

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/mw-rule-downlink-packet-scheduler.cpp

2 
	~"mw-ruË-dowÆšk-·ck‘-scheduËr.h
"

3 
	~"../mac-’t™y.h
"

4 
	~"../../·ck‘/Pack‘.h
"

5 
	~"../../·ck‘/·ck‘-bur¡.h
"

6 
	~"../../../deviû/N‘wÜkNode.h
"

7 
	~"../../../æows/¿dio-b—»r.h
"

8 
	~"../../../´ÙocŞSck/¼c/¼c-’t™y.h
"

9 
	~"../../../æows/­¶iÿtiÚ/AµliÿtiÚ.h
"

10 
	~"../../../deviû/ENodeB.h
"

11 
	~"../../../´ÙocŞSck/mac/AMCModuË.h
"

12 
	~"../../../phy/Ée-phy.h
"

13 
	~"../../../cÜe/¥eùrum/bªdwidth-mªag”.h
"

14 
	~"../../../cÜe/id—lMes§ges/id—l-cÚŒŞ-mes§ges.h
"

15 
	~"../../../æows/QoS/QoSP¬am‘”s.h
"

16 
	~"../../../æows/MacQueue.h
"

18 
	gMwRuËPack‘ScheduËr
::
	$MwRuËPack‘ScheduËr
()

20 
	`S‘MacEÁ™y
 (0);

21 
	`C»©eFlowsToScheduË
 ();

22 
	}
}

24 
	gMwRuËPack‘ScheduËr
::~
	$MwRuËPack‘ScheduËr
()

26 
	`De¡roy
 ();

27 
	}
}

31 
	gMwRuËPack‘ScheduËr
::
	$Compu‹SchedulšgM‘ric
 (
RadioB—»r
 *
b—»r
, 
¥eù¿lEffic›ncy
, 
subChªÃl
)

33 #ifdeà
SCHEDULER_DEBUG


34 
¡d
::
cout
 << "\t ComputeSchedulingMetric for flow "

35 << 
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚID
 (è<< 
¡d
::
’dl
;

38 
m‘ric
;

40 ià((
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_INFINITE_BUFFER
)

42 (
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_CBR
))

44 
m‘ric
 = (
¥eù¿lEffic›ncy
 * 180000.)

46 
b—»r
->
	`G‘Av”ageT¿nsmissiÚR©e
();

48 #ifdeà
SCHEDULER_DEBUG


49 
¡d
::
cout
 << "\t\ˆnÚ„—Ètimæow: m‘riøğ" << 
m‘ric
 << std::
’dl
;

55 
QoSP¬am‘”s
 *
qos
 = 
b—»r
->
	`G‘QoSP¬am‘”s
 ();

56 
HOL
 = 
b—»r
->
	`G‘H—dOfLšePack‘D–ay
 ();

57 
rg‘D–ay
 = 
qos
->
	`G‘MaxD–ay
 ();

59 #ifdeà
SCHEDULER_DEBUG


60 
¡d
::
cout
 << "\t\ˆ»®imæow: HOL = " << 
HOL
 << ",¬g‘ d–ay = " << 
rg‘D–ay
;

68 
sumHOL
 = 0;

69 
nbFlows
 = 0;

70 
FlowsToScheduË
 *
æowsToScheduË
 = 
	`G‘FlowsToScheduË
 ();

71 
FlowsToScheduË
::
™”©Ü
 
™”
;

72 
FlowToScheduË
 *
æow
;

74 
™”
 = 
æowsToScheduË
->
	`begš
 (); i‹¸!ğæowsToScheduË->
	`’d
 (); iter++)

76 
æow
 = (*
™”
);

77 ià(!
æow
->
	`G‘B—»r
 ()->
	`HasPack‘s
 ())

81 ià((
æow
->
	`G‘B—»r
 ()->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 ()

82 !ğ
AµliÿtiÚ
::
APPLICATION_TYPE_INFINITE_BUFFER
)

84 (
æow
->
	`G‘B—»r
 ()->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 ()

85 !ğ
AµliÿtiÚ
::
APPLICATION_TYPE_CBR
))

87 
sumHOL
 +ğ
æow
->
	`G‘B—»r
 ()->
	`G‘H—dOfLšePack‘D–ay
 ();

88 
nbFlows
++;

106 
num”©Ü
 = (6/
rg‘D–ay
è* 
HOL
;

107 
d’omš©Ü
 = (1 + 
	`sq¹
 (
sumHOL
/
nbFlows
));

108 
weight
 = (
¥eù¿lEffic›ncy
 * 180000.)

110 
b—»r
->
	`G‘Av”ageT¿nsmissiÚR©e
();

112 
m‘ric
 = (
	`exp
 (
num”©Ü
 / 
d’omš©Ü
)è* 
weight
;

114 #ifdeà
SCHEDULER_DEBUG


115 
¡d
::
cout
 << " --> m‘riøğ" << 
m‘ric
 << std::
’dl
;

119  
m‘ric
;

120 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/mw-rule-downlink-packet-scheduler.h

2 #iâdeà
MW_RULE_DOWNLINK_PACKET_SCHEDULER_H_


3 
	#MW_RULE_DOWNLINK_PACKET_SCHEDULER_H_


	)

5 
	~"dowÆšk-·ck‘-scheduËr.h
"

7 şas 
	cMwRuËPack‘ScheduËr
 : 
public
 
DowÆškPack‘ScheduËr
 {

8 
public
:

9 
MwRuËPack‘ScheduËr
();

10 
	mvœtu®
 ~
MwRuËPack‘ScheduËr
();

12 
vœtu®
 
Compu‹SchedulšgM‘ric
 (
RadioB—»r
 *
b—»r
, 
¥eù¿lEffic›ncy
, 
subChªÃl
);

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/packet-scheduler.cpp

1 
	~"·ck‘-scheduËr.h
"

2 
	~"../mac-’t™y.h
"

3 
	~"../../·ck‘/Pack‘.h
"

4 
	~"../../·ck‘/·ck‘-bur¡.h
"

5 
	~"../../../deviû/N‘wÜkNode.h
"

6 
	~"../../../æows/¿dio-b—»r.h
"

7 
	~"../../../´ÙocŞSck/¼c/¼c-’t™y.h
"

8 
	~"../../../æows/­¶iÿtiÚ/AµliÿtiÚ.h
"

9 
	~"../../../æows/MacQueue.h
"

10 
	~"../../../æows/QoS/QoSP¬am‘”s.h
"

11 
	~"../../¾c/am-¾c-’t™y.h
"

13 
	gPack‘ScheduËr
::
	$Pack‘ScheduËr
()

15 
m_mac
 = 
NULL
;

16 
m_æowsToScheduË
 = 
NULL
;

17 
	}
}

19 
	gPack‘ScheduËr
::~
	$Pack‘ScheduËr
()

21 
	`CË¬FlowsToScheduË
 ();

22 
d–‘e
 
m_æowsToScheduË
;

23 
m_mac
 = 
NULL
;

24 
	}
}

27 
	gPack‘ScheduËr
::
	$De¡roy
 ()

29 
	`CË¬FlowsToScheduË
 ();

30 
d–‘e
 
m_æowsToScheduË
;

31 
m_mac
 = 
NULL
;

32 
	}
}

35 
	gPack‘ScheduËr
::
	$S‘MacEÁ™y
 (
MacEÁ™y
* 
mac
)

37 
m_mac
 = 
mac
;

38 
	}
}

40 
MacEÁ™y
*

41 
	gPack‘ScheduËr
::
	$G‘MacEÁ™y
 ()

43  
m_mac
;

44 
	}
}

47 
	gPack‘ScheduËr
::
	$ScheduË
 ()

49 
	`CË¬FlowsToScheduË
 ();

50 
	`DoScheduË
 ();

51 
	}
}

54 
	gPack‘ScheduËr
::
	$DoScheduË
 ()

55 {
	}
}

58 
Pack‘ScheduËr
::
	$StİScheduË
 ()

60 
	`DoStİScheduË
 ();

61 
	`CË¬FlowsToScheduË
 ();

62 
	}
}

65 
	gPack‘ScheduËr
::
	$DoStİScheduË
 ()

66 {
	}
}

69 
Pack‘ScheduËr
::
FlowToScheduË
::
	$FlowToScheduË
(
RadioB—»r
* 
b—»r
, 
d©aToT¿nsm™
)

71 
m_b—»r
 = 
b—»r
;

72 
m_®loÿ‹dB™s
 = 0;

73 
m_Œªsm™‹dD©a
 = 0;

74 
m_d©aToT¿nsm™
 = 
d©aToT¿nsm™
;

75 
	}
}

77 
	gPack‘ScheduËr
::
FlowToScheduË
::~
	$FlowToScheduË
()

78 {
	}
}

81 
Pack‘ScheduËr
::
	$C»©eFlowsToScheduË
 ()

83 
m_æowsToScheduË
 = 
Ãw
 
	`FlowsToScheduË
 ();

84 
	}
}

87 
	gPack‘ScheduËr
::
	$D–‘eFlowsToScheduË
 ()

89 
	`CË¬FlowsToScheduË
 ();

90 
d–‘e
 
m_æowsToScheduË
;

91 
	}
}

93 
	gPack‘ScheduËr
::
FlowsToScheduË
*

94 
Pack‘ScheduËr
::
	$G‘FlowsToScheduË
 () const

96  
m_æowsToScheduË
;

97 
	}
}

100 
	gPack‘ScheduËr
::
	$CË¬FlowsToScheduË
 ()

102 
FlowsToScheduË
* 
»cÜds
 = 
	`G‘FlowsToScheduË
 ();

103 
FlowsToScheduË
::
™”©Ü
 
™”
;

105 
™”
 = 
»cÜds
->
	`begš
(); i‹¸!ğ»cÜds->
	`’d
 (); iter++)

107 
d–‘e
 *
™”
;

110 
	`G‘FlowsToScheduË
 ()->
	`ş—r
 ();

111 
	}
}

113 
RadioB—»r
*

114 
	gPack‘ScheduËr
::
FlowToScheduË
::
	$G‘B—»r
 ()

116  
m_b—»r
;

117 
	}
}

120 
	gPack‘ScheduËr
::
FlowToScheduË
::
S‘S³ù¿lEffic›ncy
 (
¡d
::
veùÜ
<> 
s
)

122 
m_¥eù¿lEffic›ncy
 = 
s
;

125 
	g¡d
::
veùÜ
<>

126 
Pack‘ScheduËr
::
FlowToScheduË
::
	$G‘S³ù¿lEffic›ncy
 ()

128  
m_¥eù¿lEffic›ncy
;

129 
	}
}

132 
	gPack‘ScheduËr
::
FlowToScheduË
::
	$Upd©eAÎoÿ‹dB™s
 (
®loÿ‹dB™s
)

134 
m_®loÿ‹dB™s
 +ğ
®loÿ‹dB™s
;

135 
avaabËBy‹s
 = 
m_®loÿ‹dB™s
/8;

137 
Œªsm™‹dPack‘s
 = 
û


138 (
avaabËBy‹s
/1513.0);

140 
m_Œªsm™‹dD©a
 = 
avaabËBy‹s
 - (
Œªsm™‹dPack‘s
 * 8);

141 ià(
m_Œªsm™‹dD©a
 < 0)

143 
m_Œªsm™‹dD©a
 = 0;

145 
	}
}

148 
	gPack‘ScheduËr
::
FlowToScheduË
::
	$G‘AÎoÿ‹dB™s
 () const

150  
m_®loÿ‹dB™s
;

151 
	}
}

154 
	gPack‘ScheduËr
::
FlowToScheduË
::
	$G‘T¿nsm™‹dD©a
 () const

156  
m_Œªsm™‹dD©a
;

157 
	}
}

160 
	gPack‘ScheduËr
::
FlowToScheduË
::
	$S‘D©aToT¿nsm™
 (
d©aToT¿nsm™
)

162 
m_d©aToT¿nsm™
 = 
d©aToT¿nsm™
;

163 
	}
}

166 
	gPack‘ScheduËr
::
FlowToScheduË
::
	$G‘D©aToT¿nsm™
 () const

168  
m_d©aToT¿nsm™
;

169 
	}
}

171 
	g¡d
::
veùÜ
<>*

172 
Pack‘ScheduËr
::
FlowToScheduË
::
	$G‘Li¡OfAÎoÿ‹dRBs
 ()

174  &
m_li¡OfAÎoÿ‹dRBs
;

175 
	}
}

177 
	g¡d
::
veùÜ
<>*

178 
Pack‘ScheduËr
::
FlowToScheduË
::
	$G‘Li¡OfS–eùedMCS
 ()

180  &
m_li¡OfS–eùedMCS
;

181 
	}
}

184 
	gPack‘ScheduËr
::
FlowToScheduË
::
S‘CqiF“dbacks
 (
¡d
::
veùÜ
<> 
cqiF“dbacks
)

186 
m_cqiF“dbacks
 = 
cqiF“dbacks
;

189 
	g¡d
::
veùÜ
<>

190 
Pack‘ScheduËr
::
FlowToScheduË
::
	$G‘CqiF“dbacks
 ()

192  
m_cqiF“dbacks
;

193 
	}
}

196 
	gPack‘ScheduËr
::
In£¹FlowToScheduË
 (
RadioB—»r
* 
b—»r
, 
d©aToT¿nsm™
, 
¡d
::
veùÜ
<> 
¥ecEff
, std::veùÜ<> 
cqiF“dbacks
)

198 #ifdeà
SCHEDULER_DEBUG


199 
¡d
::
cout
 << "\t --> selected flow: "

200 << 
b—»r
->
G‘AµliÿtiÚ
 ()->
G‘AµliÿtiÚID
 ()

201 << " " << 
d©aToT¿nsm™
 << 
¡d
::
’dl
;

204 
FlowToScheduË
 *
	gæowToScheduË
 = 
Ãw
 FlowToScheduË(
b—»r
, 
d©aToT¿nsm™
);

205 
	gæowToScheduË
->
S‘S³ù¿lEffic›ncy
 (
¥ecEff
);

206 
	gæowToScheduË
->
S‘CqiF“dbacks
 (
cqiF“dbacks
);

208 
G‘FlowsToScheduË
 ()->
push_back
(
æowToScheduË
);

212 
	gPack‘ScheduËr
::
	$Upd©eAÎoÿ‹dB™s
 (
FlowToScheduË
* 
scheduËdFlow
, 
®loÿ‹dB™s
, 
®loÿ‹dRB
, 
£ËùedMCS
)

214 
scheduËdFlow
->
	`Upd©eAÎoÿ‹dB™s
 (
®loÿ‹dB™s
);

215 
scheduËdFlow
->
	`G‘Li¡OfAÎoÿ‹dRBs
()->
	`push_back
(
®loÿ‹dRB
);

216 
scheduËdFlow
->
	`G‘Li¡OfS–eùedMCS
()->
	`push_back
(
£ËùedMCS
);

217 
	}
}

221 
	gPack‘ScheduËr
::
	$CheckFÜDLDrİPack‘s
 ()

223 
RrcEÁ™y
 *
¼c
 = 
	`G‘MacEÁ™y
 ()->
	`G‘Deviû
 ()->
	`G‘PrÙocŞSck
 ()->
	`G‘RrcEÁ™y
 ();

224 
RrcEÁ™y
::
RadioB—»rsCÚš”
* 
b—»rs
 = 
¼c
->
	`G‘RadioB—»rCÚš”
 ();

226 
¡d
::
veùÜ
<
RadioB—»r
* >::
™”©Ü
 
™
 = 
b—»rs
->
	`begš
 (); iˆ!ğb—»rs->
	`’d
 (); it++)

229 (*
™
)->
	`G‘MacQueue
 ()->
	`CheckFÜDrİPack‘s
 (

230 (*
™
)->
	`G‘QoSP¬am‘”s
 ()->
	`G‘MaxD–ay
 (), (*™)->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚID
 ());

233 ià((*
™
)->
	`G‘RlcEÁ™y
()->
	`G‘RlcMod–
(è=ğ
RlcEÁ™y
::
AM_RLC_MODE
)

235 
AmRlcEÁ™y
* 
amRlc
 = (AmRlcEÁ™y*è(*
™
)->
	`G‘RlcEÁ™y
();

236 
amRlc
->
	`CheckFÜDrİPack‘s
 (

237 (*
™
)->
	`G‘QoSP¬am‘”s
 ()->
	`G‘MaxD–ay
 (), (*™)->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚID
 ());

240 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/packet-scheduler.h

1 #iâdeà
PACKETSCHEDULER_H_


2 
	#PACKETSCHEDULER_H_


	)

4 
	~<veùÜ
>

5 
	~"../../../cÜe/id—lMes§ges/id—l-cÚŒŞ-mes§ges.h
"

7 
şass
 
	gMacEÁ™y
;

8 
şass
 
	gPack‘Bur¡
;

9 
şass
 
	gPack‘
;

10 
şass
 
	gRadioB—»r
;

12 şas 
	cPack‘ScheduËr
 {

13 
	mpublic
:

14 
Pack‘ScheduËr
();

15 
	mvœtu®
 ~
Pack‘ScheduËr
();

17 
De¡roy
 ();

19 
S‘MacEÁ™y
 (
MacEÁ™y
* 
mac
);

20 
MacEÁ™y
* 
G‘MacEÁ™y
 ();

22 
ScheduË
 ();

23 
vœtu®
 
DoScheduË
 ();

25 
StİScheduË
 ();

26 
vœtu®
 
DoStİScheduË
 ();

28 
	sFlowToScheduË


30 
FlowToScheduË
(
RadioB—»r
* 
b—»r
,

31 
d©aToT¿nsm™
);

32 
	mvœtu®
 ~
FlowToScheduË
();

33 
RadioB—»r
* 
	mm_b—»r
;

34 
	mm_®loÿ‹dB™s
;

35 
	mm_Œªsm™‹dD©a
;

36 
	mm_d©aToT¿nsm™
;

38 
	m¡d
::
veùÜ
<> 
m_¥eù¿lEffic›ncy
;

39 
	m¡d
::
veùÜ
<> 
m_li¡OfAÎoÿ‹dRBs
;

40 
	m¡d
::
veùÜ
<> 
m_li¡OfS–eùedMCS
;

41 
	m¡d
::
veùÜ
<> 
m_cqiF“dbacks
;

43 
RadioB—»r
* 
G‘B—»r
 ();

45 
Upd©eAÎoÿ‹dB™s
 (
®loÿ‹dB™s
);

46 
G‘AÎoÿ‹dB™s
 () const;

47 
G‘T¿nsm™‹dD©a
 () const;

48 
S‘D©aToT¿nsm™
 (
d©aToT¿nsm™
);

49 
G‘D©aToT¿nsm™
 () const;

51 
S‘S³ù¿lEffic›ncy
 (
¡d
::
veùÜ
<> 
s
);

52 
	m¡d
::
veùÜ
<> 
G‘S³ù¿lEffic›ncy
 ();

54 
	m¡d
::
veùÜ
<>* 
G‘Li¡OfAÎoÿ‹dRBs
 ();

55 
	m¡d
::
veùÜ
<>* 
G‘Li¡OfS–eùedMCS
 ();

57 
S‘CqiF“dbacks
 (
¡d
::
veùÜ
<> 
cqiF“dbacks
);

58 
	m¡d
::
veùÜ
<> 
G‘CqiF“dbacks
 ();

61 
	g¡d
::
	tveùÜ
<
	tFlowToScheduË
*> 
	tFlowsToScheduË
;

63 
C»©eFlowsToScheduË
 ();

64 
D–‘eFlowsToScheduË
 ();

65 
CË¬FlowsToScheduË
 ();

67 
FlowsToScheduË
* 
	$G‘FlowsToScheduË
 () const;

69 
	`In£¹FlowToScheduË
 (
RadioB—»r
* 
b—»r
,

70 
d©aToT¿nsm™
,

71 
¡d
::
veùÜ
<> 
¥ecEff
,

72 
¡d
::
veùÜ
<> 
cqiF“dbacks
);

74 
	`Upd©eAÎoÿ‹dB™s
 (
FlowToScheduË
* 
scheduËdFlow
,

75 
®loÿ‹dB™s
,

76 
®loÿ‹dRB
,

77 
£ËùedMCS
);

79 
	`CheckFÜDLDrİPack‘s
();

82 
´iv©e
:

83 
MacEÁ™y
 *
m_mac
;

84 
FlowsToScheduË
 *
m_æowsToScheduË
;

85 
	}
};

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/ue-mac-entity.cc

3 
	~"ue-mac-’t™y.h
"

4 
	~"../·ck‘/Pack‘.h
"

5 
	~"../·ck‘/·ck‘-bur¡.h
"

6 
	~"AMCModuË.h
"

7 
	~"../../cÜe/id—lMes§ges/id—l-cÚŒŞ-mes§ges.h
"

8 
	~"../../deviû/N‘wÜkNode.h
"

11 
	gUeMacEÁ™y
::
	$UeMacEÁ™y
 ()

13 
	`S‘AmcModuË
 (
Ãw
 
	`AMCModuË
 ());

14 
	`S‘Deviû
 (
NULL
);

15 
	}
}

18 
	gUeMacEÁ™y
::~
	$UeMacEÁ™y
 ()

20 
	`De¡roy
 ();

21 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/mac/ue-mac-entity.h

2 #iâdeà
UE_MAC_ENTITY_H


3 
	#UE_MAC_ENTITY_H


	)

5 
	~<li¡
>

6 
	~"mac-’t™y.h
"

11 şas 
	cUeMacEÁ™y
 : 
public
 
MacEÁ™y


13 
public
:

15 
UeMacEÁ™y
 ();

16 
	mvœtu®
 ~
UeMacEÁ™y
 ();

18 
	m´iv©e
:

	@/home/lyang3/work/src_son/runWorld/protocolStack/nas/nas-entity.cpp

3 
	~"Çs-’t™y.h
"

4 
	~"../../deviû/N‘wÜkNode.h
"

7 
	gNasEÁ™y
::
	$NasEÁ™y
()

9 
m_deviû
 = 
NULL
;

10 
	}
}

12 
	gNasEÁ™y
::~
	$NasEÁ™y
()

14 
m_deviû
 = 0;

15 
	}
}

18 
	gNasEÁ™y
::
	$S‘Deviû
 (
N‘wÜkNode
* 
d
)

20 
m_deviû
 = 
d
;

21 
	}
}

23 
N‘wÜkNode
*

24 
	gNasEÁ™y
::
	$G‘Deviû
 ()

26  
m_deviû
;

27 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/nas/nas-entity.h

2 #iâdeà
NASENTITY_H_


3 
	#NASENTITY_H_


	)

5 
şass
 
	gN‘wÜkNode
;

7 şas 
	cNasEÁ™y
 {

8 
	mpublic
:

9 
NasEÁ™y
();

10 
	mvœtu®
 ~
NasEÁ™y
();

12 
S‘Deviû
 (
N‘wÜkNode
* 
d
);

13 
N‘wÜkNode
* 
G‘Deviû
 ();

15 
	m´iv©e
:

16 
N‘wÜkNode
* 
m_deviû
;

	@/home/lyang3/work/src_son/runWorld/protocolStack/packet/Header.cpp

1 
	~"H—d”.h
"

3 
	gH—d”
::
	$H—d”
()

4 {
	}
}

6 
H—d”
::~
	$H—d”
()

7 {
	}
}

10 
H—d”
::
	$S‘PrÙocŞH—d”
 (
PrÙocŞH—d”
 
´ÙocŞH—d”
)

12 
m_´ÙocŞH—d”
 = 
´ÙocŞH—d”
;

13 
	}
}

15 
	gH—d”
::
PrÙocŞH—d”


16 
H—d”
::
	$G‘PrÙocŞH—d”
 () const

18  
m_´ÙocŞH—d”
;

19 
	}
}

22 
	gH—d”
::
	$S‘H—d”Size
 (
size
)

24 
m_size
 = 
size
;

25 
	}
}

28 
	gH—d”
::
	$G‘H—d”Size
 () const

30  
m_size
;

31 
	}
}

38 
	gT¿n¥ÜtH—d”
::
	$T¿n¥ÜtH—d”
()

39 {
	}
}

41 
T¿n¥ÜtH—d”
::~
	$T¿n¥ÜtH—d”
()

42 {
	}
}

45 
T¿n¥ÜtH—d”
::
	$S‘SourûPÜt
 (
pÜt
)

47 
m_sourûPÜt
 = 
pÜt
;

48 
	}
}

51 
	gT¿n¥ÜtH—d”
::
	$G‘SourûPÜt
 () const

53  
m_sourûPÜt
;

54 
	}
}

57 
	gT¿n¥ÜtH—d”
::
	$S‘De¡š©iÚPÜt
 (
pÜt
)

59 
m_de¡š©iÚPÜt
 = 
pÜt
;

60 
	}
}

63 
	gT¿n¥ÜtH—d”
::
	$G‘De¡š©iÚPÜt
 () const

65  
m_de¡š©iÚPÜt
;

66 
	}
}

69 
	gT¿n¥ÜtH—d”
::
	$S‘PrÙocŞTy³
 (
T¿n¥ÜtPrÙocŞ
::
T¿n¥ÜtPrÙocŞTy³
 
´ÙocŞ
)

71 
m_´ÙocŞTy³
 = 
´ÙocŞ
;

72 
	}
}

74 
	gT¿n¥ÜtPrÙocŞ
::
T¿n¥ÜtPrÙocŞTy³


75 
T¿n¥ÜtH—d”
::
	$G‘PrÙocŞTy³
 () const

77  
m_´ÙocŞTy³
;

78 
	}
}

84 
	gUDPH—d”
::
	$UDPH—d”
()

85 {
	}
}

87 
UDPH—d”
::
	$UDPH—d”
(
sourûPÜt
, 
de¡š©iÚPÜt
)

89 
	`S‘SourûPÜt
 (
sourûPÜt
);

90 
	`S‘De¡š©iÚPÜt
 (
de¡š©iÚPÜt
);

91 
	`S‘PrÙocŞH—d”
 (
H—d”
::
HEADER_UDP
);

92 
	`S‘H—d”Size
 (8);

93 
	`S‘PrÙocŞTy³
 (
T¿n¥ÜtPrÙocŞ
::
TRANSPORT_PROTOCOL_TYPE_UDP
);

94 
	}
}

96 
	gUDPH—d”
::~
	$UDPH—d”
()

97 {
	}
}

104 
IPH—d”
::
	$IPH—d”
()

106 
	`S‘PrÙocŞH—d”
 (
H—d”
::
HEADER_IP
);

107 
	`S‘H—d”Size
 (20);

108 
	}
}

110 
	gIPH—d”
::
	$IPH—d”
(
sourûID
, 
de¡š©iÚID
)

112 
m_sourûID
 = 
sourûID
;

113 
m_de¡š©iÚID
 = 
de¡š©iÚID
;

114 
	`S‘PrÙocŞH—d”
 (
H—d”
::
HEADER_IP
);

115 
	`S‘H—d”Size
 (20);

116 
	}
}

118 
	gIPH—d”
::~
	$IPH—d”
()

119 {
	}
}

122 
IPH—d”
::
	$S‘SourûID
 (
id
)

124 
m_sourûID
 = 
id
;

125 
	}
}

128 
	gIPH—d”
::
	$G‘SourûID
 () const

130  
m_sourûID
;

131 
	}
}

134 
	gIPH—d”
::
	$S‘De¡š©iÚID
 (
id
)

136 
m_de¡š©iÚID
 = 
id
;

137 
	}
}

140 
	gIPH—d”
::
	$G‘De¡š©iÚID
 () const

142  
m_de¡š©iÚID
;

143 
	}
}

150 
	gPDCPH—d”
::
	$PDCPH—d”
()

152 
	`S‘PrÙocŞH—d”
 (
H—d”
::
HEADER_PDCP
);

153 
	`S‘H—d”Size
 (2);

154 
	}
}

156 
	gPDCPH—d”
::~
	$PDCPH—d”
()

157 {
	}
}

165 
RLCH—d”
::
	$RLCH—d”
()

167 
	`S‘PrÙocŞH—d”
 (
H—d”
::
HEADER_RLC
);

168 
	`S‘H—d”Size
 (2);

169 
m_isAF¿gm’t
 = 
çl£
;

170 
m_isTheL©e¡F¿gm’t
 = 
Œue
;

171 
m_äagm’tNumb”
 = 0;

172 
m_¾cEÁ™yIndex
 = -1;

173 
m_¡¬tBy‹
 = 0;

174 
m_’dBy‹
 = 0;

175 
	}
}

177 
	gRLCH—d”
::~
	$RLCH—d”
()

178 {
	}
}

180 
boŞ


181 
RLCH—d”
::
	$IsTheL©e¡F¿gm’t
 ()

183  
m_isTheL©e¡F¿gm’t
;

184 
	}
}

186 
boŞ


187 
	gRLCH—d”
::
	$IsAF¿gm’t
 ()

189 ià(
m_isAF¿gm’t
 =ğ
çl£
)

190  
çl£
;

192  
m_isAF¿gm’t
;

193 
	}
}

196 
	gRLCH—d”
::
	$S‘TheL©e¡F¿gm’t
 (
boŞ
 
æag
)

198 
m_isTheL©e¡F¿gm’t
 = 
æag
;

199 
	}
}

202 
	gRLCH—d”
::
	$S‘AF¿gm’t
 (
boŞ
 
æag
)

204 
m_isAF¿gm’t
 = 
æag
;

205 
	}
}

208 
	gRLCH—d”
::
	$S‘F¿gm’tNumb”
 (
n
)

210 
m_äagm’tNumb”
 = 
n
;

211 
	}
}

214 
	gRLCH—d”
::
	$G‘F¿gm’tNumb”
 ()

216  
m_äagm’tNumb”
;

217 
	}
}

220 
	gRLCH—d”
::
	$S‘RlcEÁ™yIndex
 (
i
)

222 
m_¾cEÁ™yIndex
 = 
i
;

223 
	}
}

226 
	gRLCH—d”
::
	$G‘RlcEÁ™yIndex
 ()

228  
m_¾cEÁ™yIndex
;

229 
	}
}

232 
	gRLCH—d”
::
	$S‘RlcPduSequ’ûNumb”
 (
i
)

234 
m_¾cPduSequ’ûNumb”
 = 
i
;

235 
	}
}

238 
	gRLCH—d”
::
	$G‘RlcPduSequ’ûNumb”
 ()

240  
m_¾cPduSequ’ûNumb”
;

241 
	}
}

244 
	gRLCH—d”
::
	$S‘S¹By‹
 (
b
)

246 
m_¡¬tBy‹
 = 
b
;

247 
	}
}

250 
	gRLCH—d”
::
	$S‘EndBy‹
 (
b
)

252 
m_’dBy‹
 = 
b
;

253 
	}
}

256 
	gRLCH—d”
::
	$G‘S¹By‹
 ()

258  
m_¡¬tBy‹
;

259 
	}
}

261 
	gRLCH—d”
::
	$G‘EndBy‹
 ()

263  
m_’dBy‹
;

264 
	}
}

269 
	gMACH—d”
::
	$MACH—d”
()

271 
	`S‘PrÙocŞH—d”
 (
H—d”
::
HEADER_MAC
);

272 
	`S‘H—d”Size
 (3);

274 
m_macSourûID
 = 0;

275 
m_macDe¡š©iÚID
 = 0;

277 
	}
}

279 
	gMACH—d”
::
	$MACH—d”
(
sourûMAC
, 
de¡š©iÚMAC
)

281 
	`S‘PrÙocŞH—d”
 (
H—d”
::
HEADER_MAC
);

282 
	`S‘H—d”Size
 (3);

284 
m_macSourûID
 = 
sourûMAC
;

285 
m_macDe¡š©iÚID
 = 
de¡š©iÚMAC
;

286 
	}
}

288 
	gMACH—d”
::~
	$MACH—d”
()

289 {
	}
}

292 
MACH—d”
::
	$S‘MACsourûID
 (
id
)

294 
m_macSourûID
 = 
id
;

295 
	}
}

298 
	gMACH—d”
::
	$G‘MACsourûID
 () const

300  
m_macSourûID
;

301 
	}
}

304 
	gMACH—d”
::
	$S‘MACde¡š©iÚID
 (
id
)

306 
m_macDe¡š©iÚID
 = 
id
;

307 
	}
}

310 
	gMACH—d”
::
	$G‘MACde¡š©iÚID
 () const

312  
m_macDe¡š©iÚID
;

313 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/packet/Header.h

4 #iâdeà
HEADER_H_


5 
	#HEADER_H_


	)

7 
	~"../´ÙocŞs/T¿n¥ÜtPrÙocŞ.h
"

9 şas 
	cH—d”
 {

10 
	mpublic
:

11 
	ePrÙocŞH—d”


13 
HEADER_UDP
,

14 
	mHEADER_TCP
,

15 
	mHEADER_IP
,

16 
	mHEADER_PDCP
,

17 
	mHEADER_RLC
,

18 
	mHEADER_MAC


21 
H—d”
();

22 
	gvœtu®
 ~
H—d”
();

25 
S‘PrÙocŞH—d”
 (
PrÙocŞH—d”
 
´ÙocŞH—d”
);

26 
PrÙocŞH—d”


27 
	$G‘PrÙocŞH—d”
 () const;

30 
	`S‘H—d”Size
 (
size
);

32 
	$G‘H—d”Size
 () const;

34 
´iv©e
:

35 
m_size
;

36 
PrÙocŞH—d”
 
m_´ÙocŞH—d”
;

37 
	}
};

43 şas 
	cT¿n¥ÜtH—d”
 : 
public
 
H—d”
{

44 
public
:

45 
T¿n¥ÜtH—d”
();

46 
	mvœtu®
 ~
T¿n¥ÜtH—d”
();

49 
S‘SourûPÜt
 (
pÜt
);

51 
	$G‘SourûPÜt
 () const;

53 
	`S‘De¡š©iÚPÜt
 (
pÜt
);

55 
	$G‘De¡š©iÚPÜt
 () const;

58 
	`S‘PrÙocŞTy³
 (
T¿n¥ÜtPrÙocŞ
::
T¿n¥ÜtPrÙocŞTy³
 
´ÙocŞ
);

59 
T¿n¥ÜtPrÙocŞ
::
T¿n¥ÜtPrÙocŞTy³


60 
	$G‘PrÙocŞTy³
 () const;

62 
´iv©e
:

63 
m_sourûPÜt
;

64 
m_de¡š©iÚPÜt
;

65 
T¿n¥ÜtPrÙocŞ
::
T¿n¥ÜtPrÙocŞTy³
 
m_´ÙocŞTy³
;

71 şas 
	cUDPH—d”
 : 
public
 
T¿n¥ÜtH—d”
 {

72 
public
:

73 
	`UDPH—d”
();

74 
	`UDPH—d”
(
sourûPÜt
, 
de¡š©iÚPÜt
);

75 
vœtu®
 ~
	`UDPH—d”
();

83 şas 
	cIPH—d”
 : 
public
 
H—d”
 {

84 
public
:

85 
	`IPH—d”
();

86 
	`IPH—d”
(
sourûID
, 
de¡š©iÚID
);

87 
vœtu®
 ~
	`IPH—d”
();

90 
	`S‘SourûID
 (
id
);

92 
	$G‘SourûID
 () const;

94 
	`S‘De¡š©iÚID
 (
id
);

96 
	$G‘De¡š©iÚID
 () const;

98 
´iv©e
:

99 
m_sourûID
;

100 
m_de¡š©iÚID
;

107 şas 
	cPDCPH—d”
 : 
public
 
H—d”
 {

108 
public
:

109 
	`PDCPH—d”
();

110 
vœtu®
 ~
	`PDCPH—d”
();

118 şas 
	cRLCH—d”
 : 
public
 
H—d”
 {

119 
public
:

120 
	`RLCH—d”
();

121 
vœtu®
 ~
	`RLCH—d”
();

123 
boŞ
 
	`IsTheL©e¡F¿gm’t
 ();

124 
boŞ
 
	`IsAF¿gm’t
 ();

125 
	`S‘TheL©e¡F¿gm’t
 (
boŞ
 
æag
);

126 
	`S‘AF¿gm’t
 (
boŞ
 
æag
);

128 
	`S‘F¿gm’tNumb”
 (
n
);

129 
	`G‘F¿gm’tNumb”
 ();

131 
	`S‘RlcEÁ™yIndex
 (
i
);

132 
	`G‘RlcEÁ™yIndex
 ();

134 
	`S‘RlcPduSequ’ûNumb”
 (
i
);

135 
	`G‘RlcPduSequ’ûNumb”
 ();

137 
	`S‘S¹By‹
 (
b
);

138 
	`S‘EndBy‹
 (
b
);

139 
	`G‘S¹By‹
 ();

140 
	`G‘EndBy‹
 ();

142 
´iv©e
:

143 
boŞ
 
m_isAF¿gm’t
;

144 
boŞ
 
m_isTheL©e¡F¿gm’t
;

145 
m_äagm’tNumb”
;

146 
m_¾cEÁ™yIndex
;

148 
m_¾cPduSequ’ûNumb”
;

150 
m_¡¬tBy‹
;

151 
m_’dBy‹
;

158 şas 
	cMACH—d”
 : 
public
 
H—d”
 {

159 
public
:

160 
	`MACH—d”
();

161 
	`MACH—d”
 (
sourûMAC
, 
de¡š©iÚMAC
);

162 
vœtu®
 ~
	`MACH—d”
();

169 
	`S‘MACsourûID
 (
id
);

171 
	$G‘MACsourûID
 () const;

173 
	`S‘MACde¡š©iÚID
 (
id
);

175 
	$G‘MACde¡š©iÚID
 () const;

177 
´iv©e
:

178 
m_macSourûID
;

179 
m_macDe¡š©iÚID
;

	@/home/lyang3/work/src_son/runWorld/protocolStack/packet/Packet.cpp

2 
	~"Pack‘.h
"

3 
	~"../../cÜe/ev’tScheduËr/simuÏtÜ.h
"

4 
	~<io¡»am
>

6 
	gPack‘
::
	$Pack‘
()

8 
m_UDPH—d”
 = 
NULL
;

9 
m_IPH—d”
 = 
NULL
;

10 
m_PDCPH—d”
 = 
NULL
;

11 
m_RLCH—d”
 = 
NULL
;

12 
m_MACH—d”
 = 
NULL
;

13 
m_gs
 = 
NULL
;

15 
m_id
 = 0;

16 
m_timeSmp
 = 0;

17 
m_size
 = 0;

18 
	}
}

20 
	gPack‘
::~
	$Pack‘
()

22 
d–‘e
 
m_UDPH—d”
;

23 
d–‘e
 
m_IPH—d”
;

24 
d–‘e
 
m_PDCPH—d”
;

25 
d–‘e
 
m_RLCH—d”
;

26 
d–‘e
 
m_MACH—d”
;

27 
d–‘e
 
m_gs
;

28 
	}
}

31 
	gPack‘
::
	$S‘TimeSmp
 (
time
)

33 
m_timeSmp
 = 
time
;

34 
	}
}

37 
	gPack‘
::
	$G‘TimeSmp
 () const

39  
m_timeSmp
;

40 
	}
}

43 
	gPack‘
::
	$S‘Size
 (
size
)

45 
m_size
 = 
size
;

46 
	}
}

49 
	gPack‘
::
	$G‘Size
 () const

51  
m_size
;

52 
	}
}

55 
	gPack‘
::
	$AddH—d”Size
 (
size
)

57 
m_size
 +ğ
size
;

58 
	}
}

61 
	gPack‘
::
	$Upd©ePack‘Size
 ()

62 {
	}
}

65 
Pack‘
::
	$AddUDPH—d”
 (
UDPH—d”
 *
h—d”
)

67 
m_UDPH—d”
 = 
h—d”
;

68 
	`AddH—d”Size
 (8);

69 
	}
}

71 
UDPH—d”
*

72 
	gPack‘
::
	$G‘UDPH—d”
 () const

74  
m_UDPH—d”
;

75 
	}
}

78 
	gPack‘
::
	$AddIPH—d”
 (
IPH—d”
 *
h—d”
)

80 
m_IPH—d”
 = 
h—d”
;

81 
	`AddH—d”Size
 (20);

82 
	}
}

84 
IPH—d”
*

85 
	gPack‘
::
	$G‘IPH—d”
 ()

87  
m_IPH—d”
;

88 
	}
}

91 
	gPack‘
::
	$AddPDCPH—d”
 (
PDCPH—d”
 *
h—d”
)

93 
m_PDCPH—d”
 = 
h—d”
;

96 
ÃwPack‘Size
 = 
	`G‘Size
 () - 28 + 3;

97 
	`S‘Size
 (
ÃwPack‘Size
);

99 
	`AddH—d”Size
 (2);

100 
	}
}

102 
PDCPH—d”
*

103 
	gPack‘
::
	$G‘PDCPH—d”
 () const

105  
m_PDCPH—d”
;

107 
	}
}

110 
	gPack‘
::
	$AddRLCH—d”
 (
RLCH—d”
 *
h—d”
)

112 
m_RLCH—d”
 = 
h—d”
;

113 
	`AddH—d”Size
 (
h—d”
->
	`G‘H—d”Size
());

114 
	}
}

116 
RLCH—d”
*

117 
	gPack‘
::
	$G‘RLCH—d”
 () const

119  
m_RLCH—d”
;

120 
	}
}

123 
	gPack‘
::
	$AddMACH—d”
 (
MACH—d”
 *
h—d”
)

125 
m_MACH—d”
 = 
h—d”
;

126 
	`AddH—d”Size
(
h—d”
->
	`G‘H—d”Size
());

127 
	}
}

129 
MACH—d”
*

130 
	gPack‘
::
	$G‘MACH—d”
 () const

132  
m_MACH—d”
;

133 
	}
}

137 
	gPack‘
::
	$G‘SourûID
 ()

139  
	`G‘IPH—d”
 ()->
	`G‘SourûID
 ();

140 
	}
}

143 
	gPack‘
::
	$G‘De¡š©iÚID
 ()

145  
	`G‘IPH—d”
 ()->
	`G‘De¡š©iÚID
 ();

146 
	}
}

149 
	gPack‘
::
	$G‘SourûPÜt
 ()

151  
	`G‘UDPH—d”
 ()->
	`G‘SourûPÜt
();

152 
	}
}

155 
	gPack‘
::
	$G‘De¡š©iÚPÜt
 ()

157  
	`G‘UDPH—d”
 ()->
	`G‘De¡š©iÚPÜt
();

158 
	}
}

161 
	gPack‘
::
	$G‘SourûMAC
 ()

163  
	`G‘MACH—d”
()->
	`G‘MACsourûID
();

164 
	}
}

167 
	gPack‘
::
	$G‘De¡š©iÚMAC
 ()

169  
	`G‘MACH—d”
()->
	`G‘MACde¡š©iÚID
();

170 
	}
}

173 
	gPack‘
::
	$S‘ID
 (
uid
)

175 
m_id
 = 
uid
;

176 
	}
}

179 
	gPack‘
::
	$G‘ID
 ()

181  
m_id
;

182 
	}
}

184 
Pack‘TAGs
*

185 
	gPack‘
::
	$G‘Pack‘Tags
 () const

187  
m_gs
;

188 
	}
}

191 
	gPack‘
::
	$S‘Pack‘Tags
 (
Pack‘TAGs
* 
gs
)

193 
m_gs
 = 
gs
;

194 
	}
}

196 
Pack‘
*

197 
	gPack‘
::
	$Cİy
 ()

199 
Pack‘
 *
p
 = 
Ãw
 
	`Pack‘
 ();

200 
p
->
m_id
 = m_id;

201 
p
->
m_timeSmp
 = m_timeStamp;

203 ià(
m_UDPH—d”
 !ğ
NULL
)

205 
UDPH—d”
 *
udp
 = 
Ãw
 
	`UDPH—d”
 (
	`G‘SourûPÜt
(), 
	`G‘De¡š©iÚPÜt
());

206 
p
->
	`AddUDPH—d”
(
udp
);

209 ià(
m_IPH—d”
 !ğ
NULL
)

211 
IPH—d”
 *

 = 
Ãw
 
	`IPH—d”
 (
	`G‘SourûID
(), 
	`G‘De¡š©iÚID
());

212 
p
->
	`AddIPH—d”
(

);

215 ià(
m_PDCPH—d”
 !ğ
NULL
)

217 
PDCPH—d”
 *
pdı
 = 
Ãw
 
	`PDCPH—d”
 ();

218 
p
->
	`AddPDCPH—d”
 (
pdı
);

221 ià(
m_RLCH—d”
 !ğ
NULL
)

223 
RLCH—d”
 *
¾c
 = 
Ãw
 
	`RLCH—d”
 ();

225 ià(
	`G‘RLCH—d”
 ()->
	`IsAF¿gm’t
 ())

226 
¾c
->
	`S‘AF¿gm’t
 (
Œue
);

227 ià(!
	`G‘RLCH—d”
 ()->
	`IsTheL©e¡F¿gm’t
 ())

228 
¾c
->
	`S‘TheL©e¡F¿gm’t
 (
çl£
);

230 
¾c
->
	`S‘F¿gm’tNumb”
 (
	`G‘RLCH—d”
 ()->
	`G‘F¿gm’tNumb”
());

231 
¾c
->
	`S‘RlcEÁ™yIndex
 (
	`G‘RLCH—d”
 ()->
	`G‘RlcEÁ™yIndex
 ());

233 
¾c
->
	`S‘RlcPduSequ’ûNumb”
 (
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
());

234 
¾c
->
	`S‘S¹By‹
 (
	`G‘RLCH—d”
 ()->
	`G‘S¹By‹
 ());

235 
¾c
->
	`S‘EndBy‹
 (
	`G‘RLCH—d”
 ()->
	`G‘EndBy‹
 ());

237 
p
->
	`AddRLCH—d”
 (
¾c
);

240 ià(
m_MACH—d”
 !ğ
NULL
)

242 
MACH—d”
 *
mac
 = 
Ãw
 
	`MACH—d”
 (
	`G‘SourûMAC
 (), 
	`G‘De¡š©iÚMAC
 ());

243 
p
->
	`AddMACH—d”
(
mac
);

246 ià(
m_gs
 !ğ
NULL
)

248 
Pack‘TAGs
 *
gs
 = 
Ãw
 
	`Pack‘TAGs
 ();

249 
gs
->
	`S‘AµliÿtiÚTy³
(
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
());

250 
gs
->
	`S‘F¿meNumb”
 (
	`G‘Pack‘Tags
 ()->
	`G‘F¿meNub”
 ());

251 
gs
->
	`S‘S¹By‹
 (
	`G‘Pack‘Tags
 ()->
	`G‘S¹By‹
 ());

252 
gs
->
	`S‘EndBy‹
 (
	`G‘Pack‘Tags
 ()->
	`G‘EndBy‹
 ());

253 
gs
->
	`S‘AµliÿtiÚSize
 (
	`G‘Pack‘Tags
 ()->
	`G‘AµliÿtiÚSize
 ());

254 
p
->
	`S‘Pack‘Tags
(
gs
);

257 
p
->
m_size
 = m_size;

259  
p
;

260 
	}
}

264 
	gPack‘
::
	$Pršt
 ()

266 
¡d
::
cout
 <<

268 "\À ** ID " << 
	`G‘ID
 () <<

269 "imeSm°" << 
	`G‘TimeSmp
 () <<

270 "\À ** size: " << 
	`G‘Size
() <<

271 "\À ** sourûPÜˆ" << 
	`G‘SourûPÜt
() <<

272 " de¡š©iÚPÜˆ" << 
	`G‘De¡š©iÚPÜt
() <<

273 "\À ** srcIP " << 
	`G‘SourûID
() <<

274 " d¡IP " << 
	`G‘De¡š©iÚID
() <<

275 "\À ** srcMAC " << 
	`G‘SourûMAC
() <<

276 " d¡MAC " << 
	`G‘De¡š©iÚMAC
(è<< 
¡d
::
’dl
;

278 ià(
m_RLCH—d”
->
	`IsAF¿gm’t
())

279 
¡d
::
cout
 << " ** IsAFragment TRUE ";

281 
¡d
::
cout
 << " ** IsAFragment FALSE ";

283 ià(
m_RLCH—d”
->
	`IsTheL©e¡F¿gm’t
())

284 
¡d
::
cout
 << " IsTheLatestFragment TRUE ";

286 
¡d
::
cout
 << " IsTheLatestFragment FALSE ";

288 
¡d
::
cout
 << "\À**********" << std::
’dl
;

289 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/packet/Packet.h

4 #iâdeà
PACKET_H_


5 
	#PACKET_H_


	)

7 
	~<li¡
>

8 
	~"H—d”.h
"

9 
	~"Pack‘TAGs.h
"

11 şas 
	cPack‘
 {

12 
	mpublic
:

13 
Pack‘
();

14 
	mvœtu®
 ~
Pack‘
();

23 
S‘TimeSmp
 (
time
);

25 
	$G‘TimeSmp
 () const;

34 
	`S‘Size
 (
size
);

36 
	`AddH—d”Size
 (
size
);

38 
	$G‘Size
 () const;

40 
	`Upd©ePack‘Size
 ();

44 
	`AddUDPH—d”
 (
UDPH—d”
 *
h—d”
);

45 
UDPH—d”
*

46 
	$G‘UDPH—d”
 () const;

49 
	`AddIPH—d”
 (
IPH—d”
 *
h—d”
);

50 
IPH—d”
*

51 
	`G‘IPH—d”
 () ;

54 
	`AddPDCPH—d”
 (
PDCPH—d”
 *
h—d”
);

55 
PDCPH—d”
*

56 
	$G‘PDCPH—d”
 () const;

59 
	`AddRLCH—d”
 (
RLCH—d”
 *
h—d”
);

60 
RLCH—d”
*

61 
	$G‘RLCH—d”
 () const;

64 
	`AddMACH—d”
 (
MACH—d”
 *
h—d”
);

65 
MACH—d”
*

66 
	$G‘MACH—d”
 () const;

70 
	`G‘SourûID
 ();

72 
	`G‘De¡š©iÚID
 ();

74 
	`G‘SourûPÜt
 ();

76 
	`G‘De¡š©iÚPÜt
 ();

78 
	`G‘SourûMAC
 ();

80 
	`G‘De¡š©iÚMAC
 ();

83 
	`S‘ID
 (
uid
);

85 
	`G‘ID
 ();

87 
Pack‘TAGs
*

88 
	$G‘Pack‘Tags
 () const;

90 
	`S‘Pack‘Tags
 (
Pack‘TAGs
* 
gs
);

92 
Pack‘
*

93 
	`Cİy
 ();

96 
	`Pršt
 ();

98 
´iv©e
:

99 
m_timeSmp
;

100 
m_size
;

102 
m_id
;

104 
UDPH—d”
 *
m_UDPH—d”
;

105 
IPH—d”
 *
m_IPH—d”
;

106 
PDCPH—d”
 *
m_PDCPH—d”
;

107 
RLCH—d”
 *
m_RLCH—d”
;

108 
MACH—d”
 *
m_MACH—d”
;

110 
Pack‘TAGs
 *
m_gs
;

	@/home/lyang3/work/src_son/runWorld/protocolStack/packet/PacketTAGs.cpp

3 
	~"Pack‘TAGs.h
"

5 
	gPack‘TAGs
::
	$Pack‘TAGs
()

7 
m_ty³
 = 
Pack‘TAGs
::
APPLICATION_TYPE_INFINITE_BUFFER
;

8 
m_äameNumb”
 = 0;

9 
m_¡¬tBy‹
 = 0;

10 
m_’dBy‹s
 = 0;

11 
	}
}

13 
	gPack‘TAGs
::
	$Pack‘TAGs
(
Pack‘TAGs
::
AµliÿtiÚTy³
 
ty³
,

14 
äameNumb”
,

15 
¡¬tF¿me
,

16 
’dF¿me
)

18 
m_ty³
 = 
ty³
;

19 
m_äameNumb”
 = 
äameNumb”
;

20 
m_¡¬tBy‹
 = 
¡¬tF¿me
;

21 
m_’dBy‹s
 = 
’dF¿me
;

22 
	}
}

24 
	gPack‘TAGs
::~
	$Pack‘TAGs
()

26 
	}
}

29 
Pack‘TAGs
::
	$S‘F¿meNumb”
 (
äameNumb”
)

31 
m_äameNumb”
 = 
äameNumb”
;

32 
	}
}

35 
	gPack‘TAGs
::
	$G‘F¿meNub”
 () const

37  
m_äameNumb”
;

38 
	}
}

41 
	gPack‘TAGs
::
	$S‘S¹By‹
 (
¡¬tBy‹
)

43 
m_¡¬tBy‹
 = 
¡¬tBy‹
;

44 
	}
}

47 
	gPack‘TAGs
::
	$G‘S¹By‹
 () const

49  
m_¡¬tBy‹
;

50 
	}
}

53 
	gPack‘TAGs
::
	$S‘EndBy‹
 (
’dBy‹
)

55 
m_’dBy‹s
 = 
’dBy‹
;

56 
	}
}

59 
	gPack‘TAGs
::
	$G‘EndBy‹
 () const

61  
m_’dBy‹s
;

62 
	}
}

65 
	gPack‘TAGs
::
	$S‘AµliÿtiÚTy³
 (
Pack‘TAGs
::
AµliÿtiÚTy³
 
ty³
)

67 
m_ty³
 = 
ty³
;

68 
	}
}

70 
	gPack‘TAGs
::
AµliÿtiÚTy³


71 
Pack‘TAGs
::
	$G‘AµliÿtiÚTy³
 ()

73  
m_ty³
;

74 
	}
}

77 
	gPack‘TAGs
::
	$S‘AµliÿtiÚSize
 (
s
)

79 
m_­¶iÿtiÚSize
 = 
s
;

80 
	}
}

83 
	gPack‘TAGs
::
	$G‘AµliÿtiÚSize
 ()

85  
m_­¶iÿtiÚSize
;

86 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/packet/PacketTAGs.h

2 #iâdeà
PACKETTAGS_H_


3 
	#PACKETTAGS_H_


	)

5 
	~<veùÜ
>

7 şas 
	cPack‘TAGs
 {

8 
	mpublic
:

9 
	eAµliÿtiÚTy³


11 
APPLICATION_TYPE_VOIP
,

12 
	mAPPLICATION_TYPE_TRACE_BASED
,

13 
	mAPPLICATION_TYPE_INFINITE_BUFFER
,

14 
	mAPPLICATION_TYPE_CBR


17 
Pack‘TAGs
 ();

18 
Pack‘TAGs
(
AµliÿtiÚTy³
 
ty³
,

19 
äameNumb”
,

20 
¡¬tF¿me
,

21 
’dF¿me
);

23 
	gvœtu®
 ~
Pack‘TAGs
();

28 
S‘AµliÿtiÚTy³
 (
AµliÿtiÚTy³
 
ty³
);

29 
AµliÿtiÚTy³


30 
G‘AµliÿtiÚTy³
 ();

34 
S‘F¿meNumb”
 (
äameNumb”
);

36 
	$G‘F¿meNub”
 () const;

39 
	`S‘S¹By‹
 (
¡¬tBy‹
);

41 
	$G‘S¹By‹
 () const;

44 
	`S‘EndBy‹
 (
’dBy‹
);

46 
	$G‘EndBy‹
 () const;

48 
	`S‘AµliÿtiÚSize
 (
s
);

49 
	`G‘AµliÿtiÚSize
 ();

50 
´iv©e
:

51 
AµliÿtiÚTy³
 
m_ty³
;

54 
m_äameNumb”
;

55 
m_¡¬tBy‹
;

56 
m_’dBy‹s
;

58 
m_­¶iÿtiÚSize
;

59 
	}
};

	@/home/lyang3/work/src_son/runWorld/protocolStack/packet/packet-burst.cc

3 
	~"../../¡dšt.h
"

4 
	~<li¡
>

5 
	~"·ck‘-bur¡.h
"

8 
	gPack‘Bur¡
::
	$Pack‘Bur¡
 ()

10 
	}
}

12 
Pack‘Bur¡
::~
	$Pack‘Bur¡
 ()

14 
¡d
::
li¡
<
Pack‘
* >::
cÚ¡_™”©Ü
 
™”
 = 
m_·ck‘s
.
	`begš
 (); iter

15 !ğ
m_·ck‘s
.
	`’d
 (); ++
™”
)

17 
d–‘e
 *
™”
;

19 
m_·ck‘s
.
	`ş—r
();

20 
	}
}

22 
Pack‘Bur¡
*

23 
	gPack‘Bur¡
::
	$Cİy
 ()

25 
Pack‘Bur¡
* 
pb
 = 
Ãw
 
	`Pack‘Bur¡
 ();

27 
¡d
::
li¡
<
Pack‘
* > 
·ck‘s
 = 
	`G‘Pack‘s
 ();

28 
¡d
::
li¡
<
Pack‘
* >::
™”©Ü
 
™
;

30 
™
 = 
·ck‘s
.
	`begš
 (); iˆ!ğ·ck‘s.
	`’d
 (); it++)

32 
Pack‘
* 
·ck‘
 = (*
™
)->
	`Cİy
();

33 
pb
->
	`AddPack‘
 (
·ck‘
);

36  
pb
;

37 
	}
}

40 
	gPack‘Bur¡
::
	$AddPack‘
 (
Pack‘
* 
·ck‘
)

42 ià(
·ck‘
)

44 
m_·ck‘s
.
	`push_back
 (
·ck‘
);

46 
	}
}

48 
	g¡d
::
li¡
<
Pack‘
*>

49 
Pack‘Bur¡
::
	$G‘Pack‘s
 () const

51  
m_·ck‘s
;

52 
	}
}

54 
ušt32_t


55 
	gPack‘Bur¡
::
	$G‘NPack‘s
 () const

57  
m_·ck‘s
.
	`size
 ();

58 
	}
}

60 
ušt32_t


61 
	gPack‘Bur¡
::
	$G‘Size
 () const

63 
ušt32_t
 
size
 = 0;

64 
¡d
::
li¡
<
Pack‘
* >::
cÚ¡_™”©Ü
 
™”
 = 
m_·ck‘s
.
	`begš
 (); iter

65 !ğ
m_·ck‘s
.
	`’d
 (); ++
™”
)

67 
Pack‘
* 
·ck‘
 = *
™”
;

68 
size
 +ğ
·ck‘
->
	`G‘Size
 ();

70  
size
;

71 
	}
}

73 
	g¡d
::
li¡
<
Pack‘
* >::
cÚ¡_™”©Ü


74 
Pack‘Bur¡
::
	$Begš
 () const

76  
m_·ck‘s
.
	`begš
 ();

77 
	}
}

79 
	g¡d
::
li¡
<
Pack‘
* >::
cÚ¡_™”©Ü


80 
Pack‘Bur¡
::
	$End
 () const

82  
m_·ck‘s
.
	`’d
 ();

83 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/packet/packet-burst.h

2 #iâdeà
PACKET_BURST_H


3 
	#PACKET_BURST_H


	)

5 
	~"../../¡dšt.h
"

6 
	~<li¡
>

7 
	~"Pack‘.h
"

10 şas 
	cPack‘Bur¡


16 
	mpublic
:

17 
Pack‘Bur¡
 ();

18 
	mvœtu®
 ~
Pack‘Bur¡
 ();

20 
Pack‘Bur¡
* 
Cİy
 ();

21 
AddPack‘
 (
Pack‘
* 
·ck‘
);

22 
	m¡d
::
li¡
<
Pack‘
* > 
	$G‘Pack‘s
 () const;

23 
ušt32_t
 
	$G‘NPack‘s
 () const;

24 
ušt32_t
 
	$G‘Size
 () const;

26 
¡d
::
li¡
<
Pack‘
* >::
cÚ¡_™”©Ü
 
	$Begš
 () const;

27 
¡d
::
li¡
<
Pack‘
* >::
cÚ¡_™”©Ü
 
	$End
 () const;

29 
´iv©e
:

30 
¡d
::
li¡
<
Pack‘
* > 
m_·ck‘s
;

	@/home/lyang3/work/src_son/runWorld/protocolStack/pdcp/pdcp-entity.cpp

2 
	~"pdı-’t™y.h
"

4 
	gPdıEÁ™y
::
	$PdıEÁ™y
()

5 {
	}
}

7 
PdıEÁ™y
::~
	$PdıEÁ™y
()

8 {
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/pdcp/pdcp-entity.h

4 #iâdeà
PDCPNTITY_H_


5 
	#PDCPNTITY_H_


	)

7 şas 
	cPdıEÁ™y
 {

8 
	mpublic
:

9 
PdıEÁ™y
();

10 
	mvœtu®
 ~
PdıEÁ™y
();

	@/home/lyang3/work/src_son/runWorld/protocolStack/protocol-stack.cpp

3 
	~"´ÙocŞ-¡ack.h
"

4 
	~"../deviû/N‘wÜkNode.h
"

6 
	gPrÙocŞSck
::
	$PrÙocŞSck
()

8 
m_Çs
 = 
NULL
;

9 
m_¼c
 = 
NULL
;

10 
m_mac
 = 
NULL
;

11 
m_pdı
 = 
NULL
;

12 
	}
}

14 
	gPrÙocŞSck
::
	$PrÙocŞSck
(
N‘wÜkNode
* 
deviû
)

16 
m_¼c
 = 
Ãw
 
	`RrcEÁ™y
 ();

17 
m_¼c
->
	`S‘Deviû
 (
deviû
);

19 
m_pdı
 = 
Ãw
 
	`PdıEÁ™y
 ();

21 
m_Çs
 = 
Ãw
 
	`NasEÁ™y
 ();

22 
m_Çs
->
	`S‘Deviû
 (
deviû
);

24 ià(
deviû
->
	`G‘NodeTy³
(è=ğ
N‘wÜkNode
::
TYPE_ENODEB
)

26 
m_mac
 = 
Ãw
 
	`EnbMacEÁ™y
 ();

27 
m_mac
->
	`S‘Deviû
(
deviû
);

30 ià(
deviû
->
	`G‘NodeTy³
(è=ğ
N‘wÜkNode
::
TYPE_UE
)

32 
m_mac
 = 
Ãw
 
	`UeMacEÁ™y
 ();

33 
m_mac
->
	`S‘Deviû
(
deviû
);

38 
m_mac
 = 
NULL
;

41 
	}
}

43 
	gPrÙocŞSck
::~
	$PrÙocŞSck
()

45 
d–‘e
 
m_¼c
;

46 
d–‘e
 
m_mac
;

47 
d–‘e
 
m_Çs
;

48 
d–‘e
 
m_pdı
;

49 
	}
}

51 
RrcEÁ™y
*

52 
	gPrÙocŞSck
::
	$G‘RrcEÁ™y
 ()

54  
m_¼c
;

55 
	}
}

57 
MacEÁ™y
*

58 
	gPrÙocŞSck
::
	$G‘MacEÁ™y
 ()

60  
m_mac
;

61 
	}
}

63 
NasEÁ™y
*

64 
	gPrÙocŞSck
::
	$G‘NasEÁ™y
 ()

66  
m_Çs
;

67 
	}
}

69 
PdıEÁ™y
*

70 
	gPrÙocŞSck
::
	$G‘PdıEÁ™y
 ()

72  
m_pdı
;

73 
	}
}

76 
	gPrÙocŞSck
::
	$S‘NasEÁ™y
 (
NasEÁ™y
* 
e
)

78 
m_Çs
 = 
e
;

79 
	}
}

82 
	gPrÙocŞSck
::
	$S‘RrcEÁ™y
 (
RrcEÁ™y
* 
e
)

84 
m_¼c
 = 
e
;

85 
	}
}

88 
	gPrÙocŞSck
::
	$S‘MacEÁ™y
 (
MacEÁ™y
* 
e
)

90 
m_mac
 = 
e
;

91 
	}
}

94 
	gPrÙocŞSck
::
	$S‘PdıEÁ™y
 (
PdıEÁ™y
* 
e
)

96 
m_pdı
 = 
e
;

97 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/protocol-stack.h

3 #iâdeà
CONTROL_PLANE_PROTOCOL_STACK_H_


4 
	#CONTROL_PLANE_PROTOCOL_STACK_H_


	)

6 
	~"·ck‘/Pack‘.h
"

7 
	~"·ck‘/H—d”.h
"

8 
	~"·ck‘/Pack‘TAGs.h
"

9 
	~"´ÙocŞs/T¿n¥ÜtPrÙocŞ.h
"

10 
	~<veùÜ
>

11 
	~"Çs/Çs-’t™y.h
"

12 
	~"¼c/¼c-’t™y.h
"

13 
	~"¾c/¾c-’t™y.h
"

14 
	~"mac/mac-’t™y.h
"

15 
	~"mac/’b-mac-’t™y.h
"

16 
	~"mac/ue-mac-’t™y.h
"

17 
	~"pdı/pdı-’t™y.h
"

20 şas 
	cPrÙocŞSck
 {

21 
	mpublic
:

22 
PrÙocŞSck
();

23 
PrÙocŞSck
(
N‘wÜkNode
* 
deviû
);

24 
	mvœtu®
 ~
PrÙocŞSck
();

26 
NasEÁ™y
* 
G‘NasEÁ™y
 ();

27 
RrcEÁ™y
* 
G‘RrcEÁ™y
 ();

28 
MacEÁ™y
* 
G‘MacEÁ™y
 ();

29 
PdıEÁ™y
* 
G‘PdıEÁ™y
 ();

31 
S‘NasEÁ™y
 (
NasEÁ™y
* 
e
);

32 
S‘RrcEÁ™y
 (
RrcEÁ™y
* 
e
);

33 
S‘MacEÁ™y
 (
MacEÁ™y
* 
e
);

34 
S‘PdıEÁ™y
 (
PdıEÁ™y
* 
e
);

36 
	m´iv©e
:

38 
NasEÁ™y
* 
m_Çs
;

39 
RrcEÁ™y
* 
	mm_¼c
;

40 
PdıEÁ™y
* 
	mm_pdı
;

41 
MacEÁ™y
* 
	mm_mac
;

	@/home/lyang3/work/src_son/runWorld/protocolStack/protocols/TransportProtocol.cpp

3 
	~"T¿n¥ÜtPrÙocŞ.h
"

5 
	gT¿n¥ÜtPrÙocŞ
::
	$T¿n¥ÜtPrÙocŞ
()

6 {
	}
}

8 
T¿n¥ÜtPrÙocŞ
::~
	$T¿n¥ÜtPrÙocŞ
()

9 {
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/protocols/TransportProtocol.h

2 #iâdeà
TRANSPORTPROTOCOL_H_


3 
	#TRANSPORTPROTOCOL_H_


	)

5 şas 
	cT¿n¥ÜtPrÙocŞ
 {

6 
	mpublic
:

7 
	eT¿n¥ÜtPrÙocŞTy³


9 
TRANSPORT_PROTOCOL_TYPE_TCP
,

10 
	mTRANSPORT_PROTOCOL_TYPE_UDP


13 
T¿n¥ÜtPrÙocŞ
();

14 
	gvœtu®
 ~
T¿n¥ÜtPrÙocŞ
();

	@/home/lyang3/work/src_son/runWorld/protocolStack/rlc/am-rlc-entity.cpp

1 
	~"am-¾c-’t™y.h
"

2 
	~"../·ck‘/·ck‘-bur¡.h
"

3 
	~"../../æows/¿dio-b—»r.h
"

4 
	~"../../æows/¿dio-b—»r-sšk.h
"

5 
	~"../../æows/MacQueue.h
"

6 
	~"../../æows/­¶iÿtiÚ/AµliÿtiÚ.h
"

7 
	~"../../æows/­¶iÿtiÚ/­¶iÿtiÚ-sšk.h
"

8 
	~"../../æows/QoS/QoSP¬am‘”s.h
"

9 
	~"../../deviû/N‘wÜkNode.h
"

10 
	~"amd-»cÜd.h
"

11 
	~"../../cÜe/id—lMes§ges/id—l-cÚŒŞ-mes§ges.h
"

12 
	~"../../lßd-·¿m‘”s.h
"

14 
	#MAX_AMD_RETX
 5

	)

16 
	gAmRlcEÁ™y
::
	$AmRlcEÁ™y
()

18 
	`S‘Deviû
 (
NULL
);

19 
	`S‘RadioB—»r
 (
NULL
);

20 
	`S‘RlcMode
(
RlcEÁ™y
::
AM_RLC_MODE
);

21 
	`S‘RlcPduSequ’ûNumb”
 (0);

22 
m_amS‹V¬ŸbËs
 = 
Ãw
 
	`AmS‹V¬ŸbËs
 ();

23 
m_£ÁAMDs
 = 
Ãw
 
¡d
::
veùÜ
<
AmdRecÜd
*> ();

24 
m_»ûivedAMDs
 = 
Ãw
 
¡d
::
veùÜ
<
AmdRecÜd
*> ();

26 
	}
}

28 
	gAmRlcEÁ™y
::~
	$AmRlcEÁ™y
()

30 
d–‘e
 
m_amS‹V¬ŸbËs
;

31 
	`CË¬Pack‘Li¡
 ();

32 
	`De¡roy
 ();

33 
	}
}

36 
	gAmRlcEÁ™y
::
	$CË¬Pack‘Li¡
 ()

38 
¡d
::
veùÜ
 <
AmdRecÜd
*>::
™”©Ü
 
™
;

39 
™
 = 
m_£ÁAMDs
->
	`begš
 (); iˆ!ğm_£ÁAMDs->
	`’d
 (); it++)

41 
d–‘e
 *
™
;

43 
m_£ÁAMDs
->
	`ş—r
 ();

45 
™
 = 
m_»ûivedAMDs
->
	`begš
 (); iˆ!ğm_»ûivedAMDs->
	`’d
 (); it++)

47 
d–‘e
 *
™
;

49 
m_»ûivedAMDs
->
	`ş—r
 ();

50 
	}
}

53 
	gAmRlcEÁ™y
::
	$PrštS’tAMDs
 ()

55 
¡d
::
cout
 << "\ˆPrštS’tAMDs" << std::
’dl
;

56 
¡d
::
veùÜ
 <
AmdRecÜd
*>::
™”©Ü
 
™
;

57 
™
 = 
m_£ÁAMDs
->
	`begš
 (); iˆ!ğm_£ÁAMDs->
	`’d
 (); it++)

59 
Pack‘
* 
·ck‘
 = (*
™
)->
m_·ck‘
;

60 
¡d
::
cout
 << "\t\ˆ***…kˆ" << 
·ck‘
->
	`G‘ID
(è<< " f¿g " <<…ack‘->
	`G‘RLCH—d”
 ()->
	`G‘F¿gm’tNumb”
 () <<

61 " sÀ" << 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
 () <<

62 " s¹B " << 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘S¹By‹
 () <<

63 "ƒndB " << 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘EndBy‹
 (è<< 
¡d
::
’dl
;

66 
	}
}

69 
	gAmRlcEÁ™y
::
	$PrštReûivedAMDs
 ()

71 
¡d
::
cout
 << "\ˆPrštReûivedAMDs" << std::
’dl
;

72 
¡d
::
veùÜ
 <
AmdRecÜd
*>::
™”©Ü
 
™
;

73 
™
 = 
m_»ûivedAMDs
->
	`begš
 (); iˆ!ğm_»ûivedAMDs->
	`’d
 (); it++)

75 
Pack‘
* 
·ck‘
 = (*
™
)->
m_·ck‘
;

76 
¡d
::
cout
 << "\t\ˆ***…kˆ" << 
·ck‘
->
	`G‘ID
(è<< " f¿g " <<…ack‘->
	`G‘RLCH—d”
 ()->
	`G‘F¿gm’tNumb”
 () <<

77 " sÀ" << 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
 () <<

78 " s¹B " << 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘S¹By‹
 () <<

79 "ƒndB " << 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘EndBy‹
 (è<< 
¡d
::
’dl
;

82 
	}
}

85 
AmS‹V¬ŸbËs
*

86 
	gAmRlcEÁ™y
::
	$G‘AmS‹V¬ŸbËs
 ()

88  
m_amS‹V¬ŸbËs
;

89 
	}
}

91 
	g¡d
::
veùÜ
<
AmdRecÜd
*>*

92 
AmRlcEÁ™y
::
	$G‘S’tAMDs
 ()

94  
m_£ÁAMDs
;

95 
	}
}

97 
	g¡d
::
veùÜ
<
AmdRecÜd
*>*

98 
AmRlcEÁ™y
::
	$G‘ReûivedAMDs
 ()

100  
m_»ûivedAMDs
;

101 
	}
}

104 
	gAmRlcEÁ™y
::
	$In£¹AMDIÁoReû±iÚLi¡
 (
AmdRecÜd
* 
amd
)

106 #ifdeà
RLC_DEBUG


107 
¡d
::
cout
 << "In£¹AMDIÁoReû±iÚLi¡" << std::
’dl
;

108 
	`PrštReûivedAMDs
 ();

111 
amds
 = 
m_»ûivedAMDs
->
	`size
 ();

113 ià(
amds
 == 0)

116 
m_»ûivedAMDs
->
	`š£¹
 (m_»ûivedAMDs->
	`begš
 (), 
amd
);

120 
i
 = 0; i < 
amds
; i++)

122 
Pack‘
* 
·ck‘
 = 
m_»ûivedAMDs
->
	`©
 (
i
)->
m_·ck‘
;

124 ià(
amd
->
m_·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
 (è< 
·ck‘
->GetRLCHeader ()->GetRlcPduSequenceNumber ())

127 
m_»ûivedAMDs
->
	`š£¹
 (m_»ûivedAMDs->
	`begš
 (è+ 
i
, 
amd
);

130 ià(
amd
->
m_·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
 (è> 
·ck‘
->GetRLCHeader ()->GetRlcPduSequenceNumber ()

131 && 
i
 =ğ
amds
 - 1)

134 
m_»ûivedAMDs
->
	`š£¹
 (m_»ûivedAMDs->
	`’d
 (), 
amd
);

137 ià(
amd
->
m_·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
 (è=ğ
·ck‘
->GetRLCHeader ()->GetRlcPduSequenceNumber ())

139 ià(
amd
->
m_·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘EndBy‹
 (è< 
·ck‘
->G‘RLCH—d” ()->
	`G‘S¹By‹
 ())

142 
m_»ûivedAMDs
->
	`š£¹
 (m_»ûivedAMDs->
	`begš
 (è+ 
i
, 
amd
);

145 ià(
i
 =ğ
amds
 - 1)

148 
m_»ûivedAMDs
->
	`š£¹
 (m_»ûivedAMDs->
	`’d
 (), 
amd
);

156 #ifdeà
RLC_DEBUG


157 
	`PrštReûivedAMDs
 ();

159 
	}
}

161 
Pack‘Bur¡
*

162 
	gAmRlcEÁ™y
::
	$T¿nsmissiÚProûdu»
 (
avaabËBy‹s
)

164 #ifdeà
RLC_DEBUG


165 
¡d
::
cout
 << "AM RLCx…roûdu» fÜ‚od" << 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 ()<< " b—»¸"<< 
	`G‘RlcEÁ™yIndex
 (è<< std::
’dl
;

168 
Pack‘Bur¡
* 
pb
 = 
Ãw
 
	`Pack‘Bur¡
 ();

169 
AmS‹V¬ŸbËs
* 
amRlcS‹
 = 
	`G‘AmS‹V¬ŸbËs
 ();

172 #ifdeà
RLC_DEBUG


173 
¡d
::
cout
 << "--> STEP 1: CHECK FOR RE-TRANSMISSION" << std::
’dl
;

174 
	`PrštS’tAMDs
 ();

177 ià(
	`G‘S’tAMDs
()->
	`size
() != 0)

179 
amdId
 = 0;

180 
avaabËBy‹s
 > 0 && 
amdId
 =ğ
	`G‘S’tAMDs
()->
	`size
());

182 
AmdRecÜd
* 
amdRecÜd
 = 
	`G‘S’tAMDs
()->
	`©
 (
amdId
);

184 ià(
amdRecÜd
->
m_·ck‘
->
	`G‘Size
 (è+ 6 <ğ
avaabËBy‹s
)

186 
amdRecÜd
->
m_»tx_couÁ
++;

187 #ifdeà
RLC_DEBUG


188 
¡d
::
cout
 << "£ndhwhŞuÇcknowËdged AMD PDU" << std::
’dl
;

190 
Pack‘
* 
p
 = 
amdRecÜd
->
m_·ck‘
->
	`Cİy
 ();

191 
MACH—d”
 *
mac
 = 
Ãw
 
	`MACH—d”
 (
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 (),

192 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘De¡š©iÚ
 ()->
	`G‘IDN‘wÜkNode
 ());

193 
p
->
	`AddMACH—d”
(
mac
);

194 
p
->
	`AddH—d”Size
 (3);

196 ià(
_RLC_TRACING_
)

198 
¡d
::
cout
 << "TX AM_RLC SIZE" << 
p
->
	`G‘Size
 () <<

199 " B " << 
	`G‘RlcEÁ™yIndex
 () <<

200 " PDU_SN " << 
p
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
(è<< 
¡d
::
’dl
;

203 
pb
->
	`AddPack‘
 (
p
);

204 
avaabËBy‹s
 -ğ
p
->
	`G‘Size
 ();

205 
amdId
++;

207 ià(
avaabËBy‹s
 > 8)

210 
amdRecÜd
->
m_»tx_couÁ
++;

211 #ifdeà
RLC_DEBUG


212 
¡d
::
cout
 << "there is‚otƒnough bandwidth forhis AMD PDU. Do‡nother fragmentation"

213 << "--> by‹s: " << 
avaabËBy‹s
 << 
¡d
::
’dl
;

215 
Pack‘
* 
p1
 = 
amdRecÜd
->
m_·ck‘
->
	`Cİy
 ();

216 
Pack‘
* 
p2
 = 
amdRecÜd
->
m_·ck‘
;

218 
£ÁBy‹s
 = 
avaabËBy‹s
 - 7;

219 
p1
->
	`G‘RLCH—d”
 ()->
	`S‘EndBy‹
 (p1->G‘RLCH—d” ()->
	`G‘S¹By‹
 (è+ 
£ÁBy‹s
 - 1);

220 
p1
->
	`S‘Size
 (2 + 
£ÁBy‹s
);

221 
p2
->
	`G‘RLCH—d”
 ()->
	`S‘S¹By‹
 (
p1
->G‘RLCH—d” ()->
	`G‘S¹By‹
 (è+ 
£ÁBy‹s
);

222 
p2
->
	`S‘Size
 (p2->
	`G‘Size
 (è- 
£ÁBy‹s
);

223 
p1
->
	`G‘RLCH—d”
 ()->
	`S‘TheL©e¡F¿gm’t
 (
çl£
);

225 
p1
->
	`G‘RLCH—d”
 ()->
	`S‘AF¿gm’t
 (
Œue
);

226 
p2
->
	`G‘RLCH—d”
 ()->
	`S‘AF¿gm’t
 (
Œue
);

228 
MACH—d”
 *
mac
 = 
Ãw
 
	`MACH—d”
 (
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 (),

229 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘De¡š©iÚ
 ()->
	`G‘IDN‘wÜkNode
 ());

230 
p1
->
	`AddMACH—d”
(
mac
);

231 
p1
->
	`AddH—d”Size
 (3);

233 ià(
_RLC_TRACING_
)

235 
¡d
::
cout
 << "TX AM_RLC SIZE" << 
p1
->
	`G‘Size
 () <<

236 " B " << 
	`G‘RlcEÁ™yIndex
 () <<

237 " PDU_SN " << 
p1
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
(è<< 
¡d
::
’dl
;

240 
pb
->
	`AddPack‘
 (
p1
->
	`Cİy
 ());

242 
AmdRecÜd
* 
ÃwAmdRecÜd
 = 
Ãw
 
	`AmdRecÜd
 (
p1
,…1->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
 ());

243 
ÃwAmdRecÜd
->
m_»tx_couÁ
 = 
amdRecÜd
->m_retx_count;

244 
	`G‘S’tAMDs
 ()->
	`š£¹
(G‘S’tAMD ()->
	`begš
(è+ 
amdId
, 
ÃwAmdRecÜd
);

246 #ifdeà
RLC_DEBUG


247 
	`PrštS’tAMDs
 ();

249 
avaabËBy‹s
 = 0;

257 ià(
avaabËBy‹s
 <ğ0 )  
pb
;

261 #ifdeà
RLC_DEBUG


262 
¡d
::
cout
 << "--> STEP 2: CHECK FOR NEW TRANSMISSION" << std::
’dl
;

265 
RadioB—»r
 *
b—»r
 = (RadioB—»r*è
	`G‘RadioB—»rIn¡ªû
 ();

266 
MacQueue
 *
queue
 = 
b—»r
->
	`G‘MacQueue
 ();

268 ià(
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_INFINITE_BUFFER
)

271 
Œue
)

273 
Pack‘
 *
·ck‘
 = 
b—»r
->
	`C»©ePack‘
 (
avaabËBy‹s
);

274 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`S‘RlcEÁ™yIndex
 (
	`G‘RlcEÁ™yIndex
 ());

277 
cu¼’tSN
 = 
amRlcS‹
->
m_vt_s
;

278 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`S‘RlcPduSequ’ûNumb”
 (
cu¼’tSN
);

281 
amRlcS‹
->
m_vt_s
++;

284 
MACH—d”
 *
mac
 = 
Ãw
 
	`MACH—d”
 (
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 (),

285 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘De¡š©iÚ
 ()->
	`G‘IDN‘wÜkNode
 ());

286 
·ck‘
->
	`AddMACH—d”
(
mac
);

287 
·ck‘
->
	`AddH—d”Size
 (3);

289 ià(
avaabËBy‹s
 > 1503)

291 
·ck‘
->
	`S‘Size
 (1503);

292 
·ck‘
->
	`G‘Pack‘Tags
 ()->
	`S‘AµliÿtiÚSize
 (1490);

293 
avaabËBy‹s
 -= 1503;

295 ià(
_RLC_TRACING_
)

297 
¡d
::
cout
 << "TX AM_RLC SIZE " << 
·ck‘
->
	`G‘Size
 () <<

298 " B " << 
	`G‘RlcEÁ™yIndex
 () <<

299 " PDU_SN " << 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
(è<< 
¡d
::
’dl
;

302 
pb
->
	`AddPack‘
 (
·ck‘
);

304 ià(
avaabËBy‹s
 > 13)

306 
·ck‘
->
	`S‘Size
 (
avaabËBy‹s
);

307 
·ck‘
->
	`G‘Pack‘Tags
 ()->
	`S‘AµliÿtiÚSize
 (
avaabËBy‹s
 - 13);

308 
avaabËBy‹s
 = 0;

310 ià(
_RLC_TRACING_
)

312 
¡d
::
cout
 << "TX AM_RLC SIZE " << 
·ck‘
->
	`G‘Size
 () <<

313 " B " << 
	`G‘RlcEÁ™yIndex
 () <<

314 " PDU_SN " << 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
(è<< 
¡d
::
’dl
;

317 
pb
->
	`AddPack‘
 (
·ck‘
);

322 
avaabËBy‹s
 = 0;

329 
avaabËBy‹s
 > 0 && !
queue
->
	`IsEm±y
 ())

331 
Pack‘
* 
·ck‘
 = 
queue
->
	`G‘Pack‘ToT¿ms™
 (
avaabËBy‹s
);

333 ià(
·ck‘
 !ğ
NULL
)

336 #ifdeà
RLC_DEBUG


337 
¡d
::
cout
 << "SEND PACKET id " << 
·ck‘
->
	`G‘ID
(è<< " f¿g‚ " <<…ack‘->
	`G‘RLCH—d”
 ()->
	`G‘F¿gm’tNumb”
 ()<< std::
’dl
;

341 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`S‘RlcEÁ™yIndex
 (
	`G‘RlcEÁ™yIndex
 ());

346 
cu¼’tSN
 = 
amRlcS‹
->
m_vt_s
;

347 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`S‘RlcPduSequ’ûNumb”
 (
cu¼’tSN
);

350 
amRlcS‹
->
m_vt_s
++;

354 #ifdeà
RLC_DEBUG


355 
¡d
::
cout
 << "_____…kˆ" << 
·ck‘
->
	`G‘ID
(è<< " f¿g " <<…ack‘->
	`G‘RLCH—d”
 ()->
	`G‘F¿gm’tNumb”
 () <<

356 " sÀ" << 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
 () <<

357 " s¹B " << 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘S¹By‹
 () <<

358 "ƒndB " << 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘EndBy‹
 (è<< 
¡d
::
’dl
;

359 
	`PrštS’tAMDs
 ();

363 
AmdRecÜd
 *
amdRecÜd
 = 
Ãw
 
	`AmdRecÜd
 (
·ck‘
->
	`Cİy
 (), 
cu¼’tSN
);

364 
	`G‘S’tAMDs
 ()->
	`push_back
 (
amdRecÜd
);

365 #ifdeà
RLC_DEBUG


366 
	`PrštS’tAMDs
 ();

369 
MACH—d”
 *
mac
 = 
Ãw
 
	`MACH—d”
 (
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 (),

370 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘De¡š©iÚ
 ()->
	`G‘IDN‘wÜkNode
 ());

371 
·ck‘
->
	`AddMACH—d”
(
mac
);

372 
·ck‘
->
	`AddH—d”Size
 (3);

374 ià(
_RLC_TRACING_
)

376 
¡d
::
cout
 << "TX AM_RLC SIZE " << 
·ck‘
->
	`G‘Size
 () <<

377 " B " << 
	`G‘RlcEÁ™yIndex
 () <<

378 " PDU_SN " << 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
(è<< 
¡d
::
’dl
;

381 
pb
->
	`AddPack‘
 (
·ck‘
);

382 
avaabËBy‹s
 -ğ
·ck‘
->
	`G‘Size
 ();

386 
avaabËBy‹s
 = 0;

390  
pb
;

391 
	}
}

395 
	gAmRlcEÁ™y
::
	$Reû±iÚProûdu»
 (
Pack‘
* 
p
)

397 #ifdeà
RLC_DEBUG


398 
¡d
::
cout
 << "AM RLC„x…roûdu» fÜ‚od" << 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘De¡š©iÚ
 ()->
	`G‘IDN‘wÜkNode
 (è<< " b—»¸"<< 
	`G‘RlcEÁ™yIndex
 (è<< std::
’dl
;

399 
¡d
::
cout
 << "_____…kˆ" << 
p
->
	`G‘ID
(è<< " f¿g " <<…->
	`G‘RLCH—d”
 ()->
	`G‘F¿gm’tNumb”
 () <<

400 " sÀ" << 
p
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
 () <<

401 " s¹B " << 
p
->
	`G‘RLCH—d”
 ()->
	`G‘S¹By‹
 () <<

402 "ƒndB " << 
p
->
	`G‘RLCH—d”
 ()->
	`G‘EndBy‹
 (è<< 
¡d
::
’dl
;

405 ià(
_RLC_TRACING_
)

407 
¡d
::
cout
 << "RX AM_RLC SIZE " << 
p
->
	`G‘Size
 () <<

408 " B " << 
	`G‘RlcEÁ™yIndex
 () <<

409 " PDU_SN " << 
p
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
(è<< 
¡d
::
’dl
;

412 
RadioB—»rSšk
 *
b—»r
 = (RadioB—»rSšk*è
	`G‘RadioB—»rIn¡ªû
 ();

413 
AmS‹V¬ŸbËs
* 
amsS‹
 = 
	`G‘AmS‹V¬ŸbËs
 ();

415 #ifdeà
RLC_DEBUG


416 
	`PrštReûivedAMDs
 ();

420 
£qNumb”
 = 
p
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
 ();

431 ià(
£qNumb”
 >ğ
amsS‹
->
m_vr_h
)

433 
amsS‹
->
m_vr_h
 = 
£qNumb”
 + 1;

434 
amsS‹
->
m_vr_mr
 =‡msS‹->
m_vr_h
 +‡msS‹->
m_am_wšdow_size
;

440 
ArqRlcId—lCÚŒŞMes§ge
 
msg
;

441 
msg
.
	`S‘Ack
 (
£qNumb”
);

442 
msg
.
	`S‘S¹By‹
 (
p
->
	`G‘RLCH—d”
 ()->
	`G‘S¹By‹
 ());

443 
msg
.
	`S‘EndBy‹
 (
p
->
	`G‘RLCH—d”
 ()->
	`G‘EndBy‹
 ());

444 
	`S’dArqRlcId—lCÚŒŞMes§ge
 (
msg
);

448 ià(!
p
->
	`G‘RLCH—d”
 ()->
	`IsAF¿gm’t
 ())

450 #ifdeà
RLC_DEBUG


451 
¡d
::
cout
 << "\ˆ»ûived‡…ack‘ " << std::
’dl
;

453 
RadioB—»rSšk
 *
b—»r
 = (RadioB—»rSšk*è
	`G‘RadioB—»rIn¡ªû
 ();

454 
b—»r
->
	`Reûive
 (
p
);

458 ià(
p
->
	`G‘RLCH—d”
 ()->
	`IsAF¿gm’t
 ())

460 #ifdeà
RLC_DEBUG


461 
¡d
::
cout
 << "\ˆ»ûived‡ f¿gm’ˆ" << std::
’dl
;

463 
AmdRecÜd
 *
amdRecÜd
 = 
Ãw
 
	`AmdRecÜd
 (
p
, 
£qNumb”
);

464 
	`In£¹AMDIÁoReû±iÚLi¡
 (
amdRecÜd
);

466 #ifdeà
RLC_DEBUG


467 
	`PrštReûivedAMDs
 ();

470 
	`Reû±iÚProûdu»End
 ();

473 
	}
}

476 
	gAmRlcEÁ™y
::
	$Reû±iÚProûdu»End
 ()

478 #ifdeà
RLC_DEBUG


479 
¡d
::
cout
 << "AM RLC Reû±iÚProûdu»End " << std::
’dl
;

480 
	`PrštReûivedAMDs
 ();

483 ià(
m_»ûivedAMDs
->
	`size
 () == 0) ;

485 
cu¼’tPack‘
 = -1;

486 
ex³ùedNextBy‹
 = 0;

488 
¡d
::
li¡
<> 
·ck‘IdToD–‘e
;

490 
¡d
::
veùÜ
 <
AmdRecÜd
*>::
™”©Ü
 
™
;

491 
™
 = 
m_»ûivedAMDs
->
	`begš
 (); iˆ!ğm_»ûivedAMDs->
	`’d
 (); it++)

493 
Pack‘
* 
·ck‘
 = (*
™
)->
m_·ck‘
;

495 ià(
·ck‘
->
	`G‘ID
 (è!ğ
cu¼’tPack‘
 &&…ack‘->
	`G‘RLCH—d”
 ()->
	`G‘S¹By‹
 () == 0)

498 
cu¼’tPack‘
 = 
·ck‘
->
	`G‘ID
 ();

499 
ex³ùedNextBy‹
 = 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘EndBy‹
 () + 1;

501 ià(
·ck‘
->
	`G‘ID
 (è!ğ
cu¼’tPack‘
 &&…ack‘->
	`G‘RLCH—d”
 ()->
	`G‘S¹By‹
 () != 0)

504 
ex³ùedNextBy‹
 = 0;

506 ià(
·ck‘
->
	`G‘ID
 (è=ğ
cu¼’tPack‘
 &&…ack‘->
	`G‘RLCH—d”
 ()->
	`G‘S¹By‹
 (è=ğ
ex³ùedNextBy‹
)

508 ià(
·ck‘
->
	`G‘RLCH—d”
 ()->
	`IsTheL©e¡F¿gm’t
 ())

511 
RadioB—»rSšk
 *
b—»r
 = (RadioB—»rSšk*è
	`G‘RadioB—»rIn¡ªû
 ();

512 
Pack‘
* 
p
 = 
·ck‘
->
	`Cİy
 ();

513 
p
->
	`S‘Size
 (
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘EndBy‹
 () + 8);

514 
b—»r
->
	`Reûive
 (
p
);

516 
·ck‘IdToD–‘e
.
	`push_äÚt
(
·ck‘
->
	`G‘ID
 ());

518 
ex³ùedNextBy‹
 = 0;

523 
ex³ùedNextBy‹
 = 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘EndBy‹
 () + 1;

530 #ifdeà
RLC_DEBUG


531 
¡d
::
cout
 << "\t\ˆ!! DELETE REASSEBLED PACKETS" << std::
’dl
;

534 
¡d
::
li¡
<>::
™”©Ü
 
™”
 = 
·ck‘IdToD–‘e
.
	`begš
 (); i‹¸!ğ·ck‘IdToD–‘e.
	`’d
 (); iter++)

536 
¡d
::
veùÜ
 <
AmdRecÜd
*> *
ÃwAmdLi¡
 = 
Ãw
 std::vector <AmdRecord*>;

537 
id
 = (*
™”
);

538 
¡d
::
veùÜ
 <
AmdRecÜd
*>::
™”©Ü
 
™t
 = 
m_»ûivedAMDs
->
	`begš
 (); i‰ !ğm_»ûivedAMDs->
	`’d
 (); itt++)

540 
AmdRecÜd
 *
amdRecÜd
 = (*
™t
);

541 
d–ay
 = 
amdRecÜd
->
m_·ck‘
->
	`G‘TimeSmp
 (è+ 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘QoSP¬am‘”s
 ()->
	`G‘MaxD–ay
 ();

542 ià(
amdRecÜd
->
m_·ck‘
->
	`G‘ID
 (è=ğ
id
)

544 
d–‘e
 
amdRecÜd
;

548 
ÃwAmdLi¡
->
	`push_back
 (
amdRecÜd
);

551 
m_»ûivedAMDs
->
	`ş—r
();

552 
d–‘e
 
m_»ûivedAMDs
;

553 
m_»ûivedAMDs
 = 
ÃwAmdLi¡
;

558 #ifdeà
RLC_DEBUG


559 
¡d
::
cout
 << "\t\ˆ!! DELETE PACKETS o¸AMD WHOSE DEADLINE i EXPIRED !" << std::
’dl
;

562 
cu¼’ack‘Id
 = -1;

563 
¡d
::
veùÜ
 <
AmdRecÜd
*> *
ÃwAmdLi¡
 = 
Ãw
 std::vector <AmdRecord*>;

564 
¡d
::
veùÜ
 <
AmdRecÜd
*>::
™”©Ü
 
™t
 = 
m_»ûivedAMDs
->
	`begš
 (); i‰ !ğm_»ûivedAMDs->
	`’d
 (); itt++)

566 
AmdRecÜd
 *
amdRecÜd
 = (*
™t
);

567 
d–ay
 = 
amdRecÜd
->
m_·ck‘
->
	`G‘TimeSmp
 (è+ 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘QoSP¬am‘”s
 ()->
	`G‘MaxD–ay
 ();

568 ià((
d–ay
 + 0.01è< 
SimuÏtÜ
::
	`In™
()->
	`Now
())

571 
Pack‘
 *
µ
 = 
amdRecÜd
->
m_·ck‘
;

572 ià(
µ
->
	`G‘ID
 (è!ğ
cu¼’ack‘Id
)

574 
cu¼’ack‘Id
 = 
amdRecÜd
->
m_·ck‘
->
	`G‘ID
 ();

576 ià(
_RLC_TRACING_
)

578 
¡d
::
cout
 << "DROP_RX_AM_RLC";

579 ià(
µ
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
(è=ğ
Pack‘TAGs
::
APPLICATION_TYPE_VOIP
)

580 
¡d
::
cout
 << " VOIP";

581 ià(
µ
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
(è=ğ
Pack‘TAGs
::
APPLICATION_TYPE_TRACE_BASED
)

582 
¡d
::
cout
 << " VIDEO";

583 ià(
µ
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
(è=ğ
Pack‘TAGs
::
APPLICATION_TYPE_CBR
)

584 
¡d
::
cout
 << " CBR";

585 ià(
µ
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
(è=ğ
Pack‘TAGs
::
APPLICATION_TYPE_INFINITE_BUFFER
)

586 
¡d
::
cout
 << " INF_BUF";

588 
¡d
::
cout
 << " UNKNOW";

590 
¡d
::
cout
 << " ID "<< 
µ
->
	`G‘ID
()

591 << " B " << 
	`G‘RlcEÁ™yIndex
 ();

593 ià(
µ
->
	`G‘Pack‘Tags
(è!ğ
NULL


594 && 
µ
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
() ==

595 
Pack‘TAGs
::
APPLICATION_TYPE_TRACE_BASED
)

597 
¡d
::
cout
 << " FRAME " << 
µ
->
	`G‘Pack‘Tags
()->
	`G‘F¿meNub”
()

598 << " START " << 
µ
->
	`G‘Pack‘Tags
()->
	`G‘S¹By‹
()

599 << " END " << 
µ
->
	`G‘Pack‘Tags
()->
	`G‘EndBy‹
();

601 
¡d
::
cout
 << std::
’dl
;

604 
d–‘e
 
amdRecÜd
;

608 
ÃwAmdLi¡
->
	`push_back
 (
amdRecÜd
);

611 
m_»ûivedAMDs
->
	`ş—r
();

612 
d–‘e
 
m_»ûivedAMDs
;

613 
m_»ûivedAMDs
 = 
ÃwAmdLi¡
;

617 #ifdeà
RLC_DEBUG


618 
	`PrštReûivedAMDs
 ();

620 
	}
}

623 
	gAmRlcEÁ™y
::
	$S’dArqRlcId—lCÚŒŞMes§ge
 (
ArqRlcId—lCÚŒŞMes§ge
 
msg
)

625 #ifdeà
RLC_DEBUG


626 
¡d
::
cout
 << "AM RLC -- S’dArqRlcId—lCÚŒŞMes§ge,‚od" << 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘De¡š©iÚ
 ()->
	`G‘IDN‘wÜkNode
 (è<< " b—»¸"<< 
	`G‘RlcEÁ™yIndex
 (è<< std::
’dl
;

627 
¡d
::
cout
 << "\ˆack " << 
msg
.
	`G‘Ack
(è<< ", s¹B " << msg.
	`G‘S¹By‹
 (è<< ",ƒndB " << msg.
	`G‘EndBy‹
 (è<< std::
’dl
;

631 
RadioB—»rSšk
* 
thisB—»r
 = (RadioB—»rSšk*è
	`G‘RadioB—»rIn¡ªû
 ();

632 
AµliÿtiÚSšk
 *
thisAµliÿtiÚ
 = (AµliÿtiÚSšk*è
thisB—»r
->
	`G‘AµliÿtiÚ
 ();

633 
RadioB—»r
* 
»mÙeB—»r
 = 
thisAµliÿtiÚ
->
	`G‘SourûAµliÿtiÚ
 ()->
	`G‘RadioB—»r
 ();

635 
AmRlcEÁ™y
* 
»mÙeRlc
 = (AmRlcEÁ™y*è
»mÙeB—»r
->
	`G‘RlcEÁ™y
();

636 
»mÙeRlc
->
	`ReûiveArqRlcId—lCÚŒŞMes§ge
 (
msg
);

637 
	}
}

640 
	gAmRlcEÁ™y
::
	$ReûiveArqRlcId—lCÚŒŞMes§ge
 (
ArqRlcId—lCÚŒŞMes§ge
 
msg
)

642 #ifdeà
RLC_DEBUG


643 
¡d
::
cout
 << "AM RLC -- ReûiveArqRlcId—lCÚŒŞMes§ge,‚od" << 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 (è<< " b—»¸"<< 
	`G‘RlcEÁ™yIndex
 (è<< std::
’dl
;

644 
¡d
::
cout
 << "\ˆack " << 
msg
.
	`G‘Ack
(è<< ", s¹B " << msg.
	`G‘S¹By‹
 (è<< ",ƒndB " << msg.
	`G‘EndBy‹
 (è<< std::
’dl
;

645 
	`PrštS’tAMDs
 ();

649 
¡d
::
veùÜ
<
AmdRecÜd
*>::
™”©Ü
 
™
;

650 
™
 = 
m_£ÁAMDs
->
	`begš
(); iˆ!ğm_£ÁAMDs->
	`’d
(); it++)

652 
AmdRecÜd
 *
amdRecÜd
 = (*
™
);

653 ià(
amdRecÜd
->
m_·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
 (è=ğ
msg
.
	`G‘Ack
()

655 
amdRecÜd
->
m_·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘S¹By‹
 (è=ğ
msg
.GetStartByte ())

657 
m_£ÁAMDs
->
	`”a£
 (
™
);

658 
d–‘e
 
amdRecÜd
;

660 #ifdeà
RLC_DEBUG


661 
¡d
::
cout
 << " || d–‘ed AMD ||"<< std::
’dl
;

662 
	`PrštS’tAMDs
 ();

668 
	}
}

671 
	gAmRlcEÁ™y
::
	$CheckFÜDrİPack‘s
 (
maxD–ay
, 
b—»rID
)

673 #ifdeà
RLC_DEBUG


674 
¡d
::
cout
 << "AmRlcEÁ™y::CheckFÜDrİPack‘ " << std::
’dl
;

675 
	`PrštS’tAMDs
 ();

678 
cu¼’ack‘
 = -1;

679 
now
 = 
SimuÏtÜ
::
	`In™
()->
	`Now
();

680 
¡d
::
veùÜ
 <
AmdRecÜd
*> *
ÃwAmdli¡
 = 
Ãw
 std::vector <AmdRecord*> ();

682 
¡d
::
veùÜ
 <
AmdRecÜd
*>::
™”©Ü
 
™
 = 
m_£ÁAMDs
->
	`begš
 (); iˆ!ğm_£ÁAMDs->
	`’d
 (); it++)

684 
AmdRecÜd
 *
amdRecÜd
 = (*
™
);

685 
HOL
 = 
now
 - 
amdRecÜd
->
m_·ck‘
->
	`G‘TimeSmp
 ();

687 ià(
HOL
 > 
maxD–ay
 || 
amdRecÜd
->
m_»tx_couÁ
 > 
MAX_AMD_RETX
)

689 ià(
cu¼’ack‘
 !ğ
amdRecÜd
->
m_·ck‘
->
	`G‘ID
 ())

691 
cu¼’ack‘
 = 
amdRecÜd
->
m_·ck‘
->
	`G‘ID
 ();

693 ià(
_RLC_TRACING_
)

698 
¡d
::
cout
 << "DROP";

699 ià(
amdRecÜd
->
m_·ck‘
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
(è=ğ
Pack‘TAGs
::
APPLICATION_TYPE_VOIP
)

700 
¡d
::
cout
 << " VOIP";

701 ià(
amdRecÜd
->
m_·ck‘
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
(è=ğ
Pack‘TAGs
::
APPLICATION_TYPE_TRACE_BASED
)

702 
¡d
::
cout
 << " VIDEO";

703 ià(
amdRecÜd
->
m_·ck‘
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
(è=ğ
Pack‘TAGs
::
APPLICATION_TYPE_CBR
)

704 
¡d
::
cout
 << " CBR";

705 ià(
amdRecÜd
->
m_·ck‘
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
(è=ğ
Pack‘TAGs
::
APPLICATION_TYPE_INFINITE_BUFFER
)

706 
¡d
::
cout
 << " INF_BUF";

708 
¡d
::
cout
 << " UNKNOW";

710 
¡d
::
cout
 << " ID "<< 
amdRecÜd
->
m_·ck‘
->
	`G‘ID
()

711 << " B " << 
	`G‘RlcEÁ™yIndex
 ();

712 ià(
amdRecÜd
->
m_·ck‘
->
	`G‘Pack‘Tags
(è!ğ
NULL


713 && 
amdRecÜd
->
m_·ck‘
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
() ==

714 
Pack‘TAGs
::
APPLICATION_TYPE_TRACE_BASED
)

716 
¡d
::
cout
 << " FRAME " << 
amdRecÜd
->
m_·ck‘
->
	`G‘Pack‘Tags
()->
	`G‘F¿meNub”
()

717 << " START " << 
amdRecÜd
->
m_·ck‘
->
	`G‘Pack‘Tags
()->
	`G‘S¹By‹
()

718 << " END " << 
amdRecÜd
->
m_·ck‘
->
	`G‘Pack‘Tags
()->
	`G‘EndBy‹
();

720 
¡d
::
cout
 << std::
’dl
;

723 
d–‘e
 
amdRecÜd
;

727 
ÃwAmdli¡
->
	`push_back
 (
amdRecÜd
);

731 
m_£ÁAMDs
->
	`ş—r
();

732 
d–‘e
 
m_£ÁAMDs
;

733 
m_£ÁAMDs
 = 
ÃwAmdli¡
;

735 #ifdeà
RLC_DEBUG


736 
	`PrštS’tAMDs
 ();

738 
	}
}

741 
	gAmRlcEÁ™y
::
	$G‘SizeOfUÇknowËdgedAmd
 ()

743 
size
 = 0;

744 
¡d
::
veùÜ
 <
AmdRecÜd
*>::
™”©Ü
 
™
 = 
m_£ÁAMDs
->
	`begš
 (); iˆ!ğm_£ÁAMDs->
	`’d
 (); it++)

746 
size
 +ğ(*
™
)->
m_·ck‘
->
	`G‘Size
 () + 5;

748  
size
;

749 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/rlc/am-rlc-entity.h

2 #iâdeà
AMRLCENTITY_H_


3 
	#AMRLCENTITY_H_


	)

5 
	~"¾c-’t™y.h
"

6 
	~"am-¡©e-v¬ŸbËs.h
"

7 
	~<veùÜ
>

9 
şass
 
	gPack‘Bur¡
;

10 
şass
 
	gPack‘
;

11 
şass
 
	gAmdRecÜd
;

12 
şass
 
	gArqRlcId—lCÚŒŞMes§ge
;

14 şas 
	cAmRlcEÁ™y
: 
public
 
RlcEÁ™y
 {

15 
public
:

16 
AmRlcEÁ™y
();

17 
	mvœtu®
 ~
AmRlcEÁ™y
();

19 
vœtu®
 
Pack‘Bur¡
* 
T¿nsmissiÚProûdu»
 (
avaabËBy‹s
);

20 
vœtu®
 
Reû±iÚProûdu»
 (
Pack‘
* 
p
);

21 
Reû±iÚProûdu»End
 ();

23 
AmS‹V¬ŸbËs
* 
G‘AmS‹V¬ŸbËs
 ();

25 
	m¡d
::
veùÜ
<
AmdRecÜd
*>* 
G‘S’tAMDs
 ();

26 
	m¡d
::
veùÜ
<
AmdRecÜd
*>* 
G‘ReûivedAMDs
 ();

28 
In£¹AMDIÁoReû±iÚLi¡
 (
AmdRecÜd
* 
amd
);

30 
S’dArqRlcId—lCÚŒŞMes§ge
 (
ArqRlcId—lCÚŒŞMes§ge
 
msg
);

31 
ReûiveArqRlcId—lCÚŒŞMes§ge
 (
ArqRlcId—lCÚŒŞMes§ge
 
msg
);

33 
CË¬Pack‘Li¡
 ();

35 
PrštS’tAMDs
 ();

36 
PrštReûivedAMDs
 ();

38 
CheckFÜDrİPack‘s
 (
maxD–ay
, 
b—»rID
);

40 
G‘SizeOfUÇknowËdgedAmd
 ();

42 
	m´iv©e
:

43 
AmS‹V¬ŸbËs
* 
m_amS‹V¬ŸbËs
;

44 
	m¡d
::
veùÜ
<
AmdRecÜd
*> *
m_£ÁAMDs
;

45 
	m¡d
::
veùÜ
 <
AmdRecÜd
*> *
m_»ûivedAMDs
;

	@/home/lyang3/work/src_son/runWorld/protocolStack/rlc/am-state-variables.cpp

2 
	~"am-¡©e-v¬ŸbËs.h
"

3 
	~"io¡»am
"

5 
	gAmS‹V¬ŸbËs
::
	$AmS‹V¬ŸbËs
()

7 
m_am_wšdow_size
 = 512;

8 
m_vt_a
 = 0;

9 
m_vt_ms
 = 
m_vt_a
 + 
m_am_wšdow_size
;

10 
m_vt_s
 = 0;

11 
m_pŞl_¢
 = 0;

13 
m_pdu_w™hout_pŞl_couÁ”
 = 0;

14 
m_by‹_w™hout_pŞl_couÁ”
 = 0;

15 
m_»tx_couÁ”
 = 0;

17 
m_vr_r
 = 0;

18 
m_vr_mr
 = 
m_vr_r
 + 
m_am_wšdow_size
;

19 
m_vr_x
 = 
m_am_wšdow_size
;

20 
m_vr_ms
 = 0;

21 
m_vr_h
 = 0;

23 
m_t_pŞl_»Œªsm™
 = 10;

24 
m_t_»Üd”šg
 = 10;

25 
m_t_¡©us_´ohib™
 = 10;

27 
m_max_»tx_th»shŞd
 = 3;

28 
m_pŞl_PDU
 = 10;

29 
m_pŞl_By‹
 = 10;

30 
	}
}

32 
	gAmS‹V¬ŸbËs
::~
	$AmS‹V¬ŸbËs
()

34 
	}
}

37 
AmS‹V¬ŸbËs
::
	$Pršt
 ()

39 
¡d
::
cout
 << "AmStateVariables"

40 "\ˆTX STATE: VT(A)=" << 
m_vt_a
 << " VT(MS)=" << 
m_vt_ms
 << " VT(S)=" << 
m_vt_s
 <<

41 "\ˆRX STATE: VR(R)=" << 
m_vr_r
 << " VR(MR)=" << 
m_vr_mr
 << " VR(H)=" << 
m_vr_h
 <<

42 
¡d
::
’dl
;

43 
	}
}

46 
	gAmS‹V¬ŸbËs
::
	$PrštTxV¬ŸbËs
 ()

48 
¡d
::
cout
 << "TX AmStateVariables"

49 "\ˆTX STATE: VT(A)=" << 
m_vt_a
 << " VT(MS)=" << 
m_vt_ms
 << " VT(S)=" << 
m_vt_s
 <<

50 
¡d
::
’dl
;

51 
	}
}

54 
	gAmS‹V¬ŸbËs
::
	$PrštRxV¬ŸbËs
 ()

56 
¡d
::
cout
 << "RX AmStateVariables"

57 "\ˆRX STATE: VR(R)=" << 
m_vr_r
 << " VR(MR)=" << 
m_vr_mr
 << " VR(H)=" << 
m_vr_h
 <<

58 
¡d
::
’dl
;

59 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/rlc/am-state-variables.h

4 #iâdeà
AMSTATEVARIABLES_H_


5 
	#AMSTATEVARIABLES_H_


	)

12 şas 
	cAmS‹V¬ŸbËs
 {

13 
	mpublic
:

14 
AmS‹V¬ŸbËs
();

15 
	mvœtu®
 ~
AmS‹V¬ŸbËs
();

17 
Pršt
 ();

18 
PrštTxV¬ŸbËs
 ();

19 
PrštRxV¬ŸbËs
 ();

26 
	mm_vt_a
;

27 
	mm_vt_ms
;

28 
	mm_vt_s
;

29 
	mm_pŞl_¢
;

35 
	mm_pdu_w™hout_pŞl_couÁ”
;

36 
	mm_by‹_w™hout_pŞl_couÁ”
;

37 
	mm_»tx_couÁ”
;

43 
	mm_vr_r
;

44 
	mm_vr_mr
;

45 
	mm_vr_x
;

46 
	mm_vr_ms
;

47 
	mm_vr_h
;

52 
	mm_am_wšdow_size
;

57 
	mm_t_pŞl_»Œªsm™
;

58 
	mm_t_»Üd”šg
;

59 
	mm_t_¡©us_´ohib™
;

65 
	mm_max_»tx_th»shŞd
;

66 
	mm_pŞl_PDU
;

67 
	mm_pŞl_By‹
;

	@/home/lyang3/work/src_son/runWorld/protocolStack/rlc/amd-record.cpp

2 
	~"amd-»cÜd.h
"

3 
	~"../·ck‘/Pack‘.h
"

5 
	gAmdRecÜd
::
	$AmdRecÜd
 (
Pack‘
* 
p
, 
¢
)

7 
m_·ck‘
 = 
p
;

8 
m_¢
 = 
¢
;

9 
m_»tx_couÁ
 = 0;

10 
	}
}

12 
	gAmdRecÜd
::~
	$AmdRecÜd
()

14 
d–‘e
 
m_·ck‘
;

15 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/rlc/amd-record.h

4 #iâdeà
AMDRECORD_H_


5 
	#AMDRECORD_H_


	)

7 
şass
 
	gPack‘
;

9 şas 
	cAmdRecÜd
 {

10 
	mpublic
:

11 
AmdRecÜd
 (
Pack‘
* 
p
, 
¢
);

12 
	mvœtu®
 ~
AmdRecÜd
();

14 
Pack‘
* 
	mm_·ck‘
;

15 
	mm_¢
;

16 
	mm_»tx_couÁ
;

18 
boŞ
 
	mm_toR‘¿nsm™
;

	@/home/lyang3/work/src_son/runWorld/protocolStack/rlc/rlc-entity.cc

4 
	~"¾c-’t™y.h
"

5 
	~"../../deviû/N‘wÜkNode.h
"

6 
	~"../·ck‘/Pack‘.h
"

7 
	~"../../æows/¿dio-b—»r-š¡ªû.h
"

9 
	gRlcEÁ™y
::
	$RlcEÁ™y
 ()

10 : 
	`m_deviû
 (
NULL
),

11 
	$m_b—»r
 (
NULL
)

13 
	}
}

16 
	gRlcEÁ™y
::
	$RlcEÁ™y
 (
N‘wÜkNode
* 
d
)

17 : 
	`m_deviû
 (
NULL
),

18 
	$m_b—»r
 (
NULL
)

20 
	}
}

23 
	gRlcEÁ™y
::
	$De¡roy
 ()

25 
m_deviû
 = 
NULL
;

26 
m_b—»r
 = 
NULL
;

27 
	}
}

30 
	gRlcEÁ™y
::~
	$RlcEÁ™y
 ()

32 
	}
}

36 
RlcEÁ™y
::
	$S‘Deviû
 (
N‘wÜkNode
* 
d
)

38 
m_deviû
 = 
d
;

39 
	}
}

42 
N‘wÜkNode
*

43 
	gRlcEÁ™y
::
	$G‘Deviû
 ()

45  
m_deviû
;

46 
	}
}

49 
	gRlcEÁ™y
::
	$S‘RadioB—»r
 (
RadioB—»rIn¡ªû
 *
b
)

51 
m_b—»r
 = 
b
;

52 
	}
}

54 
RadioB—»rIn¡ªû
*

55 
	gRlcEÁ™y
::
	$G‘RadioB—»rIn¡ªû
 ()

57  
m_b—»r
;

58 
	}
}

62 
	gRlcEÁ™y
::
	$S‘RlcEÁ™yIndex
 (
i
)

64 
m_¾cEÁ™yIndex
 = 
i
;

65 
	}
}

68 
	gRlcEÁ™y
::
	$G‘RlcEÁ™yIndex
 ()

70  
m_¾cEÁ™yIndex
;

71 
	}
}

74 
	gRlcEÁ™y
::
	$S‘RlcPduSequ’ûNumb”
 (
¢
)

76 
m_¾cPduSequ’ûNumb”
 = 
¢
;

77 
	}
}

80 
	gRlcEÁ™y
::
	$G‘RlcPduSequ’ûNumb”
 ()

82  
m_¾cPduSequ’ûNumb”
;

83 
	}
}

86 
	gRlcEÁ™y
::
	$S‘RlcMode
 (
RlcMode
 
mode
)

88 
m_¾cMode
 = 
mode
;

89 
	}
}

91 
	gRlcEÁ™y
::
RlcMode


92 
RlcEÁ™y
::
	$G‘RlcMod–
 ()

94  
m_¾cMode
;

95 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/rlc/rlc-entity.h

2 #iâdeà
RLC_ENTITY_H


3 
	#RLC_ENTITY_H


	)

5 
	~<li¡
>

6 
	~"../../lßd-·¿m‘”s.h
"

8 
şass
 
	gN‘wÜkNode
;

9 
şass
 
	gRadioB—»rIn¡ªû
;

10 
şass
 
	gPack‘Bur¡
;

11 
şass
 
	gPack‘
;

20 şas 
	cRlcEÁ™y


22 
	mpublic
:

24 
RlcEÁ™y
 ();

25 
RlcEÁ™y
 (
N‘wÜkNode
* 
d
);

26 
	mvœtu®
 ~
RlcEÁ™y
 ();

28 
De¡roy
 ();

30 
	eRlcMode


32 
	mTM_RLC_MODE
, 
	mUM_RLC_MODE
, 
	mAM_RLC_MODE


35 
S‘Deviû
 (
N‘wÜkNode
* 
d
);

36 
N‘wÜkNode
* 
G‘Deviû
 ();

38 
S‘RadioB—»r
 (
RadioB—»rIn¡ªû
 *
b
);

39 
RadioB—»rIn¡ªû
* 
G‘RadioB—»rIn¡ªû
 ();

41 
vœtu®
 
Pack‘Bur¡
* 
T¿nsmissiÚProûdu»
 (
avaabËBy‹s
) = 0;

42 
vœtu®
 
Reû±iÚProûdu»
 (
Pack‘
* 
p
) = 0;

44 
S‘RlcEÁ™yIndex
 (
i
);

45 
G‘RlcEÁ™yIndex
 ();

47 
S‘RlcPduSequ’ûNumb”
 (
¢
);

48 
G‘RlcPduSequ’ûNumb”
 ();

50 
S‘RlcMode
 (
RlcMode
 
mode
);

51 
RlcMode
 
G‘RlcMod–
 ();

53 
	g´iv©e
:

54 
RlcMode
 
m_¾cMode
;

55 
N‘wÜkNode
* 
	gm_deviû
;

56 
RadioB—»rIn¡ªû
 *
	gm_b—»r
;

58 
	gm_¾cEÁ™yIndex
;

59 
	gm_¾cPduSequ’ûNumb”
;

	@/home/lyang3/work/src_son/runWorld/protocolStack/rlc/tm-rlc-entity.cpp

2 
	~"tm-¾c-’t™y.h
"

3 
	~"../·ck‘/·ck‘-bur¡.h
"

4 
	~"../../æows/¿dio-b—»r.h
"

5 
	~"../../æows/¿dio-b—»r-sšk.h
"

6 
	~"../../æows/MacQueue.h
"

7 
	~"../../æows/­¶iÿtiÚ/AµliÿtiÚ.h
"

8 
	~"../../deviû/N‘wÜkNode.h
"

9 
	~"../../lßd-·¿m‘”s.h
"

12 
	gTmRlcEÁ™y
::
	$TmRlcEÁ™y
()

14 
	`S‘Deviû
 (
NULL
);

15 
	`S‘RadioB—»r
 (
NULL
);

16 
	`S‘RlcPduSequ’ûNumb”
 (0);

17 
	`S‘RlcMode
(
RlcEÁ™y
::
TM_RLC_MODE
);

18 
	}
}

20 
	gTmRlcEÁ™y
::~
	$TmRlcEÁ™y
()

22 
	`De¡roy
 ();

23 
	}
}

25 
Pack‘Bur¡
*

26 
	gTmRlcEÁ™y
::
	$T¿nsmissiÚProûdu»
 (
avaabËBy‹s
)

28 #ifdeà
RLC_DEBUG


29 
¡d
::
cout
 << "TM RLCx…roûdu» fÜ‚od" << 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 ()<< std::
’dl
;

32 
Pack‘Bur¡
* 
pb
 = 
Ãw
 
	`Pack‘Bur¡
 ();

34 
RadioB—»r
 *
b—»r
 = (RadioB—»r*è
	`G‘RadioB—»rIn¡ªû
 ();

35 
MacQueue
 *
queue
 = 
b—»r
->
	`G‘MacQueue
 ();

37 ià(
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_INFINITE_BUFFER
)

40 
Œue
)

42 
Pack‘
 *
·ck‘
 = 
b—»r
->
	`C»©ePack‘
 (
avaabËBy‹s
);

45 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`S‘RlcEÁ™yIndex
 (
	`G‘RlcEÁ™yIndex
 ());

48 
MACH—d”
 *
mac
 = 
Ãw
 
	`MACH—d”
 (
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 (),

49 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘De¡š©iÚ
 ()->
	`G‘IDN‘wÜkNode
 ());

50 
·ck‘
->
	`AddMACH—d”
(
mac
);

51 
·ck‘
->
	`AddH—d”Size
 (3);

53 ià(
avaabËBy‹s
 > 1503)

55 
·ck‘
->
	`S‘Size
 (1503);

56 
·ck‘
->
	`G‘Pack‘Tags
 ()->
	`S‘AµliÿtiÚSize
 (1490);

57 
avaabËBy‹s
 -= 1503;

58 
pb
->
	`AddPack‘
 (
·ck‘
);

60 ià(
_RLC_TRACING_
)

62 
¡d
::
cout
 << "TX TM_RLC SIZE " << 
·ck‘
->
	`G‘Size
 () <<

63 " B " << 
	`G‘RlcEÁ™yIndex
 (è<< 
¡d
::
’dl
;

66 ià(
avaabËBy‹s
 > 13)

68 
·ck‘
->
	`S‘Size
 (
avaabËBy‹s
);

69 
·ck‘
->
	`G‘Pack‘Tags
 ()->
	`S‘AµliÿtiÚSize
 (
avaabËBy‹s
 - 13);

70 
avaabËBy‹s
 = 0;

71 
pb
->
	`AddPack‘
 (
·ck‘
);

73 ià(
_RLC_TRACING_
)

75 
¡d
::
cout
 << "TX TM_RLC SIZE " << 
·ck‘
->
	`G‘Size
 () <<

76 " B " << 
	`G‘RlcEÁ™yIndex
 (è<< 
¡d
::
’dl
;

83 
avaabËBy‹s
 = 0;

90 
avaabËBy‹s
 > 0 && !
queue
->
	`IsEm±y
 ())

92 
Pack‘
* 
·ck‘
 = 
queue
->
	`P“k
 ().
	`G‘Pack‘
 ();

94 ià((
·ck‘
->
	`G‘Size
 (è+ 6è<ğ
avaabËBy‹s
)

96 ià(
_RLC_TRACING_
)

98 
¡d
::
cout
 << "TX TM_RLC SIZE " << 
·ck‘
->
	`G‘Size
 () <<

99 " B " << 
	`G‘RlcEÁ™yIndex
 (è<< 
¡d
::
’dl
;

102 
Pack‘
 *
p
 = 
·ck‘
->
	`Cİy
 ();

104 
queue
->
	`Upd©eQueueSize
 (-
p
->
	`G‘Size
 ());

105 
queue
->
	`Dequeue
 ();

108 
MACH—d”
 *
mac
 = 
Ãw
 
	`MACH—d”
 (
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 (),

109 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘De¡š©iÚ
 ()->
	`G‘IDN‘wÜkNode
 ());

110 
p
->
	`AddMACH—d”
(
mac
);

111 
p
->
	`AddH—d”Size
(3);

112 
pb
->
	`AddPack‘
 (
p
);

113 
avaabËBy‹s
 -ğ
p
->
	`G‘Size
 ();

117 
avaabËBy‹s
 = 0;

122  
pb
;

123 
	}
}

127 
	gTmRlcEÁ™y
::
	$Reû±iÚProûdu»
 (
Pack‘
* 
p
)

129 #ifdeà
RLC_DEBUG


130 
¡d
::
cout
 << "TM RLC„x…roûdu» fÜ‚od" << 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 ()<< std::
’dl
;

132 ià(
_RLC_TRACING_
)

134 
¡d
::
cout
 << "RX TM_RLC SIZE " << 
p
->
	`G‘Size
 () <<

135 " B " << 
	`G‘RlcEÁ™yIndex
 (è<< 
¡d
::
’dl
;

138 
RadioB—»rSšk
 *
b—»r
 = (RadioB—»rSšk*è
	`G‘RadioB—»rIn¡ªû
 ();

139 
b—»r
->
	`Reûive
 (
p
);

140 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/rlc/tm-rlc-entity.h

4 #iâdeà
TMRLCENTITY_H_


5 
	#TMRLCENTITY_H_


	)

7 
	~"¾c-’t™y.h
"

9 
şass
 
	gPack‘Bur¡
;

11 şas 
	cTmRlcEÁ™y
: 
public
 
RlcEÁ™y
 {

12 
public
:

13 
TmRlcEÁ™y
();

14 
	mvœtu®
 ~
TmRlcEÁ™y
();

16 
vœtu®
 
Pack‘Bur¡
* 
T¿nsmissiÚProûdu»
 (
avaabËBy‹s
);

17 
vœtu®
 
Reû±iÚProûdu»
 (
Pack‘
* 
p
);

	@/home/lyang3/work/src_son/runWorld/protocolStack/rlc/um-rlc-entity.cpp

3 
	~"um-¾c-’t™y.h
"

4 
	~"../·ck‘/·ck‘-bur¡.h
"

5 
	~"../../æows/¿dio-b—»r.h
"

6 
	~"../../æows/¿dio-b—»r-sšk.h
"

7 
	~"../../æows/MacQueue.h
"

8 
	~"../../æows/­¶iÿtiÚ/AµliÿtiÚ.h
"

9 
	~"../../deviû/N‘wÜkNode.h
"

10 
	~"../../lßd-·¿m‘”s.h
"

13 
	gUmRlcEÁ™y
::
	$UmRlcEÁ™y
()

15 
	`S‘Deviû
 (
NULL
);

16 
	`S‘RadioB—»r
 (
NULL
);

17 
	`S‘RlcPduSequ’ûNumb”
 (0);

18 
	`S‘RlcMode
(
RlcEÁ™y
::
UM_RLC_MODE
);

19 
	}
}

21 
	gUmRlcEÁ™y
::~
	$UmRlcEÁ™y
()

23 
	`CË¬IncomšgPack‘s
 ();

24 
	`De¡roy
 ();

25 
	}
}

27 
Pack‘Bur¡
*

28 
	gUmRlcEÁ™y
::
	$T¿nsmissiÚProûdu»
 (
avaabËBy‹s
)

30 #ifdeà
RLC_DEBUG


31 
¡d
::
cout
 << "UM RLCx…roûdu» fÜ‚od" << 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 ()<< std::
’dl
;

34 
Pack‘Bur¡
* 
pb
 = 
Ãw
 
	`Pack‘Bur¡
 ();

36 
RadioB—»r
 *
b—»r
 = (RadioB—»r*è
	`G‘RadioB—»rIn¡ªû
 ();

37 
MacQueue
 *
queue
 = 
b—»r
->
	`G‘MacQueue
 ();

39 ià(
b—»r
->
	`G‘AµliÿtiÚ
 ()->
	`G‘AµliÿtiÚTy³
 (è=ğ
AµliÿtiÚ
::
APPLICATION_TYPE_INFINITE_BUFFER
)

42 
Œue
)

44 
Pack‘
 *
·ck‘
 = 
b—»r
->
	`C»©ePack‘
 (
avaabËBy‹s
);

47 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`S‘RlcEÁ™yIndex
 (
	`G‘RlcEÁ™yIndex
 ());

49 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`S‘RlcPduSequ’ûNumb”
 (
	`G‘RlcPduSequ’ûNumb”
 ());

50 
ÃwSequ’ûNumb”
 = 
	`G‘RlcPduSequ’ûNumb”
 () + 1;

51 
	`S‘RlcPduSequ’ûNumb”
 (
ÃwSequ’ûNumb”
);

54 
MACH—d”
 *
mac
 = 
Ãw
 
	`MACH—d”
 (
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 (),

55 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘De¡š©iÚ
 ()->
	`G‘IDN‘wÜkNode
 ());

56 
·ck‘
->
	`AddMACH—d”
(
mac
);

57 
·ck‘
->
	`AddH—d”Size
 (3);

59 ià(
avaabËBy‹s
 > 1503)

61 
·ck‘
->
	`S‘Size
 (1503);

62 
·ck‘
->
	`G‘Pack‘Tags
 ()->
	`S‘AµliÿtiÚSize
 (1490);

64 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`S‘RlcEÁ™yIndex
 (
	`G‘RlcEÁ™yIndex
 ());

65 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`S‘RlcPduSequ’ûNumb”
 (
	`G‘RlcPduSequ’ûNumb”
 ());

66 
ÃwSequ’ûNumb”
 = 
	`G‘RlcPduSequ’ûNumb”
 () + 1;

67 
	`S‘RlcPduSequ’ûNumb”
 (
ÃwSequ’ûNumb”
);

69 
avaabËBy‹s
 -= 1503;

70 
pb
->
	`AddPack‘
 (
·ck‘
);

72 ià(
_RLC_TRACING_
)

74 
¡d
::
cout
 << "TX UM_RLC SIZE" << 
·ck‘
->
	`G‘Size
 () <<

75 " B " << 
	`G‘RlcEÁ™yIndex
 () <<

76 " PDU_SN " << 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
(è<< 
¡d
::
’dl
;

79 ià(
avaabËBy‹s
 > 13)

81 
·ck‘
->
	`S‘Size
 (
avaabËBy‹s
);

82 
·ck‘
->
	`G‘Pack‘Tags
 ()->
	`S‘AµliÿtiÚSize
 (
avaabËBy‹s
 - 13);

84 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`S‘RlcEÁ™yIndex
 (
	`G‘RlcEÁ™yIndex
 ());

85 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`S‘RlcPduSequ’ûNumb”
 (
	`G‘RlcPduSequ’ûNumb”
 ());

86 
ÃwSequ’ûNumb”
 = 
	`G‘RlcPduSequ’ûNumb”
 () + 1;

87 
	`S‘RlcPduSequ’ûNumb”
 (
ÃwSequ’ûNumb”
);

89 
avaabËBy‹s
 = 0;

90 
pb
->
	`AddPack‘
 (
·ck‘
);

92 ià(
_RLC_TRACING_
)

94 
¡d
::
cout
 << "TX UM_RLC SIZE" << 
·ck‘
->
	`G‘Size
 () <<

95 " B " << 
	`G‘RlcEÁ™yIndex
 () <<

96 " PDU_SN " << 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
(è<< 
¡d
::
’dl
;

103 
avaabËBy‹s
 = 0;

110 
avaabËBy‹s
 > 0 && !
queue
->
	`IsEm±y
 ())

112 
Pack‘
* 
·ck‘
 = 
queue
->
	`G‘Pack‘ToT¿ms™
 (
avaabËBy‹s
);

114 ià(
·ck‘
 !ğ
NULL
)

117 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`S‘RlcEÁ™yIndex
 (
	`G‘RlcEÁ™yIndex
 ());

118 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`S‘RlcPduSequ’ûNumb”
 (
	`G‘RlcPduSequ’ûNumb”
 ());

119 
ÃwSequ’ûNumb”
 = 
	`G‘RlcPduSequ’ûNumb”
 () + 1;

120 
	`S‘RlcPduSequ’ûNumb”
 (
ÃwSequ’ûNumb”
);

122 ià(
_RLC_TRACING_
)

124 
¡d
::
cout
 << "TX UM_RLC SIZE" << 
·ck‘
->
	`G‘Size
 () <<

125 " B " << 
	`G‘RlcEÁ™yIndex
 () <<

126 " PDU_SN " << 
·ck‘
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
(è<< 
¡d
::
’dl
;

130 
MACH—d”
 *
mac
 = 
Ãw
 
	`MACH—d”
 (
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘Sourû
 ()->
	`G‘IDN‘wÜkNode
 (),

131 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘De¡š©iÚ
 ()->
	`G‘IDN‘wÜkNode
 ());

132 
·ck‘
->
	`AddMACH—d”
(
mac
);

133 
·ck‘
->
	`AddH—d”Size
 (3);

135 
pb
->
	`AddPack‘
 (
·ck‘
);

136 
avaabËBy‹s
 -ğ
·ck‘
->
	`G‘Size
 ();

140 
avaabËBy‹s
 = 0;

145  
pb
;

146 
	}
}

150 
	gUmRlcEÁ™y
::
	$Reû±iÚProûdu»
 (
Pack‘
* 
p
)

152 #ifdeà
RLC_DEBUG


153 
¡d
::
cout
 << "UM RLC„x…roûdu» fÜ‚od" << 
	`G‘RadioB—»rIn¡ªû
 ()->
	`G‘De¡š©iÚ
 ()->
	`G‘IDN‘wÜkNode
 ()<< std::
’dl
;

154 
¡d
::
cout
 << "RECEIVE PACKET id " << 
p
->
	`G‘ID
(è<< " f¿g‚ " <<…->
	`G‘RLCH—d”
 ()->
	`G‘F¿gm’tNumb”
 ()<< std::
’dl
;

157 ià(
_RLC_TRACING_
)

159 
¡d
::
cout
 << "RX UM_RLC SIZE " << 
p
->
	`G‘Size
 () <<

160 " B " << 
	`G‘RlcEÁ™yIndex
 () <<

161 " PDU_SN " << 
p
->
	`G‘RLCH—d”
 ()->
	`G‘RlcPduSequ’ûNumb”
(è<< 
¡d
::
’dl
;

164 ià(
m_šcomšgPack‘
.
	`size
(è> 0 && 
p
->
	`G‘ID
 (è!ğm_šcomšgPack‘.
	`©
 (0)->GetID ())

166 #ifdeà
RLC_DEBUG


167 
¡d
::
cout
 << "»ûived‡‚ew…ack‘, d–‘’queued f¿gm’ts"<< std::
’dl
;

170 
Pack‘
 *
µ
 = 
m_šcomšgPack‘
.
	`©
 (0);

172 ià(
_RLC_TRACING_
)

174 
¡d
::
cout
 << "DROP_RX_UM_RLC";

175 ià(
µ
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
(è=ğ
Pack‘TAGs
::
APPLICATION_TYPE_VOIP
)

176 
¡d
::
cout
 << " VOIP";

177 ià(
µ
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
(è=ğ
Pack‘TAGs
::
APPLICATION_TYPE_TRACE_BASED
)

178 
¡d
::
cout
 << " VIDEO";

179 ià(
µ
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
(è=ğ
Pack‘TAGs
::
APPLICATION_TYPE_CBR
)

180 
¡d
::
cout
 << " CBR";

181 ià(
µ
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
(è=ğ
Pack‘TAGs
::
APPLICATION_TYPE_INFINITE_BUFFER
)

182 
¡d
::
cout
 << " INF_BUF";

184 
¡d
::
cout
 << " UNKNOW";

186 
¡d
::
cout
 << " ID "<< 
µ
->
	`G‘ID
()

187 << " B " << 
	`G‘RlcEÁ™yIndex
 ();

189 ià(
µ
->
	`G‘Pack‘Tags
(è!ğ
NULL


190 && 
µ
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
() ==

191 
Pack‘TAGs
::
APPLICATION_TYPE_TRACE_BASED
)

193 
¡d
::
cout
 << " FRAME " << 
µ
->
	`G‘Pack‘Tags
()->
	`G‘F¿meNub”
()

194 << " START " << 
µ
->
	`G‘Pack‘Tags
()->
	`G‘S¹By‹
()

195 << " END " << 
µ
->
	`G‘Pack‘Tags
()->
	`G‘EndBy‹
();

197 
¡d
::
cout
 << std::
’dl
;

200 
	`CË¬IncomšgPack‘s
 ();

204 ià(!
p
->
	`G‘RLCH—d”
 ()->
	`IsAF¿gm’t
 ())

206 #ifdeà
RLC_DEBUG


207 
¡d
::
cout
 << "\ˆ»ûived‡…ack‘ " << std::
’dl
;

211 
RadioB—»rSšk
 *
b—»r
 = (RadioB—»rSšk*è
	`G‘RadioB—»rIn¡ªû
 ();

212 
b—»r
->
	`Reûive
 (
p
);

216 ià(
p
->
	`G‘RLCH—d”
 ()->
	`IsAF¿gm’t
 (è&& !p->G‘RLCH—d” ()->
	`IsTheL©e¡F¿gm’t
())

219 #ifdeà
RLC_DEBUG


220 
¡d
::
cout
 << "\ˆ»ûived‡ f¿gm’ˆ" << std::
’dl
;

222 
m_šcomšgPack‘
.
	`push_back
 (
p
);

226 ià(
p
->
	`G‘RLCH—d”
 ()->
	`IsAF¿gm’t
 (è&&…->G‘RLCH—d” ()->
	`IsTheL©e¡F¿gm’t
())

229 #ifdeà
RLC_DEBUG


230 
¡d
::
cout
 << "\ˆ»ûivedhÏ‹¡ f¿gm’ˆ" << std::
’dl
;

232 
m_šcomšgPack‘
.
	`push_back
 (
p
);

235 
numb”OfPack‘s
 = 
p
->
	`G‘RLCH—d”
 ()->
	`G‘F¿gm’tNumb”
 () + 1;

237 ià(
m_šcomšgPack‘
.
	`size
 (è=ğ
numb”OfPack‘s
)

239 
RadioB—»rSšk
 *
b—»r
 = (RadioB—»rSšk*è
	`G‘RadioB—»rIn¡ªû
 ();

240 
b—»r
->
	`Reûive
 (
p
->
	`Cİy
 ());

242 
	`CË¬IncomšgPack‘s
 ();

247 #ifdeà
RLC_DEBUG


248 
¡d
::
cout
 << "li¡ oàäagm’ˆšcom¶‘-> d–‘®l!"<< std::
’dl
;

251 ià(
_RLC_TRACING_
)

253 
¡d
::
cout
 << "DROP_RX_UM_RLC";

254 ià(
p
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
(è=ğ
Pack‘TAGs
::
APPLICATION_TYPE_VOIP
)

255 
¡d
::
cout
 << " VOIP";

256 ià(
p
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
(è=ğ
Pack‘TAGs
::
APPLICATION_TYPE_TRACE_BASED
)

257 
¡d
::
cout
 << " VIDEO";

258 ià(
p
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
(è=ğ
Pack‘TAGs
::
APPLICATION_TYPE_CBR
)

259 
¡d
::
cout
 << " CBR";

260 ià(
p
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
(è=ğ
Pack‘TAGs
::
APPLICATION_TYPE_INFINITE_BUFFER
)

261 
¡d
::
cout
 << " INF_BUF";

263 
¡d
::
cout
 << " UNKNOW";

265 
¡d
::
cout
 << " ID "<< 
p
->
	`G‘ID
()

266 << " B " << 
	`G‘RlcEÁ™yIndex
 ();

268 ià(
p
->
	`G‘Pack‘Tags
(è!ğ
NULL


269 && 
p
->
	`G‘Pack‘Tags
()->
	`G‘AµliÿtiÚTy³
() ==

270 
Pack‘TAGs
::
APPLICATION_TYPE_TRACE_BASED
)

272 
¡d
::
cout
 << " FRAME " << 
p
->
	`G‘Pack‘Tags
()->
	`G‘F¿meNub”
()

273 << " START " << 
p
->
	`G‘Pack‘Tags
()->
	`G‘S¹By‹
()

274 << " END " << 
p
->
	`G‘Pack‘Tags
()->
	`G‘EndBy‹
();

276 
¡d
::
cout
 << std::
’dl
;

279 
	`CË¬IncomšgPack‘s
 ();

282 
	}
}

285 
	gUmRlcEÁ™y
::
	$CË¬IncomšgPack‘s
 ()

287 
¡d
::
veùÜ
 <
Pack‘
*>::
™”©Ü
 
™
;

288 
™
 = 
m_šcomšgPack‘
.
	`begš
 (); iˆ!ğm_šcomšgPack‘.
	`’d
 (); it++)

290 
d–‘e
 *
™
;

292 
m_šcomšgPack‘
.
	`ş—r
 ();

293 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/rlc/um-rlc-entity.h

2 #iâdeà
UMRLCENTITY_H_


3 
	#UMRLCENTITY_H_


	)

5 
	~"¾c-’t™y.h
"

6 
	~<veùÜ
>

8 
şass
 
	gPack‘Bur¡
;

10 şas 
	cUmRlcEÁ™y
: 
public
 
RlcEÁ™y
 {

11 
public
:

12 
UmRlcEÁ™y
();

13 
	mvœtu®
 ~
UmRlcEÁ™y
();

15 
vœtu®
 
Pack‘Bur¡
* 
T¿nsmissiÚProûdu»
 (
avaabËBy‹s
);

16 
vœtu®
 
Reû±iÚProûdu»
 (
Pack‘
* 
p
);

18 
CË¬IncomšgPack‘s
 ();

20 
	m´iv©e
:

21 
¡d
::
veùÜ
 <
Pack‘
*> 
m_šcomšgPack‘
;

	@/home/lyang3/work/src_son/runWorld/protocolStack/rrc/ho/handover-entity.cpp

3 
	~"hªdov”-’t™y.h
"

4 
	~"../../../deviû/N‘wÜkNode.h
"

5 
	~"../../../deviû/U£rEqum’t.h
"

6 
	~"ho-mªag”.h
"

7 
	~"pos™iÚ-ba£d-ho-mªag”.h
"

9 
	gHªdov”EÁ™y
::
	$Hªdov”EÁ™y
()

11 
m_deviû
 = 
NULL
;

12 
m_hoMªag”
 = 
Ãw
 
	`Pos™iÚBa£dHoMªag”
 ();

13 
	}
}

15 
	gHªdov”EÁ™y
::~
	$Hªdov”EÁ™y
()

17 
m_deviû
 = 0;

18 
d–‘e
 
m_hoMªag”
;

19 
	}
}

22 
	gHªdov”EÁ™y
::
	$S‘Deviû
 (
N‘wÜkNode
* 
d
)

24 
m_deviû
 = 
d
;

25 
	}
}

27 
N‘wÜkNode
*

28 
	gHªdov”EÁ™y
::
	$G‘Deviû
 ()

30  
m_deviû
;

31 
	}
}

34 
	gHªdov”EÁ™y
::
	$S‘HoMªag”
 (
HoMªag”
 *
h
)

36 
m_hoMªag”
 = 
h
;

37 
	}
}

39 
HoMªag”
*

40 
	gHªdov”EÁ™y
::
	$G‘HoMªag”
 ()

42  
m_hoMªag”
;

43 
	}
}

46 
boŞ


47 
	gHªdov”EÁ™y
::
	$CheckHªdov”N“d
 (
U£rEqum’t
* 
ue
)

49  
	`G‘HoMªag”
 ()->
	`CheckHªdov”N“d
 (
ue
);

50 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/rrc/ho/handover-entity.h

2 #iâdeà
HANDOVERENTITY_H_


3 
	#HANDOVERENTITY_H_


	)

5 
şass
 
	gN‘wÜkNode
;

6 
şass
 
	gU£rEqum’t
;

7 
şass
 
	gHoMªag”
;

9 şas 
	cHªdov”EÁ™y
 {

10 
	mpublic
:

11 
Hªdov”EÁ™y
();

12 
	mvœtu®
 ~
Hªdov”EÁ™y
();

14 
S‘Deviû
 (
N‘wÜkNode
* 
d
);

15 
N‘wÜkNode
* 
G‘Deviû
 ();

17 
S‘HoMªag”
 (
HoMªag”
 *
h
);

18 
HoMªag”
* 
G‘HoMªag”
 ();

20 
boŞ
 
CheckHªdov”N“d
 (
U£rEqum’t
* 
ue
);

22 
	m´iv©e
:

23 
N‘wÜkNode
* 
m_deviû
;

24 
HoMªag”
* 
	mm_hoMªag”
;

	@/home/lyang3/work/src_son/runWorld/protocolStack/rrc/ho/ho-manager.cpp

3 
	~"ho-mªag”.h
"

5 
	gHoMªag”
::
	$HoMªag”
()

6 {
	}
}

8 
HoMªag”
::~
	$HoMªag”
()

9 {
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/rrc/ho/ho-manager.h

2 #iâdeà
HOMANAGER_H_


3 
	#HOMANAGER_H_


	)

5 
şass
 
	gU£rEqum’t
;

6 
şass
 
	gN‘wÜkNode
;

8 şas 
	cHoMªag”
 {

9 
	mpublic
:

10 
HoMªag”
();

11 
	mvœtu®
 ~
HoMªag”
();

13 
vœtu®
 
boŞ
 
CheckHªdov”N“d
 (
U£rEqum’t
* 
ue
) = 0;

15 
N‘wÜkNode
* 
	mm_rg‘
;

	@/home/lyang3/work/src_son/runWorld/protocolStack/rrc/ho/position-based-ho-manager.cpp

3 
	~"pos™iÚ-ba£d-ho-mªag”.h
"

4 
	~"../../../deviû/N‘wÜkNode.h
"

5 
	~"../../../deviû/U£rEqum’t.h
"

6 
	~"../../../deviû/ENodeB.h
"

7 
	~"../../../compÚ’tMªag”s/N‘wÜkMªag”.h
"

9 
	gPos™iÚBa£dHoMªag”
::
	$Pos™iÚBa£dHoMªag”
()

11 
m_rg‘
 = 
NULL
;

12 
	}
}

14 
	gPos™iÚBa£dHoMªag”
::~
	$Pos™iÚBa£dHoMªag”
()

16 
m_rg‘
 = 
NULL
;

17 
	}
}

19 
boŞ


20 
	gPos™iÚBa£dHoMªag”
::
	$CheckHªdov”N“d
 (
U£rEqum’t
* 
ue
)

22 
N‘wÜkNode
 *
rg‘Node
 = 
ue
->
	`G‘T¬g‘Node
 ();

24 
C¬‹sŸnCoÜdš©es
 *
uePos™iÚ
 = 
ue
->
	`G‘Mob™yMod–
 ()->
	`G‘AbsŞu‹Pos™iÚ
 ();

25 
C¬‹sŸnCoÜdš©es
 *
rg‘Pos™iÚ
;

27 
rg‘Pos™iÚ
 = 
rg‘Node
->
	`G‘Mob™yMod–
 ()->
	`G‘AbsŞu‹Pos™iÚ
 ();

28 
rg‘Di¡ªû
 = 
uePos™iÚ
->
	`G‘Di¡ªû
 (
rg‘Pos™iÚ
);

37 
¡d
::
veùÜ
<
ENodeB
*> *
li¡OfNodes
 = 
N‘wÜkMªag”
::
	`In™
 ()->
	`G‘ENodeBCÚš”
 ();

38 
¡d
::
veùÜ
<
ENodeB
*>::
™”©Ü
 
™
;

39 
™
 = 
li¡OfNodes
->
	`begš
 (); iˆ!ğli¡OfNodes->
	`’d
 (); it++)

41 ià((*
™
)->
	`G‘IDN‘wÜkNode
 (è!ğ
rg‘Node
->GetIDNetworkNode () )

44 
N‘wÜkNode
 *
´obabËNewT¬g‘Node
 = (*
™
);

47 
di¡ªû
 = 
´obabËNewT¬g‘Node
->
	`G‘Mob™yMod–
 ()->

48 
	`G‘AbsŞu‹Pos™iÚ
 ()->
	`G‘Di¡ªû
 (
uePos™iÚ
);

50 ià(
di¡ªû
 < 
rg‘Di¡ªû
)

52 
rg‘Di¡ªû
 = 
di¡ªû
;

53 
rg‘Node
 = 
´obabËNewT¬g‘Node
;

58 ià(
ue
->
	`G‘T¬g‘Node
 ()->
	`G‘IDN‘wÜkNode
 (è!ğ
rg‘Node
->GetIDNetworkNode ())

60 
m_rg‘
 = 
rg‘Node
;

61  
Œue
;

65  
çl£
;

67 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/rrc/ho/position-based-ho-manager.h

2 #iâdeà
POSITIONBASEDHOMANAGER_H_


3 
	#POSITIONBASEDHOMANAGER_H_


	)

5 
	~"ho-mªag”.h
"

7 şas 
	cPos™iÚBa£dHoMªag”
: 
public
 
HoMªag”
 {

8 
public
:

9 
Pos™iÚBa£dHoMªag”
();

10 
	mvœtu®
 ~
Pos™iÚBa£dHoMªag”
();

12 
vœtu®
 
boŞ
 
CheckHªdov”N“d
 (
U£rEqum’t
* 
ue
);

	@/home/lyang3/work/src_son/runWorld/protocolStack/rrc/rrc-entity.cc

4 
	~"¼c-’t™y.h
"

5 
	~"../·ck‘/Pack‘.h
"

6 
	~"../../deviû/IPCÏssif›r/CÏssif›rP¬am‘”s.h
"

7 
	~"../../æows/¿dio-b—»r.h
"

8 
	~"../../æows/¿dio-b—»r-sšk.h
"

9 
	~"../../lßd-·¿m‘”s.h
"

10 
	~"../../deviû/N‘wÜkNode.h
"

11 
	~"ho/hªdov”-’t™y.h
"

13 
	gRrcEÁ™y
::
	$RrcEÁ™y
 ()

15 
m_b—»rs
 = 
Ãw
 
	`RadioB—»rsCÚš”
 ();

16 
m_sšk
 = 
Ãw
 
	`RadioB—»rsSškCÚš”
 ();

17 
m_deviû
 = 
NULL
;

18 
m_hªdov”
 = 
Ãw
 
	`Hªdov”EÁ™y
 ();

19 
	}
}

21 
	gRrcEÁ™y
::~
	$RrcEÁ™y
 ()

23 
m_b—»rs
->
	`ş—r
 ();

24 
d–‘e
 
m_b—»rs
;

26 
m_sšk
->
	`ş—r
 ();

27 
d–‘e
 
m_sšk
;

29 
d–‘e
 
m_hªdov”
;

31 
m_deviû
 = 
NULL
;

32 
	}
}

35 
	gRrcEÁ™y
::
	$S‘Deviû
 (
N‘wÜkNode
* 
d
)

37 
m_deviû
 = 
d
;

38 
m_hªdov”
->
	`S‘Deviû
 (
d
);

39 
	}
}

42 
N‘wÜkNode
*

43 
	gRrcEÁ™y
::
	$G‘Deviû
 ()

45  
m_deviû
;

46 
	}
}

48 
	gRrcEÁ™y
::
RadioB—»rsCÚš”
*

49 
RrcEÁ™y
::
	$G‘RadioB—»rCÚš”
 ()

51  
m_b—»rs
;

52 
	}
}

54 
	gRrcEÁ™y
::
RadioB—»rsSškCÚš”
*

55 
RrcEÁ™y
::
	$G‘RadioB—»rSškCÚš”
 ()

57  
m_sšk
;

58 
	}
}

62 
	gRrcEÁ™y
::
	$AddRadioB—»r
 (
RadioB—»r
* 
b—»r
)

64 #ifdeà
TEST_START_APPLICATION


65 
¡d
::
cout
 << "Add„adiØb—»¸Ú " << 
	`G‘Deviû
 ()->
	`G‘IDN‘wÜkNode
 (è<< std::
’dl
;

68 
m_b—»rs
->
	`push_back
 (
b—»r
);

69 
	}
}

72 
	gRrcEÁ™y
::
	$D–RadioB—»r
 (
RadioB—»r
* 
b—»r
)

74 
RadioB—»rsCÚš”
* 
ÃwCÚš”
 = 
Ãw
 
	`RadioB—»rsCÚš”
 ();

75 
RadioB—»rsCÚš”
::
™”©Ü
 
™
;

76 
™
 = 
	`G‘RadioB—»rCÚš”
 ()->
	`begš
(); iˆ!ğG‘RadioB—»rCÚš” ()->
	`’d
(); it++)

78 
RadioB—»r
 *
b
 = (*
™
);

79 ià(
b
->
	`G‘RlcEÁ™y
 ()->
	`G‘RlcEÁ™yIndex
 (è!ğ
b—»r
->GetRlcEntity ()->GetRlcEntityIndex ())

81 
ÃwCÚš”
->
	`push_back
 (
b
);

84 
m_b—»rs
->
	`ş—r
 ();

85 
d–‘e
 
m_b—»rs
;

86 
m_b—»rs
 = 
ÃwCÚš”
;

87 
	}
}

90 
	gRrcEÁ™y
::
	$AddRadioB—»rSšk
 (
RadioB—»rSšk
* 
b—»r
)

92 #ifdeà
TEST_START_APPLICATION


93 
¡d
::
cout
 << "Add sšk„adiØb—»¸Ú " << 
	`G‘Deviû
 ()->
	`G‘IDN‘wÜkNode
 (è<< std::
’dl
;

96 
m_sšk
->
	`push_back
 (
b—»r
);

97 
	}
}

100 
	gRrcEÁ™y
::
	$D–RadioB—»rSšk
 (
RadioB—»rSšk
* 
b—»r
)

102 
RadioB—»rsSškCÚš”
* 
ÃwCÚš”
 = 
Ãw
 
	`RadioB—»rsSškCÚš”
 ();

103 
RadioB—»rsSškCÚš”
::
™”©Ü
 
™
;

104 
™
 = 
	`G‘RadioB—»rSškCÚš”
 ()->
	`begš
(); iˆ!ğG‘RadioB—»rSškCÚš” ()->
	`’d
(); it++)

106 
RadioB—»rSšk
 *
b
 = (*
™
);

107 ià(
b
->
	`G‘RlcEÁ™y
 ()->
	`G‘RlcEÁ™yIndex
 (è!ğ
b—»r
->GetRlcEntity ()->GetRlcEntityIndex ())

109 
ÃwCÚš”
->
	`push_back
 (
b
);

112 
m_sšk
->
	`ş—r
 ();

113 
d–‘e
 
m_sšk
;

114 
m_sšk
 = 
ÃwCÚš”
;

115 
	}
}

117 
RadioB—»r
*

118 
	gRrcEÁ™y
::
	$G‘RadioB—»r
 (
CÏssif›rP¬am‘”s
* 
c
)

120 
RadioB—»rsCÚš”
::
™”©Ü
 
™
;

121 
™
 = 
	`G‘RadioB—»rCÚš”
 ()->
	`begš
(); iˆ!ğG‘RadioB—»rCÚš” ()->
	`’d
(); it++)

123 
RadioB—»r
 *
b—»r
 = (*
™
);

125 ià(
b—»r
->
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘SourûPÜt
 (è=ğ
c
->GetSourcePort ()

127 
b—»r
->
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘De¡š©iÚPÜt
 (è=ğ
c
->GetDestinationPort ())

129  
b—»r
;

133 
	}
}

135 
RadioB—»rSšk
*

136 
	gRrcEÁ™y
::
	$G‘RadioB—»rSšk
 (
CÏssif›rP¬am‘”s
* 
c
)

138 
RadioB—»rsSškCÚš”
::
™”©Ü
 
™
;

139 
™
 = 
	`G‘RadioB—»rSškCÚš”
 ()->
	`begš
(); iˆ!ğG‘RadioB—»rSškCÚš” ()->
	`’d
(); it++)

141 
RadioB—»rSšk
 *
b—»r
 = (*
™
);

143 ià(
b—»r
->
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘SourûPÜt
 (è=ğ
c
->GetSourcePort ()

145 
b—»r
->
	`G‘CÏssif›rP¬am‘”s
 ()->
	`G‘De¡š©iÚPÜt
 (è=ğ
c
->GetDestinationPort ())

147  
b—»r
;

151 
	}
}

154 
RadioB—»rIn¡ªû
*

155 
	gRrcEÁ™y
::
	$G‘RadioB—»r
 (
¾cIndex
)

158 
RadioB—»rsSškCÚš”
::
™”©Ü
 
™
 = 
	`G‘RadioB—»rSškCÚš”
 ()->
	`begš
();

159 
™
 !ğ
	`G‘RadioB—»rSškCÚš”
 ()->
	`’d
(); it++)

161 
RadioB—»rSšk
 *
b—»r
 = (*
™
);

163 ià(
b—»r
->
	`G‘RlcEÁ™y
 ()->
	`G‘RlcEÁ™yIndex
 (è=ğ
¾cIndex
)

165  
b—»r
;

169 
RadioB—»rsCÚš”
::
™”©Ü
 
™
 = 
	`G‘RadioB—»rCÚš”
 ()->
	`begš
();

170 
™
 !ğ
	`G‘RadioB—»rCÚš”
 ()->
	`’d
(); it++)

172 
RadioB—»r
 *
b—»r
 = (*
™
);

174 ià(
b—»r
->
	`G‘RlcEÁ™y
 ()->
	`G‘RlcEÁ™yIndex
 (è=ğ
¾cIndex
)

176  
b—»r
;

181 
	}
}

185 
	gRrcEÁ™y
::
	$S‘Hªdov”EÁ™y
 (
Hªdov”EÁ™y
* 
h
)

187 
m_hªdov”
 = 
h
;

188 
	}
}

190 
Hªdov”EÁ™y
*

191 
	gRrcEÁ™y
::
	$G‘Hªdov”EÁ™y
 ()

193  
m_hªdov”
;

194 
	}
}

	@/home/lyang3/work/src_son/runWorld/protocolStack/rrc/rrc-entity.h

3 #iâdeà
RRC_ENTITY_H


4 
	#RRC_ENTITY_H


	)

6 
	~<li¡
>

7 
	~<veùÜ
>

9 
şass
 
	gCÏssif›rP¬am‘”s
;

10 
şass
 
	gRadioB—»r
;

11 
şass
 
	gRadioB—»rSšk
;

12 
şass
 
	gRadioB—»rIn¡ªû
;

13 
şass
 
	gN‘wÜkNode
;

14 
şass
 
	gHªdov”EÁ™y
;

19 şas 
	cRrcEÁ™y


21 
	mpublic
:

23 
RrcEÁ™y
 ();

24 
	mvœtu®
 ~
RrcEÁ™y
 ();

26 
S‘Deviû
 (
N‘wÜkNode
* 
d
);

27 
N‘wÜkNode
* 
G‘Deviû
 ();

29 
	m¡d
::
	tveùÜ
<
	tRadioB—»r
* > 
	tRadioB—»rsCÚš”
;

30 
	m¡d
::
	tveùÜ
<
	tRadioB—»rSšk
* > 
	tRadioB—»rsSškCÚš”
;

33 
RadioB—»rsCÚš”
* 
G‘RadioB—»rCÚš”
 ();

34 
RadioB—»rsSškCÚš”
* 
G‘RadioB—»rSškCÚš”
 ();

37 
AddRadioB—»r
 (
RadioB—»r
* 
b—»r
);

38 
D–RadioB—»r
 (
RadioB—»r
* 
b—»r
);

41 
AddRadioB—»rSšk
 (
RadioB—»rSšk
* 
b—»r
);

42 
D–RadioB—»rSšk
 (
RadioB—»rSšk
* 
b—»r
);

45 
RadioB—»r
* 
G‘RadioB—»r
 (
CÏssif›rP¬am‘”s
* 
c
);

46 
RadioB—»rSšk
* 
G‘RadioB—»rSšk
 (
CÏssif›rP¬am‘”s
* 
c
);

47 
RadioB—»rIn¡ªû
* 
G‘RadioB—»r
 (
¾cIndex
);

50 
S‘Hªdov”EÁ™y
 (
Hªdov”EÁ™y
* 
h
);

51 
Hªdov”EÁ™y
* 
G‘Hªdov”EÁ™y
 ();

53 
	m´iv©e
:

54 
RadioB—»rsCÚš”
* 
m_b—»rs
;

55 
RadioB—»rsSškCÚš”
* 
	mm_sšk
;

56 
N‘wÜkNode
* 
	mm_deviû
;

57 
Hªdov”EÁ™y
* 
	mm_hªdov”
;

	@/home/lyang3/work/src_son/runWorld/random.cpp

1 
	~<¡dio.h
>

2 
	~<m©h.h
>

6 
	#M1
 259200

	)

7 
	#IA1
 7141

	)

8 
	#IC1
 54773

	)

9 
	#RM1
 (1.0/
M1
)

	)

10 
	#M2
 134456

	)

11 
	#IA2
 8121

	)

12 
	#IC2
 28411

	)

13 
	#RM2
 (1.0/
M2
)

	)

14 
	#M3
 243000

	)

15 
	#IA3
 4561

	)

16 
	#IC3
 51349

	)

18 
	$¿n1
(*
idum
) {

20 
ix1
,

21 
ix2
,

22 
ix3
;

24 
r
[98];

26 
‹mp
;

28 
iff
=0;

30 
j
;

32 
	`Ä”rÜ
();

34 ià(*
idum
 <0 || 
iff
 ==0) {

35 
iff
=1;

36 
ix1
=(
IC1
-(*
idum
)è% 
M1
;

37 
ix1
=(
IA1
*ix1+
IC1
è% 
M1
;

38 
ix2
=
ix1
 % 
M2
;

39 
ix1
=(
IA1
*ix1+
IC1
è% 
M1
;

40 
ix3
=
ix1
 % 
M3
;

41 
j
=1; j<=97; j++) {

42 
ix1
=(
IA1
*ix1+
IC1
è% 
M1
;

43 
ix2
=(
IA2
*ix2+
IC2
è% 
M2
;

44 
r
[
j
]=(
ix1
+
ix2
*
RM2
)*
RM1
;

46 *
idum
=1;

48 
ix1
=(
IA1
*ix1+
IC1
è% 
M1
;

49 
ix2
=(
IA2
*ix2+
IC2
è% 
M2
;

50 
ix3
=(
IA3
*ix3+
IC3
è% 
M3
;

51 
j
=1+((97*
ix3
)/
M3
);

53 
‹mp
=
r
[
j
];

54 
r
[
j
]=(
ix1
+
ix2
*
RM2
)*
RM1
;

56  
‹mp
;

57 
	}
}

59 
	$gasdev
(*
idum
) {

61 
i£t
=0;

63 
g£t
;

65 
çc
,
r
,
v1
,
v2
;

67 
	`¿n1
(*
idum
);

69 ià(
i£t
==0) {

71 
v1
=2.0* 
	`¿n1
(
idum
)-1.0;

72 
v2
=2.0* 
	`¿n1
(
idum
)-1.0;

73 
r
=
v1
*v1+
v2
*v2;

74 } 
r
>=1.0);

75 
çc
=
	`sq¹
(-2.0*
	`log
(
r
)/r);

76 
g£t
=
v1
*
çc
;

77 
i£t
=1;

78  
v2
*
çc
;

80 
i£t
=0;

81  
g£t
;

84 
	}
}

	@/home/lyang3/work/src_son/runWorld/random.h

2 
¿n1
(*
idum
);

3 
gasdev
(*
idum
);

	@/home/lyang3/work/src_son/runWorld/runWorld.cpp

1 
	~<io¡»am
>

2 
	~<f¡»am
>

4 
	~"runWÜld.h
"

5 
	~"wÜld.h
"

6 
	~"·thloss_‹¡.h
"

8 
usšg
 
Çme¥aû
 
	g¡d
;

10 
	eMašMode
 {

11 
	mTEST
,

12 
	mSINGLE_USER_DRIVE_TEST
,

13 
	mWORLD_RASTER_SCAN
,

14 
	mMULTI_USER_RANDOM_DISTRO_ONESHOT
,

15 
	mMULTI_USER_RANDOM_DISTRO_MOBILITY


18 
	$maš
(
¬gc
, *
¬gv
[]){

21 
boŞ


22 
bQu›t
 = 
Œue
,

23 
bFeOuut
 = 
Œue
;

26 
i
,

27 
iTick
,

28 
iDrİ
,

29 
iE¼
;

31 
MašMode


32 
Mode
 = 
WORLD_RASTER_SCAN
;

34 
D•loyMode


35 
Dmode
 = 
S³cific
;

38 
dIÁ”S™eDi¡ªû
 = 100;

40 
of¡»am


41 
feOuut2M©Ïb
;

43 
FILE


44 *
feIÅutFromCAD
,

45 *
feOuutFloÜPÏn
;

48 
feOuut2M©Ïb
.
	`İ’
("Results/Output2Matlab.txt");

54 
CoÜd


55 
coDTûÁ»
;

57 
FloÜ¶ªs


58 
æoÜ¶ªs
;

60 
WÜld
*

61 
myWÜld
 = 
Ãw
 
WÜld
;

63 
coDTûÁ»
.
dX
 =0.0;

64 
coDTûÁ»
.
dY
 =0.0;

66 ià(
Dmode
 =ğ
S³cific
){

68 ià((
feIÅutFromCAD
 = 
	`fİ’
("FloÜ¶ª/l89.dxf", "r")è=ğ
NULL
){

69 
cout
 << "No floorplan fileƒxists. \n";

73 
cout
 << "[runWorld] [Specific] [main] Started...\n";

76 
myWÜld
->
	`š™Ÿli£N‘wÜk
(
dIÁ”S™eDi¡ªû
, 
S³cific
);

79 
myWÜld
->
	`driveTe¡_Pede¡rŸn
(&
æoÜ¶ªs
);

83 
	`fşo£
Ğ
feIÅutFromCAD
 );

84 
	}
}

86 
	gcout
 << "[runWorld] [General] [main] Started...\n";

89 
	gmyWÜld
->
š™Ÿli£N‘wÜk
(
dIÁ”S™eDi¡ªû
, 
G’”®
);

91 
	gMode
) {

92 
	gTEST
:

93 
iE¼
 = 
‹¡P©hloss
();

94 
	gmyWÜld
->
cÚfigN‘wÜkTe¡Mode
(
SINGLESITE0_SINGLESECTOR2
);

97 
	gSINGLE_USER_DRIVE_TEST
:

99 
myWÜld
->
driveTe¡_Cœşe
(500.0,
coDTûÁ»
);

102 
	gWORLD_RASTER_SCAN
:

104 
myWÜld
->
´štN‘wÜk
(
bQu›t
, 
bFeOuut
);

107 
	gmyWÜld
->
ÿlcRa¡”Sÿn
(
BINSIZE
, &
æoÜ¶ªs
);

110 
	gMULTI_USER_RANDOM_DISTRO_ONESHOT
:

112 
iDrİ
 = 0; 
	giDrİ
 < 
	gDROPS
; iDrop++) {

113 
	gmyWÜld
->
š™Ÿli£HomeN‘wÜk
(
dIÁ”S™eDi¡ªû
);

116 
	gmyWÜld
->
š™Ÿli£U£rs
();

117 
	gmyWÜld
->
š™Ÿli£HomeU£rs
();

119 
	gmyWÜld
->
ÿlcP©hlos£s
(
bQu›t
);

122 
	gmyWÜld
->
ÿlcShadowšg
(
bQu›t
);

124 
	gmyWÜld
->
doC–lS–eùiÚ
(
bQu›t
);

127 
	gmyWÜld
->
doC–lAdmissiÚ
(
bQu›t
);

130 
	gmyWÜld
->
addIÁ”ã»nûToOth”C–ls
();

132 
	gmyWÜld
->
In™Fadšg
( );

134 
	giTick
 = 0; iTick < 
	gTICKS
; iTick++) {

136 
	gcout
 << "Drop‚umber/Total Drops: "

137 << 
	giDrİ
 << "/" << 
	gDROPS


139 << 
	giTick
 << "/" << 
	gTICKS
 << 
	g’dl
;

142 
	gmyWÜld
->
UlFadšg
(
iTick
);

143 
	gmyWÜld
->
UlScheduË
(
iDrİ
, 
iTick
);

146 
	gmyWÜld
->
DlFadšg
(
iTick
);

148 
	gmyWÜld
->
DlScheduË
(
iDrİ
, 
iTick
);

151 
	gmyWÜld
->
¡©sDowÆšk
(
iTick
);

154 
	gmyWÜld
->
¡©sU¶šk
(
iTick
);

161 
	gfeOuut2M©Ïb
 << 1001 << "\t" << 10001 << "\n";

162 
	gi
 = 0; i < 1001; i++) {

163 
	gfeOuut2M©Ïb
 << 
	gmyWÜld
->
	g¡©e
.
	gbš_ûÁ»s_¢r
[
i
] << "\t";

164 
	gfeOuut2M©Ïb
 << 
	gmyWÜld
->
	g¡©e
.
	ghi¡ULSNRMaüo
[
i
] << "\t";

165 
	gfeOuut2M©Ïb
 << 
	gmyWÜld
->
	g¡©e
.
	ghi¡ULSNRFemto
[
i
] << "\t";

166 
	gfeOuut2M©Ïb
 << 
	gmyWÜld
->
	g¡©e
.
	ghi¡DLSNRMaüo
[
i
] << "\t";

167 
	gfeOuut2M©Ïb
 << 
	gmyWÜld
->
	g¡©e
.
	ghi¡DLSNRFemto
[
i
] << "\n";

170 
	gi
 = 0; i < 10001; i++) {

171 
	gfeOuut2M©Ïb
 << 
	gmyWÜld
->
	g¡©e
.
	gbš_ûÁ»s_u£r_th±
[
i
] << "\t";

172 
	gfeOuut2M©Ïb
 << 
	gmyWÜld
->
	g¡©e
.
	ghi¡ULU£rTh±Maüo
[
i
] << "\t";

173 
	gfeOuut2M©Ïb
 << 
	gmyWÜld
->
	g¡©e
.
	ghi¡ULU£rTh±Femto
[
i
] << "\t";

174 
	gfeOuut2M©Ïb
 << 
	gmyWÜld
->
	g¡©e
.
	ghi¡DLU£rTh±Maüo
[
i
] << "\t";

175 
	gfeOuut2M©Ïb
 << 
	gmyWÜld
->
	g¡©e
.
	ghi¡DLU£rTh±Femto
[
i
] << "\n";

178 
	gfeOuut2M©Ïb
 << 
	g’dl
;

181 
	gMULTI_USER_RANDOM_DISTRO_MOBILITY
:

183 
myWÜld
->
š™Ÿli£HomeN‘wÜk
(
dIÁ”S™eDi¡ªû
);

186 
	gmyWÜld
->
š™Ÿli£U£rs
();

187 
	gmyWÜld
->
š™Ÿli£HomeU£rs
();

189 
	giTick
 = 0; iTick < 
	gTICKS
; iTick++) {

191 
	gcout
 << "TTI‚umbero sim: "

192 << 
	giTick
 << 
	g’dl
;

194 
	gmyWÜld
->
ÿlcP©hlos£s
(
bQu›t
);

197 
	gmyWÜld
->
ÿlcShadowšg
(
bQu›t
);

200 
	gmyWÜld
->
doC–lS–eùiÚ
(
bQu›t
);

203 
	gmyWÜld
->
doC–lAdmissiÚ
(
bQu›t
);

207 
	gmyWÜld
->
addIÁ”ã»nûToOth”C–ls
();

210 
	gmyWÜld
->
DlScheduË
(0, 
iTick
);

219 
	gmyWÜld
->
¡©sDowÆšk
(
iTick
);

222 
	gmyWÜld
->
¡©sU¶šk
(
iTick
);

225 
	gmyWÜld
->
moveU£rs
(
bQu›t
);

235 ià(
	gmyWÜld
)

237 
d–‘e
 
	gmyWÜld
;

241 
	gfeOuut2M©Ïb
.
şo£
();

	@/home/lyang3/work/src_son/runWorld/runWorld.h

2 
	#SITES
 7

	)

3 
	#MACROSECTORS
 3

	)

4 
	#PI
 3.1415926535

	)

5 
	#C¬rF»q
 2000.0

6 
	#BINSIZE
 1.0

7 
	#DROPS
 10

	)

8 
	#TICK
 10.0

9 
	#TICKS
 40

10 
	#W¬mUpTICKS
 20

11 
	#MAXSPEED
 1.0

12 
	#avMaüoUEsP”C–l
 20

13 
	#ISD
 700.0

14 
	#BSANTGAIN
 14.0

15 
	#BSANTHEIGHT
 32.0

16 
	#NªtsBSRx
 2

	)

17 
	#AÁS·cšgMaüo
 10

	)

18 
	#NOdBm
 -200.0

19 
	#mšS•¬©iÚUEMaüo
 35.0

20 
	#ShadowšgCÜ»lDi¡Maüo
 50.0

21 
	#ShadowšgStdDevMaüo
 8.0

22 
	#LTEBªdWidth
 10

23 

	)

25 
	#HSPANOISE
 (-174.0+4.0+67.0)

26 
	#HSPANOISERISE
 6.0

27 
	#HSPAC2ITARGET
 9.0

28 
	#HSPANBTXPWRMACRO
 43.0

29 

	)

31 
	#HSPAUENOISE
 (-174.0+6.0+67.0)

32 
	#HSPAUETXPWRMAX
 24.0

33 
	#HSPAUETXPWRMIN
 -50.0

34 

	)

36 
	#HSPAHNBNOISE
 (-174.0+4.0+67.0)

37 
	#HSPAHNBNOISERISE
 6.0

38 
	#HSPAHNBC2ITARGET
 9.0

39 
	#HSPAHNBTXPWRFEMTO
 23.0

40 

	)

42 #ià
LTEBªdWidth
 == 10

43 
	#LTENOISE
 (-174.0+5.0+70.0)

44 #–£

	)

45 
	#LTENOISE
 (-174.0+5.0+73.0)

47 
	#LTENOISERISE
 6.0

48 
	#LTEC2ITARGET
 9.0

49 
	#LTEeNBTXPWRMACRO
 46

50 
	#LTESam¶eR©e
 (1.536 * 
LTEBªdWidth
)

51 
	#Nrb
 (5 * 
LTEBªdWidth
)

52 
	#NrbPUCCH
 4

53 
	#numBlocksDL
 
LTEBªdWidth


54 
	#MaxUlFDM
 30

55 

	)

57 #ià
LTEBªdWidth
 == 10

58 
	#LTEUENOISE
 (-174.0+7.0+70.0)

59 #–£

	)

60 
	#LTEUENOISE
 (-174.0+7.0+73.0)

62 
	#LTEUETXPWRMAX
 23.0

63 
	#LTEUETXPWRMIN
 -50.0

64 

	)

65 
	#th”m®P”SymbŞUE
 (1.38e-23)*300*15e3*
	`pow
(10.0,6.0/10)

	)

66 
	#th”m®P”SymbŞMaüo
 (1.38e-23)*300*15e3*
	`pow
(10.0,5.0/10)

	)

67 
	#th”m®P”SymbŞFemto
 (1.38e-23)*300*15e3*
	`pow
(10.0,8.0/10)

	)

70 #ià
LTEBªdWidth
 == 10

71 
	#LTEHeNBNOISE
 (-174.0+8.0+70.0)

72 #–£

	)

73 
	#LTEHeNBNOISE
 (-174.0+8.0+73.0)

75 
	#LTEHeNBNOISERISE
 6.0

76 
	#LTEHeNBC2ITARGET
 9.0

77 
	#LTEHeNBTXPWRFEMTO
 20.0

78 
	#LTEHeNBTXPWRFEMTOMIN
 0.0

79 

	)

81 
	#M‘rÛNBS
 15

82 
	#METROANTHEIGHT
 4.5

83 
	#METROANTGAIN
 5.0

84 
	#LTEeNBTXPWRMETRO
 20.0

85 

	)

87 
	#FEMTOANTHEIGHT
 1.5

88 
	#FEMTOANTGAIN
 5.0

89 
	#A±FloÜHeight
 3.0

90 
	#HeNBS
 30

91 
	#HOMEUSERS
 30

92 
	#NumHUEsP”HeNB
 1

93 
	#HeNBD•lTy³
 
APTBLOCKMODEL


94 
	#NUMSŒAPT
 2

95 
	#BLOCKS³rCELL
 1

96 
	#mšS•¬©iÚA±A±
 98.99494936611666

97 
	#mšS•¬©iÚA±Maüo
 84.4974746830583

98 
	#ShadowšgCÜ»lDi¡Femto
 0.0

99 
	#ShadowšgStdDevFemto
 4.0

100 

	)

101 
	#UeAÁ’ÇHeight
 1.5

102 
	#UeAÁGaš
 0.0

103 
	#AÁS·cšgFemto
 0.5

	)

105 
	#mšS•¬©iÚUEFemto
 3.0

106 
	#´obMaüoUeOutdoÜs
 0.1

107 

	)

108 
	#DLd—dzÚeT¬g‘
 80

109 
	#DLmšMaüoSIR
 30

110 

	)

112 
	#Ùh”MaüoUEP’‘¿tiÚ
 20.0

113 
	#Ex‹riÜW®lP’‘¿tiÚLoss
 20.0

114 

	)

116 
	#numFadšgP©hs
 10

	)

117 
	#numSub·thFadšgChªÃl
 10

	)

119 
	#dAÍha
 0.8

	)

120 
	#dB‘a
 0.6

	)

121 
	#®phaUL
 0.9

	)

122 
	#b‘aUL
 0.5

	)

125 
	#X2f‹rCÛff
 0.93

	)

126 
	#th»shX2HighIÁ”f
 9

	)

127 
	#th»shX2LowIÁ”f
 6

	)

128 
	#rg‘IoTMaüo
 3

	@/home/lyang3/work/src_son/runWorld/scheduling.cpp

1 
	~<io¡»am
>

2 
	~<f¡»am
>

3 
	~<m©h.h
>

5 
	~"wÜld.h
"

6 
	~"¿ndom.h
"

8 
usšg
 
Çme¥aû
 
	g¡d
;

9 
RBSizeTabË
[27];

11 
	gWÜld
::
	$DlScheduË
(
iDrİ
, 
nTTIs
){

13 
iS™es
, 
iSeùs
, 
dÚe
, 
iUE
, 
i
, 
j
, 
šd
, 
¡¬tRB
,

14 
PrbGroupAva
, 
maxSegsFemtoMaüoTmp
, 
£ËùedTBS
, 
ÿpMšOv”SŒ—ms
, 
NRB£Ëùed
,

15 
ÿpS–eùed
, 
numBlocksDLU£d
, 
£rvedUE³rTTI
,

16 
hi¡ÜicH¬qInd
;

18 
avaMaxPow”
,

19 
maxPow”P”RB
,

20 
SNRava
[
numBlocksDL
],

21 
S·¿m
,

22 
tÙ®C­Max
, 
numRBsMax
,

23 
tÙ®C­Max2
,

24 
equivChªBe¡_»
[
numC¬r›rIÁ”e¡
/
decim©eR©e
],
equivChªBe¡_im
[numCarrierInterest/decimateRate],

25 
NItoU£
[
numBlocksDL
],

26 
be¡Ind
[
numBlocksDL
],

27 
be¡SNR
[
numBlocksDL
],

28 
ÿpDiff
,

29 
tmpMaxPow”
,

30 
³rAÁPow”Requœed
,

31 
SNRtmp
[
numBlocksDL
];

33 
i
=0; i<
numC¬r›rIÁ”e¡
/
decim©eR©e
; i++){

34 
equivChªBe¡_»
[
i
] = 0.5;

35 
equivChªBe¡_im
[
i
] = 0.5;

38 
i
=0; i<
numBlocksDL
; i++){

39 
NItoU£
[
i
] = 3e-16;

40 
be¡Ind
[
i
] = 0;

41 
be¡SNR
[
i
] = 0;

44 
hi¡ÜicH¬qInd
 = (
nTTIs
 + 4) % 8;

46 
iS™es
=0; iS™es<
numMaüoS™es
; iSites++){

47 
iSeùs
=0; iSeùs<
MACROSECTORS
; iSects++){

49 ià(
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
 > 0){

50 
PrbGroupAva
 = 
numBlocksDL
;

51 
maxSegsFemtoMaüoTmp
 = 
numBlocksDL
;

52 
avaMaxPow”
 = 
	`dBm2Lš—rW
(
LTEeNBTXPWRMACRO
);

53 
maxPow”P”RB
 = 
avaMaxPow”
 / 
Nrb
;

54 
£rvedUE³rTTI
 = 0;

55 
dÚe
 = 0;

56 
PrbGroupAva
 = 
¡©e
.
PrbGroupAvaMaüo
[
iS™es
][
iSeùs
];

57 
¡¬tRB
 = 
¡©e
.
¡¬tRBMaüo
[
iS™es
][
iSeùs
];

59 
dÚe
 == 0){

60 
iUE
 = 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
’B_Ée_·rs
.
ŒafficMªag”
.
ueS”vedQueue
[S™es[iS™es].SeùÜs[iSeùs].’B_Ée_·rs.ŒafficMªag”.
iU£rS”všg
];

61 
i
=0; i<
numBlocksDL
; i++)

62 
SNRava
[
i
] = 
UEs
[
iUE
].
SNR_DL
[i];

64 
i
=1; i<=
numBlocksDL
; i++){

65 
j
=0; j<=
numBlocksDL
-
i
; j++){

66 
SNRtmp
[
j
] = 0;

67 
šd
=
j
; ind<j+
i
; ind++)

68 
SNRtmp
[
j
] = SNRtmp[j] + 
SNRava
[
šd
] * 
numBlocksDL
 / 
i
 / i;

70 
šd
 = (
numBlocksDL
-
i
-1è* 
	`¿n1
(&
iS“d
);

71 ià(
SNRtmp
[
šd
] > 0){

72 
be¡Ind
[
i
-1] = 
šd
;

73 
be¡SNR
[
i
-1] = 
SNRtmp
[
šd
];

78 
i
=0; i<
numC¬r›rIÁ”e¡
/
decim©eR©e
; i++){

79 
equivChªBe¡_»
[
i
] = 
UEs
[
iUE
].
DLFadšgAÎ
[i][
hi¡ÜicH¬qInd
].
»®
;

80 
equivChªBe¡_im
[
i
] = 
UEs
[
iUE
].
DLFadšgAÎ
[i][
hi¡ÜicH¬qInd
].
img
;

82 
i
=0; i<
numBlocksDL
; i++)

83 
NItoU£
[
i
] = 
UEs
[
iUE
].
sumNIf‹»d
[i];

86 
S·¿m
=0.08333333 * 
	`dB2R—l
(-
UEs
[
iUE
].
ueLTEd©a
.
ûÎD©a
[
iS™es
][
iSeùs
].
dP©hlossNoB—ršg
);

88 
	`sum_ÿp_maüo_1Ïy”_DL
(&
tÙ®C­Max
,&
numRBsMax
,
Nrb
,1,&
equivChªBe¡_»
[0], &
equivChªBe¡_im
[0], 
S·¿m
, 
dAÍha
, 
dB‘a
,

89 &
NItoU£
[0],
numBlocksDL
,
be¡Ind
,4,
avaMaxPow”
,
maxPow”P”RB
,
mšP”AÁPwrP”UE
);

91 ià(
numRBsMax
 > 0){

92 
tÙ®C­Max2
 = 
	`mš
(5 * 
numRBsMax
, 
tÙ®C­Max
);

93 
tÙ®C­Max2
 =Ù®C­Max2*ÑÙ®C­Max2>=
numRBsMax
/8);

95 ià(
tÙ®C­Max2
 > 0){

97 
£ËùedTBS
 = 
tÙ®C­Max2
 * 12.0 * (14-
NsymsPDCCH
è* 
pÙRedFac
;

98 
ÿpMšOv”SŒ—ms
 = 
tÙ®C­Max
 / 
numRBsMax
;

99 
NRB£Ëùed
 = 
numRBsMax
;

102 
ÿpDiff
 = 
	`max
(0, 
ÿpMšOv”SŒ—ms
 - 5);

104 
tmpMaxPow”
 = 
	`mš
(
avaMaxPow”
, 
maxPow”P”RB
 * 
numRBsMax
);

105 
tmpMaxPow”
 = 
	`max
ÑmpMaxPow”, 
mšP”AÁPwrP”UE
);

106 
³rAÁPow”Requœed
 = 
tmpMaxPow”
;

108 
ÿpS–eùed
 = 
tÙ®C­Max2
 / 
numRBsMax
;

109 
numBlocksDLU£d
 = 
	`û
(
numRBsMax
 * 
numBlocksDL
 / 
Nrb
);

114 
PrbGroupAva
 = PrbGroupAva - 
numBlocksDLU£d
;

115 
¡¬tRB
 = s¹RB + 
numBlocksDLU£d
;

117 
j
 = ((
¡¬tRB
-
numBlocksDLU£d
 + 
numBlocksDL
è%‚umBlocksDLè* 
Nrb
 /‚umBlocksDL;

118 
i
=
j
; i<j+
NRB£Ëùed
; i++){

119 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
’B_Ée_·rs
.
TxPow”ENB³rRB
[
i
%
Nrb
] = 
³rAÁPow”Requœed
 / 
NRB£Ëùed
;

124 
³rAÁPow”Requœed
 = 0;

125 
NRB£Ëùed
 = 0;

126 
£ËùedTBS
 = 0;

127 
ÿpS–eùed
 = 0;

130 ià(
nTTIs
 > 
W¬mUpTICKS
)

131 
UEs
[
iUE
].
ueLTEd©a
.
avDLThroughputs
 = UEs[iUE].ueLTEd©a.avDLThroughput + 
£ËùedTBS
;

134 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”všg
 = (Sites[iSites].Sectors[iSects].enB_lte_pars.trafficManager.iUserServing + 1)

135 % 
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
;

136 
£rvedUE³rTTI
++;

138 ià(
£rvedUE³rTTI
 >ğ
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
){

139 
dÚe
 = 1;

140 
PrbGroupAva
 = 
numBlocksDL
;

141 
¡¬tRB
 = 0;

143 ià(
PrbGroupAva
 <= 0){

144 
dÚe
 = 1;

146 
PrbGroupAva
 = PrbGroupAva + 
numBlocksDL
;

147 
¡¬tRB
 = s¹RB % 
numBlocksDL
;

150 ià(
nTTIs
 > 
W¬mUpTICKS
)

151 
¡©e
.
DLûÎThruPtMaüo
[
iDrİ
][
iS™es
][
iSeùs
] = s‹.DLûÎThruPtMaüo[
nTTIs
][iS™es][iSeùs] + 
£ËùedTBS
;

154 
¡©e
.
PrbGroupAvaMaüo
[
iS™es
][
iSeùs
] = 
PrbGroupAva
;

155 
¡©e
.
¡¬tRBMaüo
[
iS™es
][
iSeùs
] = 
¡¬tRB
;

160 
iS™es
=0; iS™es<
numHeNB
; iSites++){

163 
HeNBS™es
[
iS™es
].
	`pow”S‘tšg
(&
HUEs
[0], &
UEs
[0], 
numMaüoS™es
, 
numMaüoUEs
);

165 
avaMaxPow”
 = 
	`dBm2Lš—rW
(
HeNBS™es
[
iS™es
].
’B_Ée_·rs
.
dTxpow”
);

166 
maxPow”P”RB
 = 
avaMaxPow”
 / 
Nrb
;

168 
£rvedUE³rTTI
 = 0;

169 
dÚe
 = 0;

171 
PrbGroupAva
 = 
¡©e
.
PrbGroupAvaFemto
[
iS™es
];

172 
¡¬tRB
 = 
¡©e
.
¡¬tRBFemto
[
iS™es
];

174 
dÚe
 == 0){

175 
iUE
 = 
HeNBS™es
[
iS™es
].
’B_Ée_·rs
.
ŒafficMªag”
.
ueS”vedQueue
[HeNBS™es[iS™es].’B_Ée_·rs.ŒafficMªag”.
iU£rS”všg
];

176 
i
=0; i<
numBlocksDL
; i++)

177 
SNRava
[
i
] = 
HUEs
[
iUE
].
SNR_DL
[i];

179 
i
=1; i<=
numBlocksDL
; i++){

180 
j
=0; j<=
numBlocksDL
-
i
; j++){

181 
SNRtmp
[
j
] = 0;

182 
šd
=
j
; ind<j+
i
; ind++)

183 
SNRtmp
[
j
] = SNRtmp[j] + 
SNRava
[
šd
] * 
numBlocksDL
 / 
i
 / i;

185 
šd
 = (
numBlocksDL
-
i
-1è* 
	`¿n1
(&
iS“d
);

186 ià(
SNRtmp
[
šd
] > 0){

187 
be¡Ind
[
i
-1] = 
šd
;

188 
be¡SNR
[
i
-1] = 
SNRtmp
[
šd
];

193 
i
=0; i<
numC¬r›rIÁ”e¡
/
decim©eR©e
; i++){

194 
equivChªBe¡_»
[
i
] = 
HUEs
[
iUE
].
DLFadšgAÎ
[i][
hi¡ÜicH¬qInd
].
»®
;

195 
equivChªBe¡_im
[
i
] = 
HUEs
[
iUE
].
DLFadšgAÎ
[i][
hi¡ÜicH¬qInd
].
img
;

197 
i
=0; i<
numBlocksDL
; i++)

198 
NItoU£
[
i
] = 
HUEs
[
iUE
].
sumNIf‹»d
[i];

201 
S·¿m
=0.08333333 * 
	`dB2R—l
(-
HUEs
[
iUE
].
ueLTEd©a
.
ãmtoD©a
[
iS™es
].
dP©hloss
);

203 
	`sum_ÿp_ãmto_1Ïy”_DL
(&
tÙ®C­Max
,&
numRBsMax
,
Nrb
,1,&
equivChªBe¡_»
[0], &
equivChªBe¡_im
[0], 
S·¿m
, 
dAÍha
, 
dB‘a
, &
NItoU£
[0],

204 
numBlocksDL
, 
be¡Ind
, 4, 
avaMaxPow”
, 
maxPow”P”RB
, 
mšP”AÁPwrP”UE
, &
RBSizeTabË
[0], 27, 
§m¶esP”Block
);

206 ià(
numRBsMax
 > 0){

207 
tÙ®C­Max2
 = 
	`mš
(5 * 
numRBsMax
, 
tÙ®C­Max
);

208 
tÙ®C­Max2
 =Ù®C­Max2*ÑÙ®C­Max2>=
numRBsMax
/8);

210 ià(
tÙ®C­Max2
 > 0){

212 
£ËùedTBS
 = 
tÙ®C­Max2
 * 12 * (14-
NsymsPDCCH
è* 
pÙRedFac
;

213 
ÿpMšOv”SŒ—ms
 = 
tÙ®C­Max
 / 
numRBsMax
;

214 
NRB£Ëùed
 = 
numRBsMax
;

217 
ÿpDiff
 = 
	`max
(0, 
ÿpMšOv”SŒ—ms
 - 5);

219 
tmpMaxPow”
 = 
	`mš
(
avaMaxPow”
, 
maxPow”P”RB
 * 
numRBsMax
);

220 
tmpMaxPow”
 = 
	`max
ÑmpMaxPow”, 
mšP”AÁPwrP”UE
);

221 
³rAÁPow”Requœed
 = 
tmpMaxPow”
;

223 
ÿpS–eùed
 = 
tÙ®C­Max2
 / 
numRBsMax
;

224 
numBlocksDLU£d
 = 
	`û
(
numRBsMax
 * 
numBlocksDL
 / 
Nrb
);

226 ià(
£rvedUE³rTTI
 == 0 )

227 
¡¬tRB
 = 
be¡Ind
[
numBlocksDLU£d
];

229 
PrbGroupAva
 = PrbGroupAva - 
numBlocksDLU£d
;

230 
¡¬tRB
 = s¹RB + 
numBlocksDLU£d
;

232 
j
 = ((
¡¬tRB
-
numBlocksDLU£d
 + 
numBlocksDL
è%‚umBlocksDLè* 
Nrb
 /‚umBlocksDL;

233 
i
=
j
; i<j+
NRB£Ëùed
; i++){

234 
HeNBS™es
[
iS™es
].
’B_Ée_·rs
.
TxPow”ENB³rRB
[
i
%
Nrb
] = 
³rAÁPow”Requœed
 / 
NRB£Ëùed
;

236 
i
=
j
+
NRB£Ëùed
; i<j+
Nrb
; i++){

237 
HeNBS™es
[
iS™es
].
’B_Ée_·rs
.
TxPow”ENB³rRB
[
i
%
Nrb
] = 
³rAÁPow”Requœed
 / 
NRB£Ëùed
;

242 
³rAÁPow”Requœed
 = 0;

243 
NRB£Ëùed
 = 0;

244 
£ËùedTBS
 = 0;

245 
ÿpS–eùed
 = 0;

248 ià(
nTTIs
 > 
W¬mUpTICKS
)

249 
HUEs
[
iUE
].
ueLTEd©a
.
avDLThroughputs
 = HUEs[iUE].ueLTEd©a.avDLThroughput + 
£ËùedTBS
;

252 
HeNBS™es
[
iS™es
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”všg
 = (HeNBSites[iSites].enB_lte_pars.trafficManager.iUserServing + 1)

253 % 
HeNBS™es
[
iS™es
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
;

254 
£rvedUE³rTTI
++;

256 ià(
£rvedUE³rTTI
 >ğ
HeNBS™es
[
iS™es
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
){

257 
dÚe
 = 1;

258 
PrbGroupAva
 = 
numBlocksDL
;

259 
¡¬tRB
 = 0;

261 ià(
PrbGroupAva
 <= 0){

262 
dÚe
 = 1;

263 
PrbGroupAva
 = PrbGroupAva % 
numBlocksDL
;

264 
¡¬tRB
 = s¹RB % 
numBlocksDL
;

267 ià(
nTTIs
 > 
W¬mUpTICKS
)

268 
¡©e
.
DLûÎThruPtFemto
[
iDrİ
][
iS™es
] = s‹.DLûÎThruPtFemto[
nTTIs
][iS™es] + 
£ËùedTBS
;

270 
¡©e
.
PrbGroupAvaFemto
[
iS™es
] = 
PrbGroupAva
;

271 
¡©e
.
¡¬tRBFemto
[
iS™es
] = 
¡¬tRB
;

273 
	}
}

275 
	gWÜld
::
	$UlScheduË
(
iDrİ
, 
nTTIs
){

277 
iUE
, 
iS™e
, 
iSeùÜ
,

278 
i
, 
j
, 
iAÁ
,

279 
h¬qInd
,

280 
avaRBs
,

281 
numUEsSched
,

282 
¼AmouÁ
,

283 
»£rveAmouÁ
[70],

284 
toDoFÏg
[70],

285 
¡¬tAvaRbPos
,

286 
¡¬tPosFÏg
 = 1,

287 
’dAvaRbPos
,

288 
NRBsToU£Max
,

289 
rg‘Boo¡
 = 1,

290 
¡¬tInd
,

291 
¡¬tPos
,

292 
’dPos
,

293 
§m¶esP”RB
,

294 
»duùiÚFac
 = 1,

295 
hi¡ÜicH¬qInd
;

298 
m‘ricsUL
[70],

299 
maxTÙ®P”AÁTxPow”UE
 = 0.2,

300 
ULschdAÍha
 = 0.25,

301 
mšTh±T¬g‘UL
 = 400,

302 
niIn
[50],

303 
tÙ®C­Max
, 
NRB£Ëùed
, 
NRB£ËùedMš
, 
tÙ®C­Max2
,

304 
equivChªBe¡_»
[(
numC¬r›rIÁ”e¡
 - 12 * 
NrbPUCCH
)/
decim©eR©e
][
NªtsBSRx
],

305 
equivChªBe¡_im
[(
numC¬r›rIÁ”e¡
 - 12 * 
NrbPUCCH
)/
decim©eR©e
][
NªtsBSRx
],

306 
buffIn
,

307 
S·¿m
,

308 
avaMaxPow”
,

309 
ÿpS–eùed
,

310 
³rAÁPow”Requœed
,

311 
£ËùedTBS
,

312 
ÿpMšOv”SŒ—ms
,

313 
PŞd
, 
PÃw
,

314 
®ph®og2b‘aPÃw
,

315 
ÿpDiff
,

316 
ULmaxMCS
 = 3,

317 
pÙRedFacUL
 = 6.0/7.0,

318 
mxRBpow
;

320 
§m¶esP”RB
 = 
chªÃl
.samplesPerRB;

321 
h¬qInd
 = 
nTTIs
 % 8;

322 
hi¡ÜicH¬qInd
 = ((
nTTIs
 + 4 ) % 8);

324 
iS™e
=0; iS™e<
numMaüoS™es
; iSite++)

325 
iSeùÜ
=0; iSeùÜ<
MACROSECTORS
; iSector++){

326 ià(
nTTIs
 == 0){

327 
¡©e
.
ULûÎThruPtMaüo
[
iDrİ
][
iS™e
][
iSeùÜ
] = 0;

328 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”všgUl
 =

329 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
 * 
	`¿n1
(&
iS“d
);

331 
numUEsSched
 = 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
;

332 ià(
numUEsSched
 > 
MaxUlFDM
)

333 
numUEsSched
 = 
MaxUlFDM
;

335 
avaRBs
 = 
Nrb
 - 
NrbPUCCH
;

336 
¼AmouÁ
 = 
	`æoÜ
(()(
Nrb
 - 
NrbPUCCH
è/ 
numUEsSched
);

337 
¡¬tAvaRbPos
 = 0;

340 
i
=0; i<
numUEsSched
; i++){

341 
m‘ricsUL
[
i
] = 0;

342 
toDoFÏg
[
i
] = 1;

343 
iUE
 = 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
ŒafficMªag”
.
ueS”vedQueue
[

344 ((
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”všgUl
 + 
i
)

345 % 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
)];

346 
j
=0; j<
Nrb
-
NrbPUCCH
; j++){

347 
m‘ricsUL
[
i
] = m‘ricsUL[i] + 
UEs
[
iUE
].
SNR_UL
[
j
];

349 
m‘ricsUL
[
i
] = 
	`pow
(m‘ricsUL[i] / (
Nrb
-
NrbPUCCH
), 
ULschdAÍha
);

351 
»£rveAmouÁ
[
i
] = 1 + ((
UEs
[
iUE
].
ueLTEd©a
.
avULThroughputs
è< 
mšTh±T¬g‘UL
è* (
¼AmouÁ
 - 1);

353 
’dAvaRbPos
 = 
avaRBs
 - 1;

355 
i
=0; i<
numUEsSched
; i++){

356 
iUE
 = 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
ŒafficMªag”
.
ueS”vedQueue
[

357 ((
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”všgUl
 + 
i
)

358 % 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
)];

359 ià(
SchedMode
 =ğ
RoundRobš
)

360 
NRBsToU£Max
 = 
¼AmouÁ
;

362 
¡¬tInd
 = 
¡¬tAvaRbPos
;

363 
¡¬tPos
 = 
¡¬tInd
 * 
§m¶esP”RB
;

364 
’dPos
 = 
¡¬tPos
 + 
NRBsToU£Max
*
§m¶esP”RB
 -1;

366 
j
=0; j<
NRBsToU£Max
*
§m¶esP”RB
; j++){

367 
iAÁ
=0; iAÁ<
NªtsBSRx
; iAnt++){

368 
equivChªBe¡_»
[
j
][
iAÁ
] = 
UEs
[
iUE
].
ULFadšgAÎ
[j][iAÁ][
hi¡ÜicH¬qInd
].
»®
;

369 
equivChªBe¡_im
[
j
][
iAÁ
] = 
UEs
[
iUE
].
ULFadšgAÎ
[j][iAÁ][
hi¡ÜicH¬qInd
].
img
;

373 
mxRBpow
 = 0.2 / 
NRBsToU£Max
 * 
»duùiÚFac
;

374 ià(
UEs
[
iUE
].
ueLTEd©a
.
avULThroughputs
 < 
mšTh±T¬g‘UL
)

375 
mxRBpow
 = mxRBpow * 
rg‘Boo¡
;

377 
S·¿m
 = 
	`dB2R—l
(-
UEs
[
iUE
].
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dP©hlossNoB—ršg
) / 12.0;

378 
j
=0; j<
NRBsToU£Max
; j++)

379 
niIn
[
j
] = 
UEs
[
iUE
].
sumNIf‹»dUL
[j+
¡¬tInd
];

380 
buffIn
 = 
	`û
(
UEs
[
iUE
].
T¿fficMod–ULBufãr
 / (12*14*
pÙRedFacUL
));

382 
	`sum_ÿp_maüo_1Ïy”_UL
(&
tÙ®C­Max
, &
NRB£Ëùed
, &
NRB£ËùedMš
, 
NRBsToU£Max
, 
NªtsBSRx
, &
equivChªBe¡_»
[0][0], &
equivChªBe¡_im
[0][0],

383 
S·¿m
, 
®phaUL
, 
b‘aUL
, &
niIn
[0], 
maxTÙ®P”AÁTxPow”UE
, 
mxRBpow
, 
§m¶esP”RB
, 
buffIn
, 
ULmaxMCS
);

385 ià(
NRB£ËùedMš
 == 0){

386 
avaMaxPow”
 = 
	`mš
(
maxTÙ®P”AÁTxPow”UE
, 
NRB£Ëùed
*
mxRBpow
);

387 
tÙ®C­Max2
 = 
	`mš
(
ULmaxMCS
*
NRB£Ëùed
,
tÙ®C­Max
);

388 
tÙ®C­Max2
 =Ù®C­Max2 * (tÙ®C­Max2>=
NRB£Ëùed
/8);

391 
avaMaxPow”
 = 
	`mš
(
maxTÙ®P”AÁTxPow”UE
, 
NRB£ËùedMš
*
mxRBpow
);

392 
tÙ®C­Max2
 = 
buffIn
;

393 
tÙ®C­Max2
 =Ù®C­Max2 * (tÙ®C­Max2>=
NRB£ËùedMš
/8);

396 ià(
tÙ®C­Max2
 > 0){

398 ià(
NRB£ËùedMš
 > 0){

399 
£ËùedTBS
 = 
buffIn
 * 12 * 14 * 
pÙRedFacUL
;

400 
NRB£Ëùed
 = 
NRB£ËùedMš
;

401 
ÿpMšOv”SŒ—ms
 = 
tÙ®C­Max
 / 
NRB£Ëùed
;

402 
ÿpDiff
 = 
	`max
(0.0, 
ÿpMšOv”SŒ—ms
 - 
tÙ®C­Max2
 / 
NRB£Ëùed
);

405 
£ËùedTBS
 = 
tÙ®C­Max2
 * 12 * 14 * 
pÙRedFacUL
;

406 
ÿpMšOv”SŒ—ms
 = 
tÙ®C­Max
 / 
NRB£Ëùed
;

407 
ÿpDiff
 = 
	`max
(0.0, 
ÿpMšOv”SŒ—ms
 - 
ULmaxMCS
);

411 
PŞd
=1;

412 
PÃw
=1;

413 if(
ÿpDiff
 > 0){

414 
®ph®og2b‘aPÃw
 = 
®phaUL
 * 
	`log
(
b‘aUL
 * 
PŞd
)/log(2.0è- 
ÿpDiff
;

415 
PÃw
 = 1.0 / 
b‘aUL
 * 
	`pow
(2.0, (
®ph®og2b‘aPÃw
 / 
®phaUL
));

417 
³rAÁPow”Requœed
 = 
avaMaxPow”
 * 
PÃw
;

418 
ÿpS–eùed
 = 
tÙ®C­Max2
 / 
NRB£Ëùed
;

420 ià(
nTTIs
 > 
W¬mUpTICKS
){

422 
UEs
[
iUE
].
ueLTEd©a
.
avULThroughputs
 = UEs[iUE].ueLTEd©a.avULThroughput + 
£ËùedTBS
;

423 
¡©e
.
ULûÎThruPtMaüo
[
iDrİ
][
iS™e
][
iSeùÜ
] = s‹.ULûÎThruPtMaüo[
nTTIs
][iS™e][iSeùÜ] + 
£ËùedTBS
;

427 ià(
UEs
[
iUE
].
ŒafficMod–Ty³
 =ğ
Bur¡y
)

428 
UEs
[
iUE
].
T¿fficMod–ULBufãr
 = 
	`max
(0.0,UEs[iUE].T¿fficMod–ULBufã¸- 8*
£ËùedTBS
);

430 ià(
¡¬tPosFÏg
 == 1)

431 
¡¬tAvaRbPos
 = s¹AvaRbPo + 
NRB£Ëùed
;

433 
’dAvaRbPos
 =ƒndAvaRbPo - 
NRB£Ëùed
;

434 
¡¬tInd
 = s¹Ind + (
NRBsToU£Max
-
NRB£Ëùed
);

436 
j
=0; j<
¡¬tInd
; j++)

437 
UEs
[
iUE
].
ulTxPow”UE³rRB
[
j
][
h¬qInd
] = 
	`dBm2Lš—rW
(UEs[iUE].
ueLTEd©a
.
dTxpow”
)/(
Nrb
-
NrbPUCCH
);

438 
j
=
¡¬tInd
; j<¡¬tInd+
NRB£Ëùed
; j++)

439 
UEs
[
iUE
].
ulTxPow”UE³rRB
[
j
][
h¬qInd
] = 
³rAÁPow”Requœed
 / 
NRB£Ëùed
;

440 
j
=j; j<
Nrb
-
NrbPUCCH
; j++)

441 
UEs
[
iUE
].
ulTxPow”UE³rRB
[
j
][
h¬qInd
] = 
	`dBm2Lš—rW
(UEs[iUE].
ueLTEd©a
.
dTxpow”
)/(
Nrb
-
NrbPUCCH
);

443 
j
=0; j<
Nrb
-
NrbPUCCH
; j++)

444 
UEs
[
iUE
].
SNR_UL
[
j
] = UEs[iUE].SNR_UL[j] * 
	`mš
(1.0,
mxRBpow
/(
maxTÙ®P”AÁTxPow”UE
/
Nrb
));

450 
toDoFÏg
[
i
] = 0;

454 
iS™e
=0; iS™e<
numHeNB
; iSite++){

455 ià(
nTTIs
 == 0)

456 
¡©e
.
ULûÎThruPtFemto
[
iDrİ
][
iS™e
] = 0;

457 
numUEsSched
 = 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
;

458 
avaRBs
 = 
Nrb
 - 
NrbPUCCH
;

459 
¼AmouÁ
 = 
	`æoÜ
(()(
Nrb
 - 
NrbPUCCH
è/ 
numUEsSched
);

460 
¡¬tAvaRbPos
 = 0;

461 
i
=0; i<
numUEsSched
; i++){

462 
iUE
 = 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
ŒafficMªag”
.
ueS”vedQueue
[

463 ((
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”všgUl
 + 
i
)

464 % 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
)];

465 ià(
SchedMode
 =ğ
RoundRobš
)

466 
NRBsToU£Max
 = 
¼AmouÁ
;

468 
¡¬tInd
 = 
¡¬tAvaRbPos
;

469 
¡¬tPos
 = 
¡¬tInd
 * 
§m¶esP”RB
;

470 
’dPos
 = 
¡¬tPos
 + 
NRBsToU£Max
*
§m¶esP”RB
 -1;

472 
j
=0; j<
NRBsToU£Max
*
§m¶esP”RB
; j++){

473 
iAÁ
=0; iAÁ<
NªtsBSRx
; iAnt++){

474 
equivChªBe¡_»
[
j
][
iAÁ
] = 
HUEs
[
iUE
].
ULFadšgAÎ
[j][iAÁ][
hi¡ÜicH¬qInd
].
»®
;

475 
equivChªBe¡_im
[
j
][
iAÁ
] = 
HUEs
[
iUE
].
ULFadšgAÎ
[j][iAÁ][
hi¡ÜicH¬qInd
].
img
;

480 
mxRBpow
 = 
HUEs
[
iUE
].
ueLTEd©a
.
maxTxPow”P”RB
 * 
»duùiÚFac
;

481 ià(
HUEs
[
iUE
].
ueLTEd©a
.
avULThroughputs
 < 
mšTh±T¬g‘UL
)

482 
mxRBpow
 = mxRBpow * 
rg‘Boo¡
;

483 
S·¿m
 = 
	`dB2R—l
(-
HUEs
[
iUE
].
ueLTEd©a
.
ãmtoD©a
[
iS™e
].
dP©hloss
) / 12.0;

484 
j
=0; j<
NRBsToU£Max
; j++)

485 
niIn
[
j
] = 
HUEs
[
iUE
].
sumNIf‹»dUL
[j+
¡¬tInd
];

486 
buffIn
 = 
	`û
(
HUEs
[
iUE
].
T¿fficMod–ULBufãr
 / (12*14*
pÙRedFacUL
));

488 
	`sum_ÿp_ãmto_1Ïy”_UL
(&
tÙ®C­Max
, &
NRB£Ëùed
, &
NRB£ËùedMš
, 
NRBsToU£Max
, 
NªtsBSRx
, &
equivChªBe¡_»
[0][0], &
equivChªBe¡_im
[0][0],

489 
S·¿m
, 
®phaUL
, 
b‘aUL
, &
niIn
[0], 
maxTÙ®P”AÁTxPow”UE
, 
mxRBpow
, 
§m¶esP”RB
, &
RBSizeTabË
[0], 18, 
buffIn
, 
ULmaxMCS
);

491 ià(
NRB£ËùedMš
 == 0){

492 
avaMaxPow”
 = 
	`mš
(
maxTÙ®P”AÁTxPow”UE
, 
NRB£Ëùed
*
mxRBpow
);

493 
tÙ®C­Max2
 = 
	`mš
(
ULmaxMCS
*
NRB£Ëùed
,
tÙ®C­Max
);

494 
tÙ®C­Max2
 =Ù®C­Max2 * (tÙ®C­Max2>=
NRB£Ëùed
/8);

497 ià(
tÙ®C­Max2
 > 0){

499 ià(
NRB£ËùedMš
 > 0){

500 
£ËùedTBS
 = 
buffIn
 * 12 * 14 * 
pÙRedFacUL
;

501 
NRB£Ëùed
 = 
NRB£ËùedMš
;

502 
ÿpMšOv”SŒ—ms
 = 
tÙ®C­Max
 / 
NRB£Ëùed
;

503 
ÿpDiff
 = 
	`max
(0.0, 
ÿpMšOv”SŒ—ms
 - 
tÙ®C­Max2
 / 
NRB£Ëùed
);

506 
£ËùedTBS
 = 
tÙ®C­Max2
 * 12 * 14 * 
pÙRedFacUL
;

507 
ÿpMšOv”SŒ—ms
 = 
tÙ®C­Max
 / 
NRB£Ëùed
;

508 
ÿpDiff
 = 
	`max
(0.0, 
ÿpMšOv”SŒ—ms
 - 
ULmaxMCS
);

512 
PŞd
=1;

513 
PÃw
=1;

514 if(
ÿpDiff
 > 0){

515 
®ph®og2b‘aPÃw
 = 
®phaUL
 * 
	`log
(
b‘aUL
 * 
PŞd
)/log(2.0è- 
ÿpDiff
;

516 
PÃw
 = 1.0 / 
b‘aUL
 * 
	`pow
(2.0, (
®ph®og2b‘aPÃw
 / 
®phaUL
));

518 
³rAÁPow”Requœed
 = 
avaMaxPow”
 * 
PÃw
;

519 
ÿpS–eùed
 = 
tÙ®C­Max2
 / 
NRB£Ëùed
;

521 ià(
nTTIs
 > 
W¬mUpTICKS
){

523 
HUEs
[
iUE
].
ueLTEd©a
.
avULThroughputs
 = HUEs[iUE].ueLTEd©a.avULThroughput + 
£ËùedTBS
;

524 
¡©e
.
ULûÎThruPtMaüo
[
iDrİ
][
iS™e
][
iSeùÜ
] = s‹.ULûÎThruPtMaüo[
nTTIs
][iS™e][iSeùÜ] + 
£ËùedTBS
;

528 ià(
HUEs
[
iUE
].
ŒafficMod–Ty³
 =ğ
Bur¡y
)

529 
HUEs
[
iUE
].
T¿fficMod–ULBufãr
 = 
	`max
(0.0,HUEs[iUE].T¿fficMod–ULBufã¸- 8*
£ËùedTBS
);

531 ià(
¡¬tPosFÏg
 == 1)

532 
¡¬tAvaRbPos
 = s¹AvaRbPo + 
NRB£Ëùed
;

534 
’dAvaRbPos
 =ƒndAvaRbPo - 
NRB£Ëùed
;

535 
¡¬tInd
 = s¹Ind + (
NRBsToU£Max
-
NRB£Ëùed
);

537 
j
=0; j<
¡¬tInd
; j++)

538 
HUEs
[
iUE
].
ulTxPow”UE³rRB
[
j
][
h¬qInd
] = 
	`dBm2Lš—rW
(HUEs[iUE].
ueLTEd©a
.
dTxpow”
)/(
Nrb
-
NrbPUCCH
);

539 
j
=
¡¬tInd
; j<¡¬tInd+
NRB£Ëùed
; j++)

540 
HUEs
[
iUE
].
ulTxPow”UE³rRB
[
j
][
h¬qInd
] = 
³rAÁPow”Requœed
 / 
NRB£Ëùed
;

541 
j
=j; j<
Nrb
-
NrbPUCCH
; j++)

542 
HUEs
[
iUE
].
ulTxPow”UE³rRB
[
j
][
h¬qInd
] = 
	`dBm2Lš—rW
(HUEs[iUE].
ueLTEd©a
.
dTxpow”
)/(
Nrb
-
NrbPUCCH
);

544 
j
=0; j<
Nrb
-
NrbPUCCH
; j++)

545 
HUEs
[
iUE
].
SNR_UL
[
j
] = HUEs[iUE].SNR_UL[j] * 
	`mš
(1.0,
mxRBpow
/(
maxTÙ®P”AÁTxPow”UE
/
Nrb
));

552 
toDoFÏg
[
i
] = 0;

555 
	}
}

	@/home/lyang3/work/src_son/runWorld/shadowing.cpp

1 
	~<io¡»am
>

2 
	~<f¡»am
>

3 
	~<m©h.h
>

5 
	~"wÜld.h
"

6 
	~"¿ndom.h
"

8 
usšg
 
Çme¥aû
 
	g¡d
;

10 
	gWÜld
::
	$ÿlcShadowšg
(
boŞ
 
bQu›t
){

12 **
shadowšgCÜ»lMaüo
,

13 **
shadowšgCÜ»lFemto
,

14 **
evecs
,

15 *
ev®s
,

16 *
‘emp
,

17 **
autoShadowSam¶es
,

18 **
cÜ»lShadowšgSam¶es
,

19 
‹mpDi¡
,

20 **
cÜ»lM©
, 
ev®s17
[17], 
‘emp17
[17],

21 
cÜ»lShadowšgSam¶esTmp
[17];

24 
iUE
, 
i
, 
j
,

25 
PLmaxCouÁ
,

26 
šdexFemtoN—»¡
[11];

28 
shadowšgCÜ»lMaüo
 = (**è
	`m®loc
((
numMaüoUEs
+
numHomeUE
) * (*));

29 ià(
ShadowšgCÜ»lDi¡Femto
 > 0)

30 
shadowšgCÜ»lFemto
 = (**è
	`m®loc
((
numMaüoUEs
+
numHomeUE
) * (*));

32 
ev®s
 = (*è
	`m®loc
((
numMaüoUEs
+
numHomeUE
) * ());

33 
‘emp
 = (*è
	`m®loc
((
numMaüoUEs
+
numHomeUE
) * ());

34 
autoShadowSam¶es
 = (**è
	`m®loc
((
numMaüoS™es
+
numHeNB
) * (*));

35 
cÜ»lShadowšgSam¶es
 = (**è
	`m®loc
((
numMaüoS™es
+
numHeNB
) * (*));

37 
i
=0; i<
numMaüoUEs
+
numHomeUE
; i++){

38 
shadowšgCÜ»lMaüo
[
i
] = (*è
	`m®loc
((
numMaüoUEs
+
numHomeUE
) * ());

39 ià(
ShadowšgCÜ»lDi¡Femto
 > 0)

40 
shadowšgCÜ»lFemto
[
i
] = (*è
	`m®loc
((
numMaüoUEs
+
numHomeUE
) * ());

45 
i
=0; i<
numMaüoS™es
+
numHeNB
; i++){

46 
autoShadowSam¶es
[
i
] = (*è
	`m®loc
((
numMaüoUEs
+
numHomeUE
) * ());

47 
cÜ»lShadowšgSam¶es
[
i
] = (*è
	`m®loc
((
numMaüoUEs
+
numHomeUE
) * ());

50 
iUE
=0; iUE<
numMaüoUEs
; iUE++){

51 
i
=0; i<
iUE
; i++){

52 
‹mpDi¡
 = 
	`Di¡ªû
(
UEs
[
i
].
LoÿtiÚ
, UEs[
iUE
].Location);

53 
shadowšgCÜ»lMaüo
[
iUE
][
i
] = 
	`exp
(-
‹mpDi¡
 / 
ShadowšgCÜ»lDi¡Maüo
);

54 
shadowšgCÜ»lMaüo
[
i
][
iUE
] = shadowingCorrelMacro[iUE][i];

55 ià(
ShadowšgCÜ»lDi¡Femto
 > 0){

56 
shadowšgCÜ»lFemto
[
iUE
][
i
] = 
	`exp
(-
‹mpDi¡
 / 
ShadowšgCÜ»lDi¡Femto
);

57 
shadowšgCÜ»lFemto
[
i
][
iUE
] = shadowingCorrelFemto[iUE][i];

60 
shadowšgCÜ»lMaüo
[
iUE
][iUE] = 1.0;

61 ià(
ShadowšgCÜ»lDi¡Femto
 > 0)

62 
shadowšgCÜ»lFemto
[
iUE
][iUE] = 1.0;

65 
iUE
=
numMaüoUEs
; iUE<numMaüoUEs+
numHomeUE
; iUE++){

66 
i
=
numMaüoUEs
; i<
iUE
; i++){

67 
‹mpDi¡
 = 
	`Di¡ªû
(
HUEs
[
i
-
numMaüoUEs
].
LoÿtiÚ
, HUEs[
iUE
-numMacroUEs].Location);

68 
shadowšgCÜ»lMaüo
[
iUE
][
i
] = 
	`exp
(-
‹mpDi¡
 / 
ShadowšgCÜ»lDi¡Maüo
);

69 
shadowšgCÜ»lMaüo
[
i
][
iUE
] = shadowingCorrelMacro[iUE][i];

70 ià(
ShadowšgCÜ»lDi¡Femto
 > 0){

71 
shadowšgCÜ»lFemto
[
iUE
][
i
] = 
	`exp
(-
‹mpDi¡
 / 
ShadowšgCÜ»lDi¡Femto
);

72 
shadowšgCÜ»lFemto
[
i
][
iUE
] = shadowingCorrelFemto[iUE][i];

75 
shadowšgCÜ»lMaüo
[
iUE
][iUE] = 1.0;

76 ià(
ShadowšgCÜ»lDi¡Femto
 > 0)

77 
shadowšgCÜ»lFemto
[
iUE
][iUE] = 1.0;

79 
i
=0; i<
numMaüoUEs
; i++){

80 
‹mpDi¡
 = 
	`Di¡ªû
(
HUEs
[
iUE
-
numMaüoUEs
].
LoÿtiÚ
, 
UEs
[
i
].Location);

81 
shadowšgCÜ»lMaüo
[
iUE
][
i
] = 
	`exp
(-
‹mpDi¡
 / 
ShadowšgCÜ»lDi¡Maüo
);

82 
shadowšgCÜ»lMaüo
[
i
][
iUE
] = shadowingCorrelMacro[iUE][i];

83 ià(
ShadowšgCÜ»lDi¡Femto
 > 0){

84 
shadowšgCÜ»lFemto
[
iUE
][
i
] = 
	`exp
(-
‹mpDi¡
 / 
ShadowšgCÜ»lDi¡Femto
);

85 
shadowšgCÜ»lFemto
[
i
][
iUE
] = shadowingCorrelFemto[iUE][i];

91 
	`Œed
(
shadowšgCÜ»lMaüo
,
ev®s
,
‘emp
, 
numMaüoUEs
+
numHomeUE
);

92 
evecs
 = 
shadowšgCÜ»lMaüo
;

93 
	`tqli
(
ev®s
,
‘emp
,
evecs
, 
numMaüoUEs
+
numHomeUE
);

96 
i
=0; i<
numMaüoUEs
+
numHomeUE
; i++)

97 
ev®s
[
i
] = 
	`sq¹
(evals[i]);

99 
i
=0; i<
numMaüoS™es
; i++){

100 
iUE
=0; iUE<
numMaüoUEs
+
numHomeUE
; iUE++){

101 
autoShadowSam¶es
[
i
][
iUE
] = 0.0;

102 
j
=0; j<
numMaüoUEs
+
numHomeUE
; j++){

103 
autoShadowSam¶es
[
i
][
iUE
] =‡utoShadowSam¶es[i][iUE] + 
ev®s
[
j
]*
evecs
[iUE][j]*
	`gasdev
(&
iS“d
);

105 
cÜ»lShadowšgSam¶es
[
i
][
iUE
] = 
autoShadowSam¶es
[i][iUE] * 
ShadowšgStdDevMaüo
;

109 ià(
ShadowšgCÜ»lDi¡Femto
 > 0){

111 
	`Œed
(
shadowšgCÜ»lFemto
,
ev®s
,
‘emp
, 
numMaüoUEs
+
numHomeUE
);

112 
evecs
 = 
shadowšgCÜ»lFemto
;

113 
	`tqli
(
ev®s
,
‘emp
,
evecs
, 
numMaüoUEs
+
numHomeUE
);

115 
i
=0; i<
numMaüoUEs
+
numHomeUE
; i++){

116 ià(
ShadowšgCÜ»lDi¡Femto
 > 0)

117 
ev®s
[
i
] = 
	`sq¹
(evals[i]);

119 
ev®s
[
i
] = 1.0;

122 
i
=
numMaüoS™es
; i<numMaüoS™es+
numHeNB
; i++){

123 
iUE
=0; iUE<
numMaüoUEs
+
numHomeUE
; iUE++){

124 
autoShadowSam¶es
[
i
][
iUE
] = 0.0;

125 ià(
ShadowšgCÜ»lDi¡Femto
 > 0){

126 
j
=0; j<
numMaüoUEs
+
numHomeUE
; j++)

127 
autoShadowSam¶es
[
i
][
iUE
] =‡utoShadowSam¶es[i][iUE] + 
ev®s
[
j
]*
evecs
[iUE][j]*
	`gasdev
(&
iS“d
);

130 
autoShadowSam¶es
[
i
][
iUE
] = 
	`gasdev
(&
iS“d
);

131 
cÜ»lShadowšgSam¶es
[
i
][
iUE
] = 
autoShadowSam¶es
[i][iUE] * 
ShadowšgStdDevMaüo
;

141 
cÜ»lM©
 = (**è
	`m®loc
(17 * (*));

142 
i
=0; i<17; i++)

143 
cÜ»lM©
[
i
] = (*è
	`m®loc
(17 * ());

144 
i
=0; i<17; i++){

145 
j
=0; j<17; j++){

146 
cÜ»lM©
[
i
][
j
] = 0.5;

148 
cÜ»lM©
[
i
][i] = 1.0;

152 
	`Œed
(
cÜ»lM©
,
ev®s17
,
‘emp17
, 17);

153 
	`tqli
(
ev®s17
,
‘emp17
,
cÜ»lM©
, 17);

155 
i
=0; i<17; i++)

156 
ev®s17
[
i
] = 
	`sq¹
(evals17[i]);

158 
iUE
=0; iUE<
numMaüoUEs
; iUE++){

160 
i
=0; i<17; i++){

161 
cÜ»lShadowšgSam¶esTmp
[
i
] = 0.0;

163 
PLmaxCouÁ
 = 0;

164 
šdexFemtoN—»¡
[0] = 0;

166 
i
=1; i<
numHeNB
; i++){

167 ià(
UEs
[
iUE
].
ueLTEd©a
.
ãmtoD©a
[
i
].
dP©hloss
 < 200){

168 ià(
PLmaxCouÁ
 < 10)

169 
PLmaxCouÁ
++;

170 
šdexFemtoN—»¡
[
PLmaxCouÁ
] = 
i
;

172 
j
=
PLmaxCouÁ
; j>0; j--){

173 ià(
UEs
[
iUE
].
ueLTEd©a
.
ãmtoD©a
[
i
].
dP©hloss
 < UEs[iUE].ueLTEd©a.ãmtoD©a[
šdexFemtoN—»¡
[
j
-1]].dPathloss){

174 
šdexFemtoN—»¡
[
j
] = indexFemtoNearest[j-1];

175 
šdexFemtoN—»¡
[
j
-1] = 
i
;

178 
j
 = 0;

183 
i
=0; i<17; i++){

184 
j
=0; j<
numMaüoS™es
; j++){

185 
cÜ»lShadowšgSam¶esTmp
[
i
] = cÜ»lShadowšgSam¶esTmp[i] + 
cÜ»lM©
[i][
j
] * 
ev®s17
[j] * 
autoShadowSam¶es
[j][
iUE
];

187 
j
=0; j<
PLmaxCouÁ
-1; j++){

188 
cÜ»lShadowšgSam¶esTmp
[
i
] = cÜ»lShadowšgSam¶esTmp[i] + 
cÜ»lM©
[i][
j
+
numMaüoS™es
] * 
ev®s17
[j+numMaüoS™es] * 
autoShadowSam¶es
[
šdexFemtoN—»¡
[j]+numMaüoS™es][
iUE
];

191 ià(
UEs
[
iUE
].
ueD•loym’tTy³
 =ğ
maüoUeInFemto
)

192 
cÜ»lShadowšgSam¶esTmp
[
i
] = cÜ»lShadowšgSam¶esTmp[i] * 
ShadowšgStdDevFemto
;

194 
cÜ»lShadowšgSam¶esTmp
[
i
] = cÜ»lShadowšgSam¶esTmp[i] * 
ShadowšgStdDevMaüo
;

197 
j
=0; j<
numMaüoS™es
; j++){

198 
cÜ»lShadowšgSam¶es
[
j
][
iUE
] = 
cÜ»lShadowšgSam¶esTmp
[j];

200 
j
=0; j<
PLmaxCouÁ
-1; j++){

201 
cÜ»lShadowšgSam¶es
[
šdexFemtoN—»¡
[
j
]+
numMaüoS™es
][
iUE
] = 
cÜ»lShadowšgSam¶esTmp
[j+numMacroSites];

205 
iUE
=
numMaüoUEs
; iUE<numMaüoUEs+
numHomeUE
; iUE++){

207 
i
=0; i<17; i++){

208 
cÜ»lShadowšgSam¶esTmp
[
i
] = 0.0;

210 
PLmaxCouÁ
 = 0;

211 
šdexFemtoN—»¡
[0] = 0;

213 
i
=1; i<
numHeNB
; i++){

214 ià(
HUEs
[
iUE
-
numMaüoUEs
].
ueLTEd©a
.
ãmtoD©a
[
i
].
dP©hloss
 < 1000){

215 ià(
PLmaxCouÁ
 < 10)

216 
PLmaxCouÁ
++;

217 
šdexFemtoN—»¡
[
PLmaxCouÁ
] = 
i
;

219 
j
=
PLmaxCouÁ
; j>0; j--){

220 ià(
HUEs
[
iUE
-
numMaüoUEs
].
ueLTEd©a
.
ãmtoD©a
[
i
].
dP©hloss
 < HUEs[iUE-numMaüoUEs].ueLTEd©a.ãmtoD©a[
šdexFemtoN—»¡
[
j
-1]].dPathloss){

221 
šdexFemtoN—»¡
[
j
] = indexFemtoNearest[j-1];

222 
šdexFemtoN—»¡
[
j
-1] = 
i
;

225 
j
 = 0;

230 
i
=0; i<17; i++){

231 
j
=0; j<
numMaüoS™es
; j++){

232 
cÜ»lShadowšgSam¶esTmp
[
i
] = cÜ»lShadowšgSam¶esTmp[i] + 
cÜ»lM©
[i][
j
] * 
ev®s17
[j] * 
autoShadowSam¶es
[j][
iUE
];

234 
j
=0; j<
PLmaxCouÁ
-1; j++){

235 
cÜ»lShadowšgSam¶esTmp
[
i
] = cÜ»lShadowšgSam¶esTmp[i] + 
cÜ»lM©
[i][
j
+
numMaüoS™es
] * 
ev®s17
[j+numMaüoS™es] * 
autoShadowSam¶es
[
šdexFemtoN—»¡
[j]+numMaüoS™es][
iUE
];

238 ià(
HUEs
[
iUE
-
numMaüoUEs
].
ueD•loym’tTy³
 =ğ
ãmtoUeIndoÜ
)

239 
cÜ»lShadowšgSam¶esTmp
[
i
] = cÜ»lShadowšgSam¶esTmp[i] * 
ShadowšgStdDevFemto
;

241 
cÜ»lShadowšgSam¶esTmp
[
i
] = cÜ»lShadowšgSam¶esTmp[i] * 
ShadowšgStdDevMaüo
;

244 
j
=0; j<
numMaüoS™es
; j++){

245 
cÜ»lShadowšgSam¶es
[
j
][
iUE
] = 
cÜ»lShadowšgSam¶esTmp
[j];

247 
j
=0; j<
PLmaxCouÁ
-1; j++){

248 
cÜ»lShadowšgSam¶es
[
šdexFemtoN—»¡
[
j
]+
numMaüoS™es
][
iUE
] = 
cÜ»lShadowšgSam¶esTmp
[j+numMacroSites];

252 
iUE
=0; iUE<
numMaüoUEs
; iUE++){

253 
i
=0; i<
numMaüoS™es
; i++){

254 
j
=0; j<
MACROSECTORS
; j++){

255 
UEs
[
iUE
].
ueHSPAd©a
.
ûÎD©a
[
i
][
j
].
dP©hlossNoB—ršg
 = UEs[iUE].ueHSPAd©a.ûÎD©a[i][j].dP©hlossNoB—ršg - 
cÜ»lShadowšgSam¶es
[i][iUE];

256 
UEs
[
iUE
].
ueHSPAd©a
.
ûÎD©a
[
i
][
j
].
dP©hloss
 = UEs[iUE].ueHSPAd©a.ûÎD©a[i][j].dP©hlos - 
cÜ»lShadowšgSam¶es
[i][iUE];

257 
UEs
[
iUE
].
ueHSPAd©a
.
ûÎD©a
[
i
][
j
].
dP©hlossW¿µed
 = UEs[iUE].ueHSPAd©a.ûÎD©a[i][j].dP©hlossW¿µed - 
cÜ»lShadowšgSam¶es
[i][iUE];

258 
UEs
[
iUE
].
ueHSPAd©a
.
ûÎD©a
[
i
][
j
].
dRxpow”
 = 
S™es
[i].
SeùÜs
[j].
nB_h¥a_·rs
.
dTxpow”


259 - 
UEs
[
iUE
].
ueHSPAd©a
.
ûÎD©a
[
i
][
j
].
dP©hloss
;

261 
UEs
[
iUE
].
ueLTEd©a
.
ûÎD©a
[
i
][
j
].
dP©hlossNoB—ršg
 = UEs[iUE].ueLTEd©a.ûÎD©a[i][j].dP©hlossNoB—ršg - 
cÜ»lShadowšgSam¶es
[i][iUE];

262 
UEs
[
iUE
].
ueLTEd©a
.
ûÎD©a
[
i
][
j
].
dP©hloss
 = UEs[iUE].ueLTEd©a.ûÎD©a[i][j].dP©hlos - 
cÜ»lShadowšgSam¶es
[i][iUE];

263 
UEs
[
iUE
].
ueLTEd©a
.
ûÎD©a
[
i
][
j
].
dP©hlossW¿µed
 = UEs[iUE].ueLTEd©a.ûÎD©a[i][j].dP©hlossW¿µed - 
cÜ»lShadowšgSam¶es
[i][iUE];

264 
UEs
[
iUE
].
ueLTEd©a
.
ûÎD©a
[
i
][
j
].
dRxpow”
 = 
S™es
[i].
SeùÜs
[j].
’B_Ée_·rs
.
dTxpow”


265 - 
UEs
[
iUE
].
ueLTEd©a
.
ûÎD©a
[
i
][
j
].
dP©hloss
;

269 
i
=0; i<
numHeNB
; i++){

270 
UEs
[
iUE
].
ueHSPAd©a
.
ãmtoD©a
[
i
].
dP©hlossNoB—ršg
 = UEs[iUE].ueHSPAd©a.ãmtoD©a[i].dP©hlossNoB—ršg - 
cÜ»lShadowšgSam¶es
[i+
numMaüoS™es
][iUE];

271 
UEs
[
iUE
].
ueHSPAd©a
.
ãmtoD©a
[
i
].
dP©hloss
 = UEs[iUE].ueHSPAd©a.ãmtoD©a[i].dP©hlos - 
cÜ»lShadowšgSam¶es
[i+
numMaüoS™es
][iUE];

272 
UEs
[
iUE
].
ueHSPAd©a
.
ãmtoD©a
[
i
].
dP©hlossW¿µed
 = UEs[iUE].ueHSPAd©a.ãmtoD©a[i].dP©hlossW¿µed - 
cÜ»lShadowšgSam¶es
[i+
numMaüoS™es
][iUE];

273 
UEs
[
iUE
].
ueHSPAd©a
.
ãmtoD©a
[
i
].
dRxpow”
 = 
HeNBS™es
[i].
nB_h¥a_·rs
.
dTxpow”


274 - 
UEs
[
iUE
].
ueHSPAd©a
.
ãmtoD©a
[
i
].
dP©hloss
;

276 
UEs
[
iUE
].
ueLTEd©a
.
ãmtoD©a
[
i
].
dP©hlossNoB—ršg
 = UEs[iUE].ueLTEd©a.ãmtoD©a[i].dP©hlossNoB—ršg - 
cÜ»lShadowšgSam¶es
[i+
numMaüoS™es
][iUE];

277 
UEs
[
iUE
].
ueLTEd©a
.
ãmtoD©a
[
i
].
dP©hloss
 = UEs[iUE].ueLTEd©a.ãmtoD©a[i].dP©hlos - 
cÜ»lShadowšgSam¶es
[i+
numMaüoS™es
][iUE];

278 
UEs
[
iUE
].
ueLTEd©a
.
ãmtoD©a
[
i
].
dP©hlossW¿µed
 = UEs[iUE].ueLTEd©a.ãmtoD©a[i].dP©hlossW¿µed - 
cÜ»lShadowšgSam¶es
[i+
numMaüoS™es
][iUE];

279 
UEs
[
iUE
].
ueLTEd©a
.
ãmtoD©a
[
i
].
dRxpow”
 = 
HeNBS™es
[i].
’B_Ée_·rs
.
dTxpow”


280 - 
UEs
[
iUE
].
ueLTEd©a
.
ãmtoD©a
[
i
].
dP©hloss
;

284 
iUE
=0; iUE<
numHomeUE
; iUE++){

285 
i
=0; i<
numMaüoS™es
; i++){

286 
j
=0; j<
MACROSECTORS
; j++){

287 
HUEs
[
iUE
].
ueHSPAd©a
.
ûÎD©a
[
i
][
j
].
dP©hlossNoB—ršg
 = HUEs[iUE].ueHSPAd©a.ûÎD©a[i][j].dP©hlossNoB—ršg - 
cÜ»lShadowšgSam¶es
[i][iUE+
numMaüoUEs
];

288 
HUEs
[
iUE
].
ueHSPAd©a
.
ûÎD©a
[
i
][
j
].
dP©hloss
 = HUEs[iUE].ueHSPAd©a.ûÎD©a[i][j].dP©hlos - 
cÜ»lShadowšgSam¶es
[i][iUE+
numMaüoUEs
];

289 
HUEs
[
iUE
].
ueHSPAd©a
.
ûÎD©a
[
i
][
j
].
dP©hlossW¿µed
 = HUEs[iUE].ueHSPAd©a.ûÎD©a[i][j].dP©hlossW¿µed - 
cÜ»lShadowšgSam¶es
[i][iUE+
numMaüoUEs
];

290 
HUEs
[
iUE
].
ueHSPAd©a
.
ûÎD©a
[
i
][
j
].
dRxpow”
 = 
S™es
[i].
SeùÜs
[j].
nB_h¥a_·rs
.
dTxpow”


291 - 
HUEs
[
iUE
].
ueHSPAd©a
.
ûÎD©a
[
i
][
j
].
dP©hloss
;

293 
HUEs
[
iUE
].
ueLTEd©a
.
ûÎD©a
[
i
][
j
].
dP©hlossNoB—ršg
 = HUEs[iUE].ueLTEd©a.ûÎD©a[i][j].dP©hlossNoB—ršg - 
cÜ»lShadowšgSam¶es
[i][iUE+
numMaüoUEs
];

294 
HUEs
[
iUE
].
ueLTEd©a
.
ûÎD©a
[
i
][
j
].
dP©hloss
 = HUEs[iUE].ueLTEd©a.ûÎD©a[i][j].dP©hlos - 
cÜ»lShadowšgSam¶es
[i][iUE+
numMaüoUEs
];

295 
HUEs
[
iUE
].
ueLTEd©a
.
ûÎD©a
[
i
][
j
].
dP©hlossW¿µed
 = HUEs[iUE].ueLTEd©a.ûÎD©a[i][j].dP©hlossW¿µed - 
cÜ»lShadowšgSam¶es
[i][iUE+
numMaüoUEs
];

296 
HUEs
[
iUE
].
ueLTEd©a
.
ûÎD©a
[
i
][
j
].
dRxpow”
 = 
S™es
[i].
SeùÜs
[j].
’B_Ée_·rs
.
dTxpow”


297 - 
HUEs
[
iUE
].
ueLTEd©a
.
ûÎD©a
[
i
][
j
].
dP©hloss
;

301 
i
=0; i<
numHeNB
; i++){

302 
HUEs
[
iUE
].
ueHSPAd©a
.
ãmtoD©a
[
i
].
dP©hlossNoB—ršg
 = HUEs[iUE].ueHSPAd©a.ãmtoD©a[i].
dP©hloss
 - 
cÜ»lShadowšgSam¶es
[i+
numMaüoS™es
][iUE+
numMaüoUEs
];

303 
HUEs
[
iUE
].
ueHSPAd©a
.
ãmtoD©a
[
i
].
dP©hloss
 = HUEs[iUE].ueHSPAd©a.ãmtoD©a[i].dP©hlos - 
cÜ»lShadowšgSam¶es
[i+
numMaüoS™es
][iUE+
numMaüoUEs
];

304 
HUEs
[
iUE
].
ueHSPAd©a
.
ãmtoD©a
[
i
].
dP©hlossW¿µed
 = HUEs[iUE].ueHSPAd©a.ãmtoD©a[i].dP©hlossW¿µed - 
cÜ»lShadowšgSam¶es
[i+
numMaüoS™es
][iUE+
numMaüoUEs
];

305 
HUEs
[
iUE
].
ueHSPAd©a
.
ãmtoD©a
[
i
].
dRxpow”
 = 
HeNBS™es
[i].
nB_h¥a_·rs
.
dTxpow”


306 - 
HUEs
[
iUE
].
ueHSPAd©a
.
ãmtoD©a
[
i
].
dP©hloss
;

308 
HUEs
[
iUE
].
ueLTEd©a
.
ãmtoD©a
[
i
].
dP©hlossNoB—ršg
 = HUEs[iUE].ueLTEd©a.ãmtoD©a[i].
dP©hloss
 - 
cÜ»lShadowšgSam¶es
[i+
numMaüoS™es
][iUE+
numMaüoUEs
];

309 
HUEs
[
iUE
].
ueLTEd©a
.
ãmtoD©a
[
i
].
dP©hloss
 = HUEs[iUE].ueLTEd©a.ãmtoD©a[i].dP©hlos - 
cÜ»lShadowšgSam¶es
[i+
numMaüoS™es
][iUE+
numMaüoUEs
];

310 
HUEs
[
iUE
].
ueLTEd©a
.
ãmtoD©a
[
i
].
dP©hlossW¿µed
 = HUEs[iUE].ueLTEd©a.ãmtoD©a[i].dP©hlossW¿µed - 
cÜ»lShadowšgSam¶es
[i+
numMaüoS™es
][iUE+
numMaüoUEs
];

311 
HUEs
[
iUE
].
ueLTEd©a
.
ãmtoD©a
[
i
].
dRxpow”
 = 
HeNBS™es
[i].
’B_Ée_·rs
.
dTxpow”


312 - 
HUEs
[
iUE
].
ueLTEd©a
.
ãmtoD©a
[
i
].
dP©hloss
;

317 
	`ä“
(
shadowšgCÜ»lMaüo
);

318 ià(
ShadowšgCÜ»lDi¡Femto
 > 0)

319 
	`ä“
(
shadowšgCÜ»lFemto
);

321 
	`ä“
(
ev®s
);

322 
	`ä“
(
‘emp
);

323 
	`ä“
(
autoShadowSam¶es
);

324 
	`ä“
(
cÜ»lShadowšgSam¶es
);

325 
	`ä“
(
cÜ»lM©
);

326 
	}
}

328 
	$autoCÜ»Ï‹dShadowšgM­
(
‹mpH
, 
‹mpV
, 
fálx
, 
fály
, 
iS“d
, 
§m¶_Ëngth
, 
d_decÜr
, 
sigmaL_acÜ
, ** 
shadow_chªÃl
){

330 
aÙoShadowšgM©rix
;

332 
nÜm®_fá
;

333 
i
, 
j
;

335 
nÜm®_fá
 = (**è
	`m®loc
((
fálx
) * (*));

336 
aÙoShadowšgM©rix
 = (**è
	`m®loc
((
fálx
) * (*));

337 
i
=0; i<
fálx
; i++){

338 
nÜm®_fá
[
i
] = (*è
	`m®loc
((
fály
*2) * ());

339 
aÙoShadowšgM©rix
[
i
] = (*è
	`m®loc
((
fály
*2) * ());

340 
j
=0; j<
fály
*2; j++){

341 
nÜm®_fá
[
i
][
j
] = 0.0;

342 
aÙoShadowšgM©rix
[
i
][
j
] = 0.0;

346 
i
=-
‹mpH
; i<tempH + 1; i++){

347 
j
=-
‹mpV
; j<tempV + 1; j++){

348 
nÜm®_fá
[
i
+
‹mpH
][(
j
+
‹mpV
)*2] = 
	`gasdev
(&
iS“d
);

349 
aÙoShadowšgM©rix
[
i
+
‹mpH
][(
j
+
‹mpV
)*2] = 
	`exp
(-
	`sq¹
((i*
§m¶_Ëngth
)*(i*§m¶_Ëngthè+ (j*§m¶_Ëngth)*(j*§m¶_Ëngth)è/ 
d_decÜr
);

353 *

,

354 
n
;

356 *
w
;

358 
n
 = 
	`max
(
fálx
, 
fály
);

359 

 = (*è
	`m®loc
((2 + (è
	`sq¹
(
n
 + 0.5)) * ());

360 
n
 = 
	`max
(
fálx
 / 2, 
fály
 / 2) + max(fftlx, fftly);

361 
w
 = (*è
	`m®loc
(
n
 * ());

362 

[0] = 0;

364 
	`cdá2d
(
fálx
, 
fály
*2, 1, 
nÜm®_fá
, 

, 
w
);

365 
	`cdá2d
(
fálx
, 
fály
*2, 1, 
aÙoShadowšgM©rix
, 

, 
w
);

367 
Com¶ex


368 
cTemp
;

369 
i
=0; i<
fálx
; i++){

370 
j
=0; j<
fály
; j++){

371 
cTemp
 = 
	`com¶ex
(
aÙoShadowšgM©rix
[
i
][
j
*2],‡otoShadowingMatrix[i][j*2+1]);

372 
cTemp
 = 
	`Com¶exR—lMul
(
	`pha£2Com¶ex
(
	`Com¶ex2Pha£
(
	`com¶ex
(
nÜm®_fá
[
i
][
j
*2],‚Üm®_fá[i][j*2+1]))), 
	`sq¹
(sq¹(
	`pow”
(cTemp))));

373 
aÙoShadowšgM©rix
[
i
][
j
*2] = 
cTemp
.
»®
;

374 
aÙoShadowšgM©rix
[
i
][
j
*2+1] = 
cTemp
.
img
;

377 
	`cdá2d
(
fálx
, 
fály
*2, -1, 
aÙoShadowšgM©rix
, 

, 
w
);

380 
¡d
 = 0,

381 
m—n
 = 0;

382 
i
=0; i<
‹mpH
*2+1; i++){

383 
j
=0; j<
‹mpV
*2+1; j++){

384 
shadow_chªÃl
[
i
][
j
] = 
aÙoShadowšgM©rix
[i][j*2];

385 
m—n
 = m—À+ 
shadow_chªÃl
[
i
][
j
];

388 
m—n
 = m—À/ (
‹mpH
*2+1è/ (
‹mpV
*2+1);

389 
i
=0; i<
‹mpH
*2+1; i++){

390 
j
=0; j<
‹mpV
*2+1; j++){

391 
¡d
 = std + (
shadow_chªÃl
[
i
][
j
] - 
m—n
)*(shadow_channel[i][j] - mean);

394 
¡d
 = 
	`sq¹
(¡d / (
‹mpH
*2+1è/ (
‹mpV
*2+1));

396 
i
=0; i<
‹mpH
*2+1; i++){

397 
j
=0; j<
‹mpV
*2+1; j++){

398 
shadow_chªÃl
[
i
][
j
] = shadow_chªÃl[i][j] * 
sigmaL_acÜ
 / 
¡d
;

402 
	`ä“
(
aÙoShadowšgM©rix
);

403 
	`ä“
(
nÜm®_fá
);

404 
	`ä“
(

);

405 
	`ä“
(
w
);

407 
	}
}

409 
	gWÜld
::
	$ÿlcShadowšgS³cific
(
dF»q
, 
Com¶ex
 
¬—LeáLowe¡
, Com¶ex 
¬—RightUpmo¡
, 
»s
, 
ShadowšgStyË
 
shadowšgStyË
, ** 
shadowšgM©rix
){

411 
i
, 
j
, 
‹mpH
, 
‹mpV
,

412 
Size_h
, 
Size_v
,

413 
fálx
, 
fály
;

415 
d_decÜr
,

416 
§m¶_Ëngth
,

417 
sigmaL_acÜ
 = 1.0,

418 
sigmaL_xcÜ
 = 8.0;

420 
shadow_chªÃl
;

422 
shadow_chªÃl1
;

424 
ªgËsRx1Rx2
;

426 
xcÜrT”msRx1Rx2
;

428 
d_decÜr
 = 38.68 * 
	`pow
((
dF»q
/1000.0), -1.07);

430 
Size_h
 = ()((
¬—RightUpmo¡
.
»®
 - 
¬—LeáLowe¡
.»®)/
BINSIZE
);

431 
Size_v
 = ()((
¬—RightUpmo¡
.
img
 - 
¬—LeáLowe¡
.img)/
BINSIZE
);

433 
§m¶_Ëngth
 = 
PI
 / 2.0 * 
d_decÜr
 / 
	`sq¹
(1.0/0.01 - 1.0) / 2.0;

434 
‹mpH
 = 
	`û
(
Size_h
/2.0/
§m¶_Ëngth
);

435 
‹mpV
 = 
	`û
(
Size_v
/2.0/
§m¶_Ëngth
);

436 
i
=0; i<14; i++){

437 if((
‹mpH
*2 + 1)>
	`pow
(2.0,
i
) && (tempH*2 + 1)<=pow(2.0,i+1))

438 
fálx
 = 
	`pow
(2.0,
i
+1);

439 if((
‹mpV
*2 + 1)>
	`pow
(2.0,
i
) && (tempV*2 + 1)<=pow(2.0,i+1))

440 
fály
 = 
	`pow
(2.0,
i
+1);

443 
shadow_chªÃl
 = (**è
	`m®loc
((
‹mpH
*2 + 1) * (*));

444 
shadow_chªÃl1
 = (**è
	`m®loc
((
‹mpH
*2 + 1) * (*));

445 
ªgËsRx1Rx2
 = (**è
	`m®loc
((
‹mpH
*2 + 1) * (*));

446 
xcÜrT”msRx1Rx2
 = (**è
	`m®loc
((
‹mpH
*2 + 1) * (*));

447 
i
=-
‹mpH
; i<tempH + 1; i++){

448 
shadow_chªÃl
[
i
+
‹mpH
] = (*è
	`m®loc
((
‹mpV
*2 + 1) * ());

449 
shadow_chªÃl1
[
i
+
‹mpH
] = (*è
	`m®loc
((
‹mpV
*2 + 1) * ());

450 
ªgËsRx1Rx2
[
i
+
‹mpH
] = (*è
	`m®loc
((
‹mpV
*2 + 1) * ());

451 
xcÜrT”msRx1Rx2
[
i
+
‹mpH
] = (*è
	`m®loc
((
‹mpV
*2 + 1) * ());

454 
	`autoCÜ»Ï‹dShadowšgM­
(
‹mpH
, 
‹mpV
, 
fálx
, 
fály
, 
iS“d
, 
§m¶_Ëngth
, 
d_decÜr
, 
sigmaL_acÜ
, 
shadow_chªÃl
);

457 
B‘a
,

458 
‹mp
,

459 
t
, 
u
,

460 **
covM©rix
,

461 
eig’D
[2],

462 **
veùÜQ
,

463 
´edLev
 = 2.0;

465 
ÄÙ
;

466 
covM©rix
 = (**è
	`m®loc
(2 * (*));

467 
covM©rix
[0] = (*è
	`m®loc
(2 * ());

468 
covM©rix
[1] = (*è
	`m®loc
(2 * ());

469 
veùÜQ
ğ(**è
	`m®loc
(2 * (*));

470 
veùÜQ
[0] = (*è
	`m®loc
(2 * ());

471 
veùÜQ
[1] = (*è
	`m®loc
(2 * ());

473 if(
shadowšgStyË
 =ğ
autoAndXüoss
){

474 
	`autoCÜ»Ï‹dShadowšgM­
(
‹mpH
, 
‹mpV
, 
fálx
, 
fály
, 
iS“d
, 
§m¶_Ëngth
, 
d_decÜr
, 
sigmaL_acÜ
, 
shadow_chªÃl1
);

475 
B‘a
 = 0.64 + (
dF»q
 - 2400) / (5200 - 2400) * (0.54 - 0.64);

476 
i
=0; i<
‹mpH
*2+1; i++){

477 
j
=0; j<
‹mpV
*2+1; j++){

481 
ªgËsRx1Rx2
[
i
][
j
] = 
	`acos
(((
S™es
[0].
LoÿtiÚ
.
dX
 - i*
§m¶_Ëngth
 - 
¬—LeáLowe¡
.
»®
)*(Sites[1].Location.dX - i*sampl_length -‡reaLeftLowest.real)

482 + (
S™es
[0].
LoÿtiÚ
.
dY
 - 
j
*
§m¶_Ëngth
 - 
¬—LeáLowe¡
.
img
)*(Sites[1].Location.dY - j*sampl_length -‡reaLeftLowest.img)

483 + (
S™es
[0].
ª‹ÂaHeight
 - 
´edLev
)*(Sites[1].antennaHeight -…redLev))

484 / 
	`sq¹
((
S™es
[0].
LoÿtiÚ
.
dX
 - 
i
*
§m¶_Ëngth
 - 
¬—LeáLowe¡
.
»®
)*(Sites[0].Location.dX - i*sampl_length -‡reaLeftLowest.real)

485 + (
S™es
[0].
LoÿtiÚ
.
dY
 - 
j
*
§m¶_Ëngth
 - 
¬—LeáLowe¡
.
img
)*(Sites[0].Location.dY - j*sampl_length -‡reaLeftLowest.img)

486 + (
S™es
[0].
ª‹ÂaHeight
 - 
´edLev
)*(Sites[0].antennaHeight -…redLev))

487 / 
	`sq¹
((
S™es
[1].
LoÿtiÚ
.
dX
 - 
i
*
§m¶_Ëngth
 - 
¬—LeáLowe¡
.
»®
)*(Sites[1].Location.dX - i*sampl_length -‡reaLeftLowest.real)

488 + (
S™es
[1].
LoÿtiÚ
.
dY
 - 
j
*
§m¶_Ëngth
 - 
¬—LeáLowe¡
.
img
)*(Sites[1].Location.dY - j*sampl_length -‡reaLeftLowest.img)

489 + (
S™es
[1].
ª‹ÂaHeight
 - 
´edLev
)*(Sites[1].antennaHeight -…redLev)));

491 
xcÜrT”msRx1Rx2
[
i
][
j
] = 
B‘a
 * 
	`cos
(
ªgËsRx1Rx2
[i][j]);

492 
covM©rix
[0][0] = 
sigmaL_xcÜ
 * sigmaL_xcor;

493 
covM©rix
[0][1] = 
sigmaL_xcÜ
 * 
xcÜrT”msRx1Rx2
[
i
][
j
];

494 
covM©rix
[1][0] = 
sigmaL_xcÜ
 * 
xcÜrT”msRx1Rx2
[
i
][
j
];

495 
covM©rix
[1][1] = 
sigmaL_xcÜ
 * sigmaL_xcor;

496 
	`Jacobi
(
covM©rix
, 
eig’D
, 
veùÜQ
, 
ÄÙ
, 2);

497 
‹mp
 = 
veùÜQ
[0][0]*
	`sq¹
(
eig’D
[0])*
shadow_chªÃl
[
i
][
j
] + veùÜQ[0][1]*sq¹Óig’D[1])*
shadow_chªÃl1
[i][j];

498 
shadow_chªÃl1
[
i
][
j
] = 
veùÜQ
[1][0]*
	`sq¹
(
eig’D
[0])*
shadow_chªÃl
[i][j] + vectorQ[1][1]*sqrt(eigenD[1])*shadow_channel1[i][j];

499 
shadow_chªÃl
[
i
][
j
] = 
‹mp
;

504 
i
=0; i<
¬—RightUpmo¡
.
»®
-
¬—LeáLowe¡
.real; i++){

505 
j
=0; j<
¬—RightUpmo¡
.
img
-
¬—LeáLowe¡
.img; j++){

506 if(
i
 == 0)

507 
t
 = 0;

509 
t
 = (
i
/
§m¶_Ëngth
 - 
	`æoÜ
(i/§m¶_Ëngth)è/ (
	`û
(i/sampl_length) - floor(i/sampl_length));

510 if(
j
 == 0)

511 
u
 = 0;

513 
u
 = (
j
/
§m¶_Ëngth
 - 
	`æoÜ
(j/§m¶_Ëngth)è/ (
	`û
(j/sampl_length) - floor(j/sampl_length));

515 
shadowšgM©rix
[
i
][
j
] = (1-
t
)*(1-
u
)*
shadow_chªÃl
[()
	`æoÜ
(i/
§m¶_Ëngth
)][()floor(j/sampl_length)]

516 + 
t
*(1-
u
)*
shadow_chªÃl
[()
	`û
(
i
/
§m¶_Ëngth
)][()
	`æoÜ
(
j
/sampl_length)]

517 + 
t
*
u
*
shadow_chªÃl
[()
	`û
(
i
/
§m¶_Ëngth
)][()û(
j
/sampl_length)]

518 + (1-
t
)*
u
*
shadow_chªÃl
[()
	`æoÜ
(
i
/
§m¶_Ëngth
)][()
	`û
(
j
/sampl_length)];

520 if(
shadowšgStyË
 !ğ
autoAndXüoss
)

521 
shadowšgM©rix
[
i
][
j
] = shadowšgM©rix[i][j] * 
sigmaL_xcÜ
;

525 
	`ä“
(
shadow_chªÃl
);

526 
	`ä“
(
shadow_chªÃl1
);

527 
	`ä“
(
ªgËsRx1Rx2
);

528 
	`ä“
(
covM©rix
);

529 
	`ä“
(
veùÜQ
);

530 
	}
}

	@/home/lyang3/work/src_son/runWorld/sim/networkManager.cpp

	@/home/lyang3/work/src_son/runWorld/sim/networkManager.h

1 
	~"runWÜld.h
"

2 
	~"geom‘ry.h
"

3 
	~"bs.h
"

4 
	~"ue.h
"

6 
	eTe¡Mode
 {

7 
	mMETRO_FEMTO
,

8 
	mRESIDENTIAL_FEMTO
,

9 
	mENTREPRICE_FEMTO


12 şas 
	cN‘wÜkMªag”


14 
	mpublic
:

15 
N‘wÜkMªag”
();

16 ~
N‘wÜkMªag”
();

17 
š™Ÿli£N‘wÜk
(
dIÁ”S™eDi¡ªû
);

18 
´štN‘wÜk
(
boŞ
 
bQu›t
, boŞ 
bFeOuut
);

19 
š™Ÿli£U£rs
();

20 
´štU£rs
(
boŞ
 
bQu›t
, boŞ 
bFeOuut
);

21 
cÚfigN‘wÜkTe¡Mode
(
Te¡Mode
 
Mode
);

22 
ÿlcPoštLos£s
(
CoÜd
 
coPošt
, 
C–lm—su»s
 
ûÎD©aPošt
[][
MACROSECTORS
]);

23 
ÿlcP©hlos£s
(
boŞ
 
bQu›t
);

24 
ÿlcRa¡”Sÿn
(
dBšSize
);

25 
driveTe¡_Cœşe
(
dRadius
, 
CoÜd
 
coC’Œe
);

26 
doC–lS–eùiÚ
(
boŞ
 
bQu›t
);

27 
doC–lAdmissiÚ
(
boŞ
 
bQu›t
);

28 
addIÁ”ã»nûToOth”C–ls
();

29 
¡©sDowÆšk
(
boŞ
 
bQu›t
);

30 
¡©sU¶šk
(
boŞ
 
bQu›t
);

31 
moveU£rs
(
boŞ
 
bQu›t
);

33 
	m´iv©e
:

35 
numHeNB
;

37 
	mdISD
;

38 
Ba£S™e


39 
	mHeNBS™es
[
HeNBS
];

40 
UE


41 
	mHUEs
[
HOMEUSERS
];

42 
N‘wÜkMªag”


43 
	mNWMªag”
;

	@/home/lyang3/work/src_son/runWorld/state.cpp

1 
	~"¡©e.h
"

3 
	gS‹
::
	$S‹
()

6 
iS™es
, 
iSeùs
, 
i
;

8 
i
=0; i<10001; i++){

9 
bš_ûÁ»s_u£r_th±
[
i
] = i * 
LTEBªdWidth
 / 2.0;

10 
hi¡DLU£rTh±Maüo
[
i
] = 0;

11 
hi¡DLU£rTh±Femto
[
i
] = 0;

12 
hi¡ULU£rTh±Maüo
[
i
] = 0;

13 
hi¡ULU£rTh±Femto
[
i
] = 0;

15 
i
=0; i<1001; i++){

16 
bš_ûÁ»s_¢r
[
i
] = (i - 500.0)/10.0;

17 
hi¡DLSNRMaüo
[
i
] = 0;

18 
hi¡DLSNRFemto
[
i
] = 0;

19 
hi¡ULSNRMaüo
[
i
] = 0;

20 
hi¡ULSNRFemto
[
i
] = 0;

23 
i
=0; i<
DROPS
; i++){

24 
iS™es
=0; iS™es<
SITES
; iSites++){

25 
iSeùs
=0; iSeùs<
MACROSECTORS
; iSects++){

27 
ULûÎThruPtMaüo
[
i
][
iS™es
][
iSeùs
]=0.0;

28 
DLûÎThruPtMaüo
[
i
][
iS™es
][
iSeùs
]=0.0;

33 
i
=0; i<
DROPS
; i++){

34 
iS™es
=0; iS™es<
HeNBS
; iSites++){

36 
ULûÎThruPtFemto
[
i
][
iS™es
]=0.0;

37 
DLûÎThruPtFemto
[
i
][
iS™es
]=0.0;

41 
iS™es
=0; iS™es<
SITES
; iSites++){

42 
iSeùs
=0; iSeùs<
MACROSECTORS
; iSects++){

44 
PrbGroupAvaMaüo
[
iS™es
][
iSeùs
]=
numBlocksDL
;

45 
¡¬tRBMaüo
[
iS™es
][
iSeùs
]=0;

49 
iS™es
=0; iS™es<
HeNBS
; iSites++){

50 
PrbGroupAvaFemto
[
iS™es
]=
numBlocksDL
;

51 
¡¬tRBFemto
[
iS™es
]=0;

53 
	}
}

55 
	gS‹
::~
	$S‹
()

57 
	}
}

59 
S‹
::
	$In™
(){

61 
	}
}

	@/home/lyang3/work/src_son/runWorld/state.h

1 
	~"runWÜld.h
"

3 şas 
	cS‹


5 
	mpublic
:

7 
S‹
();

8 ~
S‹
();

9 
In™
();

13 
	mPrbGroupAvaMaüo
[
SITES
][
MACROSECTORS
],

14 
	mPrbGroupAvaFemto
[
HeNBS
],

15 
	m¡¬tRBMaüo
[
SITES
][
MACROSECTORS
],

16 
	m¡¬tRBFemto
[
HeNBS
],

17 
	mloÿtiÚ
;

20 
	mbš_ûÁ»s_u£r_th±
[10001],

21 
	mhi¡DLU£rTh±Maüo
[10001],

22 
	mhi¡DLU£rTh±Femto
[10001],

23 
	mhi¡ULU£rTh±Maüo
[10001],

24 
	mhi¡ULU£rTh±Femto
[10001],

25 
	mbš_ûÁ»s_¢r
[1001],

26 
	mhi¡DLSNRMaüo
[1001],

27 
	mhi¡DLSNRFemto
[1001],

28 
	mhi¡ULSNRMaüo
[1001],

29 
	mhi¡ULSNRFemto
[1001],

30 
	mDLûÎThruPtMaüo
[
DROPS
][
SITES
][
MACROSECTORS
],

31 
	mULûÎThruPtMaüo
[
DROPS
][
SITES
][
MACROSECTORS
],

33 
	mDLûÎThruPtFemto
[
DROPS
][
HeNBS
],

34 
	mULûÎThruPtFemto
[
DROPS
][
HeNBS
],

35 
	mSNRUeDlBlocks
[1000][
numBlocksDL
];

	@/home/lyang3/work/src_son/runWorld/ue.cpp

3 
	~<io¡»am
>

4 
	~<iomª
>

5 
	~<f¡»am
>

6 
	~<m©h.h
>

8 
	~"runWÜld.h
"

9 
	~"geom‘ry.h
"

10 
	~"ue.h
"

12 
usšg
 
Çme¥aû
 
	g¡d
;

15 
	gV–oc™y
::
	$V–oc™y
()

17 
	}
}

19 
V–oc™y
::
	$´št
()

21 
cout
 << 
fixed
 << 
	`£»cisiÚ
(1)

22 << "\tv: " << 
dS³ed


23 << "\tdœeùiÚ: " << 180.0*
dDœeùiÚ
/
PI
 << 
’dl
;

24 
	}
}

26 
	gV–oc™y
::~
	$V–oc™y
()

28 
	}
}

31 
UE_h¥a_·¿ms
::
	$UE_h¥a_·¿ms
()

33 
	}
}

35 
UE_h¥a_·¿ms
::~
	$UE_h¥a_·¿ms
()

37 
	}
}

39 
UE_h¥a_·¿ms
::
	$š™Ÿli£
()

42 
iS™e
,

43 
iSeùÜ
;

45 
iS™e
 = 0; iS™< 
SITES
; iSite++) {

46 
iSeùÜ
 = 0; iSeùÜ < 
MACROSECTORS
; iSector++) {

47 
ûÎD©a
[
iS™e
][
iSeùÜ
].
	`š™Ÿli£
();

51 
iS”všgS™e
 = -1;

52 
iS”všgSeùÜ
 = -1;

53 
dTxpow”
 = 
NOdBm
;

54 
dS”všgRxsigÇl
 = 
NOdBm
;

55 
dS”všgRxšt
 = 
NOdBm
;

56 
dS”všgCtoI
 = 
NOdBm
;

57 
dThroughput
 = 0.0;

58 
dC­ac™y
 = 0.0;

59 
	}
}

61 
	gUE_h¥a_·¿ms
::
	$´št
()

63 ià(
iS”všgFemto
 != -1)

65 
cout
<< 
fixed
 << 
	`£»cisiÚ
(1) << "HSPA Femto Cell: ["

66 << 
iS”všgFemto


71 
cout
 << 
fixed
 << 
	`£»cisiÚ
(1) <<"HSPA Cell: ["

72 << 
iS”všgS™e


74 << 
iS”všgSeùÜ


78 
cout
<< 
dS”všgRxsigÇl


80 << 
dS”všgRxšt


82 << 
dS”všgCtoI


84 << 
dC­ac™y


86 << 
dTxpow”


88 
	}
}

91 
	gUE_Ée_·¿ms
::
	$UE_Ée_·¿ms
()

93 
avDLThroughputs
 = 100;

94 
avULThroughputs
 = 100;

95 
maxTxPow”P”RB
 = 0.2 / 
Nrb
;

96 
	}
}

98 
	gUE_Ée_·¿ms
::~
	$UE_Ée_·¿ms
()

100 
	}
}

102 
UE_Ée_·¿ms
::
	$š™Ÿli£
()

105 
iS™e
,

106 
iSeùÜ
;

108 
iS™e
 = 0; iS™< 
SITES
; iSite++) {

109 
iSeùÜ
 = 0; iSeùÜ < 
MACROSECTORS
; iSector++) {

110 
ûÎD©a
[
iS™e
][
iSeùÜ
].
	`š™Ÿli£
();

114 
bMIMO
 = 
çl£
;

115 
iS”všgS™e
 = -1;

116 
iS”všgSeùÜ
 = -1;

117 
iS”všgFemto
 = -1;

118 
dTxpow”
 = 
NOdBm
;

119 
dS”všgRxsigÇl
 = 
NOdBm
;

120 
dS”všgRxšt
 = 
NOdBm
;

121 
dS”všgCtoI
 = 
NOdBm
;

122 
dThroughput
 = 0.0;

123 
dC­ac™y
 = 0.0;

125 
avDLThroughputs
 = 100;

126 
avULThroughputs
 = 100;

127 
	}
}

129 
	gUE_Ée_·¿ms
::
	$´št
()

131 ià(
iS”všgFemto
 != -1)

133 
cout
<< 
fixed
 << 
	`£»cisiÚ
(1) << "\tLTE Femto Cell: ["

134 << 
iS”všgFemto


139 
cout
<< 
fixed
 << 
	`£»cisiÚ
(1) << "\tLTE Cell: ["

140 << 
iS”všgS™e


142 << 
iS”všgSeùÜ


146 
cout
<< 
dS”všgRxsigÇl


148 << 
dS”všgRxšt


150 << 
dS”všgCtoI


152 << 
dC­ac™y


154 << 
dTxpow”


156 
	}
}

159 
	gC–lm—su»s
::
	$C–lm—su»s
()

161 
	}
}

163 
C–lm—su»s
::~
	$C–lm—su»s
()

165 
	}
}

167 
C–lm—su»s
::
	$š™Ÿli£
()

169 
dDi¡ªû
 = 0.0;

170 
dP©hloss
 = 
NOdBm
;

171 
dB—ršg
 = 0.0;

172 
dRxpow”
 = 
NOdBm
;

173 
dRxšt
 = 
NOdBm
;

174 
dCtoI
 = 
NOdBm
;

175 
	}
}

178 
	gUE
::
	$UE
()

180 
i
, 
j
;

182 
T¿fficMod–ULBufãr
 = 10000000;

183 
ŒafficMod–Ty³
 = 
FuÎBuff
;

185 
i
=0; i<
numC¬r›rIÁ”e¡
/
decim©eR©e
; i++)

186 
j
=0; j<8; j++)

187 
DLFadšgAÎ
[
i
][
j
] = 
	`com¶ex
(0.0, 0.0);

189 
i
=0; i<
Nrb
-
NrbPUCCH
; i++){

190 
SNR_UL
[
i
] = 0;

191 
ulS”všgRxš”RB
[
i
] = 0;

192 
ulS”všgRxsig³rRB
[
i
] = 0;

193 
j
=0; j<8; j++)

194 
ulTxPow”UE³rRB
[
i
][
j
] = 0;

196 
	}
}

198 
	gUE
::
	$š™Ÿli£
()

200 
v
.
dS³ed
 = 0.0;

201 
v
.
dDœeùiÚ
 = 0.0;

202 
LoÿtiÚ
.
dX
 = 0.0;

203 
LoÿtiÚ
.
dY
 = 0.0;

204 
ueHSPAd©a
.
	`š™Ÿli£
();

205 
ueLTEd©a
.
	`š™Ÿli£
();

207 
T¿fficMod–ULBufãr
 = 10000000;

208 
	}
}

210 
	gUE
::
	$´št
()

212 
LoÿtiÚ
.
	`´št
();

213 
v
.
	`´št
();

214 
ueHSPAd©a
.
	`´št
();

215 
ueLTEd©a
.
	`´št
();

216 
cout
 << 
’dl
;

217 
	}
}

219 
	gUE
::
	$move
()

221 
LoÿtiÚ
.
dX
 +ğ
TICK
/1000.0 * 
v
.
dS³ed
 * 
	`sš
(v.
dDœeùiÚ
);

222 
LoÿtiÚ
.
dY
 +ğ
TICK
/1000.0 * 
v
.
dS³ed
 * 
	`cos
(v.
dDœeùiÚ
);

223 
	}
}

225 
	gUE
::
	$´štS”všg
()

227 
cout
 << 
fixed
 << 
	`£»cisiÚ
(1)

228 << "HSPA:: S™e: "<< 
ueHSPAd©a
.
iS”všgS™e


229 << " SeùÜ: "<< 
ueHSPAd©a
.
iS”všgSeùÜ


230 << " S”vRxsigÇl: " << 
ueHSPAd©a
.
dS”všgRxsigÇl


231 << "\tS”vRxšt: " << 
ueHSPAd©a
.
dS”všgRxšt


232 << "\tS”vC/I: " << 
ueHSPAd©a
.
dS”všgCtoI


233 << "\tLTE:: S™e: "<< 
ueLTEd©a
.
iS”všgS™e


234 << " SeùÜ: "<< 
ueLTEd©a
.
iS”všgSeùÜ


235 << " S”vRxsigÇl: " << 
ueLTEd©a
.
dS”všgRxsigÇl


236 << "\tS”vRxšt: " << 
ueLTEd©a
.
dS”všgRxšt


237 << "\tS”vC/I: " << 
ueLTEd©a
.
dS”všgCtoI


238 << 
’dl
;

239 
	}
}

241 
	gUE
::~
	$UE
()

243 
	}
}

245 
S”všgC–l
::
	$S”všgC–l
(){

248 
iS”všgS™e
 = -1;

249 
iS”všgSeùÜ
 = -1;

250 
iS”všgFemto
 = -1;

251 
iS”všgM‘ro
 = -1;

252 
	}
}

254 
	gS”všgC–l
::~
	$S”všgC–l
(){

255 
	}
}

257 
S”všgC–l
::
	$š™Ÿli£
(){

258 
iS”všgS™e
 = -1;

259 
iS”všgSeùÜ
 = -1;

260 
iS”všgFemto
 = -1;

261 
iS”všgM‘ro
 = -1;

262 
dP©hloss
 = 200;

263 
dRxpow”
 = -200;

264 
dCtoI
 = -100;

265 
	}
}

	@/home/lyang3/work/src_son/runWorld/ue.h

1 
	~"chªÃl.h
"

4 
	eUED•loym’tTy³
 {

5 
	mmaüoUeIndoÜ
,

6 
	mmaüoUeOutdoÜ
,

7 
	mmaüoUeInFemto
,

8 
	mãmtoUeIndoÜ
,

9 
	mmaüoUeOutdoÜNLOS
,

10 
	mãmtoUeOutdoÜ


13 
	eT¿fficMod–Ty³
 {

14 
	mFuÎBuff
,

15 
	mBur¡y


18 
	eS”všgC–lTy³
 {

19 
	mMaüo
,

20 
	mFemto
,

21 
	mM‘ro


24 
	eS”všgRANTy³
 {

25 
	mLTE
,

26 
	mHSPA
,

27 
	mGSM


30 şas 
	cV–oc™y


32 
	mpublic
:

34 
V–oc™y
();

35 
V–oc™y
(
dA
, 
dB
);

36 
´št
();

37 ~
V–oc™y
();

41 
	mdS³ed
,

42 
	mdDœeùiÚ
;

46 şas 
	cC–lm—su»s


48 
	mpublic
:

50 
C–lm—su»s
();

51 ~
C–lm—su»s
();

52 
m—su»Los£s
();

53 
š™Ÿli£
();

57 
	mdDi¡ªû
,

58 
	mdP©hloss
,

59 
	mdP©hlossW¿µed
,

60 
	mdP©hlossNoB—ršg
,

61 
	mdB—ršg
,

62 
	mdRxpow”
,

63 
	mdRxšt
,

64 
	mdCtoI
;

67 şas 
	cS”všgC–l


69 
	mpublic
:

71 
S”všgC–l
();

72 ~
S”všgC–l
();

73 
š™Ÿli£
();

77 
	mdP©hloss
,

78 
	mdRxpow”
,

79 
	mdCtoI
;

81 
S”všgC–lTy³


82 
	m£rvšgC–lTy³
;

83 
S”všgRANTy³


84 
	m£rvšgRANTy³
;

87 
	miS”všgS™e
,

88 
	miS”všgSeùÜ
,

89 
	miS”všgFemto
,

90 
	miS”všgM‘ro
;

93 şas 
	cUE_h¥a_·¿ms


95 
	mpublic
:

97 
UE_h¥a_·¿ms
();

98 ~
UE_h¥a_·¿ms
();

99 
š™Ÿli£
();

100 
´št
();

103 
C–lm—su»s


104 
	mûÎD©a
[
SITES
][
MACROSECTORS
];

106 
C–lm—su»s


107 
	mãmtoD©a
[
HeNBS
],

108 
	mm‘roD©a
[
M‘rÛNBS
];

111 
	miS”všgS™e
,

112 
	miS”všgSeùÜ
,

113 
	miS”všgFemto
,

114 
	miS”všgM‘ro
;

116 
	mdTxpow”
,

117 
	mdS”všgP©hloss
,

118 
	mdS”všgRxsigÇl
,

119 
	mdS”všgRxšt
,

120 
	mdS”všgCtoI
,

121 
	mdC­ac™y
,

122 
	mdThroughput
;

125 şas 
	cUE_Ée_·¿ms


127 
	mpublic
:

129 
UE_Ée_·¿ms
();

130 ~
UE_Ée_·¿ms
();

131 
š™Ÿli£
();

132 
´št
();

135 
C–lm—su»s


136 
	mûÎD©a
[
SITES
][
MACROSECTORS
];

138 
C–lm—su»s


139 
	mãmtoD©a
[
HeNBS
],

140 
	mm‘roD©a
[
M‘rÛNBS
];

142 
boŞ
 
	mbMIMO
;

144 
	miS”všgS™e
,

145 
	miS”všgSeùÜ
,

146 
	miS”všgFemto
,

147 
	miS”všgM‘ro
;

149 
	mdTxpow”
,

150 
	mdS”všgP©hloss
,

151 
	mdS”všgRxsigÇl
,

152 
	mdS”všgRxšt
,

153 
	mdS”všgCtoI
,

154 
	mdC­ac™y
,

155 
	mavDLThroughputs
,

156 
	mavULThroughputs
,

157 
	mmaxTxPow”P”RB
,

158 
	mdThroughput
;

162 şas 
	cUE


164 
	mpublic
:

166 
UE
();

167 ~
UE
();

168 
š™Ÿli£
();

169 
´št
();

170 
´štS”všg
();

171 
move
();

174 
ÿlcuÏ‹S”všgC–l
(
numMaüoS™es
, 
numFemto
, 
numM‘roBS
);

175 
u¶škPow”CÚŒŞ
();

176 
ÿlcHSPAThroughputE¡im©e
();

177 
ÿlcLTEThroughputE¡im©e
();

178 
ÿlcDLCQI
(
iTTI
);

179 
ÿlcULCQI
(
iTTI
);

182 
CoÜd


183 
	mLoÿtiÚ
;

184 
Com¶ex


185 
	mDLFadšgAÎ
[
numC¬r›rIÁ”e¡
/
decim©eR©e
][8],

186 
	mULFadšgAÎ
[(
numC¬r›rIÁ”e¡
-12 * 
NrbPUCCH
)/
decim©eR©e
][
NªtsBSRx
][8],

187 
	mULS‹”šgVec
[
numFadšgP©hs
][
NªtsBSRx
];

189 
	mHeight
,

190 
	mDLSÿ‰”AngËsAtUE
[
numFadšgP©hs
][
numSub·thFadšgChªÃl
],

191 
	mDL·thPha£s
[
numFadšgP©hs
][
numSub·thFadšgChªÃl
],

192 
	mDLd–Pha£s
[
numFadšgP©hs
][
numSub·thFadšgChªÃl
],

193 
	mULSÿ‰”AngËsAtFemto
[
numFadšgP©hs
][
numSub·thFadšgChªÃl
],

194 
	mUL·thPha£s
[
numFadšgP©hs
][
numSub·thFadšgChªÃl
],

195 
	mULd–Pha£s
[
numFadšgP©hs
][
numSub·thFadšgChªÃl
],

196 
	mAÁAngËs
[
numFadšgP©hs
],

197 
	mAÁGaš
[
numFadšgP©hs
],

198 
	mULsummedP©hPha£sMuÉAÁs
[
numFadšgP©hs
][
NªtsBSRx
],

199 
	mDLS‹”šgVec
[
numFadšgP©hs
];

200 
UED•loym’tTy³


201 
	mueD•loym’tTy³
;

202 
V–oc™y


203 
	mv
;

204 
UE_h¥a_·¿ms


205 
	mueHSPAd©a
;

206 
UE_Ée_·¿ms


207 
	mueLTEd©a
;

209 
	mIndexBa£S™e
;

210 
	mIndexSeùÜ
;

211 
	mIndexA±Block
;

212 
	mIndexA±
;

215 
	mDLP”BlockSumFadPow”RecÜd
[
numBlocksDL
][8],

216 
	mULP”BlockSumFadPow”RecÜd
[
Nrb
-
NrbPUCCH
][8],

217 
	mulTxPow”UE³rRB
[
Nrb
-
NrbPUCCH
][8],

218 
	mulS”všgRxš”RB
[
Nrb
-
NrbPUCCH
],

219 
	mulS”všgRxsig³rRB
[
Nrb
-
NrbPUCCH
],

220 
	mRxSigÇÍ”Block
[
numBlocksDL
],

221 
	msumIÁ”ã»nû³rBlock
[
numBlocksDL
],

222 
	msumNIf‹»d
[
numBlocksDL
],

223 
	msumNIf‹»dUL
[
Nrb
-
NrbPUCCH
],

224 
	mSNR_DL
[
numBlocksDL
],

225 
	mSNR_UL
[
Nrb
-
NrbPUCCH
],

226 
	mC­ac™yDL
[
numBlocksDL
];

229 
	mT¿fficMod–ULBufãr
;

231 
T¿fficMod–Ty³


232 
	mŒafficMod–Ty³
;

234 
S”všgC–l


235 
	mbe¡S”všgC–l
,

236 
	m£cÚdBe¡S”všgC–l
,

237 
	mmaüoS”všgC–l
,

238 
	mãmtoS”všgC–l
;

	@/home/lyang3/work/src_son/runWorld/ueSystemProcedures.cpp

3 
	~<io¡»am
>

4 
	~<iomª
>

5 
	~<f¡»am
>

6 
	~<m©h.h
>

8 
	~"runWÜld.h
"

9 
	~"geom‘ry.h
"

10 
	~"ue.h
"

12 
	#DLmaxSINR
 15848931.924611134852021013733915

	)

14 
usšg
 
Çme¥aû
 
	g¡d
;

17 
	$log2
Ğ
n
 )

20  
	`log
Ğ
n
 ) /†og( 2.0 );

21 
	}
}

23 
	gUE
::
	$ÿlcHSPAThroughputE¡im©e
()

25 ià(
ueHSPAd©a
.
dS”všgCtoI
 < 
	`pow
(10.0, -1.4)) {

29 
ueHSPAd©a
.
dC­ac™y
 = 3.84 *

30 
	`log2
(1.0 + 0.5*
	`pow
(10.0, 
ueLTEd©a
.
dS”všgCtoI
/10.0));

33 
	}
}

35 
	gUE
::
	$ÿlcLTEThroughputE¡im©e
()

38 
iSubC¬r›r
,

39 
NpdschD©aSymb
 = 1000,

40 
NSubC¬r›r
 = 10;

43 
dPÙR©io
 = 0.15,

44 
dSumSubC¬r›rs
 = 0.0,

45 
dLš—rCtoI
;

47 
dLš—rCtoI
 = 
	`pow
(10.0, 
ueLTEd©a
.
dS”všgCtoI
/10.0);

49 ià(
ueLTEd©a
.
bMIMO
) {

53 
iSubC¬r›r
 = 0; iSubC¬r›¸< 
NSubC¬r›r
; iSubCarrier++){

54 
dSumSubC¬r›rs
 +ğ
dAÍha
*
	`log2
(1.0 + 
dB‘a
*
dLš—rCtoI
);

56 
ueLTEd©a
.
dC­ac™y
 = (
NpdschD©aSymb
/1000.0)

57 * (1.0-
dPÙR©io
è* 
dSumSubC¬r›rs
;

60 
	}
}

63 
	gUE
::
	$ÿlcuÏ‹S”všgC–l
(
numMaüoS™es
, 
numFemto
, 
numM‘roBS
)

66 
iS™e
,

67 
iS™e2
,

68 
iSeùÜ
,

69 
iSeùÜ2
,

70 
iFemto
,

71 
šdi_‹¡
 = 0;

73 
ãmtoHSPAdRxšt
 = 
NOdBm
,

74 
ãmtoLTEdRxšt
 = 
NOdBm
,

75 
m‘roHSPAdRxšt
 = 
NOdBm
,

76 
m‘roLTEdRxšt
 = 
NOdBm
,

77 
rxMax
 = -200;

80 
iFemto
 = 0; iFemtØ< 
numFemto
; iFemto++) {

81 
ãmtoHSPAdRxšt
 = 
	`AdddBm
(femtoHSPAdRxint,

82 
ueHSPAd©a
.
ãmtoD©a
[
iFemto
].
dRxpow”
);

83 
ãmtoLTEdRxšt
 = 
	`AdddBm
(femtoLTEdRxint,

84 
ueLTEd©a
.
ãmtoD©a
[
iFemto
].
dRxpow”
);

86 
iFemto
 = 0; iFemtØ< 
numM‘roBS
; iFemto++) {

87 
m‘roHSPAdRxšt
 = 
	`AdddBm
(metroHSPAdRxint,

88 
ueHSPAd©a
.
m‘roD©a
[
iFemto
].
dRxpow”
);

89 
m‘roLTEdRxšt
 = 
	`AdddBm
(metroLTEdRxint,

90 
ueLTEd©a
.
m‘roD©a
[
iFemto
].
dRxpow”
);

95 
iS™e
 = 0; iS™< 
numMaüoS™es
; iSite++) {

96 
iSeùÜ
 = 0; iSeùÜ < 
MACROSECTORS
; iSector++) {

101 
ueHSPAd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt
 = 
HSPAUENOISE
;

102 
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt
 = 
LTEUENOISE
;

104 
iS™e2
 = 0; iS™e2 < 
numMaüoS™es
; iSite2++) {

105 
iSeùÜ2
 = 0; iSeùÜ2 < 
MACROSECTORS
; iSector2++) {

108 ià((
iS™e2
 !ğ
iS™e
)

109 && (
iSeùÜ2
 !ğ
iSeùÜ
)) {

110 
ueHSPAd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt


111 ğ
	`AdddBm
(
ueHSPAd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt
,

112 
ueHSPAd©a
.
ûÎD©a
[
iS™e2
][
iSeùÜ2
].
dRxpow”
);

116 ià((
iS™e2
 !ğ
iS™e
)

117 && (
iSeùÜ2
 !ğ
iSeùÜ
)) {

118 
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt


119 ğ
	`AdddBm
(
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt
,

120 
ueLTEd©a
.
ûÎD©a
[
iS™e2
][
iSeùÜ2
].
dRxpow”
);

125 
ueHSPAd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt


126 ğ
	`AdddBm
(
ueHSPAd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt
, 
ãmtoHSPAdRxšt
);

127 
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt


128 ğ
	`AdddBm
(
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt
, 
ãmtoLTEdRxšt
);

129 
ueHSPAd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt


130 ğ
	`AdddBm
(
ueHSPAd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt
, 
m‘roHSPAdRxšt
);

131 
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt


132 ğ
	`AdddBm
(
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt
, 
m‘roLTEdRxšt
);

135 
ueHSPAd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dCtoI
 =

136 
ueHSPAd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxpow”


137 - 
ueHSPAd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt
;

138 
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dCtoI
 =

139 
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxpow”


140 - 
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt
;

143 ià(
ueHSPAd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dCtoI
 >

144 
ueHSPAd©a
.
dS”všgCtoI
){

146 
ueHSPAd©a
.
iS”všgS™e
 = 
iS™e
;

147 
ueHSPAd©a
.
iS”všgSeùÜ
 = 
iSeùÜ
;

148 
ueHSPAd©a
.
dS”všgP©hloss
 = ueHSPAd©a.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dP©hloss
;

149 
ueHSPAd©a
.
dS”všgRxsigÇl
 = ueHSPAd©a.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxpow”
;

150 
ueHSPAd©a
.
dS”všgRxšt
 = ueHSPAd©a.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt
;

151 
ueHSPAd©a
.
dS”všgCtoI
 = ueHSPAd©a.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dCtoI
;

154 ià(
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dCtoI
 >

155 
ueLTEd©a
.
dS”všgCtoI
){

157 
ueLTEd©a
.
iS”všgS™e
 = 
iS™e
;

158 
ueLTEd©a
.
iS”všgSeùÜ
 = 
iSeùÜ
;

159 
ueLTEd©a
.
dS”všgP©hloss
 = ueLTEd©a.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dP©hloss
;

160 
ueLTEd©a
.
dS”všgRxsigÇl
 = ueLTEd©a.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxpow”
;

161 
ueLTEd©a
.
dS”všgRxšt
 = ueLTEd©a.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxšt
;

162 
ueLTEd©a
.
dS”všgCtoI
 = ueLTEd©a.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dCtoI
;

167 
be¡S”všgC–l
.
£rvšgC–lTy³
 = 
Maüo
;

168 
be¡S”všgC–l
.
£rvšgRANTy³
 = 
LTE
;

169 
be¡S”všgC–l
.
dCtoI
 = 
ueLTEd©a
.
dS”všgCtoI
;

170 
be¡S”všgC–l
.
dP©hloss
 = 
ueLTEd©a
.
dS”všgP©hloss
;

171 
be¡S”všgC–l
.
dRxpow”
 = 
ueLTEd©a
.
dS”všgRxsigÇl
;

172 
be¡S”všgC–l
.
iS”všgS™e
 = 
ueLTEd©a
.iServingSite;

173 
be¡S”všgC–l
.
iS”všgSeùÜ
 = 
ueLTEd©a
.iServingSector;

175 
maüoS”všgC–l
.
£rvšgC–lTy³
 = 
Maüo
;

176 
maüoS”všgC–l
.
£rvšgRANTy³
 = 
LTE
;

177 
maüoS”všgC–l
.
dCtoI
 = 
ueLTEd©a
.
dS”všgCtoI
;

178 
maüoS”všgC–l
.
dP©hloss
 = 
ueLTEd©a
.
dS”všgP©hloss
;

179 
maüoS”všgC–l
.
dRxpow”
 = 
ueLTEd©a
.
dS”všgRxsigÇl
;

180 
maüoS”všgC–l
.
iS”všgS™e
 = 
ueLTEd©a
.iServingSite;

181 
maüoS”všgC–l
.
iS”všgSeùÜ
 = 
ueLTEd©a
.iServingSector;

183 ià(
ueHSPAd©a
.
iS”všgFemto
 == 2000)

184 
šdi_‹¡
 = 1;

185 ià(
ueHSPAd©a
.
iS”všgFemto
 !ğ-1 && 
numFemto
 > 0){

187 ià(
šdi_‹¡
 == 1){

188 
iFemto
 = 0; iFemtØ< 
numFemto
; iFemto++) {

189 ià(
ueLTEd©a
.
ãmtoD©a
[
iFemto
].
dRxpow”
 > 
rxMax
){

190 
rxMax
 = 
ueLTEd©a
.
ãmtoD©a
[
iFemto
].
dRxpow”
;

191 
ueLTEd©a
.
iS”všgFemto
 = 
iFemto
;

192 
ueHSPAd©a
.
iS”všgFemto
 = 
iFemto
;

197 
ueHSPAd©a
.
ãmtoD©a
[ueHSPAd©a.
iS”všgFemto
].
dRxšt
 = 
	`AdddBm
(ueHSPAd©a.
dS”všgRxšt
,

198 
ueHSPAd©a
.
ûÎD©a
[
ueLTEd©a
.
iS”všgS™e
][ueLTEd©a.
iS”všgSeùÜ
].
dRxpow”
);

199 
ueLTEd©a
.
ãmtoD©a
[ueLTEd©a.
iS”všgFemto
].
dRxšt
 = 
	`AdddBm
(ueLTEd©a.
dS”všgRxšt
,

200 
ueLTEd©a
.
ûÎD©a
[ueLTEd©a.
iS”všgS™e
][ueLTEd©a.
iS”všgSeùÜ
].
dRxpow”
);

202 
ueHSPAd©a
.
ãmtoD©a
[ueHSPAd©a.
iS”všgFemto
].
dRxšt
 = 
	`SubdBm
(ueHSPAdata.femtoData[ueHSPAdata.iServingFemto].dRxint,

203 
ueHSPAd©a
.
ãmtoD©a
[ueHSPAd©a.
iS”všgFemto
].
dRxpow”
);

204 
ueLTEd©a
.
ãmtoD©a
[ueLTEd©a.
iS”všgFemto
].
dRxšt
 = 
	`SubdBm
(ueLTEdata.femtoData[ueLTEdata.iServingFemto].dRxint,

205 
ueLTEd©a
.
ãmtoD©a
[ueLTEd©a.
iS”všgFemto
].
dRxpow”
);

207 
ueHSPAd©a
.
ãmtoD©a
[ueHSPAd©a.
iS”všgFemto
].
dCtoI
 =

208 
ueHSPAd©a
.
ãmtoD©a
[ueHSPAd©a.
iS”všgFemto
].
dRxpow”


209 - 
ueHSPAd©a
.
ãmtoD©a
[ueHSPAd©a.
iS”všgFemto
].
dRxšt
;

210 
ueLTEd©a
.
ãmtoD©a
[
ueHSPAd©a
.
iS”všgFemto
].
dCtoI
 =

211 
ueLTEd©a
.
ãmtoD©a
[
ueHSPAd©a
.
iS”všgFemto
].
dRxpow”


212 - 
ueLTEd©a
.
ãmtoD©a
[
ueHSPAd©a
.
iS”všgFemto
].
dRxšt
;

214 ià(
šdi_‹¡
 == 1){

215 ià(
ueLTEd©a
.
dS”všgCtoI
 < ueLTEd©a.
ãmtoD©a
[ueLTEd©a.
iS”všgFemto
].
dCtoI
){

216 
ueLTEd©a
.
dS”všgP©hloss
 = ueLTEd©a.
ãmtoD©a
[ueLTEd©a.
iS”všgFemto
].
dP©hloss
;

217 
ueLTEd©a
.
dS”všgRxsigÇl
 = ueLTEd©a.
ãmtoD©a
[ueLTEd©a.
iS”všgFemto
].
dRxpow”
;

218 
ueLTEd©a
.
dS”všgRxšt
 = ueLTEd©a.
ãmtoD©a
[ueLTEd©a.
iS”všgFemto
].
dRxšt
;

219 
ueLTEd©a
.
dS”všgCtoI
 = ueLTEd©a.
ãmtoD©a
[ueLTEd©a.
iS”všgFemto
].
dCtoI
;

220 
be¡S”všgC–l
.
£rvšgC–lTy³
 = 
Femto
;

221 
be¡S”všgC–l
.
£rvšgRANTy³
 = 
LTE
;

222 
be¡S”všgC–l
.
dCtoI
 = 
ueLTEd©a
.
dS”všgCtoI
;

223 
be¡S”všgC–l
.
dP©hloss
 = 
ueLTEd©a
.
dS”všgP©hloss
;

224 
be¡S”všgC–l
.
dRxpow”
 = 
ueLTEd©a
.
dS”všgRxsigÇl
;

225 
be¡S”všgC–l
.
iS”všgS™e
 = -1;

226 
be¡S”všgC–l
.
iS”všgSeùÜ
 = -1;

227 
be¡S”všgC–l
.
iS”všgFemto
 = 
ueLTEd©a
.iServingFemto;

229 
ãmtoS”všgC–l
.
£rvšgC–lTy³
 = 
Femto
;

230 
ãmtoS”všgC–l
.
£rvšgRANTy³
 = 
LTE
;

231 
ãmtoS”všgC–l
.
dCtoI
 = 
ueLTEd©a
.
ãmtoD©a
[ueLTEd©a.
iS”všgFemto
].dCtoI;

232 
ãmtoS”všgC–l
.
dP©hloss
 = 
ueLTEd©a
.
ãmtoD©a
[ueLTEd©a.
iS”všgFemto
].dPathloss;

233 
ãmtoS”všgC–l
.
dRxpow”
 = 
ueLTEd©a
.
ãmtoD©a
[ueLTEd©a.
iS”všgFemto
].dRxpower;

234 
ãmtoS”všgC–l
.
iS”všgS™e
 = -1;

235 
ãmtoS”všgC–l
.
iS”všgSeùÜ
 = -1;

236 
ãmtoS”všgC–l
.
iS”všgFemto
 = 
ueLTEd©a
.iServingFemto;

239 
ueHSPAd©a
.
dS”všgP©hloss
 = ueHSPAd©a.
ãmtoD©a
[ueHSPAd©a.
iS”všgFemto
].
dP©hloss
;

240 
ueHSPAd©a
.
dS”všgRxsigÇl
 = ueHSPAd©a.
ãmtoD©a
[ueHSPAd©a.
iS”všgFemto
].
dRxpow”
;

241 
ueHSPAd©a
.
dS”všgRxšt
 = ueHSPAd©a.
ãmtoD©a
[ueHSPAd©a.
iS”všgFemto
].
dRxšt
;

242 
ueHSPAd©a
.
dS”všgCtoI
 = ueHSPAd©a.
ãmtoD©a
[ueHSPAd©a.
iS”všgFemto
].
dCtoI
;

244 
ueLTEd©a
.
dS”všgP©hloss
 = ueLTEd©a.
ãmtoD©a
[ueLTEd©a.
iS”všgFemto
].
dP©hloss
;

245 
ueLTEd©a
.
dS”všgRxsigÇl
 = ueLTEd©a.
ãmtoD©a
[ueLTEd©a.
iS”všgFemto
].
dRxpow”
;

246 
ueLTEd©a
.
dS”všgRxšt
 = ueLTEd©a.
ãmtoD©a
[ueLTEd©a.
iS”všgFemto
].
dRxšt
;

247 
ueLTEd©a
.
dS”všgCtoI
 = ueLTEd©a.
ãmtoD©a
[ueLTEd©a.
iS”všgFemto
].
dCtoI
;

251 
rxMax
 = -2000;

252 ià(
šdi_‹¡
 =ğ1 && 
numM‘roBS
 > 0){

253 
iS™e
 = 0; iS™< 
numM‘roBS
; iSite++) {

254 ià(
ueLTEd©a
.
m‘roD©a
[
iS™e
].
dRxpow”
 > 
rxMax
){

255 
rxMax
 = 
ueLTEd©a
.
m‘roD©a
[
iS™e
].
dRxpow”
;

256 
ueLTEd©a
.
iS”všgM‘ro
 = 
iS™e
;

257 
ueHSPAd©a
.
iS”všgM‘ro
 = 
iS™e
;

260 
ueLTEd©a
.
m‘roD©a
[ueLTEd©a.
iS”všgM‘ro
].
dRxšt
 = 
	`AdddBm
(ueLTEd©a.
dS”všgRxšt
,

261 
ueLTEd©a
.
ûÎD©a
[ueLTEd©a.
iS”všgS™e
][ueLTEd©a.
iS”všgSeùÜ
].
dRxpow”
);

262 
ueLTEd©a
.
m‘roD©a
[ueLTEd©a.
iS”všgM‘ro
].
dRxšt
 = 
	`SubdBm
(ueLTEdata.metroData[ueLTEdata.iServingMetro].dRxint,

263 
ueLTEd©a
.
m‘roD©a
[ueLTEd©a.
iS”všgM‘ro
].
dRxpow”
);

264 
ueLTEd©a
.
m‘roD©a
[
ueHSPAd©a
.
iS”všgM‘ro
].
dCtoI
 =

265 
ueLTEd©a
.
m‘roD©a
[
ueHSPAd©a
.
iS”všgM‘ro
].
dRxpow”


266 - 
ueLTEd©a
.
m‘roD©a
[
ueHSPAd©a
.
iS”všgM‘ro
].
dRxšt
;

268 ià(
ueLTEd©a
.
dS”všgCtoI
 < ueLTEd©a.
m‘roD©a
[ueLTEd©a.
iS”všgM‘ro
].
dCtoI
){

269 
ueLTEd©a
.
dS”všgP©hloss
 = ueLTEd©a.
m‘roD©a
[ueLTEd©a.
iS”všgM‘ro
].
dP©hloss
;

270 
ueLTEd©a
.
dS”všgRxsigÇl
 = ueLTEd©a.
m‘roD©a
[ueLTEd©a.
iS”všgM‘ro
].
dRxpow”
;

271 
ueLTEd©a
.
dS”všgRxšt
 = ueLTEd©a.
m‘roD©a
[ueLTEd©a.
iS”všgM‘ro
].
dRxšt
;

272 
ueLTEd©a
.
dS”všgCtoI
 = ueLTEd©a.
m‘roD©a
[ueLTEd©a.
iS”všgM‘ro
].
dCtoI
;

273 
be¡S”všgC–l
.
£rvšgC–lTy³
 = 
M‘ro
;

274 
be¡S”všgC–l
.
£rvšgRANTy³
 = 
LTE
;

275 
be¡S”všgC–l
.
dCtoI
 = 
ueLTEd©a
.
dS”všgCtoI
;

276 
be¡S”všgC–l
.
dP©hloss
 = 
ueLTEd©a
.
dS”všgP©hloss
;

277 
be¡S”všgC–l
.
dRxpow”
 = 
ueLTEd©a
.
dS”všgRxsigÇl
;

278 
be¡S”všgC–l
.
iS”všgS™e
 = -1;

279 
be¡S”všgC–l
.
iS”všgSeùÜ
 = -1;

280 
be¡S”všgC–l
.
iS”všgM‘ro
 = 
ueLTEd©a
.iServingMetro;

282 
ãmtoS”všgC–l
.
£rvšgC–lTy³
 = 
M‘ro
;

283 
ãmtoS”všgC–l
.
£rvšgRANTy³
 = 
LTE
;

284 
ãmtoS”všgC–l
.
dCtoI
 = 
ueLTEd©a
.
m‘roD©a
[ueLTEd©a.
iS”všgM‘ro
].dCtoI;

285 
ãmtoS”všgC–l
.
dP©hloss
 = 
ueLTEd©a
.
m‘roD©a
[ueLTEd©a.
iS”všgM‘ro
].dPathloss;

286 
ãmtoS”všgC–l
.
dRxpow”
 = 
ueLTEd©a
.
m‘roD©a
[ueLTEd©a.
iS”všgM‘ro
].dRxpower;

287 
ãmtoS”všgC–l
.
iS”všgS™e
 = -1;

288 
ãmtoS”všgC–l
.
iS”všgSeùÜ
 = -1;

289 
ãmtoS”všgC–l
.
iS”všgFemto
 = 
ueLTEd©a
.
iS”všgM‘ro
;

292 
	}
}

295 
	gUE
::
	$u¶škPow”CÚŒŞ
()

298 
dN“dedTxPwr
;

300 
i
, 
j
;

306 
dN“dedTxPwr
 = 
HSPANOISE
 + 
HSPANOISERISE
 + 
HSPAC2ITARGET


307 + 
ueHSPAd©a
.
dS”všgP©hloss
;

309 ià(
dN“dedTxPwr
 > 
HSPAUETXPWRMAX
) {

311 
ueHSPAd©a
.
dTxpow”
 = 
HSPAUETXPWRMAX
;

313 ià(
dN“dedTxPwr
 < 
HSPAUETXPWRMIN
) {

314 
cout
 << "OUT OF PC RANGE\n";

315 
ueHSPAd©a
.
dTxpow”
 = 
HSPAUETXPWRMIN
;

318 
ueHSPAd©a
.
dTxpow”
 = 
dN“dedTxPwr
;

321 
dN“dedTxPwr
 = 
LTENOISE
 + 
LTENOISERISE
 + 
LTEC2ITARGET


322 + 
ueLTEd©a
.
dS”všgP©hloss
;

325 ià(
dN“dedTxPwr
 > 
LTEUETXPWRMAX
) {

327 
ueLTEd©a
.
dTxpow”
 = 
LTEUETXPWRMAX
;

329 ià(
dN“dedTxPwr
 < 
LTEUETXPWRMIN
) {

330 
cout
 << "OUT OF PC RANGE\n";

331 
ueLTEd©a
.
dTxpow”
 = 
LTEUETXPWRMIN
;

334 
ueLTEd©a
.
dTxpow”
 = 
dN“dedTxPwr
;

337 
dN“dedTxPwr
 = 
	`dBm2Lš—rW
(
ueLTEd©a
.
dTxpow”
è/ 
Nrb
;

338 
ueLTEd©a
.
maxTxPow”P”RB
 = 
dN“dedTxPwr
;

340 
i
=0; i<
Nrb
-
NrbPUCCH
; i++){

341 
j
=0; j<8; j++)

342 
ulTxPow”UE³rRB
[
i
][
j
] = 
dN“dedTxPwr
;

345 
	}
}

347 
	gUE
::
	$ÿlcDLCQI
(
iTTI
)

350 
Nd–ay
 = 4,

351 
hi¡ÜicInd
,

352 
i
, 
j
;

354 
hi¡ÜicInd
 = (
iTTI
 + 
Nd–ay
) % 8;

357 
i
=0; i<
numBlocksDL
; i++){

358 ià(
ueD•loym’tTy³
 =ğ
ãmtoUeIndoÜ
 || ueD•loym’tTy³ =ğ
ãmtoUeOutdoÜ
){

359 
RxSigÇÍ”Block
[
i
] = 
	`dBm2Lš—rW
(
LTEHeNBTXPWRFEMTO
 - 
ueLTEd©a
.
ãmtoD©a
[ueLTEd©a.
iS”všgFemto
].
dP©hloss
è/ 
Nrb
 / 12.0

360 * 
DLP”BlockSumFadPow”RecÜd
[
i
][
hi¡ÜicInd
];

363 
RxSigÇÍ”Block
[
i
] = 
	`dBm2Lš—rW
(
LTEeNBTXPWRMACRO
 - 
ueLTEd©a
.
ûÎD©a
[ueLTEd©a.
iS”všgS™e
][ueLTEd©a.
iS”všgSeùÜ
].
dP©hlossNoB—ršg
è/ 
Nrb
 / 12.0

364 * 
DLP”BlockSumFadPow”RecÜd
[
i
][
hi¡ÜicInd
];

366 
SNR_DL
[
i
] = 
	`mš
(
DLmaxSINR
, 
RxSigÇÍ”Block
[i] / 
sumNIf‹»d
[i]);

367 
C­ac™yDL
[
i
] = 
dAÍha
 * 
	`log2
(1 + 
dB‘a
 * 
SNR_DL
[i]);

369 
	}
}

	@/home/lyang3/work/src_son/runWorld/world.cpp

1 
	~<io¡»am
>

2 
	~<f¡»am
>

3 
	~<m©h.h
>

5 
	~"wÜld.h
"

6 
	~"¿ndom.h
"

7 
	~"·thloss.h
"

9 
usšg
 
Çme¥aû
 
	g¡d
;

12 
	gWÜld
::
	$WÜld
()

14 
d•loym’tTy³
 = 
HeNBD•lTy³
;

15 
numMaüo£ùÜs
 = 
SITES
 * 
MACROSECTORS
;

16 
numMaüoUEs
 = 
avMaüoUEsP”C–l
 * 
numMaüo£ùÜs
;

17 
SchedMode
 = 
RoundRobš
;

18 
gašFacDL
 = 3;

19 
mšTh±T¬g‘DL
 = 600;

20 
mšTh±T¬g‘UL
 = 400;

21 
NsymsPDCCH
 = 3;

22 
pÙRedFac
 = 0.9;

23 
§m¶esP”Block
 = 20;

24 
mšP”AÁPwrP”UE
 = 0;

25 
numHUEsP”HeNB
 = 
NumHUEsP”HeNB
;

26 
numHeNB
 = 0;

28 ià(
d•loym’tTy³
 =ğ
APTBLOCKMODEL
){

29 
x¿ngeFemtoENB
 = 0.01;

30 
y¿ngeFemtoENB
 = 0.01;

31 
x¿ngeW®ls
 = 5;

32 
y¿ngeW®ls
 = 5;

33 
ReùGridDim’siÚX
 = 10;

34 
ReùGridDim’siÚY
 = 4;

35 
x¿ngeFemtoUE
 = 8.86;

36 
y¿ngeFemtoUE
 = 8.86;

37 
A±NumFloÜs
 = 1;

39 ià(
d•loym’tTy³
 =ğ
SUBURBAN
){

40 
x¿ngeFemtoENB
 = 4.0;

41 
y¿ngeFemtoENB
 = 4.0;

42 
x¿ngeW®ls
 = 6;

43 
y¿ngeW®ls
 = 6;

44 
ReùGridDim’siÚX
 = 1;

45 
ReùGridDim’siÚY
 = 1;

46 
x¿ngeFemtoUE
 = 6*
	`sq¹
(1.1);

47 
y¿ngeFemtoUE
 = 6*
	`sq¹
(1.1);

48 
A±NumFloÜs
 = 1;

52 
´obAùiveA·¹m’t
 = 0.2;

53 
numM‘roBS
 = 0;

55 
ULschdAÍha
 = 0.25;

56 
iS“d
 = 1;

57 
	}
}

59 
	gWÜld
::~
	$WÜld
()

61 
	}
}

64 
WÜld
::
	$š™Ÿli£N‘wÜk
(
dIÁ”S™eDi¡ªû
, 
D•loyMode
 
Dmode
) {

67 
iS™e
;

69 
cout
 << "[runWorld] "

70 << "[WÜld::£tupN‘wÜk] S‘u°myWÜld N‘wÜk" << 
’dl
;

73 
dISD
 = 
dIÁ”S™eDi¡ªû
;

75 ià(
Dmode
 =ğ
S³cific
){

87 
numMaüoS™es
 = 
SITES
;

90 
S™es
[0].
LoÿtiÚ
.
dX
 = 0.0;

91 
S™es
[0].
LoÿtiÚ
.
dY
 = 0.0;

92 
S™es
[0].
	`š™Ÿli£
();

95 
iS™e
 = 1; iS™<ğ
numMaüoS™es
; iSite++) {

96 
S™es
[
iS™e
].
LoÿtiÚ
.
dX
 = 
dISD
 * 
	`sš
(2.0 * 
PI
 * (iSite - 1.0)/6.0);

97 
S™es
[
iS™e
].
LoÿtiÚ
.
dY
 = 
dISD
 * 
	`cos
(2.0 * 
PI
 * (iSite - 1.0)/6.0);

98 
S™es
[
iS™e
].
	`š™Ÿli£
();

102 
di¥ÏûVec
[0] = 
	`CoÜd
(0.0, 0.0);

103 
di¥ÏûVec
[1] = 
	`CoÜd
(2.0 * 
dISD
 * 
	`sq¹
(3.0) / 2.0, 4.0 * dISD / 2.0);

104 
di¥ÏûVec
[2] = 
	`CoÜd
(3.0 * 
dISD
 * 
	`sq¹
(3.0) / 2.0, -1.0 * dISD / 2.0);

105 
di¥ÏûVec
[3] = 
	`CoÜd
(1.0 * 
dISD
 * 
	`sq¹
(3.0) / 2.0, -5.0 * dISD / 2.0);

106 
di¥ÏûVec
[4] = 
	`CoÜd
(-2.0 * 
dISD
 * 
	`sq¹
(3.0) / 2.0, -4.0 * dISD / 2.0);

107 
di¥ÏûVec
[5] = 
	`CoÜd
(-3.0 * 
dISD
 * 
	`sq¹
(3.0) / 2.0, 1.0 * dISD / 2.0);

108 
di¥ÏûVec
[6] = 
	`CoÜd
(-1.0 * 
dISD
 * 
	`sq¹
(3.0) / 2.0, 5.0 * dISD / 2.0);

112 
	}
}

114 
	gWÜld
::
	$´štN‘wÜk
(
boŞ
 
bQu›t
, boŞ 
bFeOuut
) {

117 
iS™e
;

119 
of¡»am


120 
feS™es
;

122 
cout
 << "[runWorld] "

124 << 
’dl
;

127 ià(
bFeOuut
) {

128 
feS™es
.
	`İ’
("Results/Sites.txt");

132 
iS™e
 = 0; iS™< 
numMaüoS™es
; iSite++) {

133 ià(!
bQu›t
){

134 
cout
 << "Site: "

135 << 
iS™e


137 << (
HSPANOISE
 + 
HSPANOISERISE
) << "dBm LTE"

138 << (
LTENOISE
 + 
LTENOISERISE
è<< "dBm" << 
’dl
;

140 
S™es
[
iS™e
].
	`´št
();

142 ià(
bFeOuut
){

143 
feS™es
 << 
S™es
[
iS™e
].
LoÿtiÚ
.
dX


145 << 
S™es
[
iS™e
].
LoÿtiÚ
.
dY


146 << 
’dl
;

150 ià(
bFeOuut
) {

151 
feS™es
.
	`şo£
();

154 
	}
}

156 
	gWÜld
::
	$cÚfigN‘wÜkTe¡Mode
(
Te¡Mode
 
Mode
){

159 
iS™e
,

160 
iSeùÜ
;

163 
S™es
[0].
SeùÜs
[0].
	`ª‹ÂaTe¡
();

166 
iS™e
 = 0; iS™< 
numMaüoS™es
; iSite++) {

167 
iSeùÜ
 = 0; iSeùÜ < 
MACROSECTORS
; iSector++) {

168 
Mode
) {

169 
SINGLESITE0_SINGLESECTOR0
:

170 ià(
iSeùÜ
 =ğ0 && 
iS™e
 == 0) {

171 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
nB_h¥a_·rs
.
dTxpow”
 = 30.0;

172 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
dTxpow”
 = 30.0;

175 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
nB_h¥a_·rs
.
dTxpow”
 = -200.0;

176 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
dTxpow”
 = -200.0;

179 
SINGLESITE0_SINGLESECTOR1
:

180 ià(
iSeùÜ
 =ğ1 && 
iS™e
 == 0) {

181 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
nB_h¥a_·rs
.
dTxpow”
 = 30.0;

182 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
dTxpow”
 = 30.0;

185 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
nB_h¥a_·rs
.
dTxpow”
 = -200.0;

186 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
dTxpow”
 = -200.0;

189 
SINGLESITE0_SINGLESECTOR2
:

190 ià(
iSeùÜ
 =ğ2 && 
iS™e
 == 0) {

191 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
nB_h¥a_·rs
.
dTxpow”
 = 30.0;

192 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
dTxpow”
 = 30.0;

195 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
nB_h¥a_·rs
.
dTxpow”
 = -200.0;

196 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
dTxpow”
 = -200.0;

205 
	}
}

208 
	gWÜld
::
	$š™Ÿli£U£rs
(){

210 
iUE
 = 0,

211 
iS™es
, 
iSeùs
, 
iBlock
;

214 
dA»aHexagÚ
,

215 
dA»aWÜld
,

216 
dRadiusWÜld
;

218 
CoÜd


219 
CoÜdU£r
;

222 
dA»aHexagÚ
 = 0.5*
	`sq¹
(3.0)*
	`pow
(
dISD
,2.0);

223 
dA»aWÜld
 = 7.0*
dA»aHexagÚ
;

224 
dRadiusWÜld
 = 
	`sq¹
(
dA»aWÜld
/
PI
);

226 
cout
 << "[runWorld] "

228 << 
dRadiusWÜld
 << " m" << 
’dl
;

230 
iUE
 < 
numMaüoUEs
) {

232 
CoÜdU£r
.
dX
 = 
dRadiusWÜld
 * (2.0 * 
	`¿n1
(&
iS“d
) - 1.0);

233 
CoÜdU£r
.
dY
 = 
dRadiusWÜld
 * (2.0 * 
	`¿n1
(&
iS“d
) - 1.0);

236 ià((
	`sq¹
(
	`pow
(
CoÜdU£r
.
dX
,2.0è+…ow(CoÜdU£r.
dY
,2.0)è< 
dRadiusWÜld
è&& (sq¹Õow(CoÜdU£r.dX,2.0è+…ow(CoÜdU£r.dY,2.0)è> 
mšS•¬©iÚUEMaüo
)) {

237 ià(
	`¿n1
(&
iS“d
è< 
´obMaüoUeOutdoÜs
)

238 
UEs
[
iUE
].
ueD•loym’tTy³
 = 
maüoUeOutdoÜ
;

240 
UEs
[
iUE
].
ueD•loym’tTy³
 = 
maüoUeIndoÜ
;

248 
iS™es
=0; iS™es<
numMaüoS™es
; iSites++){

249 
iSeùs
=0; iSeùs<
MACROSECTORS
; iSects++){

250 
iBlock
=0; iBlock<
BLOCKS³rCELL
; iBlock++){

251 ià((
	`abs
(
CoÜdU£r
.
dX
-
S™es
[
iS™es
].
SeùÜs
[
iSeùs
].
­tBlock
[
iBlock
].
LoÿtiÚ
.dXè< 5*
x¿ngeW®ls
è&& (abs(CoÜdU£r.
dY
-S™es[iS™es].SeùÜs[iSeùs].­tBlock[iBlock].LoÿtiÚ.dYè< 5*
y¿ngeW®ls
)){

252 
UEs
[
iUE
].
ueD•loym’tTy³
 = 
maüoUeInFemto
;

253 
UEs
[
iUE
].
IndexBa£S™e
 = 
iS™es
;

254 
UEs
[
iUE
].
IndexSeùÜ
 = 
iSeùs
;

255 
UEs
[
iUE
].
IndexA±Block
 = 
iBlock
;

260 
UEs
[
iUE
].
	`š™Ÿli£
();

261 
UEs
[
iUE
].
LoÿtiÚ
 = 
CoÜdU£r
;

262 
UEs
[
iUE
].
Height
 = 
UeAÁ’ÇHeight
;

263 
UEs
[
iUE
].
v
.
dS³ed
 = 
MAXSPEED
 * 
	`¿n1
(&
iS“d
);

264 
UEs
[
iUE
].
v
.
dDœeùiÚ
 = 
PI
 * (2.0 * 
	`¿n1
(&
iS“d
) - 1.0);

265 
UEs
[
iUE
].
ueHSPAd©a
.
iS”všgFemto
 = -1;

266 
UEs
[
iUE
].
ueLTEd©a
.
iS”všgFemto
 = -1;

267 
iUE
++;

272 
	}
}

275 
	gWÜld
::
	$´štU£rs
(
boŞ
 
bQu›t
, boŞ 
bFeOuut
){

277 
iUE
;

279 
of¡»am


280 
feU£rs
;

283 ià(
bFeOuut
) {

284 
feU£rs
.
	`İ’
("Results/Users.txt");

287 
iUE
 = 0; iUE < 
numMaüoUEs
; iUE++) {

288 ià(!
bQu›t
) {

289 
cout
 << "U£r: " << 
iUE
 << " ";

290 
UEs
[
iUE
].
	`´št
();

292 ià(
bFeOuut
){

293 
feU£rs
 << 
UEs
[
iUE
].
LoÿtiÚ
.
dX


295 << 
UEs
[
iUE
].
LoÿtiÚ
.
dY


296 << 
’dl
;

300 
iUE
 = 0; iUE < 
numHeNB
; iUE++) {

301 ià(!
bQu›t
) {

302 
cout
 << "HomU£r: " << 
iUE
 << " ";

303 
HUEs
[
iUE
].
	`´št
();

305 ià(
bFeOuut
){

306 
feU£rs
 << 
HUEs
[
iUE
].
LoÿtiÚ
.
dX


308 << 
HUEs
[
iUE
].
LoÿtiÚ
.
dY


309 << 
’dl
;

312 ià(
bFeOuut
) {

313 
feU£rs
.
	`şo£
();

316 
	}
}

320 
	gWÜld
::
	$ÿlcPoštLos£s
(
CoÜd
 
coPošt
, 
C–lm—su»s
 
ûÎD©aPt
[][
MACROSECTORS
], 
UED•loym’tTy³
 
D•loym’tTy³
){

322 
iS™e
,

323 
iSeùÜ
,

324 
i
, 
numW¿pS™e
=1;

326 
CoÜd


327 
s™eCoPošt
;

330 
dDi¡ªû
,

331 
dP©hlossTemp
,

332 
dP©hloss
[
SITES
],

333 
dP©hlossNoB—ršg
[
SITES
],

334 
dB—ršg
[
SITES
],

335 
dP©hlossW¿µed
;

337 if(
numMaüoS™es
 == 7)

338 
numW¿pS™e
 = 7;

340 
iS™e
 = 0; iS™< 
numMaüoS™es
; iSite++) {

342 
iSeùÜ
 = 0; iSeùÜ < 
MACROSECTORS
; iSector++) {

344 
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dP©hloss
 = 1000;

345 
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dP©hlossW¿µed
 = 1000;

346 
i
 = 0; i < 
numW¿pS™e
; i++) {

348 
s™eCoPošt
.
dX
 = 
S™es
[
iS™e
].
LoÿtiÚ
.dX - 
di¥ÏûVec
[
i
].dX;

349 
s™eCoPošt
.
dY
 = 
S™es
[
iS™e
].
LoÿtiÚ
.dY - 
di¥ÏûVec
[
i
].dY;

351 
dDi¡ªû
 = 
	`Di¡ªû3D
(
coPošt
, 
s™eCoPošt
, 
S™es
[
iS™e
].
ª‹ÂaHeight
, 
UeAÁ’ÇHeight
);

353 ià(
dDi¡ªû
 < 10.0){

354 
dDi¡ªû
 = 10.0;

358 ià(
D•loym’tTy³
 =ğ
maüoUeOutdoÜNLOS
)

359 
dP©hlossTemp
 = 
	`dPlM‘roMaüoCOST231
(
dDi¡ªû
, 2100.0, 
S™es
[
iS™e
].
ª‹ÂaHeight
, 1.5, 
çl£
);

361 
dP©hlossTemp
 = 
	`dPlCOST231Okumu¿H©a
((
dDi¡ªû
/1000.0), 2100.0, 
S™es
[
iS™e
].
ª‹ÂaHeight
, 1.5, 
Œue
);

364 ià(
D•loym’tTy³
 =ğ
maüoUeIndoÜ
)

366 
dP©hlossTemp
 +ğ
Ùh”MaüoUEP’‘¿tiÚ
;

367 ià(
D•loym’tTy³
 =ğ
maüoUeInFemto
)

368 
dP©hlossTemp
 +ğ
Ex‹riÜW®lP’‘¿tiÚLoss
 + 
ShadowšgStdDevFemto
 * 
	`¿n1
(&
iS“d
);

369 ià(
D•loym’tTy³
 =ğ
ãmtoUeIndoÜ
)

370 
dP©hlossTemp
 +ğ
Ex‹riÜW®lP’‘¿tiÚLoss
 + 
ShadowšgStdDevFemto
 * 
	`¿n1
(&
iS“d
);

372 
dP©hlossNoB—ršg
[
i
] = 
dP©hlossTemp
 - 
BSANTGAIN
 - 
UeAÁGaš
;

375 
dB—ršg
[
i
] = 
	`B—ršgFromSeùÜ
(
iSeùÜ
, 
s™eCoPošt
, 
coPošt
);

377 
dP©hloss
[
i
] = 
dP©hlossTemp
 - 
UeAÁGaš
 - 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
	`ª‹ÂaGaš
(180.0*
dB—ršg
[i]/
PI
);

380 ià(
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dP©hloss
 > dP©hloss[
i
]){

381 
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dP©hloss
 = dP©hloss[
i
];

382 
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dP©hlossNoB—ršg
 = dP©hlossNoB—ršg[
i
];

383 
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dB—ršg


384 ğ
dB—ršg
[
i
];

387 
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dP©hlossW¿µed
 = -
	`AdddBm
(-
dP©hloss
[
i
],

388 -
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dP©hlossW¿µed
);

393 
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dRxpow”


394 ğ
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
dTxpow”


395 - 
ûÎD©aPt
[
iS™e
][
iSeùÜ
].
dP©hloss
;

399 
	}
}

401 
	gWÜld
::
	$ÿlcP©hlos£s
(
boŞ
 
bQu›t
){

403 
iUE
,

404 
iS™e
;

407 
iS™e
 = 0; iS™< 
numHeNB
; iSite++) {

408 ià(! 
bQu›t
){

409 
cout
 << "FemtØ" << 
iS™e
 << "¢ifãr. " << 
’dl
;

413 
	`ÿlcSnifãr
(
HeNBS™es
[
iS™e
].
LoÿtiÚ
, HeNBS™es[iS™e].
ûÎD©a
);

418 
iUE
 = 0; iUE < 
numMaüoUEs
; iUE++) {

419 ià(! 
bQu›t
){

420 
cout
 << "U£r: " << 
iUE
 << 
’dl
;

424 
UEs
[
iUE
].
ueHSPAd©a
.
	`š™Ÿli£
();

425 
UEs
[
iUE
].
ueLTEd©a
.
	`š™Ÿli£
();

426 
	`ÿlcPoštLos£s
(
UEs
[
iUE
].
LoÿtiÚ
, UEs[iUE].
ueHSPAd©a
.
ûÎD©a
, UEs[iUE].
ueD•loym’tTy³
);

427 
	`ÿlcPoštLos£s
(
UEs
[
iUE
].
LoÿtiÚ
, UEs[iUE].
ueLTEd©a
.
ûÎD©a
, UEs[iUE].
ueD•loym’tTy³
);

431 
	`ÿlcFemtoPoštLos£s
(
UEs
[
iUE
], &UEs[iUE].
ueHSPAd©a
.
ãmtoD©a
[0]);

432 
	`ÿlcFemtoPoštLos£s
(
UEs
[
iUE
], &UEs[iUE].
ueLTEd©a
.
ãmtoD©a
[0]);

436 
iUE
 = 0; iUE < 
numHomeUE
; iUE++) {

437 ià(! 
bQu›t
){

438 
cout
 << "HomU£r: " << 
iUE
 << 
’dl
;

444 
	`ÿlcPoštLos£s
(
HUEs
[
iUE
].
LoÿtiÚ
, HUEs[iUE].
ueHSPAd©a
.
ûÎD©a
, HUEs[iUE].
ueD•loym’tTy³
);

445 
	`ÿlcPoštLos£s
(
HUEs
[
iUE
].
LoÿtiÚ
, HUEs[iUE].
ueLTEd©a
.
ûÎD©a
, HUEs[iUE].
ueD•loym’tTy³
);

449 
	`ÿlcFemtoPoštLos£s
(
HUEs
[
iUE
], &HUEs[iUE].
ueHSPAd©a
.
ãmtoD©a
[0]);

450 
	`ÿlcFemtoPoštLos£s
(
HUEs
[
iUE
], &HUEs[iUE].
ueLTEd©a
.
ãmtoD©a
[0]);

453 
	}
}

455 
	gWÜld
::
	$driveTe¡_Pede¡rŸn
(
FloÜ¶ªs
 *
æoÜ¶ª
){

457 
tÙ®P©hL’gth
 = 0,

458 
Œav–S‹p
 = 0.2;

460 
i
, 
j
,

461 
numWayPošt
,

462 
šdexWayPošt
 = 0;

463 
CoÜd


464 *
wayPošt
;

465 
UE


466 
ue
;

468 
iSeùÜ
,

469 
iS™e
;

472 
dBe¡SigÇl
,

473 
‹mpP’eLoss
,

474 *
wayPoštHeight
;

476 
S”všgC–l


477 
be¡S”všgC–l
,

478 
£cÚdBe¡S”všgC–l
;

480 
of¡»am


481 
feRa¡”SigÇl
,

482 
feRa¡”Hªdov”
,

483 
feRa¡”C2I
;

486 
feRa¡”SigÇl
.
	`İ’
("Results/RasterSignal.txt");

487 
feRa¡”C2I
.
	`İ’
("Results/RasterC2I.txt");

488 
feRa¡”Hªdov”
.
	`İ’
("Results/RasterSignalHandover.txt");

490 
i
=0; i<
æoÜ¶ª
[0].
numT¿v–P©hSeg
; i++){

491 
tÙ®P©hL’gth
 =Ù®P©hL’gth + 
	`Di¡ªû
(
	`CoÜd
(
æoÜ¶ª
[0].
Œav–P©h
[
i
].
x1
, floÜ¶ª[0].Œav–P©h[i].
y1
),

492 
	`CoÜd
(
æoÜ¶ª
[0].
Œav–P©h
[
i
].
x2
, floÜ¶ª[0].Œav–P©h[i].
y2
));

494 
numWayPošt
 = 
	`û
(
tÙ®P©hL’gth
 / 
Œav–S‹p
)+1;

495 
wayPošt
 = (
CoÜd
 *)
	`m®loc
((
numWayPošt
) * (Coord));

496 
wayPoštHeight
 = (*)
	`m®loc
((
numWayPošt
) * ());

499 
»mašP©h
 = 0;

500 
wayPošt
[0].
dX
 = 
æoÜ¶ª
[0].
Œav–P©h
[0].
x1
;

501 
wayPošt
[0].
dY
 = 
æoÜ¶ª
[0].
Œav–P©h
[0].
y1
;

502 
wayPoštHeight
[0] = 
æoÜ¶ª
[0].
Œav–P©h
[0].
height
;

503 
šdexWayPošt
++;

504 
i
=0; i<
æoÜ¶ª
[0].
numT¿v–P©hSeg
; i++){

505 
tÙ®P©hL’gth
 = 
»mašP©h
 + 
	`Di¡ªû
(
	`CoÜd
(
æoÜ¶ª
[0].
Œav–P©h
[
i
].
x1
, floÜ¶ª[0].Œav–P©h[i].
y1
),

506 
	`CoÜd
(
æoÜ¶ª
[0].
Œav–P©h
[
i
].
x2
, floÜ¶ª[0].Œav–P©h[i].
y2
));

507 
numWayPošt
 = 
tÙ®P©hL’gth
 / 
Œav–S‹p
;

508 
j
=1; j<=
numWayPošt
; j++){

509 
wayPošt
[
šdexWayPošt
].
dX
 = 
æoÜ¶ª
[0].
Œav–P©h
[
i
].
x1
 + (
j
*
Œav–S‹p
 - 
»mašP©h
è/ (
tÙ®P©hL’gth
 -„emašP©hè* (æoÜ¶ª[0].Œav–P©h[i].
x2
 - floorplan[0].travelPath[i].x1);

510 
wayPošt
[
šdexWayPošt
].
dY
 = 
æoÜ¶ª
[0].
Œav–P©h
[
i
].
y1
 + (
j
*
Œav–S‹p
 - 
»mašP©h
è/ (
tÙ®P©hL’gth
 -„emašP©hè* (æoÜ¶ª[0].Œav–P©h[i].
y2
 - floorplan[0].travelPath[i].y1);

511 
wayPoštHeight
[
šdexWayPošt
] = 
æoÜ¶ª
[0].
Œav–P©h
[
i
].
height
;

512 
šdexWayPošt
++;

514 
»mašP©h
 = 
tÙ®P©hL’gth
 - 
numWayPošt
*
Œav–S‹p
;

519 
i
=0; i<
šdexWayPošt
-1; i++){

520 
ue
.
LoÿtiÚ
 = 
wayPošt
[
i
];

521 
ue
.
Height
 = 
wayPoštHeight
[
i
];

522 
	`‹¡LoÿtiÚUE
(&
ue
, 
æoÜ¶ª
);

523 
ue
.
ueLTEd©a
.
	`š™Ÿli£
();

524 
ue
.
ueHSPAd©a
.
iS”všgFemto
 = 2000;

527 
	`ÿlcPoštLos£s
(
ue
.
LoÿtiÚ
, ue.
ueLTEd©a
.
ûÎD©a
, ue.
ueD•loym’tTy³
);

528 
	`ÿlcFemtoPoštLos£s
(
ue
, &ue.
ueLTEd©a
.
ãmtoD©a
[0]);

529 
	`ÿlcM‘roPoštLos£s
(
ue
, &ue.
ueLTEd©a
.
m‘roD©a
[0], 
æoÜ¶ª
);

570 
UEs
[0] = 
ue
;

574 
UEs
[0].
	`ÿlcuÏ‹S”všgC–l
(
numMaüoS™es
, 
numHeNB
, 
numM‘roBS
);

576 
dBe¡SigÇl
 = 
UEs
[0].
ueLTEd©a
.
dS”všgRxsigÇl
;

578 
feRa¡”SigÇl
 << 
dBe¡SigÇl
 << "\t";

579 
feRa¡”C2I
 << 
UEs
[0].
ueLTEd©a
.
dS”všgCtoI
 << "\t";

580 ià(
i
 > 0){

581 ià(
be¡S”všgC–l
.
£rvšgC–lTy³
 =ğ
UEs
[0].bestServingCell.servingCellType){

582 ià(
be¡S”všgC–l
.
£rvšgC–lTy³
 =ğ
Maüo
){

583 ià(
be¡S”všgC–l
.
iS”všgS™e
 !ğ
UEs
[0].bestServingCell.iServingSite ||

584 
be¡S”všgC–l
.
iS”všgSeùÜ
 !ğ
UEs
[0].bestServingCell.iServingSector)

585 
feRa¡”Hªdov”
 << 3 << "\t";

587 
feRa¡”Hªdov”
 << 0 << "\t";

589 ià(
be¡S”všgC–l
.
£rvšgC–lTy³
 =ğ
M‘ro
){

590 ià(
be¡S”všgC–l
.
iS”všgM‘ro
 !ğ
UEs
[0].bestServingCell.iServingMetro)

591 
feRa¡”Hªdov”
 << 2 << "\t";

593 
feRa¡”Hªdov”
 << 0 << "\t";

595 ià(
be¡S”všgC–l
.
£rvšgC–lTy³
 =ğ
Femto
){

596 ià(
be¡S”všgC–l
.
iS”všgFemto
 !ğ
UEs
[0].bestServingCell.iServingFemto)

597 
feRa¡”Hªdov”
 << 1 << "\t";

599 
feRa¡”Hªdov”
 << 0 << "\t";

603 
feRa¡”Hªdov”
 << 4 << "\t";

606 
feRa¡”Hªdov”
 << 0 << "\t";

607 
be¡S”všgC–l
 = 
UEs
[0].bestServingCell;

610 
feRa¡”SigÇl
.
	`şo£
();

611 
feRa¡”C2I
.
	`şo£
();

612 
feRa¡”Hªdov”
.
	`şo£
();

614 
	`ä“
(
wayPošt
);

616 
	}
}

619 
	gWÜld
::
	$ÿlcRa¡”Sÿn
(
dBšSize
, 
FloÜ¶ªs
 *
æoÜ¶ª
){

621 
i
, 
size
,

622 
iSeùÜ
,

623 
iS™e
,

624 
iS”všgSeùÜ
 = 0,

625 
iS”všgS™e
 = 0;

628 
dBe¡SigÇl
,

629 
dEx‹ÁOfWÜld
,

630 
‹mpP’eLoss
;

632 
CoÜd


633 
coSÿnPt
,

634 
¡¬tPošt
;

637 
ShadowšgM©rix
;

642 
UE


643 
ue
;

645 
of¡»am


646 
feRa¡”SigÇlShadowšg
,

647 
feRa¡”SigÇlMaüo
,

648 
feRa¡”SigÇlFemto
,

649 
feRa¡”C2IMaüo
,

650 
feRa¡”C2IFemto
;

653 
feRa¡”SigÇlMaüo
.
	`İ’
("Results/RasterSignalMacro.txt");

654 
feRa¡”C2IMaüo
.
	`İ’
("Results/RasterC2IMacro.txt");

655 
feRa¡”SigÇlFemto
.
	`İ’
("Results/RasterSignalFemto.txt");

656 
feRa¡”C2IFemto
.
	`İ’
("Results/RasterC2IFemto.txt");

657 
feRa¡”SigÇlShadowšg
.
	`İ’
("Results/RasterSignalShadowing.txt");

659 
dEx‹ÁOfWÜld
 = 1.0 * 
dISD
;

660 
¡¬tPošt
.
dX
 = -10;

661 
¡¬tPošt
.
dY
 = -10;

663 
size
 = ()((
dEx‹ÁOfWÜld
-
¡¬tPošt
.
dY
)/
BINSIZE
);

664 
ShadowšgM©rix
 = (**è
	`m®loc
(
size
 * (*));

665 
i
=0; i<
size
; i++){

666 
ShadowšgM©rix
[
i
] = (*è
	`m®loc
(
size
 * ());

671 
CRSEc
,

672 
Ioh
;

673 
iS™e
 = 0; iS™< 
numHeNB
; iSite++) {

677 
ue
.
LoÿtiÚ
 = 
HeNBS™es
[
iS™e
].Location;

678 
ue
.
Height
 = 
UeAÁ’ÇHeight
;

679 
ue
.
ueD•loym’tTy³
 = 
maüoUeInFemto
;

680 
ue
.
ueLTEd©a
.
	`š™Ÿli£
();

681 
ue
.
maüoS”všgC–l
.
	`š™Ÿli£
();

682 
ue
.
ãmtoS”všgC–l
.
	`š™Ÿli£
();

683 
ue
.
ueHSPAd©a
.
iS”všgFemto
 = 2000;

684 
	`ÿlcPoštLos£s
(
ue
.
LoÿtiÚ
, ue.
ueLTEd©a
.
ûÎD©a
, ue.
ueD•loym’tTy³
);

685 
	`ÿlcFemtoPoštLos£s
(
ue
, &ue.
ueLTEd©a
.
ãmtoD©a
[0]);

686 
UEs
[0] = 
ue
;

687 
UEs
[0].
	`ÿlcuÏ‹S”všgC–l
(
numMaüoS™es
, 
numHeNB
, 
numM‘roBS
);

688 
CRSEc
 = 
UEs
[0].
maüoS”všgC–l
.
dRxpow”
 - 27;

689 
Ioh
 = 
UEs
[0].
ueLTEd©a
.
dS”všgRxšt
;

690 ià(
CRSEc
 > -127){

691 ià(
Ioh
 > 
CRSEc
 + 27 + 30)

692 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
dTxpow”
 = 20;

694 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
dTxpow”
 = 
	`max
(20.0, 
	`mš
(20.0, 
CRSEc
+27+45));

699 
numMaüoUEs
 = 1;

700 
numHomeUE
 = 0;

702 
	`ÿlcShadowšgS³cific
(
C¬rF»q
, 
	`com¶ex
(
¡¬tPošt
.
dX
, s¹Pošt.
dY
), com¶ex(
dEx‹ÁOfWÜld
, dEx‹ÁOfWÜld), 
BINSIZE
, 
autoAndXüoss
, 
ShadowšgM©rix
);

704 
coSÿnPt
.
dX
 = 
¡¬tPošt
.dX; coSÿnPt.dX < 
dEx‹ÁOfWÜld
;

705 
coSÿnPt
.
dX
 +ğ
dBšSize
){

707 
coSÿnPt
.
dY
 = 
¡¬tPošt
.dY; coSÿnPt.dY < 
dEx‹ÁOfWÜld
;

709 
coSÿnPt
.
dY
 +ğ
dBšSize
){

712 
ue
.
LoÿtiÚ
 = 
coSÿnPt
;

713 
ue
.
Height
 = 
UeAÁ’ÇHeight
;

714 
	`‹¡LoÿtiÚUE
(&
ue
, 
æoÜ¶ª
);

715 
ue
.
ueLTEd©a
.
	`š™Ÿli£
();

716 
ue
.
maüoS”všgC–l
.
	`š™Ÿli£
();

717 
ue
.
ãmtoS”všgC–l
.
	`š™Ÿli£
();

718 
ue
.
ueHSPAd©a
.
iS”všgFemto
 = 2000;

722 
	`ÿlcPoštLos£s
(
ue
.
LoÿtiÚ
, ue.
ueLTEd©a
.
ûÎD©a
, ue.
ueD•loym’tTy³
);

723 
	`ÿlcFemtoPoštLos£s
(
ue
, &ue.
ueLTEd©a
.
ãmtoD©a
[0]);

724 
	`ÿlcM‘roPoštLos£s
(
ue
, &ue.
ueLTEd©a
.
m‘roD©a
[0], 
æoÜ¶ª
);

727 
iS™e
 = 0; iS™< 
numMaüoS™es
; iSite++) {

729 
‹mpP’eLoss
 = 
	`p2pP’‘¿tiÚLoss
(
ue
.
LoÿtiÚ
, ue.
Height
, 
S™es
[
iS™e
].LoÿtiÚ, S™es[iS™e].
ª‹ÂaHeight
, 
æoÜ¶ª
);

730 
iSeùÜ
 = 0; iSeùÜ < 
MACROSECTORS
; iSector++) {

732 ià(
‹mpP’eLoss
 > 0) {

733 
ue
.
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dP©hloss
 = ue.ueLTEd©a.ûÎD©a[iS™e][iSeùÜ].dP©hlos + 
‹mpP’eLoss
;

734 
ue
.
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dP©hlossNoB—ršg
 = ue.ueLTEd©a.ûÎD©a[iS™e][iSeùÜ].dP©hlossNoB—ršg + 
‹mpP’eLoss
;

735 
ue
.
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dP©hlossW¿µed
 = ue.ueLTEd©a.ûÎD©a[iS™e][iSeùÜ].dP©hlossW¿µed + 
‹mpP’eLoss
;

736 
ue
.
ueLTEd©a
.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dRxpow”
 = ue.ueLTEd©a.ûÎD©a[iS™e][iSeùÜ].dRxpow” - 
‹mpP’eLoss
;

741 
iS™e
 = 0; iS™< 
numHeNB
; iSite++) {

743 
‹mpP’eLoss
 = 
	`p2pP’‘¿tiÚLoss
(
ue
.
LoÿtiÚ
, ue.
Height
, 
HeNBS™es
[
iS™e
].LoÿtiÚ, HeNBS™es[iS™e].
ª‹ÂaHeight
, 
æoÜ¶ª
);

745 ià(
‹mpP’eLoss
 > 0) {

746 
ue
.
ueLTEd©a
.
ãmtoD©a
[
iS™e
].
dP©hloss
 = ue.ueLTEd©a.ãmtoD©a[iS™e].dP©hlos + 
‹mpP’eLoss
;

747 
ue
.
ueLTEd©a
.
ãmtoD©a
[
iS™e
].
dP©hlossNoB—ršg
 = ue.ueLTEd©a.ãmtoD©a[iS™e].dP©hlossNoB—ršg + 
‹mpP’eLoss
;

748 
ue
.
ueLTEd©a
.
ãmtoD©a
[
iS™e
].
dP©hlossW¿µed
 = ue.ueLTEd©a.ãmtoD©a[iS™e].dP©hlossW¿µed + 
‹mpP’eLoss
;

749 
ue
.
ueLTEd©a
.
ãmtoD©a
[
iS™e
].
dRxpow”
 = ue.ueLTEd©a.ãmtoD©a[iS™e].dRxpow” - 
‹mpP’eLoss
;

753 
iS™e
 = 0; iS™< 
numM‘roBS
; iSite++) {

755 
‹mpP’eLoss
 = 
	`p2pP’‘¿tiÚLoss
(
ue
.
LoÿtiÚ
, ue.
Height
, 
m‘roS™es
[
iS™e
].LoÿtiÚ, m‘roS™es[iS™e].
ª‹ÂaHeight
, 
æoÜ¶ª
);

757 ià(
‹mpP’eLoss
 > 0) {

758 
ue
.
ueLTEd©a
.
m‘roD©a
[
iS™e
].
dP©hloss
 = ue.ueLTEd©a.m‘roD©a[iS™e].dP©hlos + 
‹mpP’eLoss
;

759 
ue
.
ueLTEd©a
.
m‘roD©a
[
iS™e
].
dP©hlossNoB—ršg
 = ue.ueLTEd©a.m‘roD©a[iS™e].dP©hlossNoB—ršg + 
‹mpP’eLoss
;

760 
ue
.
ueLTEd©a
.
m‘roD©a
[
iS™e
].
dP©hlossW¿µed
 = ue.ueLTEd©a.m‘roD©a[iS™e].dP©hlossW¿µed + 
‹mpP’eLoss
;

761 
ue
.
ueLTEd©a
.
m‘roD©a
[
iS™e
].
dRxpow”
 = ue.ueLTEd©a.m‘roD©a[iS™e].dRxpow” - 
‹mpP’eLoss
;

765 
UEs
[0] = 
ue
;

769 
iS”všgSeùÜ
 = 0;

770 
iS”všgS™e
 = 0;

771 
UEs
[0].
	`ÿlcuÏ‹S”všgC–l
(
numMaüoS™es
, 
numHeNB
, 
numM‘roBS
);

773 
dBe¡SigÇl
 = 
UEs
[0].
ueLTEd©a
.
dS”všgRxsigÇl
;

775 
feRa¡”SigÇlMaüo
 << 
UEs
[0].
maüoS”všgC–l
.
dRxpow”
 << "\t";

776 
feRa¡”C2IMaüo
 << 
UEs
[0].
maüoS”všgC–l
.
dCtoI
 << "\t";

777 
feRa¡”SigÇlFemto
 << 
UEs
[0].
ãmtoS”všgC–l
.
dRxpow”
 << "\t";

778 
feRa¡”C2IFemto
 << 
UEs
[0].
ãmtoS”všgC–l
.
dCtoI
 << "\t";

779 
feRa¡”SigÇlShadowšg
 << 
ShadowšgM©rix
[()(
coSÿnPt
.
dX
-
¡¬tPošt
.dX)][()(coSÿnPt.
dY
-startPoint.dY)] << "\t";

781 
feRa¡”SigÇlMaüo
 << 
’dl
;

782 
feRa¡”C2IMaüo
 << 
’dl
;

783 
feRa¡”SigÇlFemto
 << 
’dl
;

784 
feRa¡”C2IFemto
 << 
’dl
;

785 
feRa¡”SigÇlShadowšg
 << 
’dl
;

786 if(()((
coSÿnPt
.
dX
-
¡¬tPošt
.dX)*100/
size
) % 10 == 0)

787 
cout
 << ()((
coSÿnPt
.
dX
-
¡¬tPošt
.dX)*100/
size
è<< "%"<< 
’dl
;

789 
feRa¡”SigÇlMaüo
.
	`şo£
();

790 
feRa¡”C2IMaüo
.
	`şo£
();

791 
feRa¡”SigÇlFemto
.
	`şo£
();

792 
feRa¡”C2IFemto
.
	`şo£
();

793 
feRa¡”SigÇlShadowšg
.
	`şo£
();

795 
	`ä“
(
ShadowšgM©rix
);

797 
	}
}

799 
	gWÜld
::
	$driveTe¡_Cœşe
(
dRadius
, 
CoÜd
 
coC’Œe
) {

801 
iSeùÜ
;

804 
dAngË
;

806 
UE


807 
ueDriveTe¡
;

809 
of¡»am


810 
feDriveTe¡Cœşe
;

813 
feDriveTe¡Cœşe
.
	`İ’
("Results/driveTestCircle.txt");

816 
dAngË
 = 0.0; dAngle < 360.0; dAngle+=1.0) {

817 
ueDriveTe¡
.
LoÿtiÚ
.
dY
 = 
coC’Œe
.dY + (
dRadius
*
	`cos
(
PI
*
dAngË
/180.0));

818 
ueDriveTe¡
.
LoÿtiÚ
.
dX
 = 
coC’Œe
.dX + (
dRadius
*
	`sš
(
PI
*
dAngË
/180.0));

821 
	`ÿlcPoštLos£s
(
ueDriveTe¡
.
LoÿtiÚ
, ueDriveTe¡.
ueHSPAd©a
.
ûÎD©a
, 
maüoUeOutdoÜ
);

822 
	`ÿlcPoštLos£s
(
ueDriveTe¡
.
LoÿtiÚ
, ueDriveTe¡.
ueLTEd©a
.
ûÎD©a
, 
maüoUeOutdoÜ
);

825 
feDriveTe¡Cœşe
 << 
dAngË
<< "\t"

826 << 
ueDriveTe¡
.
LoÿtiÚ
.
dX
 << "\t"

827 << 
ueDriveTe¡
.
LoÿtiÚ
.
dY
;

828 
iSeùÜ
 = 0; iSeùÜ < 
MACROSECTORS
; iSector++) {

829 
feDriveTe¡Cœşe
 << "\t" << 180.0*
ueDriveTe¡
.
ueHSPAd©a
.
ûÎD©a
[0][
iSeùÜ
].
dB—ršg
/
PI
;

830 
feDriveTe¡Cœşe
 << "\t" << 
ueDriveTe¡
.
ueHSPAd©a
.
ûÎD©a
[0][
iSeùÜ
].
dP©hloss
;

831 
feDriveTe¡Cœşe
 << "\t" << 180.0*
ueDriveTe¡
.
ueLTEd©a
.
ûÎD©a
[0][
iSeùÜ
].
dB—ršg
/
PI
;

832 
feDriveTe¡Cœşe
 << "\t" << 
ueDriveTe¡
.
ueLTEd©a
.
ûÎD©a
[0][
iSeùÜ
].
dP©hloss
;

835 
feDriveTe¡Cœşe
 << 
’dl
;

839 
feDriveTe¡Cœşe
.
	`şo£
();

842 
	}
}

844 
	gWÜld
::
	$doC–lS–eùiÚ
(
boŞ
 
bQu›t
) {

846 
iUE
;

848 
cout
 << "[runWorld] [World::doCellSelection] Doing UE cell selections\n";

850 
iUE
 = 0; iUE < 
numMaüoUEs
; iUE++) {

851 
UEs
[
iUE
].
	`ÿlcuÏ‹S”všgC–l
(
numMaüoS™es
, 
numHeNB
, 
numM‘roBS
);

852 ià(!
bQu›t
) {

853 
cout
 << "[runWÜld] [WÜld::doC–lS–eùiÚ] UE:" << 
iUE
 << "\t";

854 
UEs
[
iUE
].
	`´štS”všg
();

858 
iUE
 = 0; iUE < 
numHeNB
; iUE++) {

859 
HUEs
[
iUE
].
	`ÿlcuÏ‹S”všgC–l
(
numMaüoS™es
, 
numHeNB
, 
numM‘roBS
);

860 ià(!
bQu›t
) {

861 
cout
 << "[runWÜld] [WÜld::doHUEC–lS–eùiÚ] HUE:" << 
iUE
 << "\t";

862 
HUEs
[
iUE
].
	`´štS”všg
();

867 
	}
}

869 
	gWÜld
::
	$doC–lAdmissiÚ
(
boŞ
 
bQu›t
) {

871 
iUE
;

873 
cout
 << "[runWorld] [World::doCellAdmission] Doing Cell Admission\n";

875 
iUE
 = 0; iUE < 
numMaüoUEs
; iUE++) {

877 
UEs
[
iUE
].
	`u¶škPow”CÚŒŞ
();

878 ià(!
bQu›t
) {

879 
cout
 << "[runWÜld] [WÜld::doC–lAdmissiÚ] UE:" << 
iUE
 << "\t";

880 
UEs
[
iUE
].
	`´štS”všg
();

884 
UEs
[
iUE
].
	`ÿlcHSPAThroughputE¡im©e
();

885 
UEs
[
iUE
].
	`ÿlcLTEThroughputE¡im©e
();

890 
iUE
 = 0; iUE < 
numHeNB
; iUE++) {

892 
HUEs
[
iUE
].
	`u¶škPow”CÚŒŞ
();

893 ià(!
bQu›t
) {

894 
cout
 << "[runWÜld] [WÜld::doHUEC–lAdmissiÚ] HUE:" << 
iUE
 << "\t";

895 
HUEs
[
iUE
].
	`´štS”všg
();

899 
HUEs
[
iUE
].
	`ÿlcHSPAThroughputE¡im©e
();

900 
HUEs
[
iUE
].
	`ÿlcLTEThroughputE¡im©e
();

903 
	}
}

905 
	gWÜld
::
	$addIÁ”ã»nûToOth”C–ls
()

908 
iUE
,

909 
iS™e
,

910 
iSeùÜ
;

912 
iS™e
 = 0; iS™< 
numMaüoS™es
; iSite++) {

913 
iSeùÜ
 = 0; iSeùÜ < 
MACROSECTORS
; iSector++) {

914 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
nB_h¥a_·rs
.
ŒafficMªag”
.
iU£rS”ved
 = 0;

915 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
 = 0;

919 
iS™e
 = 0; iS™< 
numHeNB
; iSite++) {

920 
HeNBS™es
[
iS™e
].
nB_h¥a_·rs
.
ŒafficMªag”
.
iU£rS”ved
 = 0;

921 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
 = 0;

926 
iUE
 = 0; iUE < 
numMaüoUEs
; iUE++) {

928 
iS™e
 = 0; iS™< 
numMaüoS™es
; iSite++) {

929 
iSeùÜ
 = 0; iSeùÜ < 
MACROSECTORS
; iSector++) {

930 ià((
iS™e
 !ğ
UEs
[
iUE
].
ueHSPAd©a
.
iS”všgS™e
è|| (
iSeùÜ
 !ğUEs[iUE].ueHSPAd©a.
iS”všgSeùÜ
)){

931 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
nB_h¥a_·rs
.
dRxšt
 =

932 
	`AdddBm
(
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
nB_h¥a_·rs
.
dRxšt
,

933 
UEs
[
iUE
].
ueHSPAd©a
.
dTxpow”
 - UEs[iUE].ueHSPAd©a.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dP©hloss
);

938 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
nB_h¥a_·rs
.
ŒafficMªag”
.
ueS”vedQueue
[S™es[iS™e].SeùÜs[iSeùÜ].nB_h¥a_·rs.ŒafficMªag”.
iU£rS”ved
] = 
iUE
;

939 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
nB_h¥a_·rs
.
ŒafficMªag”
.
iU£rS”ved
++;

941 ià((
iS™e
 !ğ
UEs
[
iUE
].
ueLTEd©a
.
iS”všgS™e
è|| (
iSeùÜ
 !ğUEs[iUE].ueLTEd©a.
iS”všgSeùÜ
)){

942 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
dRxšt
 =

943 
	`AdddBm
(
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
dRxšt
,

944 
UEs
[
iUE
].
ueLTEd©a
.
dTxpow”
 - UEs[iUE].ueLTEd©a.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dP©hlossW¿µed
);

947 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
ŒafficMªag”
.
ueS”vedQueue
[S™es[iS™e].SeùÜs[iSeùÜ].’B_Ée_·rs.ŒafficMªag”.
iU£rS”ved
] = 
iUE
;

948 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
++;

954 
iS™e
 = 0; iS™< 
numHeNB
; iSite++) {

955 
HeNBS™es
[
iS™e
].
nB_h¥a_·rs
.
dRxšt
 = 
	`AdddBm
(HeNBSites[iSite].nB_hspa_pars.dRxint,

956 
UEs
[
iUE
].
ueHSPAd©a
.
dTxpow”
 - UEs[iUE].ueHSPAd©a.
ãmtoD©a
[
iS™e
].
dP©hloss
);

958 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
dRxšt
 = 
	`AdddBm
(HeNBSites[iSite].enB_lte_pars.dRxint,

959 
UEs
[
iUE
].
ueLTEd©a
.
dTxpow”
 - UEs[iUE].ueLTEd©a.
ãmtoD©a
[
iS™e
].
dP©hlossW¿µed
);

963 
iUE
 = 0; iUE < 
numHomeUE
; iUE++) {

965 
iS™e
 = 0; iS™< 
numMaüoS™es
; iSite++) {

966 
iSeùÜ
 = 0; iSeùÜ < 
MACROSECTORS
; iSector++) {

967 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
nB_h¥a_·rs
.
dRxšt
 =

968 
	`AdddBm
(
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
nB_h¥a_·rs
.
dRxšt
,

969 
HUEs
[
iUE
].
ueHSPAd©a
.
dTxpow”
 - HUEs[iUE].ueHSPAd©a.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dP©hloss
);

971 
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
dRxšt
 =

972 
	`AdddBm
(
S™es
[
iS™e
].
SeùÜs
[
iSeùÜ
].
’B_Ée_·rs
.
dRxšt
,

973 
HUEs
[
iUE
].
ueLTEd©a
.
dTxpow”
 - HUEs[iUE].ueLTEd©a.
ûÎD©a
[
iS™e
][
iSeùÜ
].
dP©hlossW¿µed
);

978 
iS™e
 = 0; iS™< 
numHeNB
; iSite++) {

979 ià(
iS™e
 !ğ
HUEs
[
iUE
].
ueHSPAd©a
.
iS”všgFemto
)

980 
HeNBS™es
[
iS™e
].
nB_h¥a_·rs
.
dRxšt
 = 
	`AdddBm
(HeNBSites[iSite].nB_hspa_pars.dRxint,

981 
HUEs
[
iUE
].
ueHSPAd©a
.
dTxpow”
 - HUEs[iUE].ueHSPAd©a.
ãmtoD©a
[
iS™e
].
dP©hloss
);

983 
HeNBS™es
[
iS™e
].
nB_h¥a_·rs
.
ŒafficMªag”
.
ueS”vedQueue
[HeNBS™es[iS™e].nB_h¥a_·rs.ŒafficMªag”.
iU£rS”ved
] = 
iUE
;

984 
HeNBS™es
[
iS™e
].
nB_h¥a_·rs
.
ŒafficMªag”
.
iU£rS”ved
++;

987 ià(
iS™e
 !ğ
HUEs
[
iUE
].
ueLTEd©a
.
iS”všgFemto
)

988 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
dRxšt
 = 
	`AdddBm
(HeNBSites[iSite].enB_lte_pars.dRxint,

989 
UEs
[
iUE
].
ueLTEd©a
.
dTxpow”
 - UEs[iUE].ueLTEd©a.
ãmtoD©a
[
iS™e
].
dP©hlossW¿µed
);

991 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
ŒafficMªag”
.
ueS”vedQueue
[HeNBS™es[iS™e].’B_Ée_·rs.ŒafficMªag”.
iU£rS”ved
] = 
iUE
;

992 
HeNBS™es
[
iS™e
].
’B_Ée_·rs
.
ŒafficMªag”
.
iU£rS”ved
++;

997 
	}
}

999 
	gWÜld
::
	$¡©sDowÆšk
(
nTTIs
)

1002 
i
, 
j
,

1003 
‹mp
;

1005 if(
nTTIs
 >ğ
W¬mUpTICKS
)

1006 
i
=0; i<
numMaüoUEs
; i++)

1007 
j
=0; j<
numBlocksDL
; j++){

1008 
‹mp
 = (è((10 * 
	`log10
(
UEs
[
i
].
SNR_DL
[
j
]))*10 + 500);

1009 ià(
‹mp
 >= 1001)

1010 
‹mp
 = 1000;

1011 ià(
‹mp
 < 0)

1012 
‹mp
 = 0;

1013 
¡©e
.
hi¡DLSNRMaüo
[
‹mp
] = state.histDLSNRMacro[temp] + 1;

1016 if(
nTTIs
 =ğ
TICKS
-1){

1017 
i
=0; i<
numMaüoUEs
; i++){

1018 
‹mp
 = (è(
UEs
[
i
].
ueLTEd©a
.
avDLThroughputs
 / (
TICKS
-
W¬mUpTICKS
));

1019 ià(
LTEBªdWidth
 == 20)

1020 
‹mp
 =emp/2;

1021 ià(
‹mp
 >= 10001)

1022 
‹mp
 = 10000;

1023 ià(
‹mp
 < 0)

1024 
‹mp
 = 0;

1025 
¡©e
.
hi¡DLU£rTh±Maüo
[
‹mp
] = state.histDLUserThptMacro[temp] + 1;

1029 if(
nTTIs
 >ğ
W¬mUpTICKS
)

1030 
i
=0; i<
numHomeUE
; i++)

1031 
j
=0; j<
numBlocksDL
; j++){

1032 
‹mp
 = (è((10 * 
	`log10
(
HUEs
[
i
].
SNR_DL
[
j
]))*10 + 500);

1033 ià(
‹mp
 >= 1001)

1034 
‹mp
 = 1000;

1035 ià(
‹mp
 < 0)

1036 
‹mp
 = 0;

1037 
¡©e
.
hi¡DLSNRFemto
[
‹mp
] = state.histDLSNRFemto[temp] + 1;

1040 if(
nTTIs
 =ğ
TICKS
-1){

1041 
i
=0; i<
numHomeUE
; i++){

1042 
‹mp
 = (è(
HUEs
[
i
].
ueLTEd©a
.
avDLThroughputs
 / (
TICKS
-
W¬mUpTICKS
));

1043 ià(
LTEBªdWidth
 == 20)

1044 
‹mp
 =emp/2;

1045 ià(
‹mp
 >= 10001)

1046 
‹mp
 = 10000;

1047 ià(
‹mp
 < 0)

1048 
‹mp
 = 0;

1049 
¡©e
.
hi¡DLU£rTh±Femto
[
‹mp
] = state.histDLUserThptFemto[temp] + 1;

1053 
	}
}

1055 
	gWÜld
::
	$¡©sU¶šk
(
nTTIs
)

1058 
i
, 
j
,

1059 
‹mp
;

1061 if(
nTTIs
 >ğ
W¬mUpTICKS
)

1062 
i
=0; i<
numMaüoUEs
; i++)

1063 
j
=0; j<
numBlocksDL
; j++){

1064 
‹mp
 = (è((10 * 
	`log10
(
UEs
[
i
].
SNR_UL
[
j
]))*10 + 500);

1065 ià(
‹mp
 >= 1001)

1066 
‹mp
 = 1000;

1067 ià(
‹mp
 < 0)

1068 
‹mp
 = 0;

1069 
¡©e
.
hi¡ULSNRMaüo
[
‹mp
] = state.histULSNRMacro[temp] + 1;

1072 if(
nTTIs
 =ğ
TICKS
-1){

1073 
i
=0; i<
numMaüoUEs
; i++){

1074 
‹mp
 = (è(
UEs
[
i
].
ueLTEd©a
.
avULThroughputs
 / (
TICKS
-
W¬mUpTICKS
));

1075 ià(
LTEBªdWidth
 == 20)

1076 
‹mp
 =emp/2;

1077 ià(
‹mp
 >= 10001)

1078 
‹mp
 = 10000;

1079 ià(
‹mp
 < 0)

1080 
‹mp
 = 0;

1081 
¡©e
.
hi¡ULU£rTh±Maüo
[
‹mp
] = state.histULUserThptMacro[temp] + 1;

1085 if(
nTTIs
 >ğ
W¬mUpTICKS
)

1086 
i
=0; i<
numHomeUE
; i++)

1087 
j
=0; j<
numBlocksDL
; j++){

1088 
‹mp
 = (è((10 * 
	`log10
(
HUEs
[
i
].
SNR_UL
[
j
]))*10 + 500);

1089 ià(
‹mp
 >= 1001)

1090 
‹mp
 = 1000;

1091 ià(
‹mp
 < 0)

1092 
‹mp
 = 0;

1093 
¡©e
.
hi¡ULSNRFemto
[
‹mp
] = state.histULSNRFemto[temp] + 1;

1096 if(
nTTIs
 =ğ
TICKS
-1){

1097 
i
=0; i<
numHomeUE
; i++){

1098 
‹mp
 = (è(
HUEs
[
i
].
ueLTEd©a
.
avULThroughputs
 / (
TICKS
-
W¬mUpTICKS
));

1099 ià(
LTEBªdWidth
 == 20)

1100 
‹mp
 =emp/2;

1101 ià(
‹mp
 >= 10001)

1102 
‹mp
 = 10000;

1103 ià(
‹mp
 < 0)

1104 
‹mp
 = 0;

1105 
¡©e
.
hi¡ULU£rTh±Femto
[
‹mp
] = state.histULUserThptFemto[temp] + 1;

1109 
	}
}

1112 
	gWÜld
::
	$moveU£rs
(
boŞ
 
bQu›t
) {

1114 
iUE
;

1116 
cout
 << "[runWorld] [World::moveUsers] Moving UEs\n";

1118 
iUE
 = 0; iUE < 
numMaüoUEs
; iUE++) {

1119 
UEs
[
iUE
].
	`move
();

1120 ià(!
bQu›t
) {

1121 
cout
 << "[runWÜld] [WÜld::doC–lS–eùiÚ] UE:" << 
iUE
 << "\t";

1122 
UEs
[
iUE
].
LoÿtiÚ
.
	`´št
();

1126 
	}
}

1128 
CoÜd
 
	gWÜld
::
	$§m¶eSeùÜ
(
£ùÜNum
) {

1130 
CoÜd


1131 
pos™iÚ
;

1133 
šd
;

1135 
th‘a
, 
co¡h‘a
, 
sšth‘a
, 
x
, 
y
;

1137 ià(
	`¿n1
(&
iS“d
) > 0.5)

1138 
šd
 = 2 * 
£ùÜNum
;

1140 
šd
 = 2 * 
£ùÜNum
 + 1;

1141 
th‘a
 = - 
šd
 * 60 * 
PI
 / 180;

1142 
co¡h‘a
=
	`cos
(
th‘a
);

1143 
sšth‘a
=
	`sš
(
th‘a
);

1144 
y
 = 
	`sq¹
(
	`¿n1
(&
iS“d
)è* 
dISD
 /2;

1145 
x
 = (0.577350269*
y
è* 
	`¿n1
(&
iS“d
);

1146 ià(
	`¿n1
(&
iS“d
) > 0.5)

1147 
x
 = -x;

1149 
pos™iÚ
.
dX
 = 
x
 * 
co¡h‘a
 - 
y
 * 
sšth‘a
;

1150 
pos™iÚ
.
dY
 = 
x
 * 
sšth‘a
 + 
y
 * 
co¡h‘a
;

1151  
pos™iÚ
;

1152 
	}
}

1154 
	gWÜld
::
	$abs
(
x
){

1155 ià(
x
 < 0.0)

1156 
x
 = - x;

1157  
x
;

1158 
	}
}

	@/home/lyang3/work/src_son/runWorld/world.h

1 
	~"runWÜld.h
"

2 
	~"geom‘ry.h
"

3 
	~"ÃtwÜkMªag”.h
"

4 
	~"bs.h
"

5 
	~"æoÜPÏn.h
"

6 
	~"¡dlib.h
"

8 
	~"¡©e.h
"

10 
	eD•loyMode
 {

11 
	mG’”®
,

12 
	mS³cific


15 
	eTe¡Mode
 {

16 
	mSINGLESITE0_SINGLESECTOR0
,

17 
	mSINGLESITE0_SINGLESECTOR1
,

18 
	mSINGLESITE0_SINGLESECTOR2


21 
	eD•loym’tTy³
 {

22 
	mSUBURBAN
,

23 
	mAPTBLOCKMODEL
,

24 
	mMETROFEMTO


27 
	eScheduËMode
 {

28 
	mRoundRobš
,

29 
	mMaxThroughput
,

30 
	mPrİÜtiÚ®Faœ
,

31 
	mMLWDF
,

32 
	mEXP
,

33 
	mFLS
,

34 
	mEXP_RULE
,

35 
	mLOG_RULE
,

36 
	mBe¡SNR


39 
	eShadowšgStyË
 {

40 
	mautoAndXüoss
,

41 
	mautoSh
,

42 
	munCÜr
,

43 
	m¿ndomSh


47 şas 
	cWÜld


49 
	mpublic
:

50 
WÜld
();

51 ~
WÜld
();

52 
š™Ÿli£N‘wÜk
(
dIÁ”S™eDi¡ªû
, 
D•loyMode
 
Dmode
);

53 
´štN‘wÜk
(
boŞ
 
bQu›t
, boŞ 
bFeOuut
);

54 
š™Ÿli£U£rs
();

55 
´štU£rs
(
boŞ
 
bQu›t
, boŞ 
bFeOuut
);

56 
cÚfigN‘wÜkTe¡Mode
(
Te¡Mode
 
Mode
);

57 
ÿlcPoštLos£s
(
CoÜd
 
coPošt
, 
C–lm—su»s
 
ûÎD©aPošt
[][
MACROSECTORS
], 
UED•loym’tTy³
 
D•loym’tTy³
);

58 
ÿlcP©hlos£s
(
boŞ
 
bQu›t
);

61 
ÿlcRa¡”Sÿn
(
dBšSize
, 
FloÜ¶ªs
* 
æoÜ¶ªs
);

62 
driveTe¡_Cœşe
(
dRadius
, 
CoÜd
 
coC’Œe
);

63 
driveTe¡_Pede¡rŸn
(
FloÜ¶ªs
 *
æoÜ¶ªs
);

65 
doC–lS–eùiÚ
(
boŞ
 
bQu›t
);

66 
doC–lAdmissiÚ
(
boŞ
 
bQu›t
);

67 
addIÁ”ã»nûToOth”C–ls
();

68 
¡©sDowÆšk
(
nTTIs
);

69 
¡©sU¶šk
(
nTTIs
);

70 
moveU£rs
(
boŞ
 
bQu›t
);

71 
ÿlcShadowšg
(
boŞ
 
bQu›t
);

73 
CoÜd
 
§m¶eSeùÜ
(
£ùÜNum
);

74 
š™Ÿli£HomeN‘wÜk
(
dIÁ”S™eDi¡ªû
);

75 
š™Ÿli£HomeU£rs
();

76 
abs
(
x
);

77 
ÿlcSnifãr
(
CoÜd
 
coPošt
, 
C–lSnifãr
 
ûÎD©aPt
[][
MACROSECTORS
]);

78 
ÿlcFemtoPoštLos£s
(
UE
 
ue
, 
C–lm—su»s
 *
ãmtoD©aPt
);

79 
CoÜd
 
ÿlcP’‘¿tiÚPošt
(
UE
 
ue
, 
FemtoS™e
 
ãmtoBS
);

81 
DlScheduË
(
iDrİ
, 
nTTIs
);

82 
In™Fadšg
( );

83 
DlFadšg
(
nTTIs
);

85 
UlFadšg
(
nTTIs
);

86 
UlScheduË
(
iDrİ
, 
nTTIs
);

89 
‹¡LoÿtiÚUE
(
UE
 *
ue
, 
FloÜ¶ªs
* 
æoÜ¶ª
);

90 
š™Ÿli£M‘roN‘wÜk
(
dIÁ”S™eDi¡ªû
);

91 
ÿlcM‘roPoštLos£s
(
UE
 
ue
, 
C–lm—su»s
 *
m‘roD©aPt
, 
FloÜ¶ªs
* 
æoÜ¶ª
);

92 
ÿlcShadowšgS³cific
(
dF»q
, 
Com¶ex
 
¬—LeáLowe¡
, Com¶ex 
¬—RightUpmo¡
, 
»s
, 
ShadowšgStyË
 
shadowšgStyË
, ** 
shadowšgM©rix
);

94 
p2pP’‘¿tiÚLoss
(
CoÜd
 
coUE
, 
heightUE
, CoÜd 
coBS
, 
heightBS
, 
FloÜ¶ªs
* 
æoÜ¶ª
);

96 
MuÉiC–l
 (
nbC–l
, 
¿dius
,

97 
nbUE
,

98 
nbVoIP
, 
nbVideo
, 
nbBE
, 
nbCBR
,

99 
sched_ty³
,

100 
äame_¡ruù
,

101 
¥“d
,

102 
maxD–ay
, 
videoB™R©e
,

103 
£ed
);

105 
S‹


106 
	m¡©e
;

108 
	m´iv©e
:

110 
numMaüoS™es
, 
	mnumMaüo£ùÜs
, 
	mnumMaüoUEs
;

113 
	mdISD
;

114 
CoÜd


115 
	mdi¥ÏûVec
[
SITES
];

116 
Ba£S™e


117 
	mS™es
[
SITES
];

118 
UE


119 
	mUEs
[1000];

120 
N‘wÜkMªag”


121 
	mNWMªag”
;

122 
ScheduËMode


123 
	mSchedMode
;

125 
ChªÃl


126 
	mchªÃl
;

130 
	mnumHeNB
, 
	mnumHomeUE
, 
	miS“d
, 
	mNsymsPDCCH
, 
	m§m¶esP”Block
, 
	mnumHUEsP”HeNB
;

131 
D•loym’tTy³


132 
	md•loym’tTy³
;

134 
	mReùGridDim’siÚX
, 
	mReùGridDim’siÚY
, 
	mA±NumFloÜs
;

136 
	m´obAùiveA·¹m’t
;

138 
	mÙh”CÚŒMax
,

139 
	mx¿ngeW®ls
, 
	my¿ngeW®ls
,

140 
	mx¿ngeFemtoENB
, 
	my¿ngeFemtoENB
,

141 
	mx¿ngeFemtoUE
, 
	my¿ngeFemtoUE
;

142 
FemtoS™e


143 
	mHeNBS™es
[
HeNBS
];

146 
M‘roS™e


147 
	mm‘roS™es
[
M‘rÛNBS
];

149 
	mnumM‘roBS
;

150 
UE


151 
	mHUEs
[
HOMEUSERS
];

154 
	mgašFacDL
,

155 
	mmšTh±T¬g‘DL
,

156 
	mmšTh±T¬g‘UL
,

157 
	mQOSçùÜ
, 
	mpÙRedFac
,

158 
	mULschdAÍha
,

159 
	mmšP”AÁPwrP”UE
;

	@
1
.
0
141
9427
/home/lyang3/work/src_son/runWorld/Application/Application.cpp
/home/lyang3/work/src_son/runWorld/Application/Application.h
/home/lyang3/work/src_son/runWorld/Application/CBR.cpp
/home/lyang3/work/src_son/runWorld/Application/CBR.h
/home/lyang3/work/src_son/runWorld/Application/InfiniteBuffer.cpp
/home/lyang3/work/src_son/runWorld/Application/InfiniteBuffer.h
/home/lyang3/work/src_son/runWorld/Application/Trace/default-trace.h
/home/lyang3/work/src_son/runWorld/Application/TraceBased.cpp
/home/lyang3/work/src_son/runWorld/Application/TraceBased.h
/home/lyang3/work/src_son/runWorld/Application/VoIP.cpp
/home/lyang3/work/src_son/runWorld/Application/VoIP.h
/home/lyang3/work/src_son/runWorld/Application/application-sink.cpp
/home/lyang3/work/src_son/runWorld/Application/application-sink.h
/home/lyang3/work/src_son/runWorld/CqiManager/cqi-manager.cpp
/home/lyang3/work/src_son/runWorld/CqiManager/cqi-manager.h
/home/lyang3/work/src_son/runWorld/CqiManager/fullband-cqi-manager.cpp
/home/lyang3/work/src_son/runWorld/CqiManager/fullband-cqi-manager.h
/home/lyang3/work/src_son/runWorld/CqiManager/wideband-cqi-manager.cpp
/home/lyang3/work/src_son/runWorld/CqiManager/wideband-cqi-manager.h
/home/lyang3/work/src_son/runWorld/QoS/QoSForEXP.cpp
/home/lyang3/work/src_son/runWorld/QoS/QoSForEXP.h
/home/lyang3/work/src_son/runWorld/QoS/QoSForFLS.cpp
/home/lyang3/work/src_son/runWorld/QoS/QoSForFLS.h
/home/lyang3/work/src_son/runWorld/QoS/QoSForM_LWDF.cpp
/home/lyang3/work/src_son/runWorld/QoS/QoSForM_LWDF.h
/home/lyang3/work/src_son/runWorld/QoS/QoSParameters.cpp
/home/lyang3/work/src_son/runWorld/QoS/QoSParameters.h
/home/lyang3/work/src_son/runWorld/RadioBearer/radio-bearer-instance.cpp
/home/lyang3/work/src_son/runWorld/RadioBearer/radio-bearer-instance.h
/home/lyang3/work/src_son/runWorld/RadioBearer/radio-bearer-sink.cpp
/home/lyang3/work/src_son/runWorld/RadioBearer/radio-bearer-sink.h
/home/lyang3/work/src_son/runWorld/RadioBearer/radio-bearer.cpp
/home/lyang3/work/src_son/runWorld/RadioBearer/radio-bearer.h
/home/lyang3/work/src_son/runWorld/bs.cpp
/home/lyang3/work/src_son/runWorld/bs.h
/home/lyang3/work/src_son/runWorld/channel.cpp
/home/lyang3/work/src_son/runWorld/channel.h
/home/lyang3/work/src_son/runWorld/fading.cpp
/home/lyang3/work/src_son/runWorld/floorPlan.cpp
/home/lyang3/work/src_son/runWorld/floorPlan.h
/home/lyang3/work/src_son/runWorld/geometry.cpp
/home/lyang3/work/src_son/runWorld/geometry.h
/home/lyang3/work/src_son/runWorld/homeNetwork.cpp
/home/lyang3/work/src_son/runWorld/metroNetwork.cpp
/home/lyang3/work/src_son/runWorld/mobility/ConstantPosition.cpp
/home/lyang3/work/src_son/runWorld/mobility/ConstantPosition.h
/home/lyang3/work/src_son/runWorld/mobility/Mobility.cpp
/home/lyang3/work/src_son/runWorld/mobility/Mobility.h
/home/lyang3/work/src_son/runWorld/mobility/RandomDirection.cpp
/home/lyang3/work/src_son/runWorld/mobility/RandomDirection.h
/home/lyang3/work/src_son/runWorld/mobility/RandomWalk.cpp
/home/lyang3/work/src_son/runWorld/mobility/RandomWalk.h
/home/lyang3/work/src_son/runWorld/mobility/RandomWaypoint.cpp
/home/lyang3/work/src_son/runWorld/mobility/RandomWaypoint.h
/home/lyang3/work/src_son/runWorld/networkManager.cpp
/home/lyang3/work/src_son/runWorld/networkManager.h
/home/lyang3/work/src_son/runWorld/pathloss.cpp
/home/lyang3/work/src_son/runWorld/pathloss.h
/home/lyang3/work/src_son/runWorld/pathloss_test.cpp
/home/lyang3/work/src_son/runWorld/pathloss_test.h
/home/lyang3/work/src_son/runWorld/protocolStack/mac/AMCModule.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/mac/AMCModule.h
/home/lyang3/work/src_son/runWorld/protocolStack/mac/enb-mac-entity.cc
/home/lyang3/work/src_son/runWorld/protocolStack/mac/enb-mac-entity.h
/home/lyang3/work/src_son/runWorld/protocolStack/mac/harq-manager.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/mac/harq-manager.h
/home/lyang3/work/src_son/runWorld/protocolStack/mac/mac-entity.cc
/home/lyang3/work/src_son/runWorld/protocolStack/mac/mac-entity.h
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/delay-edd-rule-downlink-packet-scheduler.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/delay-edd-rule-downlink-packet-scheduler.h
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/dl-exp-packet-scheduler.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/dl-exp-packet-scheduler.h
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/dl-fls-packet-scheduler.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/dl-fls-packet-scheduler.h
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/dl-mlwdf-packet-scheduler.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/dl-mlwdf-packet-scheduler.h
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/dl-pf-packet-scheduler.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/dl-pf-packet-scheduler.h
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/downlink-packet-scheduler.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/downlink-packet-scheduler.h
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/exp-rule-downlink-packet-scheduler.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/exp-rule-downlink-packet-scheduler.h
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/log-rule-downlink-packet-scheduler.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/log-rule-downlink-packet-scheduler.h
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/mw-rule-downlink-packet-scheduler.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/mw-rule-downlink-packet-scheduler.h
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/packet-scheduler.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/mac/packet-scheduler/packet-scheduler.h
/home/lyang3/work/src_son/runWorld/protocolStack/mac/ue-mac-entity.cc
/home/lyang3/work/src_son/runWorld/protocolStack/mac/ue-mac-entity.h
/home/lyang3/work/src_son/runWorld/protocolStack/nas/nas-entity.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/nas/nas-entity.h
/home/lyang3/work/src_son/runWorld/protocolStack/packet/Header.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/packet/Header.h
/home/lyang3/work/src_son/runWorld/protocolStack/packet/Packet.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/packet/Packet.h
/home/lyang3/work/src_son/runWorld/protocolStack/packet/PacketTAGs.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/packet/PacketTAGs.h
/home/lyang3/work/src_son/runWorld/protocolStack/packet/packet-burst.cc
/home/lyang3/work/src_son/runWorld/protocolStack/packet/packet-burst.h
/home/lyang3/work/src_son/runWorld/protocolStack/pdcp/pdcp-entity.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/pdcp/pdcp-entity.h
/home/lyang3/work/src_son/runWorld/protocolStack/protocol-stack.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/protocol-stack.h
/home/lyang3/work/src_son/runWorld/protocolStack/protocols/TransportProtocol.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/protocols/TransportProtocol.h
/home/lyang3/work/src_son/runWorld/protocolStack/rlc/am-rlc-entity.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/rlc/am-rlc-entity.h
/home/lyang3/work/src_son/runWorld/protocolStack/rlc/am-state-variables.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/rlc/am-state-variables.h
/home/lyang3/work/src_son/runWorld/protocolStack/rlc/amd-record.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/rlc/amd-record.h
/home/lyang3/work/src_son/runWorld/protocolStack/rlc/rlc-entity.cc
/home/lyang3/work/src_son/runWorld/protocolStack/rlc/rlc-entity.h
/home/lyang3/work/src_son/runWorld/protocolStack/rlc/tm-rlc-entity.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/rlc/tm-rlc-entity.h
/home/lyang3/work/src_son/runWorld/protocolStack/rlc/um-rlc-entity.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/rlc/um-rlc-entity.h
/home/lyang3/work/src_son/runWorld/protocolStack/rrc/ho/handover-entity.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/rrc/ho/handover-entity.h
/home/lyang3/work/src_son/runWorld/protocolStack/rrc/ho/ho-manager.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/rrc/ho/ho-manager.h
/home/lyang3/work/src_son/runWorld/protocolStack/rrc/ho/position-based-ho-manager.cpp
/home/lyang3/work/src_son/runWorld/protocolStack/rrc/ho/position-based-ho-manager.h
/home/lyang3/work/src_son/runWorld/protocolStack/rrc/rrc-entity.cc
/home/lyang3/work/src_son/runWorld/protocolStack/rrc/rrc-entity.h
/home/lyang3/work/src_son/runWorld/random.cpp
/home/lyang3/work/src_son/runWorld/random.h
/home/lyang3/work/src_son/runWorld/runWorld.cpp
/home/lyang3/work/src_son/runWorld/runWorld.h
/home/lyang3/work/src_son/runWorld/scheduling.cpp
/home/lyang3/work/src_son/runWorld/shadowing.cpp
/home/lyang3/work/src_son/runWorld/sim/networkManager.cpp
/home/lyang3/work/src_son/runWorld/sim/networkManager.h
/home/lyang3/work/src_son/runWorld/state.cpp
/home/lyang3/work/src_son/runWorld/state.h
/home/lyang3/work/src_son/runWorld/ue.cpp
/home/lyang3/work/src_son/runWorld/ue.h
/home/lyang3/work/src_son/runWorld/ueSystemProcedures.cpp
/home/lyang3/work/src_son/runWorld/world.cpp
/home/lyang3/work/src_son/runWorld/world.h
